<dom-module id="fc-passage-display">	
<template>
<style>
	
		div.columnContainer{
			overflow-y: scroll;
		}
		div.passageContainer{ 
			min-width: 310px;
			max-width: 1450px !important;
			margin: 48px;
		}
		.highlighted {
			background: yellow;
		}
		div.blurb{
			line-height: 1.2;
			font-size: 1.25em;
			font-family: merriweather;
			font-weight: 500;
			font-style: italic;
			display: block;
		}
		
</style>
<!--double-column line-number and passage vertical container--> 
<div id="judge9" style="width: 98%;">
	<div id="noJudge4" class="layout vertical flex container left passageContainer" style="overflow-y:scroll;">
	<!--blurb full width container-->
		<div class="layout horizontal blurb" style="margin: 12px 24px 0px 24px;min-width: 240px !important; max-width: 680px !important; max-height: 140px;">
			{{passageBlurb}}
		</div>

	<!--single column container-->
			
		<!-- end-of-column-1 line number and text container-->
		<div id="singleColumnContainer" class="layout horizontal container columnContainer" hidden="{{showingSecondColumn}}" style="padding-right: 8px;">
					
					<fc-single-column-layout id="singleDisplay" the-content='{{passageArray}}'hidden='{{showingSecondColumn}}' last-word-index='{{numWords}}'>
					</fc-single-column-layout>
		
		</div>



		<div id="doubleColumnContainer" class="layout horizontal flex container" hidden='{{!showingSecondColumn}}'>
					
					<fc-double-column-layout id="doubleDisplay" the-content='{{passageArray}}' shown='{{showingSecondColumn}}' last-word-index='{{numWords}}'>
					</fc-double-column-layout>
		
		</div>	
<!--End of top container horizontal-->
	</div>
<!--End of Vertical passage container-->
</div>
</template>
<script>
Polymer({
	is:'fc-passage-display',
	behaviors: [Polymer.IronResizableBehavior],
	properties: {
		passagePath: {
			type: String,
			value: 'new_Test_1',
			notify: true,
			reflectToAttributes: true
		},
		passageRootPath: {
			type: String,
			value: function(){
				return 'https://focusedstaging1.firebaseio.com/passagesDestinations';
				},
			notify: true,
			reflectToAttributes: true
		},
		passageFullPath: {
			type: String,
			value: '',
			notify: true,
			reflectToAttributes: true
		},
		passageArray:{
			type: Array, 
			value:[],
			notify: true 
		},
		passagesArray:{
			type: Array, 
			value: function(){
				return []
			},
			notify: true 
		},
		
		passageTitle: {
			type: String, 
			value: 'Focused Reading Passage',
			notify: true,
			reflectToAttributes: true
		},

		passageBlurb:{
			type: String,
			value: 'get the blurb',
			notify: true
		},
		lastWordIndex: {
			type: Number,
			value: 550,
			notify: true
		},
		showingSecond: {
			type: Boolean,
			value: false,
			notify: true, 
			reflectToAttributes: true
		},
		
	},
	created: function(){


	},

	ready: function(){
				self=this;
				self.passagesArray=[];
				var ref= new Firebase(self.passageRootPath);
				ref.on("child_added", function(snap){
  							console.log("added", snap.key());
							if(snap.key()=='new_Test_1')
							{
								self.set('passageArray', snap.val());
								console.log(self.passageArray);
								self.passageBlurb=self.passageArray[1].passageBlurb;
								self.numWords=self.passageArray.length;
								self.$.singleDisplay.lastWordIndex=self.numWords;
								self.$.doubleDisplay.lastWordIndex=self.numWords;
								self.$.doubleDisplay.splitRatio=Math.ceil(self.numWords*.618);
								self.$.doubleDisplay.firstColumnLastWordIndex={"ratio": self.$.doubleDisplay.splitRatio, "lineNumberStart": 1, "lineNumberEnd": 53};
								self.$.doubleDisplay.secondColumnFirstWordIndex={"ratio": self.$.doubleDisplay.firstColumnLastWordIndex + 1, "lineNumberStart": 54, "lineNumberEnd": 87};

							}
		
				});
				
				console.log(this.passageArray);		
				this.$.singleDisplay.theContent=this.passageArray;
				this.$.doubleDisplay.theContent=this.passageArray;
	},

	atttached: function(){		
		this.$.singleDisplay.theContent=this.passageArray;
		this.$.doubleDisplay.theContent=this.passageArray;
		this.numWords=this.passageArray.length;
		this.set('passageBlurb',this.passageArray[1].passageBlurb);
		this.passageBlurb=this.passageArray[1].passageBlurb;
		this.notifyResize;
	},

	notifyResize: function(){
		this.setUp();
	},
	
	setUp: function()
	{
		this.screenTrueHeight =  (window.innerHeight-320);
		this.$.singleDisplay.singleWidth = this.$.judge9.clientWidth;
		if(this.$.noJudge4.clientWidth >= 670 && this.screenTrueHeight>=440)
			{
				this.showingSecondColumn = true;
				this.$.singleDisplay._notifyResize(true);
				this.$.doubleDisplay.notifyResize(true);
			}	
		else
			{ 
				this.showingSecondColumn = false;
				this.$.singleDisplay._notifyResize(false);
				this.$.doubleDisplay.notifyResize(false);
			}
		}

});
</script>
</dom-module>
