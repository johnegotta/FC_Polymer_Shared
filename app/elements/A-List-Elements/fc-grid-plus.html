<dom-module id="fc-grid-plus">
	<template>
		<style is="custom-style">
			.grid-box{
			   width: 400px;
			   height: 480px;
			   padding: 3px;
			   margin: 3px;
			   display: block;
			   color: black;
			   background: white;
			   overflow-x: hidden;
			 }
			.grid-image{
				float: left;
				padding: 3px;
				height: 72px;
				color: black;
				width: 73px;
				background: aliceblue;
				display: block;
			}
			.grid-holder{
			   width: calc(95%-85px);
			   max-height: calc(98vh-64px);
			   overflow: scroll;
			   margin: 16px;
			}
		</style>
		<firebase-collection id="FBscoreTwo" order-by-child="student" limit-to-first="8" data='{{fcscores}}' location='https://focusedstaging1.firebaseio.com/test_results'></firebase-collection>
		<firebase-collection id="studentsFB" order-by-child="last_name" limit-to-first="8" data='{{stus}}' location='https://focusedstaging1.firebaseio.com/students'>
		</firebase-collection>
		<div class="vertical layout wrap grid-holder center center-justified">
		  
			<paper-input id="searcher" label="Search" value="{{searchString}}" placeholder="Search Grid...">
				</paper-input>
				

				<paper-material style="max-width: calc(100%-128px); height: 100%; border: 9px ridge silver;" class="horizontal layout wrap container center center-justified">
				<template is="dom-repeat" class="horizontal layout wrap container center center-justified" items="{{stus}}" as="stu" order-by-key="true">
				
						<fc-cell-creator input="{{stu.last_name}}" class="horizontal layout wrap container center center-justified" name="cells" fclabel="{{stu.first_name}}" dragable="true" on-dragstart="handleDragStart" on-dragover="allowDrop" on-drop="handleDrop">
						</fc-cell-creator>
						<fc-cell-creator id="studentkeys" input="{{stu.__firebaseKey__}}" name="cells" onfocus="_filter" fclabel="{{stu.first_name}}" dragable="true" on-dragstart="handleDragStart" on-dragover="allowDrop" on-drop="handleDrop">
						</fc-cell-creator>
				</template>
				</paper-material>
				<hr>

					<div class="layout horizontal center center-justified row wrap flex" style="max-width: calc(100%-128px); height: 100%; border: 9px ridge silver;">
						<template is="dom-repeat" items="{{superGridItemHolderArray}}" filter="{{filter(stu.__firebaseKey__)}}">
							<fc-cell-creator input='{{item.val}}' name="cells" draggable="true" on-dragstart="handleDragStart" on-dragover="allowDrop" on-drop="handleDrop" fclabel="{{item.key}}">
							</fc-cell-creator>
							<span hidden="true">{{item.fcid}}</span>
						</template>
					</div>	

				</div>

<!--<div class="horizontal layout center center-justified" style="max-width: 100%; height: 100%; border: 6px ridge silver;">-->
							
						

<!--SHOULD BE PART OF THE ASSISTANT OR AN ASSISANT LIKE FUNCTION OR ITS OWN ELEMENT
		NEW ELEMENT. NEW ELEMENT. ASSISTANT FEATURE???  NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		-->
	<paper-dialog id="tada" no-cancel-on-outside-click="true">
		<div id="betterTada" style="min-height: 120px; min-width: 280px">
			<ul id="superTada">
		
			</ul>
		</div>
		<div class="buttons" style="height: 65px; padding: 8px 8px 8px 14px;" class="horizontal layout left-justified">
			<paper-button on-tap="conttap">Confirm Save</paper-button>
			<paper-button on-tap="back">Revert Array</paper-button>
			<paper-button dialog-dismiss on-tap="__clear">Continue Working</paper-button>
		</div>
	</paper-dialog>
</template>
<script>
Polymer({
  is:"fc-grid-plus",
  properties: {
    defaultPath: "https://focusedstaging1.firebaseio.com/test_results",
    pathOne: "https://focusedstaging1.firebaseio.com/test_results", 
    pathTwo: String, 
    gridWidthPx: Number, 
    gridHeightPx: Number,
    scrollX: Boolean,
    scrollY: Boolean,
    isDnD: Boolean,
    studentone: {
    	type: String,
    	notify: true,
    	reflectToAttributes: true
	},
    fillViewPort: Boolean,
    gridImageOne: String,
    gridImageTwo: String,
    griditemNumber: {
	   type: Number,
	   notify: true,
	   reflectToAttributes: true
	 },
	studentone:String,
    griditemArray: {
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    superGridItemHolderArray: {
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    gridRows: {
	 type: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    testsByStudentViewArray: {
    	type: Array,
	 	value: [],
	 	notify: true,
	 	reflectToAttributes: true
    },
    superOrderArray: {
	 type: Array,
	 value: [],
	 notify: true,
	 reflectToAttributes: true
	 },
	numbOfStudentsArray: {
	 	type: Array,
	 	value: [],
	 	notify: true,
	 	reflectToAttributes: true
	 },
    gridImageOne: '',
    gridImageTwo: '',
    searchString: {
	 type: String,
	 notify: true,
	 reflectToAttributes: true
    },
      fcid: {
		 type: Array,
		 value: [],
		 notify: true,
		 reflectToAttributes: true
	 },
    currentDragger: Object,
    reflectToAttributes: true,
    notify: true

   },

  updateFilter: function(argObj){
    //console.log(argObj);
    this.searchString = argObj.name;
  },

   doFilter: function(e){

  	console.log(e);
   return function(argItem){
	 	var itemname = argItem.student;
	 	
	 	var search = e;
	 	if (itemname !==undefined && search !=='') 
	 	{	console.log(itemname);
	 		console.log(search);
	 		return (itemname.includes(search) > -1);
	 	}
    	};
  },

  __filter: function(e2){
  return function(argItem){
	 	var itemname = argItem.student;
	 	/*var search = e2;
	 	if (itemname !==undefined && search !=='') 
	 	{	var tagVal = argItem.val;
	 		return (tagVal.includes(search) > -1);
	 	}
	 	else*/ return true;
	 	 
    	};
  },

created: function(){
/*	 
	  var setFB2 = new Firebase("https://focusedstaging1.firebaseio.com/students"); 
	    var self2 = this;
	    setFB2.on("value", function(snap){
	    var theSet2 = snap.val();
		console.log(theSet2);
	    var counter2 = 0;
		var keyfake2 = Object.keys(theSet2);
		var theSetLimit2 = keyfake2.length;
		var record2 = theSet2[keyfake2[0]];
		//console.log(record);
		var keys2 = Object.keys2(record2);
		var numbEntries2 = keys2.length; 
		for(counterPrime2=0; counterPrime2<theSetLimit2; counterPrime2++){
			var counter = 0;	
	     for(counter = 0; counter < numbEntries; counter++){

			self2.push("testsByStudentViewArray",{FCID: keyfake2[counterPrime2], Full_Name: theSet2[keyfake2[counterPrime2]].first_name + " " + theSet2[keyfake2[counterPrime2]].last_name});
			console.log(theSet2[keyfake2[counterPrime2]].first_name + " " + theSet2[keyfake2[counterPrime2]]);
		}
	}
	});

*/
	    var setFB = new Firebase("https://focusedstaging1.firebaseio.com/test_results"); 
	    var self = this;
	    setFB.on("value", function(snap){
	    var theSet = snap.val();
		//console.log(theSet);
	    var counterPrime = 0;
		var keyfake = Object.keys(theSet);
		var theSetLimit = keyfake.length;
		var record = theSet[keyfake[0]];
		//console.log(record);
		var keys = Object.keys(record);
		var numbEntries = keys.length; 
		for(counterPrime=0; counterPrime<theSetLimit; counterPrime++){
		var counter = 0;	
	     for(counter = 0; counter < numbEntries; counter++){
					self.push('superGridItemHolderArray', {val: theSet[keyfake[counterPrime]][keys[counter]], key: keys[counter], student:theSet[keyfake[counterPrime]].student});
		   		
		   	}
		}
	return self.susuperGridItemHolderArray;
	});

},
		

handleDragStart: function(e) {
	 e.dataTransfer.setData("fcdata", JSON.stringify(e.model.item));
	 console.log("drag begun for ");
	 console.log(e.model.item);
	 var cell = e.target;
	 console.log(e.target);
	 while(cell.nodeName != "FC-CELL-CREATOR")
	 {
	   console.log(cell);
	   cell = cell.parentNode;
	 }
	 document.querySelector("#dataAdmin").currentDragger = cell;
    }, 
allowDrop: function (e) {
	 e.preventDefault();
	 console.log("drag over");
    },

handleDrop: function(e){
    //console.log(e.model.item);
    //console.log(e);
    var cell = e.target;
    var i = 0;
    while(cell.nodeName != "FC-CELL-CREATOR")
    {
	 cell = cell.parentNode;
	  console.log("in loop" + cell);
    }
    console.log(cell);
    //console.log("just droppped " + e.target + " on " + e.model.item.name);
    
    var tempKey = cell.fclabel;
    var tempVal = cell.input;
    var dataObj = JSON.parse(e.dataTransfer.getData("fcdata"));
    cell.fclabel = dataObj.key;
    cell.input = dataObj.val;
    //console.log(this.currentDragger);
    var dashB = document.querySelector("#dataAdmin"); 
    dashB.currentDragger.fclabel = tempKey;
    dashB.currentDragger.input = tempVal;

  }, 

  __assign: function(){
    var i=0;
    for(i=0; i < this.griditemArray.length; i++){
    var namenow = this.griditemArray[i].name;
    console.log(i + " is the index number of " + namenow);
    var tadatwo = this.$.superTada;
    var tadathree = document.createElement("li");
    Polymer.dom(tadathree).innerHTML = "Index position " + i + " now is set to " + namenow + ". ";
    Polymer.dom(tadatwo).appendChild(tadathree);
    };
    this.$.tada.open();
  },

  __clear: function(){
    var myList  = this.$.superTada;
    Polymer.dom(myList).innerHTML = '';
    console.log(myList);
  }

});
</script>
</dom-module>