<dom-module id="fc-grid-card-portrait">
	<template>
		<style is="custom-style">
			.grid-box{
			   width: 340px;
			   height: 480px;
			   padding: 3px;
			   margin: 3px;
			   display: block;
			   color: black;
			   background: white;
			   overflow-x: hidden;
			 }
			.grid-image{
				float: left;
				padding: 3px;
				height: 72px;
				color: black;
				width: 73px;
				background: aliceblue;
				display: block;
			}
			.grid-holder{
			   width: calc(95%-85px);
			   max-height: calc(98vh-64px);
			   overflow: scroll;
			   margin: 16px;
			}
		</style>
			<!--taken care of by dashboard three-->
			<!--my thinking here is that scopes us nicely, reveals little, and makes our jobs way easier.  The grid goes up two levels and this is easy.-->
			<firebase-collection id="scores" order-by-child="student" data='{{items}}' equal-to="jkdshi283794" location='https://focusedstaging1.firebaseio.com/test_results'></firebase-collection>
		<div class="vertical layout wrap grid-holder center center-justified">
		    <div class="horizontal layout"> 
				<paper-input id="searcher" label="Search" value="{{searchString}}" placeholder="Search Grid...">
				</paper-input>
				<paper-button on-tap="__assign">Assign New Positions
				</paper-button>
				<paper-button on-tap="go">GO!!!!
				</paper-button>
			</div>
			<fc-call-card-input-model-one>
					<fc-content-holder input-names="cells" class="horizontal layout container wrap">
<!--THIS SHOULD BE A FACTORY IMPLIMENTATION OF THE CELLS INTO WHEREVER WE NEED THEM. THIS MAKES THE MOST SENSE-->			
						<template is="dom-repeat" items="{{griditemArray}}" filter="{{doFilter(searchString)}}">
							<fc-cell-creator name="cells" draggable="true" input='{{item.val}}' fclabel='{{item.key}}' on-dragstart="handleDragStart" on-dragover="allowDrop" on-drop="handleDrop">
							</fc-cell-creator>
				  		</template>
<!--The factoryImpl ends here; perhaps factImpl the holder first, and fact impl the mini headers.  You have the arsenol of a few of those items in the grid/dashboard/modal/splitter framework and we need not much else. It remains dynamic but has binding.  It seems good. We will see.-->
					</fc-content-holder>

			</fc-call-card-input-model-one>
		</div>
<!--SHOULD BE PART OF THE ASSISTANT OR AN ASSISANT LIKE FUNCTION OR ITS OWN ELEMENT
		NEW ELEMENT. NEW ELEMENT. ASSISTANT FEATURE???  NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		-->
	<paper-dialog id="tada" style="min-height:440px;" no-cancel-on-outside-click="true">
		<div id="betterTada" style="min-height: 220px; min-width: 280px;">
			<ul id="superTada">
		
			</ul>
		</div>
		<div class="buttons" style="height: 65px; padding: 8px 8px 8px 14px;" class="horizontal layout left-justified">
			<paper-button on-tap="conttap">Confirm Save</paper-button>
			<paper-button on-tap="__revertArray">Revert Array</paper-button>
			<paper-button dialog-dismiss on-tap="__clear">Continue Working</paper-button>
		</div>
	</paper-dialog>

	<div id="cuck">
	</div>
</template>
<script>
Polymer({
  is:"fc-grid-card-portrait",
  properties: {
    defaultPath: "",
    pathOne: "https://focusedstaging1.firebaseio.com/test_results", 
    pathTwo: String, 
    gridWidthPx: Number, 
    gridHeightPx: Number,
    scrollX: Boolean,
    scrollY: Boolean,
    isDnD: Boolean,
    fillViewPort: Boolean,
    gridImageOne: String,
    gridImageTwo: String,
    keyNames: {
	   type: Array,
	   value: Array,
	   notify: true,
	   reflectToAttributes: true
	 },
    griditemArray: {
	 type: Array,
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    gridHolderArray: {
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    gridRows: {
	 type: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    oldGridArray: {
	 type: Array,
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
	 },
    gridImageOne: '',
    gridImageTwo: '',
    searchString: {
	 type: String,
	 value: ''
    },
      fcid: {
		 type: Array,
		 value: [],
		 notify: true,
		 reflectToAttributes: true
	 },
    currentDragger: Object,
    reflectToAttributes: true,
    notify: true

   },

  updateFilter: function(argObj){
    console.log(argObj);
    this.searchString = argObj.name;
  },

  doFilter: function(e){
  	//console.log(e);
    //return function(argItem){
    //console.log(argItem);
	//var itemval = argItem.val;
	//var search = e.toLowerCase();
	//return (itemval.indexOf(search) > -1) 
    //};
  },

ready: function(){
	this.searchString = "";
	this.griditemArray = [];	
},
  
go: function(){
		var arrayToPrint = this.$.scores.data;
		console.log(this.$.scores.data);
		//console.log(arrayToPrint);
		var record = arrayToPrint[0];
		var keys = Object.keys(record);
		var numbEntries = keys.length; 
		var counter = 0;	
	     for(counter=0; counter < numbEntries; counter++){
					this.push('griditemArray', {val: arrayToPrint[0][keys[counter]], key: keys[counter]});
					this.push('oldGridArray', {val: arrayToPrint[0][keys[counter]], key: keys[counter]});
					this.push('keyNames', keys[counter]);

		   	}
		this.pop('griditemArray');
		//this.pop('oldGridArray');
		
		console.log(this.oldGridArray);
				
    		},


handleDragStart: function(e) {
	 e.dataTransfer.setData("fcdata", JSON.stringify(e.model.item));
	 console.log("drag begun for ");
	 console.log(e.model.item);
	 var cell = e.target;
	 console.log(e.target);
	 while(cell.nodeName != "FC-CELL-CREATOR")
	 {
	   console.log(cell);
	   cell = cell.parentNode;
	 }
	 document.querySelector("#dataAdmin").currentDragger = cell;
    }, 
allowDrop: function (e) {
	 e.preventDefault();
	 console.log("drag over");
    },
handleDrop: function(e){
    //console.log(e.model.item);
    //console.log(e);
    var cell = e.target;
    var i = 0;
    while(cell.nodeName != "FC-CELL-CREATOR")
    {
	 cell = cell.parentNode;
	  console.log("in loop" + cell);
    }
    console.log(cell);
    //console.log("just droppped " + e.target + " on " + e.model.item.name);
    
    var tempKey = cell.fclabel;
    var tempVal = cell.input;
    var dataObj = JSON.parse(e.dataTransfer.getData("fcdata"));
    cell.fclabel = dataObj.key;
    cell.input = dataObj.val;
    //console.log(this.currentDragger);
    var dashB = document.querySelector("#dataAdmin"); 
    dashB.currentDragger.fclabel = tempKey;
    dashB.currentDragger.input = tempVal;

  }, 

  __assign: function(){
    var i=0;
    for(i=0; i < this.griditemArray.length; i++){
    var valnow = this.griditemArray[i].val;
    var keynow = this.griditemArray[i].key;
    console.log(i + " is the index number of key " + keynow + " which has a value of " + valnow);
    var tadatwo = this.$.superTada;
    var tadathree = document.createElement("li");
    Polymer.dom(tadathree).innerHTML = "Index position " + keynow + " now is set to " + valnow + ". ";
    Polymer.dom(tadatwo).appendChild(tadathree);
    };
    this.$.tada.open();
  },

  __clear: function(){
    var myList  = this.$.superTada;
    Polymer.dom(myList).innerHTML = '';
    console.log(myList);
  }, 

  __revertArray: function(){
  	var myList  = this.$.superTada;
    Polymer.dom(myList).innerHTML = '';
    var giAl = this.griditemArray.length
	var oGAL = this.oldGridArray.length;
	   	if (oGAL< giAl){
	   		giAl.slice(0, oGal);
	   	}
	   	var i = 0;
	   	for(i=0; i < oGAL; i++){
	   			this.griditemArray[i]=this.oldGridArray[i];
	   			//this.push("griditemArray", {val: this.oldGridArray[i].val, key: this.oldGridArray[i].key});
	   	};
	   	this.$.tada.close();
	   	alert("Here is your old array!");
	   	var j=0;
	   	for(j=0; i < oGAL; j++){
	   			//this.push("griditemArray", {val: this.oldGridArray[j].val, key: this.oldGridArray[j].key});
	    		var keynow = this.griditemArray[j].key;
	    		var valnow = this.griditemArray[j].val;
	    	console.log(j + " hgh " + this.griditemArray[j].key + " which has a value of" + this.griditemArray[j].val);
	    		var tadathree = document.createElement("li");
	    		Polymer.dom(tadathree).innerHTML = "Index position key is " + keynow + " and now is set to " + valnow + ". ";
	    		Polymer.dom(myList).appendChild(tadathree);
	    };
	 
	    this.$.tada.open();

	}
});
</script>
</dom-module>