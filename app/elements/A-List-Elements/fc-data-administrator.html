<dom-module id="fc-data-administrator">
	<!-- CodeMirror -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.css" />

<!-- Firepad -->
<link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.2.0/firepad.css" />
<script src="https://cdn.firebase.com/libs/firepad/1.2.0/firepad.min.js"></script>

	<template>
		<style is="custom-style">
	 	#div1 {
	 		min-width:365px; 
	 		max-width: 960px;
	 		display: flex;
	 		height:680 px;
	 		padding:10px;
	 		border:1px solid #aaaaaa;
	 	}
	 	article { display: block;}
	  	
	  	.iconset{
  			  height: 97px;
			  width: 164px;
			  font-family: merriweather;
			  font-size: 1.05em;
			  color: black;
			  padding: 5px;
			  margin: 5px 5px 5px 0px;
			  text-align: center;
			  display: block;
			}

		div.assistView::--webkit-scrollbar {
					display: none;
			}
		
		paper-dialogue-scrollable::--webkit-scrollbar {
					display: none;}
	
			paper-dialog {
				font-family: merriweather;
			  	font-size: 1.05em;
				position: fixed;
				display: block;
				width: 541px;
				height: 668px;
				overflow: hidden;
				border: 2px ridge #002c90;
				background: #fff;
				border-radius: 8px;
				z-index: 100000;
				opacity: 1;
			}
			.subheading{
				font-size: 13px;
				color: brown;
				font-weight: 800;
			}
			h6.subheading{
				font-size: .6em;
				color: brown;
				font-weight: 800;
			}
			
			.fc-headerclass{
				padding: 4px 2px 2px 4px;
				font-family: Merriweather;
				font-size: 26px;
				color: #000066;
				}
			
			h3, h4 {
				color: #000066;
				margin-bottom: 4px;
				margin-top: 8px;
				font-family: Merriweather;
				font-weight: 700;

			}

			h2 {


			}
			section {
			 	height: 98vh;
			 	overflow-y: scroll;
			}
			iron-page {
				display: float;
				position: relative;
				margin-top: 0px;
				padding-top: 4px;


			}
			p.assistant{
				height: 100vh;
				font-family: Times;
				font-size: 14px;
				font-weight: 500px;
				color: goldenrod;
				overflow-y: scroll;

			}

			div.scroll-master{
				height: 98%;
				overflow: hidden;
				overflow-y: scroll;
				border: 0px 3px 0px 3px inset #fffffe;
				border-top: 1px solid #000066;
				border-bottom: 1px solid #000066;
			}


			iron-icon{
				height: 36px;
				width: 36px;
			}

			
			iron-pages{
				height: calc(100vh-65px);
				position: relative;
				display: flex;

			}

			
			
</style>
	<div class="layout container vertical center center-justified iconset">
		<button class="right" style="position: fixed; top: 30px; opacity: .65; background: goldenrod; border: 6px ridge silver;" on-tap="flattap" on-hover="{{getFocused}}"> TAP ME</button>
				<span "font-size: 8.5pt; font-family: times; color: #000066;">
					<span hidden="{{getFocused}}">Get Focused!</span>
				</span>
	</div>

								
<paper-dialog id="dragDialog2" class="layout vertical container" style="position: relative; display: flex; resize:both; overflow: auto;"  draggable="true" no-cancel-on-outside-click="true">

	<h3 class="fc-headerclass horizontal layout center-justified" style="padding-bottom: 4px;">The Focused Data Administrator</h3>
	<h6 on-mousedown="_startDrag" class="subheading horizontal layout center-justified" style="line-height:.2; margin: 10px 3px 0px 3px;">CLICK TO DRAG || CLICK AGAIN TO RELEASE</h6>
	<div class="scroll-master">
		<iron-pages id="assistantPages" selected="0">
			<section>
				<div id="firepad" style="border: 3px ridge silver; resize:both; overflow: auto;" class="fit"></div>

			</section>
			<section>
				<div style="width:50%;height:50%" id="pasty" placeholder="pasted text appears here" id="pagTwo"></div>
			</section>
		
			<section>
				




				<!--<h3> Cell Creation Page</h3>
				<paper-input>lolo</paper-input>
				<paper-input>lolo</paper-input>
				<div style="border: 5px ridge silver; width: 240px; height: 120px;"> 
					<h6>BUILD HERE</h6>
				</div>
				<paper-button>Save To Collection</paper-button>
				<input list="collectionsList" placeholder="Collection List">
					<data-list name='collectionsList'>
						<option>1</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5</option>
					</data-list>
				<h3> Card Creation Page</h3>
				<paper-input>lolo</paper-input>
				<paper-input>lolo</paper-input>
				<div style="border: 5px ridge silver; width: 240px; height: 120px;"> 
					<h6>BUILD HERE</h6>
				</div>
				<paper-button>Save To Collection</paper-button>
				<input list="collectionsList" placeholder="Collection List">
					
				<h3> Layout Creation Area</h3>
				<paper-input>lolo</paper-input>
				<paper-input>lolo</paper-input>
				<div style="border: 5px ridge silver; width: 240px; height: 120px;"> 
					<h6>BUILD HERE</h6>
				</div>
				<paper-button>Save To Collection</paper-button>
				<input list="collectionsList" placeholder="Collection List">
					
	
			<h3> Graphs and other Data Representation</h3>
				<paper-input>lolo</paper-input>
				<paper-input>lolo</paper-input>
				<div style="border: 5px ridge silver; width: 240px; height: 120px;"> 
					<h6>BUILD HERE</h6>
				</div>
				<paper-button>Save To Collection</paper-button>
				<input list="collectionsList" placeholder="Collection List">
					<datalist id="collectionsList">
						
					</datalist>

			<h3> Build Elements From Template Elements</h3>
				<p class="assistantView container" no-cancel-on-outside-click="true">
		
				
				<h3>Your Element Collections </h3>
				
				<details>
				<summary> <b>Dashboard Top-View Collection</b></summary>
					<ul> Here are your Elements As Assembled in your Top-View Dashboard
						
						<li> Six with Picture</li>
					</ul>
				</details>

				<details>
				<summary> <b>Dashboard Top-Bottom Grid-Full View Collection</b></summary>
					<ul> Here are your Elements As Assembled in your Top-Bottom/ Grid-Full View Collection
						
						<li> Six with Picture</li>
					</ul>
				</details>
				<details>
				<summary> <b>DashBoard Four Panel Two-by-Two Collection</b></summary>
					<ul> Here is your Four Panel Collection
						
						<li> Six with Picture</li>
					</ul>
				</details>
				<details>
				<summary> <b>DashBoard Four Panel Full Screen Collection</b></summary>
					<ul> Here is your Four Panel Full Screen Collection
					<template is="dom-repeat" items={{superItemArray}}>
						<li>{{item.fcid}}</li>
						<li>{{item.Email}}</li>
						<li>{{item.Full_Name}}</li>
					
						</template>
					</ul>
				</details>

				-->		
		</section>
	</iron-pages>
</div>
			
			<div class="buttons" style="height: 65px; padding: 8px 8px 8px 14px;" class="horizontal layout left-justified">
				
				
<paper-button on-tap="conttap">More</paper-button>
				<paper-button on-tap="coolThings">Scores</paper-button>
				<paper-button dialog-dismiss>Exit</paper-button>
			
				<paper-button on-tap="coolerThings">Passage Save</paper-button>
				<paper-button on-tap="pasteText">Paste Text</paper-button>

			</div>
	
</paper-dialog>
</template>
<script>  
	Polymer({
		is: 'fc-data-administrator',
		properties:{
		firepad: Object,
		offsetX: {
				type: Number,
				notify: true,
				reflectToAttributes: true
				},
		offsetY: {
				type: Number,
				notify: true,
				reflectToAttributes: true
				},
		wordArray2: {
			type: Array,
			value: [], 
			notify: true, 
			reflectToAttributes: true,
				},
			dragging: {
				type: Boolean, 
				value: false, 
				notify: true
			},

			timeout: {
				type: Boolean, 
				value: false, 
				notify: true
			},
		open: 	{
			type: Boolean,
			value: false, 
			notify: true
			},
		currentDragger:{
			type: Object,
			notify: true,
			reflectToAttributes: true
		}, 
		superItemArray:{
			type:Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		lineMeasuredWordArrays:{
			type:Array,
			value: [],
			notify: true,
			reflectToAttributes: true

		},

		passageWordArray:{
			type:Array,
			value: [],
			notify: true,
			reflectToAttributes: true

		},

		getFocused: {
			type: Boolean, 
			value: true,
			notify: true,
			reflectToAttributes: true
		},

		passageWordObject:{
			type:Object,
			value: {},
			notify: true,
			reflectToAttributes: true

		}, 

		passageContent: {
			type: String,
			notify: true,
			reflectToAttributes: true

		},

		firepad: {
			type:Object,
			value:{},
			notify: true,
			reflectToAttributes: true	
		},
		firepadRef: {
			type:Object,
			value:{},
			notify: true,
			reflectToAttributes: true	
		}




	},

	 created: function(){

	 	var setFB = new Firebase("https://focusedstaging1.firebaseio.com/students"); 
	    var self = this;
	    setFB.on("value", function(snap){
	    var theSet = snap.val();
		//console.log(theSet);
	    var counterone = 0;
		var keyfirst = Object.keys(theSet);
		var limit = keyfirst.length;
		//console.log(limit);
	
	     for(counterone = 0; counterone < limit; counterone++){
	     	var testKeys =  Object.keys(theSet[keyfirst[counterone]].test_results);
			var testCounter = testKeys.length;
	     	
	     	var studenters = keyfirst[counterone];
			//alert(testCounter + "c " + studenters);
			var full = theSet[keyfirst[counterone]].first_name + " " + theSet[keyfirst[counterone]].last_name;
			self.push('superItemArray', {
						'Full_Name' : full,
						'fcid': theSet[keyfirst[counterone]].student,
						'Email': theSet[keyfirst[counterone]].email,
						'Test_Results': {function(){
			
					     	var testFB = new Firebase("https://focusedstaging1.firebaseio.com/test_results");
					     	var thisTestResult = this;
					     	testFB.orderByChild('student').equalTo(studenters).on("value", function(snapshot){
					    			var testies = snapshot.val();
					    			var testcounter = testies.length;
					    			//console.log(testcounter);
					    			var i = 0;
					    			for(i=0; i<testcounter; i++){
						     			var keysInTestResults = Object.keys(testies);
						     			var FITRs = keysInTestResults.length;
						     			console.log(Object.keys(testies[keysInTestResults[j]]));//values we want;
						     			var scoreHeaders = Object.keys(testies[keysInTestResults[0]]);
										var it = testies[keysInTestResults[j]].values();
										var entry;
											while (!(entry = it.next()).done) {
    											console.log(entry.value);
    											self.push('superItemArray', entry.value);
												}
											//console.log(entry.value);
												return entry.value;
										};
	     							
	    							});
	    						}
	     					}
						});
					
				}
			});
		},

attached: function() { 
			this.firepadRef = new Firebase('https://focused0ne.firebaseio.com/firepad');
  			this.codeMirror = CodeMirror(this.$.firepad, { lineWrapping: true });
  			this.firepad = Firepad.fromCodeMirror(this.firepadRef, this.codeMirror,
      		{richTextShortcuts: true, richTextToolbar: true, defaultText: 'Welcome to the Focused Data Administrator' });
			//this.passage_width = document.querySelector("#stanleySucks").clientWidth;
			},

coolerThings: function(){
	var passageHeader ="This passage is from Lydia Minatoya, The Strangeness of Beauty. ©1999 by Lydia Minatoya. The setting is Japan in 1920. Chie and her daughter Naomi are members of the House of Fuji, a noble family.\n \n"
	var self = this;
	var passageContent = self.firepad.getText();
		console.log(passageContent + " this is the passageContent property " + self.firepad.getText());
		console.log(this.firepad);
			var canvas = document.createElement('canvas');
			var context = canvas.getContext("2d");
			var theFont = context.font = "12pt Roboto";
			var truePassageContent = passageContent.replace(/[\—]/g, " — ");
			var paragraphArray = truePassageContent.split(/\n/);
			var numParagraphs = paragraphArray.length;
	// Setting and saving
	// passage widths based on the current screen width
	//this should be turned into a local function
	//in the reading display element
	// that just determines how many lines to reveal, I guess?
			var passageWidth = self.passage_width = document.querySelector("#stanleySucks").clientWidth;
			var ref = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne");
				var currentRow = 1;
				self.passageWordObject = {};
				self.lineMeasuredWordArrays = [];
				for(i=0; i< numParagraphs; i++)
					{
					var newPara = true;
					var wordArray = paragraphArray[i].split(/\s/g);
					var numWords = wordArray.length;
					var wordCount = 0;
					var paragraph_number = i;

					while(wordCount < numWords)
					// line loop
						{
							var currentLine = "";
							var testLine = "";
							var currentWidth = 0;
							var space="&nbsp&nbsp&nbsp&nbsp";
							var spaceOffset = "";
							var newline = true;
						while((currentWidth + 64) < self.passage_width && wordCount <= numWords)
						//word loop
							{
							
							currentLine = testLine;
							if (testLine != "")
								{
								testLine += " "; //add a space if not beginning
			      				}
			      			else if(wordCount == 0)
			      				{
			      					//new paragraph
			      					testLine += space;
			      					spaceOffset = "aaaaaaaaaaaaaaaaaaaaa";
			      				}
			      			var oldWidth = context.measureText(testLine).width - context.measureText(spaceOffset).width;
							testLine += wordArray[wordCount]; //add a word
							currentWidth = context.measureText(testLine).width - context.measureText(spaceOffset).width;
							var remainingWidth = passageWidth - currentWidth;
							var wordWidth = currentWidth - oldWidth;
							var currentWord = wordArray[wordCount];
							if (currentWord == undefined) {currentWord = " ";}
							var index = self.lineMeasuredWordArrays.length;
				//here we are building an array-like key name that is human readable
							var indexWord = self.indexWord = currentWord;
							var mo = self.indexWord.length-1;
							while(self.indexWord[mo] == "." || self.indexWord[mo] == "#"|| self.indexWord[mo] == "$" || self.indexWord[mo] == "[" || self.indexWord[mo] == "]" || self.indexWord[mo-1] == "." || self.indexWord[mo-1] == "#"|| self.indexWord[mo-1] == "$" || self.indexWord[mo-1] == "[" || self.indexWord[mo-1] == "]")
									{
										indexWord = self.indexWord.slice(0,mo); 
										mo = mo-1;
									}
								var strIndex = ("000" + index).slice(-4);
								var rowRow = ("00" + currentRow).slice(-3);
								var instance = rowRow + "_" + strIndex + "_Passage_" + self.passageTitle + "_at_" + passageWidth + "_" + indexWord;
								var wordName = instance;
				//the build of the words row, words placement in the list of words and characters,
				// the passage number and Type
				// the width of the column 
				//as well as the word or punctuation appear as the keys//
								var labelLine = false;

								if (currentRow>0 && currentRow%5==0 && newline==true){labelLine=true;}
							self.push('lineMeasuredWordArrays',
									{ 
										"instance": instance,
										"index": strIndex,
										'line': rowRow,
										'current-line': currentLine,
										'order': wordCount,
										'word' : currentWord, 
										'pixels': wordWidth,
										'line-length-remaining': remainingWidth, 
										'font-size': theFont,
										'font-family': theFont,
										"current-line-width": currentWidth, 
										'definition': 'meaning', 
										"part of speech": "part of speech",
										'clause': 'phrases are phrase for all of my lasers', 
										'sentence': "the Sentence which the actual word appears in, this will help a ton on the build.",
										'paragraphBreak': newPara,
										'labelline': labelLine,
										'row':currentRow,
										'newline': newline,
										'passage_width': passageWidth
									}
								); 
					
								self.passageWordObject[instance]=
									{ 
										"instance": instance,
										"index": strIndex,
										'line': rowRow,
										'current-line': currentLine,
										'order': wordCount,
										'word' : currentWord, 
										'pixels': wordWidth,
										'line-length-remaining': remainingWidth, 
										'font-size': theFont,
										'font-family': theFont,
										"current-line-width": currentWidth, 
										"instance": instance,
										'order': wordCount,
										'word' : currentWord, 
										'font-size': theFont,
										'font-family': theFont, 
										'definition': 'meaning', 
										"part of speech": "part of speech",
										'clause': 'phrases are phrase for all of my lasers', 
										'sentence': "the Sentence which the actual word appears in, this will help a ton on the build.",
										'synonyms': "context synonyms 5 look for high context numbers; multii parts of speech",
										'antonyms': "context one to three synonyms and antonyms.",
										'paragraphBreak': newPara,
										'labelline': labelLine,
										'row':currentRow,
										'newline': newline, 
										'passage_width': passageWidth,  
									}
								newline = false;
								newPara = false;
								wordCount++;
							} //SINGLE word entry ends here, WOULD LOVE TO CUT THIS IN HALF
						currentRow++;
						currentWidth = 0;
						}//SINGLE line loop
					} //this is the paragraph for loop
					var arrayPassage = self.lineMeasuredWordArrays;
					ref.child("Passage_1_@:_" + passageWidth).set(arrayPassage);
					ref.child("Passage_1B:_" + self.passage_width).set(self.passageWordObject);
					alert("Passage_1B_@:_" + self.passage_width + "-----------");
					var lastElement = arrayPassage.pop();
					//var lastRow =self.lastRow[passageWidth + "_width_"] = lastOfWordArray.row;
					alert(lastElement.row);
					self.passageWordObject = {};
					self.lineMeasuredWordArrays =[];

			//	this is the loop for a whole passage. When Dynamic this loop goes away	
		//this ends the firepad stuff			
	},

	
		coolThings: function(){
			var adminStorage2 = window.localStorage;
			var len = this.superItemArray.length;
			var franklin = this.superItemArray[1];
			var name = this.superItemArray[1].Full_Name;
			var email = this.superItemArray[1].Email;
			alert(JSON.stringify(this.superItemArray[1]));
			adminStorage2.setItem(name,email,len);

			

		},
		ready: function() { 

		},

 		conttap: function() {
 			 var pages = this.$.assistantPages;
    			pages.selectNext();
  				
  				},

  		flattap: function() {
			this.$.dragDialog2.open();			
	},

	pasteText: function()
	{
		var readingDash = document.querySelector("#focuseddashboardOne");
		this.$.pasty.innerHTML = readingDash.copiedText;
	},

		back: function(){
			var pages = this.$.assistantPages;
    			pages.selectPrevious();

	},

	getFocused: function(){
		this.getFocused = !this.getFocused;
	},

getData: function(argItem)
	{
		
		this.fcid = argItem;
		if(this.scores.hasOwnProperty(argItem))
		{
		
			return ['PRETEST: ' + this.scores[argItem].scoresPreTest + "  \n\r",
					'TEST 1: ' + this.scores[argItem].scoresTest1 + "    |||    ",
					'TEST 2: ' + this.scores[argItem].scoresTest2 + "    |||    ",
					'TEST 3: ' + this.scores[argItem].scoresTest3 + "    |||    ",
					'TEST 4: ' + this.scores[argItem].scoresTest4 + "    |||    ",
					'TEST 5: ' + this.scores[argItem].scoresTest5 + "    |||    ",
					'TEST 6: ' + this.scores[argItem].scoresTest6 + "    |||    ",
					'REAL SAT: ' + this.scores[argItem].realSAT + "    |||    "
					];
		}
	},
		_startDrag: function(e){
		
			//console.log(e);
			this.dragging=true;
			var dragbox = this.$.dragDialog2.getBoundingClientRect();
			this.offsetX = e.offsetX;
			//console.log(this.offsetX);
			var Xoff = this.offsetX = e.offsetX;
			var Yoff = this.offsetY = e.offsetY;
			//console.log(Yoff);
			document.captureEvents(Event.MOUSEMOVE);
			document.onmousemove = dragmeplease;
			function dragmeplease(mp){
				var _x = mp.clientX - 80;
				var xString = _x.toString() + 'px';
				var	_y = mp.clientY -80; 
				var yString = _y.toString() + 'px';

		  		document.querySelector('#dragDialog2').style.top = yString;
		  		//console.log("_y has this value here " + _y);
		  		document.querySelector("#dragDialog2").style.left = xString;
		  		//console.log(_x + " that was x");
		  	document.captureEvents(Event.MOUSEUP);
			document.onmouseup = endThisPlease;
			function endThisPlease(omu){
				//console.log(omu.detail);
				document.onmousemove = null;
				document.onmouseup = null;


			}
	
	}
} 
});
/*"\n Akira came directly, breaking all tradition. Was that it? Had he followed form—had he asked his mother to speak to his father to approach a go-between—would Chie have been more receptive? \n He came on a winter’s eve. He pounded on the door while a cold rain beat on the shuttered veranda, so at first Chie thought him only the wind. The maid knew better. Chie heard her soft scuttling footsteps, the creak of the door. Then the maid brought a calling card to the drawing room, for Chie. \n Chie was reluctant to go to her guest; perhaps she was feeling too cozy. She and Naomi were reading at a low table set atop a charcoal brazier. A thick quilt spread over the sides of the table so their legs were tucked inside with the heat.  \n “Who is it at this hour, in this weather?” Chie questioned as she picked the name card off the maid’s lacquer tray. \n “Shinoda, Akira. Kobe Dental College,” she read. \n Naomi recognized the name. Chie heard a soft intake of air. \n “I think you should go,” said Naomi. \n Akira was waiting in the entry. He was in his early twenties, slim and serious, wearing the black military-style uniform of a student. As he bowed-his hands hanging straight down, a black cap in one, a yellow oil-paper umbrella in the other—Chie glanced beyond him. In the glistening surface of the courtyard’s rain-drenched paving stones, she saw his reflection like a dark double. \n “Madame,” said Akira, “forgive my disruption, but I come with a matter of urgency.” \n His voice was soft, refined. He straightened and stole a deferential peek at her face. \n In the dim light his eyes shone with sincerity. Chie felt herself starting to like him. \n “Come inside, get out of this nasty night. Surely your business can wait for a moment or two.” \n “I don’t want to trouble you. Normally I would approach you more properly but I’ve received word of a position. I’ve an opportunity to go to America, as dentist for Seattle’s Japanese community.” \n “Congratulations,” Chie said with amusement. “That is an opportunity, I’m sure. But how am I involved?” \n Even noting Naomi’s breathless reaction to the name card, Chie had no idea. Akira’s message, delivered like a formal speech, filled her with maternal amusement. You know how children speak so earnestly, so hurriedly, so endearingly about things that have no importance in an adult’s mind? That’s how she viewed him, as a child. \n It was how she viewed Naomi. Even though Naomi was eighteen and training endlessly in the artsneeded to make a good marriage, Chie had made no effort to find her a husband. Akira blushed. \n “Depending on your response, I may stay in Japan. I’ve come to ask for Naomi’s hand.” \n Suddenly Chie felt the dampness of the night. \n “Does Naomi know anything of your... ambitions?” \n “We have an understanding. Please don’t judge my candidacy by the unseemliness of this proposal. I ask directly because the use of a go-between takes much time. Either method comes down to the same thing: a matter of parental approval. If you give your consent, I become Naomi’s yoshi. We’ll live in the House of Fuji. Without your consent, I must go to America, to secure a new home for my bride.” \n Eager to make his point, he’d been looking her full in the face. Abruptly, his voice turned gentle. \n “I see I’ve startled you. My humble apologies. I’ll take no more of your evening. My address is on my card. If you don’t wish to contact me, I’ll reapproach you in two weeks’ time. Until then, good night.” He bowed and left. Taking her ease, with effortless grace, like a cat making off with a fish. \n “Mother?” Chie heard Naomi’s low voice and turned from the door. “He has asked you?” \n The sight of Naomi’s clear eyes, her dark brows gave Chie strength. Maybe his hopes were preposterous. \n “Where did you meet such a fellow?” Chai began.  “Imagine! He thinks he can marry the Fuji heir and take her to America all in the snap of his fingers!” \n Chie waited for Naomi’s ripe laughter. Naomi was silent. She stood a full half minute looking straight into Chie’s eyes. Finally, she spoke: \n “Mother.” \n “Yes?” \n “I mean to have him.”\n\n";*/
</script>
</dom-module>
