<dom-module id="fc-reading-questions">
<template id="fc-reading-questions-template">
<style>
</style>

<firebase-collection location="https://focused0ne.firebaseio.com/readingPassageOne/Passage_2A_443" order-by-child="instance" data='{{passageArrayOne}}'></firebase-collection>

<div id="noJudge" class="layout vertical flex container left passageContainer">					
		<!--column-1-container line numbs and passage | Flex-1 keeps the columns even-->
			<div id="singleColumnQuestions" class="layout horizontal container flex wrap text columnContainer" style="padding-right: 12px;">
				 <article>
				 	<template is="dom-repeat" items="{{firstColumnWordArrayOne}}">
							<template is="dom-if" if="{{item.paragraphBreak}}">
								<br><span>&nbsp&nbsp&nbsp&nbsp</span>
							</template>
								<a id="oneA_{{index}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
					</template>
					<br class="line-numbers">
					<hr>
					<span class="right-justified line-numbers" style="float:right; text-align: right;" id="singleColumnBounder"> Focused Coaching (c) 2016</span>
				</article>
			</div>
		<!-- end-of-column-1 line number and text container-->
		<div id="twoColumnQuestionsContainer" class="layout horizontal flex container">
				<div id="firstColumnContainer" class="layout horizontal flex-1 wrap text container columnContainer" style="padding-right: 12px; overflow-y:scroll;">
			 		<article>
			 	    	<template is="dom-repeat" items="{{firstColumnWordArrayTwo}}">
								<template is="dom-if" if="{{item.paragraphBreak}}">
									<br><span>&nbsp&nbsp&nbsp&nbsp</span>
								</template>
								<a id="one_{{item.index}}_{{item.word}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
						</template>
						<br class="line-numbers">
						<hr>
						<span class="right right-justified line-numbers" style="float:right; text-align: right;" id="doubleColumnBounderOne"> Focused Coaching (c) 2016</span>
					</article>
			 	</div>
				

				<div id="secondColumnContainer" class="layout horizontal flex-1 text wrap container" style="padding-left: 12px;overflow-y:scroll;">
				 	<article>
						<template is="dom-repeat" items="{{secondColumnWordArrayTwo}}">
								<template is="dom-if" if="{{item.paragraphBreak}}">
									<br><span>&nbsp&nbsp&nbsp&nbsp</span>
								</template>
								<a id="two_{{item.order}}_{{item.word}}" hidden="{{columnOneShow}}">{{item.word}}</a>
						</template>
						<br class="line-numbers">
						<span class="right right-justified line-numbers" style="float:right; text-align: right;" id="doubleColumnBounderTwo"> End of Passage</span>
					</article>
				</div>
		</div>
</div><!--no-judge-ends-->
<!--End of Vertical passage container-->
</template>

</template>
<script>
Polymer({
is:'fc-reading-passage-display',
	behaviors: [Polymer.IronResizableBehavior],
	properties: {
		largestLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArrayOne: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArrayTwo: {
			type: Array,
			value: [],
			notify: true
		},
		secondColumnLineNumberArrayTwo: {
			type: Array,
			value: [],
			notify: true
		},
		passageArrayOne:{
			type: Array, 
			value: [],
			notify: true, 
			reflectToAttibutes: true 
		},
		passageTitle: {
			type: String, 
			notify: true,
			reflectToAttributes: true
		},
		numWords: {
			type: Number,
			notify: true,
			reflectToAttributes: true
		},
		firstColumnWordArrayTwo: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		secondColumnWordArrayTwo: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		firstColumnWordArrayOne: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		linesH: {
			type: String,
			value: '',
			notify: true
		},
		
		goldenRatio: {
			type: Number,
			notify: true,
			reflectToAttributes: true
		},
		notify: true,
		reflectToAttributes: true
	},



	attached: function(){
		this.loadQuestions();
		},


	loadQuestions: function(){
		console.log("loadPassage here " + " am I -->  undefined")
		this.passageArrayOne=[];
		var self = this;
		var ref = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne/Passage_2A_443");
		ref.on("value", function(snap){
			self.passageArrayOne = snap.val();
			self.numWords = self.passageArrayOne.length;
			self.firstColumnWordArrayOne=snap.val();
			self.goldenRatio = Math.floor(.65*self.numWords)+3;
			self.firstColumnWordArrayTwo=self.passageArrayOne.slice(0,self.goldenRatio);
			self.secondColumnWordArrayTwo= self.passageArrayOne.slice(self.goldenRatio, self.numWords);
		});
			
			this.notifyResize();
	},


	notifyResize: function(){		
		this.setUp();

	},
	
	setUp: function(){
		this.screenTrueHeight =  (window.innerHeight-500);
		if(this.colUnoHeight!=undefined && this.colUnoHeight >=250){
			if(this.$.noJudge.clientWidth >= 660 && this.colUnoHeight>this.screenTrueHeight){
				this.$.singleColumnPassage.hidden = true;
				this.$.doubleColumnContainer.hidden = false;
				this._numberTwoColumns();
			}
			else{
				this.$.doubleColumnContainer.hidden = true;
				this.$.singleColumnPassage.hidden = false;
				this.linesH = this.$.linesA1.clientHeight;
				this._numberColumnOne();
			}
		}
		else {
			if(this.$.noJudge.clientWidth >= 660){
				this.$.singleColumnPassage.hidden = true;
				this.$.doubleColumnContainer.hidden = false;
				this.colUnoHeight=this.$.colUno.scrollHeight;
				if(this.colUnoHeight < this.screenTrueHeight){
					this.$.doubleColumnContainer.hidden = true;
					this.$.singleColumnPassage.hidden = false;
					this.linesH = this.$.linesA1.clientHeight;
					this._numberColumnOne();
					}
				//else{this._numberTwoColumns();}
			}
			else{
				this.$.doubleColumnContainer.hidden = true;
				this.$.singleColumnPassage.hidden = false;
				this.linesH = this.$.linesA1.clientHeight;
				this._numberColumnOne();
			}


		}
		
	},
	_numberColumnOne: function(){
		this.screenTrueHeight =  (window.innerHeight - 500);
		if (this.linesH != 0 && this.linesH != undefined)
		{
			var topDistance = this.$.singleColumnBounder.getBoundingClientRect().top;
			var basis = this.$.linesA1.getBoundingClientRect().top;
			var delta = topDistance - basis;
			console.log(delta);console.log(topDistance);console.log(topDistance);console.log(delta);console.log(delta);
			this.numLines = (delta/this.$.linesA1.clientHeight)-1;
			this.set("firstColumnLineNumberArrayOne", this.largestLineNumberArray.slice(0,this.numLines));
		}
		this.fire('dom-change');
	},

	_numberTwoColumns: function(){
		this.linesH = this.$.lines.clientHeight;
		if (this.linesH != 0 && this.linesH != undefined)
		{
			var topDistance = this.$.doubleColumnBounderOne.getBoundingClientRect().top;
			var basis = this.$.lines.getBoundingClientRect().top;
			var delta = topDistance - basis;
			var rowsColumnOne = delta/this.linesH-2;

			this.set("firstColumnLineNumberArrayTwo", this.largestLineNumberArray.slice(0,rowsColumnOne));
//Lines Col one
			var topDistanceTwo = this.$.doubleColumnBounderTwo.getBoundingClientRect().top;
			var deltaTwo = topDistanceTwo - basis;
//Distance fro col 2
			this.rowsColumnTwo = deltaTwo/this.linesH;
			var numLines= rowsColumnOne + this.rowsColumnTwo;
//set col two
			this.set("secondColumnLineNumberArrayTwo", this.largestLineNumberArray.slice(rowsColumnOne, numLines));
			this.colUnoHeight=this.$.colUno.scrollHeight;
			}
			else { _NumberTwoColumns();

			}
			this.fire('dom-change');

	}
});
</script>







});
</script>
</dom-module>