<dom-module id="fc-top-view-dashboard">
<template>
<style>
div.line-number {
	width: 24px;
	line-height: 1;
	font-size: 1.1em;
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	padding: 6px 0px 6px 0px;
	margin: 6px 0px 6px 0px;
	
}
.highlighted {
	background: yellow;
}
#pringles {
	max-width:620px;
	padding-bottom: 24px;
}
.text {
	max-width: 400px;
	line-height: 1;
	font-size: 1.1em;
	font-family: merriweather;
	font-weight: 500;
	padding: 6px;
	margin: 6px 9px 6px 8px;
	text-indent: 18px;
	max-height: 900px;
	min-height: 480px;
}
span.plus {
	font-weight: 700;
	font-style: italic;
	line-height: 1;
	font-size: 1em;
}
br {text-indent: 18px;}
</style>
<firebase-collection location="https://focused0ne.firebaseio.com/readingPassageOne/Passage_1_%40%3A_620" data='{{passageArrayOne}}'></firebase-collection>
	<paper-material elevation="1">
		<fc-splitter-jc orientation="horizontal" style="height: 100%;">		
			<div class="left vertical layout container" style="padding: 8px; margin: 8px; height: 1400px; max-width: 760px; border: 6px ridge silver; overflow-y: scroll;">
				<span id="preface" class="vertical layout plus" style="font-style: italic; padding:0px 16px; margin: 0px 16px;">This passage is from Lydia Minatoya, The Strangeness of Beauty. ©1999 by Lydia Minatoya. The setting is Japan in 1920. Chie and her daughter Naomi are members of the House of Fuji, a noble family.</span>
				<div  class="horizontal layout left-justified container flex wrap left" style="padding: 0px 8px 8px 8px; margin: 0px 6px 6px 6px;">
					<div id="linenumbers" class="layout vertical line-number dynamic-class">
							<span><i>line</i></span>
    						<template is="dom-repeat" items="{{firstColumnLineNumberArray}}">
     								<span id="passage1_line_{{index}}">{{item}}</span>
     								<!-- 
     								<fc-anchor fcid={{index}} id="{{index}}_{{item.line}}_blank" hidden={{item.labelline}}>&nbsp</span>
     								-->
    						</template>
   					</div>
					<div id="pringles" class="layout horizontal flex wrap container left-justified">
						<article id="stanleySucks" class="layout horizontal">
							<div class="text flex-1" id="colUno">
							<span>passage</span><br>
							<template is="dom-repeat" items="{{firstColumnWordArray}}">
 								<template is="dom-if" if="{{item.paragraphBreak}}">
 									<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 								</template>
 								<a id="{{index}}" contenteditable={{contentEdit}} on-mousedown="highlightWord" id="{{index}}_{{item.word}}">{{item.word}}</a>
							</template>
							</div>
							<div id="colDos" class="text flex-1">
							<span>passage</span><br>
							<template is="dom-repeat" items="{{secondColumnWordArray}}">
 								<template is="dom-if" if="{{item.paragraphBreak}}">
 									<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 								</template>
 								<a id="{{index}}" contenteditable={{contentEdit}} on-mousedown="highlightWord" id="{{index}}_{{item.word}}">{{item.word}}</a>
							</template>
							</div>
						</article>
					</div>
					<div id="linenumbersright" class="layout vertical line-number dynamic-class">
							<span><i>line</i></span>
    						<template is="dom-repeat" items="{{secondColumnLineNumberArray}}">
    							<!--
    							<template is="dom-if" if="{{item.newline}}">
    							-->
     								<span id="passage1_line_{{index}}">{{item}}</span>
     								<!--
     								<span id="{{index}}_{{item.line}}_blank" hidden={{item.labelline}}>&nbsp</span>
     							</template>
     							-->
    						</template>
   					</div>
   				</div>
   			</div>
				
			</fc-splitter-jc>

		
		
		<content class="left horizontal layout container" select="fc-student-intake-form, fc-grid-card-portrait">		
		</content>	
		
	</paper-material>
	<fc-data-administrator id="scottAdmin"></fc-data-administrator>
	<paper-button on-tap="columnize">2 Columnize</paper-button>
</template>
<script>
/*FcTopViewDashboard=*/
Polymer({
	is: "fc-top-view-dashboard", 

	behaviors: [Polymer.IronResizableBehavior],

	properties: {
		iPath: 'http://www.focusedstaging.com/Fresh_Attempt%20/index-jason.html',
		topClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		shitty: String,
		bottomLeftClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			}, 
		bottomRightClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		lowerRight: String,
		lowerLeft: String,
		passageWidth: {
			type: String, 
			value: function(){return this.$.stanleySucks.clientWidth;},
			notify: true, 
			reflectToAttributes: true
		},
		largestLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		secondColumnLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		passageArrayOne:{
			type: Array, 
			value: [],
			notify: true, 
			reflectToAttibutes: true
		}, 
		passageDimensions: {
			type: Object,
			value: {
				passageWidth: Number,
				passageHeight: Number,
				passageInnerWidth: Number, 
				passageInnerHeight: Number, 
				passagePositionX: Number, 
				passagePositionY: Number, 
				passagePositionZ: Number, 
			},
			notify: true, 
			reflectToAttributes: true
		},
		reflectToAttributes: true,
		notify: true,
		passageObject: {
			type: Object,
			value:{}, 
			notify: true,
			reflectToAttributes: true
		},
		passageTitle: {
			type: String, 
			notify: true,
			reflectToAttributes: true
		},
		contentEdit: {
			type: Boolean,
			value: false, 
			notify: true,
			reflectToAttributes: true
		},
		firstColumnWordArray: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		secondColumnWordArray: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		flitty: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		notify: true,
		reflectToAttributes: true




	},

	created: function(){

	},
	ready: function(){
		
	},

	attached: function(){
		var passageTitle = self.passageTitle = "stanleySucks";
		this.passageDimensions.passageWidth = document.querySelector('#stanleySucks').clientWidth;
		//alert(this.passageDimensions.passageWidth);
		//this.splitIntoColumns(2);
		//this.set("firstColumnWordArray", [{"word": "carrot"}]);
//		this.firstColumnWordArray = [{"word": "pickle"},{"word": "nickel"}];
		console.log(this.firstColumnWordArray);
		for(i=1; i <= 400; i++)
		{
			this.push("largestLineNumberArray", i % 5 ? ".": i.toString());
		}
	},

	attributeChanged: function(){
		var nooSpans = document.querySelector('[name|=false]');
		this.passageDimensions.passageWidth = document.querySelector('#stanleySucks').clientWidth;
	},

	columnize: function()
	{
		console.log("columnize");
		this.splitIntoColumns(2);
	},
	destroyed: function(){

		
	},

	timer: function(){


	},

	_outputpassageObject: function() {
		console.log( " " + JSON.stringify(this.passageObject) + "\n" + "\n");

	},

	highlightWord: function(e)
	{
		var highlighted = (e.target.className.indexOf("highlighted") > -1);
		var classString = e.target.className;
		if(!highlighted)
		{
			classString += " highlighted";
			e.target.setAttribute("class", classString);
		}
		else
		{
			classString = classString.replace(" highlighted", "");
			e.target.className = classString;
		}
	},

	notifyResize: function()
	{
		this.splitIntoColumns(2);
	},
	
	splitIntoColumns: function(argNumColumns)
	{
	/*
		var admin = document.querySelector("#scottAdmin");
		console.log(admin);
		console.log(admin.firepad);
		var passageContent = admin.firepad.getText();
		console.log(passageContent);
    */
		var i = 0;
		var canvas = document.createElement('canvas');
		var context = canvas.getContext("2d");
		var calcFontSize = window.getComputedStyle(this.$.pringles, null).getPropertyValue('font-size');
		console.log(calcFontSize);
		var calcFontFam = window.getComputedStyle(this.$.pringles, null).getPropertyValue('font-family');
		console.log(calcFontFam);

		context.font = "13.2pt merriweather"; //calcFontSize; //"12pt Roboto"; // read from window
		/*
		var truePassageContent = passageContent.replace(/[\—]/g, " — ");
		var paragraphArray = truePassageContent.split(/\n/);
		var numParagraphs = paragraphArray.length;
		var passageWidth = self.passage_width = document.querySelector("#stanleySucks").clientWidth;
		*/
		var ref = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne/Passage_1_%40%3A_620"); //https://focused0ne.firebaseio.com/readingPassageOne");
		var self = this;
		ref.on("value", function(snap){
			var words = snap.val();
			console.log(words);
			var numWords = words.length;
			var half = numWords / 2;
			var j = 0;
			self.firstColumnWordArray = [];
			self.secondColumnWordArray = [];
			for(j=0; j<half; j++)
			{
				self.push("firstColumnWordArray", words[j]);
			}
			for(;j<numWords;j++)
			{
				self.push("secondColumnWordArray", words[j]);
			}
			//self.set("firstColumnWordArray", woids.slice(0, half));
//			self.firstColumnWordArray = woids.slice(0, half);
			//self.set("secondColumnWordArray", woids.slice(half, numWoids));
//			self.secondColumnWordArray = woids.slice(half, numWoids);
			console.log(self.firstColumnWordArray);
			console.log(self.secondColumnWordArray);

		var line = "";
		var numLines = 0;
		var containerWidth = self.$.colUno.getBoundingClientRect().width - 12;
		console.log(self.$.pringles);
		console.log("containerWidth = " + containerWidth);
		for(i=0; i < numWords; i++)
		{
			//console.log(words[i]);
			var word = words[i].word;
			if(words[i].paragraphBreak == true) //paragraph begin
			{
				console.log("a paragraph break");
				line = "aaaa" + word;
				numLines++;
			}
			else if(word == "" || word == " ")
			{
				//continue;
			}
			else
			{
				line = line + " " + word;
				currentWidth = context.measureText(line).width; //- context.measureText(spaceOffset).width;
				if(currentWidth > containerWidth)
				{
					//console.log("currentWidth = " + currentWidth + " and word = " + word);
					line = word;
					numLines++;
				}
			}
		}
		console.log(numLines);
		self.numRows = numLines;
		self.set("firstColumnLineNumberArray", self.largestLineNumberArray.slice(0, numLines/2));
		self.set("secondColumnLineNumberArray", self.largestLineNumberArray.slice(numLines/2, numLines));
		console.log(self.firstColumnaLineNumberArray);
		console.log(self.secondColumnLineNumberArray);
		var pring = self.$.pringles.getBoundingClientRect();
		console.log(pring.bottom + " " + pring.left);
/*
		var currentRow = 1;
		self.passageWordObject = {};
		self.lineMeasuredWordArrays = [];
		for(i=0; i< numParagraphs; i++)
		{
			var newPara = true;
			var wordArray = paragraphArray[i].split(/\s/g);
			var numWords = wordArray.length;
			var wordCount = 0;
			var paragraph_number = i;

			while(wordCount < numWords)
					// line loop
			{
				var currentLine = "";
				var testLine = "";
				var currentWidth = 0;
				var space="&nbsp&nbsp&nbsp&nbsp";
				var spaceOffset = "";
				var newline = true;
				if(self.$.pringles.width == 0)
				while((currentWidth + 64) < self.$.pringles.passage_width && wordCount <= numWords)
				//word loop
				{
					currentLine = testLine;
					if (testLine != "")
					{
						testLine += " "; //add a space if not beginning			      	
					}
		      		else if(wordCount == 0)
			      	{
			      		//new paragraph
			     		testLine += space;
			      		spaceOffset = "aaaaaaaaaaaaaaaaaaaaa";
			    	}
			      	var oldWidth = context.measureText(testLine).width - context.measureText(spaceOffset).width;
					testLine += wordArray[wordCount]; //add a word
					currentWidth = context.measureText(testLine).width - context.measureText(spaceOffset).width;
					var remainingWidth = passageWidth - currentWidth;
					var wordWidth = currentWidth - oldWidth;
					var currentWord = wordArray[wordCount];
					if (currentWord == undefined)
					{
						currentWord = " ";
					}
					var index = self.lineMeasuredWordArrays.length;
				//here we are building an array-like key name that is human readable
					var indexWord = self.indexWord = currentWord;
								newline = false;
								newPara = false;
								wordCount++;


							} //SINGLE word entry ends here, WOULD LOVE TO CUT THIS IN HALF
						currentRow++;
						currentWidth = 0;
						} //SINGLE line loop
					} //this is the paragraph for loop
					var arrayPassage = self.lineMeasuredWordArrays;
					ref.child("Passage_1_@:_" + passageWidth).set(arrayPassage);
					ref.child("Passage_1B:_" + self.passage_width).set(self.passageWordObject);
					alert("Passage_1B_@:_" + self.passage_width + "-----------");
					var lastElement = arrayPassage.pop();
					//var lastRow =self.lastRow[passageWidth + "_width_"] = lastOfWordArray.row;
					//alert(lastElement.row);
					self.passageWordObject = {};
					self.lineMeasuredWordArrays =[];
*/
		});
	},



	measuring:function(){


		
	}



});
</script>
</dom-module>