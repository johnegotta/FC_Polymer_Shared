<dom-module id="fc-passage-display-dashboard">
<template>
<style>
div.line-number {
	width: 28px;
	line-height: 1.2;
	font-size: 12pt;
	font-size: 1.2em;
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	padding: 6px 0px 6px 0px;
	margin: 6px 0px 6px 0px;
	
}
div.columnContainer{
	overflow-y: scroll;
}
div.passageContainer{ 
	height:calc(100vh-290px);
	margin: 1vh 1vw 1vh 0vh;
}
.highlighted {
	background: yellow;
}
div.blurb{
	line-height: 1.0;
	font-size: 1em;
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	display: block;
}
#pringles {
	margin: 0px 4px 6px 4px;
	padding: 16px;
	width:calc(100%+64px);

	
}
div.text {
	max-width: 780px;
	line-height: 1.2;
	font-size: 12pt;
	font-size: 1.2em;
	font-family: merriweather;
	font-weight: 500;
	padding: 6px;
	margin: 6px 0px 6px 0px;
	max-height: 1900px;
	min-height: 480px;
	display: flex;
	min-width: 280px !important;
	max-width: 680px !important;
	
	
}
</style>
	<firebase-collection location="https://focused0ne.firebaseio.com/readingPassageOne/Passage_1A_@:_620" data='{{passageArrayOne}}'></firebase-collection>
		<fc-splitter-jc orientation="horizontal" style="height: 1900px; width: 100vw;">	
			
<!--double-column line-number and passage vertical container--> 
			<div id="noJudge" class="layout vertical flex container left passageContainer" style="border: 2px ridge silver;">
	<!--blurb full width container-->
					<div class="layout horizontal blurb" style="margin: 12px 36px 0px 36px; max-height: 140px; border: 1px ridge red;">
					This passage is from Lydia Minatoya, The Strangeness of Beauty. Â©1999 by Lydia Minatoya. The setting is Japan in 1920. Chie and her daughter Naomi are members of the House of Fuji, a noble family.<span id="tester"> </span>
					</div>

	<!--passage-columns container-->
					<div id="pringles" class="layout horizontal flex container" style="border: 1px solid goldenrod;">
		<!--column-1-container line numbs and passage | Flex-1 keeps the columns even-->
						<div class="layout horizontal flex-1 container columnContainer" style="border: 1px solid #000066; padding-right: 12px;">
			<!--Line number container-->
					 		<div id="linenumbers" class="layout vertical line-number">
					 		<span id="lines">Lines</span>
					 			<template is="dom-repeat" items="{{firstColumnLineNumberArray}}">
     								<span hidden="{{!columnOneShowLines}}" id="col_one_line_{{index}}">{{item}}</span>
     							
    							</template>
					 		</div>
			<!--passage-1-column-1 container-->
					 		<div id="colUno" class="layout horizontal flex wrap text">
					 		<article>
					 	    	<template is="dom-repeat" items="{{firstColumnWordArray}}">
 									<template is="dom-if" if="{{item.paragraphBreak}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="one_{{item.order}}_{{item.word}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
								</template>
							</article>
					 		</div>
					 	</div>
		<!-- end-of-column-1 line number and text container-->

		<!--column-2-container line numbs and passage | Flex-1 keeps the columns veen-->
					 	<div id="secondColumnContainer" hidden="false" class="layout horizontal flex-1 container" style="border: 1px solid brown; padding-left: 12px;">
			<!--Line number container-->
					 		<div id="linenumbersright" class="layout vertical line-number">
					 		 	<template is="dom-repeat" items="{{secondColumnLineNumberArray}}">
     								<span id="col_two_line_{{index}}" hidden="{{!columnOneShowLines}}">{{item}}</span>
     								
    							</template>	
					 		</div>
			<!--end of passage-1-column-1 line number container-->
			<!--passage-1-column-2 container-->
					 		<div id="colDos" class="layout vertical text">
					 		<article>
								<template is="dom-repeat" items="{{secondColumnWordArray}}">
 									<template is="dom-if" if="{{item.paragraphBreak}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="two_{{item.order}}_{{item.word}}" hidden="{{columnOneShow}}">{{item.word}}</a>
								</template>
							</article>
					 		</div>
		<!--passage-1-column-2 container-->
					 	</div>
	<!--end of flex passage column container-->
				</div>
<!--End of top container horizontal-->
			</div>
<!--End of Vertical passage container-->

		</fc-splitter-jc>
		<content class="left horizontal layout container" select="fc-student-intake-form, fc-grid-card-portrait">		
		</content>	
	<fc-data-administrator id="scottAdmin"></fc-data-administrator>
	<paper-button on-tap="columnize">2 Columnize</paper-button>
</template>
<script>
/*FcTopViewDashboard=*/
Polymer({
	is: "fc-passage-display-dashboard", 
	behaviors: [Polymer.IronResizableBehavior],
	properties: {
		
		topClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		bottomLeftClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			}, 
		bottomRightClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		lowerRight: String,
		lowerLeft: String,
		columnNumber: {
			type: Number,
			value: 1,
			notify: true
		},
		passageWidth: {
			type: String, 
			value: function(){return this.$.noJudge.clientWidth;},
			notify: true, 
			reflectToAttributes: true
		},
		largestLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		secondColumnLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		passageArrayOne:{
			type: Array, 
			value: [],
			notify: true, 
			reflectToAttibutes: true 
		},
		passageObject: {
			type: Object,
			value:{}, 
			notify: true,
			reflectToAttributes: true
		},
		passageTitle: {
			type: String, 
			notify: true,
			reflectToAttributes: true
		},
		numWords: {
			type: Number,
			notify: true,
			reflectToAttributes: true
		},
		words: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		secondColumnWordArray: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		notify: true,
		reflectToAttributes: true
	},
	created: function(){
	},
	ready: function(){
		this.loadColumnOne;
		this.columnize;

	},
	attached: function(){
		for(i=1; i <= 220; i++)
		{
			this.push("largestLineNumberArray", i % 5 ? ".": i.toString());
		}
		this.lines = document.querySelector('#lines');
		console.log(this.lines);

       this.screenTrueHeight = (window.innerHeight - 180);
       if(this.screenTrueHeight<980){
        	this.screenTrueHeight=1080;
        	}
   		if(this.$.noJudge.clientWidth > 740){
			document.querySelector("#secondColumnContainer").hidden = false;
			this.splitIntoColumns(2);}
		else{
			document.querySelector("#secondColumnContainer").hidden = true;
			this.splitIntoColumns(1);}
		

        
		
	},
	attributeChanged: function(){
		
	},
	columnize: function()
	{
		console.log("columnize");
		this.splitIntoColumns(2);
	},
	destroyed: function(){
		
	},
	timer: function(){
	},
	_outputpassageObject: function() {
		console.log( " " + JSON.stringify(this.passageObject) + "\n" + "\n");
	},
	
	notifyResize: function()
	{
		if(this.$.noJudge.clientWidth > 740){
		document.querySelector("#secondColumnContainer").hidden = false;
		this.splitIntoColumns(2);}
		else{document.querySelector("#secondColumnContainer").hidden = true;
		this.splitIntoColumns(1);
		this._loadColUno;
		}
		this.splitIntoColumns(2);
			this._loadColUno;
	},
	
	splitIntoColumns: function(argNumColumns){
		var lineHeight = this.$.lines.clientHeight;
	
		if (this.columnNumber == argNumColumns && this.columnNumber == 1){
			this.loadColumnOne;
			var newHeight = this.$.colUno.clientHeight;
			var newLineNumbers = (hello0newHeight/lineHeight);
			this.set("firstColumnLineNumberArray", this.largestLineNumberArray.slice(0, newLineNumbers));
		}
		else {
		this.rowsOfColumnOne = Math.floor(this.screenTrueHeight/lineHeight);
		console.log(this.rowsOfColumnOne + "  hello");
		this.set("firstColumnLineNumberArray", this.largestLineNumberArray.slice(0, this.rowsOfColumnOne));
		var self = this;
		var ref = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne/Passage_1A_@:_300");
		ref.on("value", function(snapshot){
		var words = snapshot.val();
		self.reference = self.measureFont(self.$.lines);
		console.log(words + words);
		var numWords = words.length;
		console.log(numWords);
		var line = 0;
		var i = 0;
		for(i=0; i < numWords; i++)
		{	
			var word = words[i];
			console.log(words[i]);
			if(words[i].paragraphBreak == true) //paragraph begin
			{ 					console.log("a paragraph break");
				line = "aaaaa" + word;
				numLines++;
			}
			else if(word == "" || word == " ")
			{
				//continue;
			}
			else
			{
				line = line + " " + word;
			}
			var currentWidth = self.reference.measureText(line).width;
				console.log(currentWidth);
			var containerWidth = parseFloat(window.getComputedStyle(document.querySelector("#colUno"), null).getPropertyValue('width'));
				console.log("YEAH containerWidth = " + containerWidth);


				if(currentWidth >= containerWidth)
				{
					numLines++;
					if(numLines == this.colOneNumLines){
						for(;i<word[i].order;i++)
							self.set("secondColumnWordArray", words[i]);
					}
				}
				else {
						self.set("firstColumnWordArray", words[i]);
						console.log(words[i]);
				}
			
			}
		

		self.set("secondColumnLineNumberArray", self.largestLineNumberArray.slice(self.rowsOfColumnOne, self.numLines));
	
	
		});
			
	}
},

	_loadColUno: function(){
		var self=this;
		this.firstColumnWordArray=[];
		var pickle = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne/Passage_1A_@:_620");
		pickle.on("value", function(snap){
			var words = snap.val();
			var numWords = words.length;
			var i = 0;
			for(i=0; i<numWords; i++){
				self.set("firstColumnWordArray", words[i]);
				console.log(words[i]);
			}
		});
	},

	measureFont: function(textTest){
		var canvas = document.createElement('canvas');
		var context = canvas.getContext("2d");
		var calcFontSize = window.getComputedStyle(textTest, null).getPropertyValue('font-size');
		var fontSizeInt = parseInt(calcFontSize.replace('px','')); 
		fontSizeInt*=.75;
		calcFontSize = fontSizeInt.toString() + 'pt';
		var calcFontFam = window.getComputedStyle(lines, null).getPropertyValue('font-family');
		context.font= calcFontSize + " " + calcFontFam;
		console.log(context.font);
		return context;
			
		
	}
});
</script>
</dom-module>

highlightWord: function(e)
	{
		var highlighted = (e.target.className.indexOf("highlighted") > -1);
		var classString = e.target.className;
		if(!highlighted)
		{
			classString += " highlighted";
			e.target.setAttribute("class", classString);
		}
		else
		{
			classString = classString.replace(" highlighted", "");
			e.target.className = classString;
		}
	},