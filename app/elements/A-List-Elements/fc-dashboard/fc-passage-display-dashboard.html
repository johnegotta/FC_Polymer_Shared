<dom-module id="fc-passage-display-dashboard">
<template>
<style>
div.line-number {
	width: 28px;
	line-height: 1.25;
	font-size: 12pt;
	font-size: 1.25em;
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	padding: 6px 0px 6px 0px;
	margin: 6px 0px 6px 0px;
	
}
div.columnContainer{
	overflow-y: scroll;
}
div.passageContainer{ 
	max-width: 1450px !important;
	margin: 1vh 12px 1vh 12px;
}
.highlighted {
	background: yellow;
}
div.blurb{
	line-height: 1.0;
	font-size: 1em;
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	display: block;
}
#pringles {
	margin: 0px 4px 6px 4px;
	padding: 16px;
	width:calc(100%+64px);

	
}
div.text {

	line-height: 1.25;
	font-size: 12pt;
	font-size: 1.25em;
	font-family: merriweather;
	font-weight: 500;
	padding: 6px;
	margin: 6px 0px 6px 0px;
	min-height: 720px;
	display: flex;
	min-width: 240px !important;
	max-width: 680px !important;
	min-height: 720px;
	
	
}
</style>
	<firebase-collection location="https://focused0ne.firebaseio.com/readingPassageOne/Passage_2A_443" order-by-child="instance" data='{{passageArrayOne}}'></firebase-collection>
		
			
<!--double-column line-number and passage vertical container--> 
			<div id="noJudge" class="layout vertical flex container left passageContainer">
	<!--blurb full width container-->
					<div class="layout horizontal blurb" style="margin: 12px 24px 0px 24px;min-width: 240px !important; max-width: 680px !important; max-height: 140px;">
					The following passage is excerpted from an autobiographical sketch of a former social and political activist for civil rights.<span id="tester"> </span>
					</div>

	<!--passage-columns container-->
					
		<!--column-1-container line numbs and passage | Flex-1 keeps the columns even-->
				<div id="singleColumnPassage" class="layout horizontal container columnContainer" style="padding-right: 12px;">
			<!--Line number container-->
					 		<div id="linenumbersA1" class="layout vertical line-number">
					 		<span id="linesA1">Lines</span>
					 			<template is="dom-repeat" items="{{firstColumnLineNumberArrayOne}}">
     								<span hidden="{{!item.show}}" id="col_one_line_{{index}}">{{item.number}}</span><span hidden="{{item.show}}">&nbsp</span>
     							
    							</template>
					 		</div>
			<!--passage-1-column-1 container-->
					 		<div id="colUnoA" class="layout horizontal flex wrap text">
					 		<article>
					 	    	<template is="dom-repeat" items="{{firstColumnWordArrayOne}}">
 									<template is="dom-if" if="{{item.paragraphBreak}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="oneA_{{index}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
								</template>
									<br class="line-numbers">
									<hr>
								<span class="right-justified line-numbers" style="float:right; text-align: right;" id="singleColumnBounder"> Focused Coaching (c) 2016</span>
							</article>
					 		</div>
					 	</div>
		<!-- end-of-column-1 line number and text container-->
					<div id="doubleColumnContainer" class="layout horizontal flex container">
						<div class="layout horizontal flex-1 container columnContainer" style="padding-right: 12px; overflow-y:scroll;">
			<!--Line number container-->
					 		<div id="linenumbers" class="layout vertical line-number">
					 		<span id="lines">Lines</span>
					 			<template is="dom-repeat" items="{{firstColumnLineNumberArrayTwo}}">
     								<span hidden="{{!item.show}}" id="col_one_line_{{index}}">{{item.number}}</span><span hidden="{{item.show}}">&nbsp</span>
     							
    							</template>
    							
					 		</div>
			<!--passage-1-column-1 container-->
					 		<div id="colUno" class="layout horizontal flex wrap text">
					 		<article>
					 	    	<template is="dom-repeat" items="{{firstColumnWordArrayTwo}}">
 									<template is="dom-if" if="{{item.paragraphBreak}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="one_{{item.index}}_{{item.word}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
								</template>
								<br class="line-numbers">
								<hr>
								<span class="right right-justified line-numbers" style="float:right; text-align: right;" id="doubleColumnBounderOne"> Focused Coaching (c) 2016</span>
							</article>
					 		</div>
					 	</div>
		<!-- end-of-column-1 line number and text container-->

		<!--column-2-container line numbs and passage | Flex-1 keeps the columns veen-->
					 	<div id="secondColumnContainer" class="layout horizontal flex-1 container" style="padding-left: 12px;overflow-y:scroll;">
			<!--Line number container-->
					 		<div id="linenumbersright" class="layout vertical line-number">
					 		 	<template is="dom-repeat" items="{{secondColumnLineNumberArrayTwo}}">
     								<span hidden="{{!item.show}}" id="col_one_line_{{index}}">{{item.number}}</span><span hidden="{{item.show}}">&nbsp</span>
     								
    							</template>	
					 		</div>
			<!--end of passage-1-column-1 line number container-->
			<!--passage-1-column-2 container-->
					 		<div id="colDos" class="layout vertical text">
					 		<article>
								<template is="dom-repeat" items="{{secondColumnWordArrayTwo}}">
 									<template is="dom-if" if="{{item.paragraphBreak}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="two_{{item.order}}_{{item.word}}" hidden="{{columnOneShow}}">{{item.word}}</a>
								</template>
								<br class="line-numbers">
								<span class="right right-justified line-numbers" style="float:right; text-align: right;" id="doubleColumnBounderTwo"> End of Passage</span>
							</article>
					 		</div>
		<!--passage-1-column-2 container-->
					 	</div>
	<!--end of flex passage column container-->
				</div>
<!--End of top container horizontal-->
			</div>
<!--End of Vertical passage container-->

		
		<content class="left horizontal layout container" select="fc-student-intake-form, fc-grid-card-portrait">		
		</content>	
</template>
<script>
/*FcTopViewDashboard=*/
Polymer({
	is: "fc-passage-display-dashboard", 
	behaviors: [Polymer.IronResizableBehavior],
	properties: {
		
		topClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		bottomLeftClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			}, 
		bottomRightClassHidden: {
			type: Boolean, 
			value: true, 
		/*	observe: however you do this Scott,*/
			reflectToAttributes: true,
			notify: true
			},
		lowerRight: String,
		lowerLeft: String,
		columnNumber: {
			type: Number,
			value: 1,
			notify: true
		},
		largestLineNumberArray: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArrayOne: {
			type: Array,
			value: [],
			notify: true
		},
		firstColumnLineNumberArrayTwo: {
			type: Array,
			value: [],
			notify: true
		},
		secondColumnLineNumberArrayTwo: {
			type: Array,
			value: [],
			notify: true
		},
		passageArrayOne:{
			type: Array, 
			value: [],
			notify: true, 
			reflectToAttibutes: true 
		},
		passageTitle: {
			type: String, 
			notify: true,
			reflectToAttributes: true
		},
		numWords: {
			type: Number,
			notify: true,
			reflectToAttributes: true
		},
		firstColumnWordArrayTwo: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		secondColumnWordArrayTwo: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		firstColumnWordArrayOne: {
			type: Array,
			value: [],
			notify: true,
			reflectToAttributes: true
		},
		linesH: {
			type: String,
			value: '',
			notify: true
		},
		
		goldenRatio: {
			type: Number,
			notify: true,
			reflectToAttributes: true
		},
		notify: true,
		reflectToAttributes: true
	},


	attached: function(){

		for(i=1; i <= 250; i++)
			{
			j=	i % 5 ? false: true;
			this.push("largestLineNumberArray", {'number': i, 'show': j});
			}
		this.loadPassages();
		},


	loadPassages: function(){
		console.log("loadPassage here " + " am I -->  undefined")
		this.passageArrayOne=[];
		var self = this;
		var ref = new Firebase("https://focused0ne.firebaseio.com/readingPassageOne/Passage_2A_443");
		ref.on("value", function(snap){
			self.passageArrayOne = snap.val();
			self.numWords = self.passageArrayOne.length;
			self.firstColumnWordArrayOne=snap.val();
			self.goldenRatio = Math.floor(.65*self.numWords)+3;
			self.firstColumnWordArrayTwo=self.passageArrayOne.slice(0,self.goldenRatio);
			self.secondColumnWordArrayTwo= self.passageArrayOne.slice(self.goldenRatio, self.numWords);
		});
			
			this.notifyResize();
	},


	notifyResize: function(){		
		this.setUp();

	},
	
	setUp: function(){
		this.screenTrueHeight =  (window.innerHeight-300);
		if(this.colUnoHeight!=undefined && this.colUnoHeight >=250){
			if(this.$.noJudge.clientWidth >= 660 && this.colUnoHeight>this.screenTrueHeight){
				document.querySelector("#singleColumnPassage").hidden = true;
				document.querySelector("#doubleColumnContainer").hidden = false;
				this._numberTwoColumns();
			}
			else{
				document.querySelector("#doubleColumnContainer").hidden = true;
				document.querySelector("#singleColumnPassage").hidden = false;
				this.linesH = this.$.linesA1.clientHeight;
				this._numberColumnOne();
			}
		}
		else {
			if(this.$.noJudge.clientWidth >= 660){
				document.querySelector("#singleColumnPassage").hidden = true;
				document.querySelector("#doubleColumnContainer").hidden = false;
				this.colUnoHeight=this.$.colUno.scrollHeight;
				if(this.colUnoHeight < this.screenTrueHeight){
					document.querySelector("#doubleColumnContainer").hidden = true;
					document.querySelector("#singleColumnPassage").hidden = false;
					this.linesH = this.$.linesA1.clientHeight;
					this._numberColumnOne();
					}
				//else{this._numberTwoColumns();}
			}
			else{
				document.querySelector("#doubleColumnContainer").hidden = true;
				document.querySelector("#singleColumnPassage").hidden = false;
				this.linesH = this.$.linesA1.clientHeight;
				this._numberColumnOne();
			}


		}
		
	},
	_numberColumnOne: function(){
		this.screenTrueHeight =  (window.innerHeight - 300);
		if (this.linesH != 0 && this.linesH != undefined)
		{
			var topDistance = document.querySelector('#singleColumnBounder').getBoundingClientRect().top;
			var basis = document.querySelector('#linesA1').getBoundingClientRect().top;
			var delta = topDistance - basis;
			console.log(delta);console.log(topDistance);console.log(topDistance);console.log(delta);console.log(delta);
			this.numLines = (delta/document.querySelector('#linesA1').clientHeight)-1;
			this.set("firstColumnLineNumberArrayOne", this.largestLineNumberArray.slice(0,this.numLines));
		}
		this.fire('dom-change');
	},

	_numberTwoColumns: function(){
		this.linesH = this.$.lines.clientHeight;
		if (this.linesH != 0 && this.linesH != undefined)
		{
			var topDistance = this.$.doubleColumnBounderOne.getBoundingClientRect().top;
			var basis = this.$.lines.getBoundingClientRect().top;
			var delta = topDistance - basis;
			var rowsColumnOne = delta/this.linesH-2;

			this.set("firstColumnLineNumberArrayTwo", this.largestLineNumberArray.slice(0,rowsColumnOne));
//Lines Col one
			var topDistanceTwo = this.$.doubleColumnBounderTwo.getBoundingClientRect().top;
			var deltaTwo = topDistanceTwo - basis;
//Distance fro col 2
			this.rowsColumnTwo = deltaTwo/this.linesH;
			var numLines= rowsColumnOne + this.rowsColumnTwo;
//set col two
			this.set("secondColumnLineNumberArrayTwo", this.largestLineNumberArray.slice(rowsColumnOne, numLines));
			this.colUnoHeight=this.$.colUno.scrollHeight;
			}
			else { _NumberTwoColumns();

			}
			this.fire('dom-change');

	}

	});
</script>
</dom-module>

highlightWord: function(e)
	{
		var highlighted = (e.target.className.indexOf("highlighted") > -1);
		var classString = e.target.className;
		if(!highlighted)
		{
			classString += " highlighted";
			e.target.setAttribute("class", classString);
		}
		else
		{
			classString = classString.replace(" highlighted", "");
			e.target.className = classString;
		}
	},

		measureFont: function(textTest){
		var lines = this.$.lines;		
		var canvas = document.createElement('canvas');
		var context = canvas.getContext("2d");
		this.context = context;
		var calcFontSize = window.getComputedStyle(textTest, null).getPropertyValue('font-size');
		var fontSizeInt = parseInt(calcFontSize.replace('px',''));
		calcFontSize = fontSizeInt.toString() + 'pt';
		var calcFontFam = window.getComputedStyle(lines, null).getPropertyValue('font-family');
		this.context.font = context.font = calcFontSize + " " + calcFontFam;
		console.log(context.font);
		console.log(context + ' ' + this.context);
		return context;
				
	},