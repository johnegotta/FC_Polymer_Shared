<script>
"use strict";

class Day{
	constructor(argDay){this.buildDay(argDay.date, argDay.location);
		}


	buildDay(date, location)
	{
		//this.timeSlotsArray=  ["what the heck","super-fail"] || [];
		this.date=new Date(date) || "";
		this.isHoliday= function(date){ 
			var holidayArray = [];
			holidayArray =[ {"name": "Daylight Saving Time", "Date":[2016,3,13]	}, 
				{"name": "St. Patrick's Day", "Date":[2016,3,17]	},
				{"name": "Palm Sunday", "Date":[2016,3,20], "isBookable": true	}, 
				{"name": "Passover Begins", "Date": [2016,3,23], "isBookable": true	},
				{"name": "Purim", "Date": [2016,3,24], "isBookable": true	}, 
				{"name": "Good Friday", "Date": [2016,3,25], "isBookable": true	},
				{"name": "Easter", "Date": [2016,3,27], 'isBookable': false	},
				{"name": "Orthodox Good Friday", "Date": [2016,4,29], 'isBookable': true},
				{"name": "Last Day of Passover", "Date": [2016,4,30],	"isBookabkle": true}, 
				{"name": "Yom HaShoah", "Date": [2016,5,4],	"isBookable": true}, 
				{"name": "Isra and Mi'raj, Cinco Di Mayo", "Date": [2016,5,5], "isBookable": true	}, 
				{"name": "MOTHERS DAY!!!", "Date": [2016,5,8], "isBookable": false},
				{"name": "Memorial Day", "Date": [2016,5,30], "isBookable": true},
				{"name": "Ramadan Begins", "Date": [2016,6,7], "isBookable": true},
				{"name": "Father's Day", "Date": [2016,6,19], "isBookable": false},
				{"name": "Independence Day July 4", "Date": [2016,7,4], "isBookable": false},
				{"name": "Labor Day", "Date": [2016,9,5], "isBookable": true},
				{"name": "Rosh Hashana, Muharram", "Date": [2016,10,3], "isBookable": true},
				{"name": "Columbus Day", "Date": [2016,10,10], "isBookable": true},
				{"name": "Yom Kippur", "Date": [2016,10,12], "isBookable": true	},
				{"name": "Diwali", "Date": [2016,10,29], "isBookable": true	},
				{"name": "Halloween", "Date": [2016,10,31],	"isBookable": false},
				{"name": "Veterans Day", "Date": [2016,11,11], "isBookable": true},
				{"name": "Thanksgiving", "Date": [2016,11,24], "isBookable": false},
				{"name": "Thanksgiving", "Date": [2016,11,25],"isBookable": false	}, 
				{"name": "Christmas Eve", "Date": [2016,12,24],"isBookable": false	},
				{"name": "Christmas", "Date": [2016,12,25],	"isBookable": false},
				{"name": "New Year's Eve", "Date": [2016,12,31], "isBookable": false}
				];
			var length = holidayArray.length;
			var i=0;
			for(i=0;i<counter;i++)
			{
				var d=new Date(holidayArray[i]);
				if (date.toLocaleString()==d.toLocaleString)
				{
				this.set("isHoliday",holidayArray[i].name);
				var bookable=isHoliday.isBookable;
				this.isBookable=bookable; 
				return holidayArray[i].name;
				}
			 else
			 	{
			 		return "";
			 	}
			}
		}

			
	}
}

class FcTestEvents{
	constructor(){
	

	var mayDate = [2016, 5, 7];
	var juneDate = [2016, 6, 4];
	var augFDate = [2016, 8, 6];
	var octDate = [2016, 10, 1];
	var novDate = [2016, 11, 5];
	var decDate = [2016, 12, 3];
	var janDate = [2017, 1, 28];
	var marDate = [2017, 3, 11];
	var may2Date = [2017, 5, 6];
	var june2Date = [2017, 6, 3];
	var aug1Date = [2017, 8, 26];
	var oct2Date = [2017, 10, 7];
	var nov2Date = [2017, 11, 4];
	var dec2Date = [2017, 12, 2];
	var mar2Date = [2018, 3, 10];
	var may3Date = [2018, 5, 5];
	var june3Date = [2018, 6, 2];
	var aug2Date = [2018, 8, 25];
	var oct3Date = [2018, 10, 6];
	var nov3Date = [2018, 11, 3];
	var dec3Date = [2018, 12, 1];
	var mar3Date = [2019, 3, 9];
	var may4Date = [2019, 5, 4];
	var june4Date = [2019, 6, 1];
	var allTestDates = [];
	allTestDates = [mayDate, juneDate, augFDate, octDate, novDate, decDate, janDate, marDate, may2Date, june2Date, aug1Date, oct2Date, nov2Date, dec2Date, mar2Date, may3Date, june3Date, aug2Date, oct3Date, nov3Date, dec3Date, mar3Date, may4Date, june4Date];
	var counter = allTestDates.length;
	var i = 0;
	var allDates = [];
	for (i = 0; i < counter; i++) 
	{
		var testSet = [];
		var j = 0;
		var Mon_Wed =[];
		var Tue_Thu=[];
		for (j = 0; j < 6; j++) {
			var d = new Date(allTestDates[i]);
			var monday = new Date(allTestDates[i]);
			var tuesday = new Date(allTestDates[i]);
			var wednesday = new Date(allTestDates[i]);
			var thursday = new Date(allTestDates[i]);
			var friday = new Date(allTestDates[i]); 
			var p = j*7+7;
			var mon = j*7+5;
			var tue= j*7+4;
			var wed= j*7+3;
			var thu= j*7+2;
			var fri= j*7+1;
			d.setDate(d.getDate() - p);
			monday.setDate(monday.getDate() - mon);
			tuesday.setDate(tuesday.getDate() - tue);
			wednesday.setDate(wednesday.getDate() - wed);
			thursday.setDate(thursday.getDate() - thu);
			friday.setDate(friday.getDate() - fri);

			testSet.push(d.toDateString());
			
			Mon_Wed.push(wednesday.toDateString());
			Mon_Wed.push(monday.toDateString());
			
			Tue_Thu.push(thursday.toDateString());
			Tue_Thu.push(tuesday.toDateString());
		}
		var testD = new Date(allTestDates[i]).toDateString();
		allDates.push({testD: testSet.reverse()});
		// allDates.push(testSet);
		//var elem=document.createElement("LI");
		this.saturdayPracticeTests=[];
		var saturdayTests="Focused Practice SATs for the " + testD +" SAT test will be held on the following dates at 9:00am: "+ testSet;
		this.saturdayPracticeTests.push(saturdayTests);
		console.log(this.saturdayPracticeTests, this.mondayWednesdayCourse);
	
		var monwed = "Focused Monday Wednesday 6:00pm to 9:00pm Course for the " + testD +" SAT test will be held on the following dates: "+ Mon_Wed.reverse();
		this.mondayWednesdayCourse=[];
		this.mondayWednesdayCourse.push(monwed);	
		
		
		var tuesthurs="Focused Tuesday Thursday 6:00pm to 9:00pm Course for the " + testD +" SAT test will be held on the following dates: "+ Tue_Thu.reverse();
		this.tuesdayThursdayCourse=[];
		this.tuesdayThursdayCourse.push(tuesthurs);	
	}
		var allDates = [];
	for (i = 0; i < counter; i++) 
	{
		var testSet = [];
		var j = 0;
		for (j = 0; j < 6; j++) {
			var d = new Date(allTestDates[i]);
			var p = j*7+6;
			d.setDate(d.getDate() - p);
			testSet.push(d.toDateString());
		}
		var testD = new Date(allTestDates[i]).toDateString();
		allDates.push({testD: testSet.reverse()});
		var sundaytest="Focused Practice SATs for the " + testD +" SAT test will be held on the following dates at 9:00am: "+ testSet;
		this.sundayTests=[];
		this.sundayTests.push(sundaytest);	
		console.log(this.sundayTests, this.tuesdayThursdayCourse);
		}
	}
}
class FcEvent {
  constructor(argEvent){
      this.build(argEvent.name, argEvent.startTime, argEvent.endTime, argEvent.fcid, argEvent.location, argEvent.completed, argEvent.relatedFcids, argEvent.parentEventName, argEvent.parentEventFcid, argEvent.coach)
  }
  build(name, startTime, endTime, fcid, location, completed, relatedFcids,  parentEventName, parentEventFcid, coach)
  {
    this.name=name || ""; 
    var ref = new Firebase("https://focused0ne.firebaseio.com/events");
    var self= this;
    ref.child('counter').transaction(function(argCounter){return argCounter+1;}, function(error, isSuccessful, finalVal){if(isSuccessful){self.fcid=finalVal;}});
    this.startTime=new Date(startTime) || ""; 
    this.endTime=new Date(endTime) || ""; 
    this.location=location || ""; 
    this.completed=completed || false;
    this.relatedFcids=relatedFcids || "";  
    this.parentEventName=parentEventName || ""; 
    this.parentEventFcid=parentEventFcid || "";
  var d=new Date(setDay);
			d.setDay(d.getDay());
		this.dateFcid= d.getMilliseconds() + "_datefcid";
		this.setDay=setDay || "doSomething that looks both ways at nearby dates: see previous field;";
		this.setInputs = setInputs || [];
		this.size=size || [];//measure if you have to using javascript
		this.month=month || "";
		this.day = day || "";
		this.year =year || "";
 // static getFirebaseLocation(){return "https://focused0ne.firebaseio.com/events";}
  }
}      

Date.prototype.assignFullMonth = function()
{
	var dat = new Date(this.valueOf());
	var monArray = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
	return monArray[dat.getMonth()];
}

function TimeSlots(){
				var timeArr = [];
        		for(var i=12; i<=48;i++){
              var hour=(Math.floor(i/2) <13)?Math.floor(i/2):(Math.floor(i/2)-12);
              var j=false;
              j=(i>47)?true:false;
              if(hour<10){hour='0'+hour.toString();}
              var space=(i<20)?true: false;
              var halfhour=(i%2==0)?0:3;
              var ampm=(i<24)?"am":(j==true)?"am":"pm";
              var tobj = {"hour": hour,
                          "halfhour": halfhour,
                          "ampm": ampm, 
                          "space": space
                        };
              var string=hour.toString() + ":" + halfhour.toString() + "0"+ ampm;
              var obj2={"label": string, "val": "open", "name": string};
              timeArr.push(obj2);
          }
          return timeArr;
         }


   function getDates(startDate, stopDate) {
      var dateArray = new Array();
      var currentDate = startDate;
      while (currentDate <= stopDate) {
        dateArray.push(currentDate)
        currentDate = currentDate.addDays(1);
      }
      return dateArray;
    }

Date.prototype.addDays = function(days) {
       var dat = new Date(this.valueOf())
       dat.setDate(dat.getDate() + days);
       return dat;
}


	
function getShortDays(numChars, argDay)
{	var shortDaysArray = [Su,M,Tu,W,Th,F,Sa];
	var singlesArray = [M,W,F];
	var dayBlocks=["M|W|F","Tu|Th"];
 	var md = argDay;
			if(numChars>2)
			{
			md=md.slice(0,numChars);
			return md;
			}
			else
				{
					var letters = md.slice(0,2);
					var lilLetters=md.slice(0,1);
					if(	shortDaysArray.indexOf(letters)!==-1)
						{
							var john = singlesArray.indexOf(lilLetters);
							console.log(singlesArray[john]);
							return singlesArray[john];
						}
					else {var retVal= shortDaysArray.indexOf(letters);
						console.log(shortDaysArray[retVal]);
							return shortDaysArray[retVal];
						}
				}
		}


// function CalendarConstructor()
// Date.prototype.createClassSchedule= function(startDate, endDate, fcidObj)	
// {



// 		}
// Date.prototype.createClassSyllabus=function(classSchedule, materialList)
// {}
// Date.prototype.getDaysOfWeekLong=function()
// {}


//    function getDates(startDate, stopDate) {
//       var dateArray = new Array();
//       var currentDate = startDate;
//       while (currentDate <= stopDate) {
//         dateArray.push(currentDate)
//         currentDate = currentDate.addDays(1);
//       }
//       return dateArray;
//     }
window.FCBehaviors = window.FCBehaviors || {};
FCBehaviors.FcCalendarBehaviorPrime = {
	properties: {
		 startDate:{
		 	type: Date,
		 	notify: true
		 },
		 endDate:{
		 	type: Date,
		 	notify: true
		 },
		displayedMonthIndex:{
			type: Number,
			notify: true
		},
		theDate:{
			type: Date,
			notify: true
		},
		displayedMonth:{
			type: Array,
			value: [],
			notify: true
		},
		monthsArray:{
			type: Array,
			value: function(){return [];},
			notify: true
		},
		dayOfWeek: {
			type: String,
			notify: true
		},
		date: {
			type: Array,
			value: function(){ return [];},
			notify: true
		},
		year: {
			type: String,
			notify: true
		},
		day:{
			type: Date,
			notify: true
		},
		dayArray:{
			type: Array,
			value: [],
			notify: true
		},
		days:{
			type: Array,
			value: function()
			{
					return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
			},
			notify: true
		}, 
		
		month: {
			type: String,
			value:"",
			notify: true
		}, 
		units:{
			type: String,
			value:"months",
			notify: true

		}


	},


	attached: function(){
	
		// this.calendarCreator()
	},

	calendarCreator: function(start, end, units)
	{	
		if (units!=undefined && units!=null){this.set("units", units);} 
		var startDate=(start!=null)?start:(new Date()).addDays(0);
		var endDate = (end!=null)?end:(new Date()).addDays(120);
		var i=0;
		console.log(startDate, endDate);
		if(endDate<=startDate)
			{
				var startDateHolder=startDate;
				startDate=[];
				startDate=endDate;
				endDate=[];
				endDate=startDateHolder; 
				//console.log(startDate, startDateHolder, endDate);
			}//date crossing condition
		while(startDate.getDay() != 0)//filling beginning week of calendar
		{
			startDate = startDate.addDays(-1);
			
		}
		//console.log(endDate);
		// var endDate = (new Date()).addDays(+1);//took care of crossing condition on start and end of utilizin talent
		while(endDate.getDay() != 6)
		{
			endDate = endDate.addDays(+1);
			
		}
		
		this.set('date', getDates(startDate, endDate));
		//console.log(this.date);
		var numDays = this.date.length;
		var currentMonth = 0; 
		for (i = 0; i < numDays; i++) 
		{
			var currDate = this.date[i];
			//var dayE = this.setHolidays(currDate);

			if(i==0)
			{	
				this.push("monthsArray", []);
				this.monthsArray[currentMonth].push(currDate);
				this.set("month", currDate.assignFullMonth());
			}
			else if(i>0)
			{
				var currDate = this.date[i];
				var yesterday = this.date[i-1];
				var dateYester = yesterday.toDateString();
				var dateToday = currDate.toDateString();
				if(currDate.assignFullMonth() != yesterday.assignFullMonth() && this.units=="months")
				{	
					this.push("monthsArray", [currDate]);
					currentMonth++;
				}
				else
				{	
					this.monthsArray[currentMonth].push(currDate);
					
				}
			}
		}
		this.padMonths();
		this.set("displayedMonth", this.monthsArray[0]);
		this.set("year", this.displayedMonth[0].getFullYear());
		this.set("displayedMonthIndex",0);
		var numDizDays = this.displayedMonth.length;
		this.set("month", this.displayedMonth[numDizDays-1].assignFullMonth());
		

	},//end of function

	padMonths: function()
	{	var month=[];
		var i = 0;
		var numMonths = this.monthsArray.length;
		for(i=1; i < numMonths; i++)
		{
			month = this.monthsArray[i];
			console.log(month);
			var lastMonth = this.monthsArray[i-1];
			var numDaysPrevMonth = this.monthsArray[i-1].length;
			var fillerDay = numDaysPrevMonth - 1;
			while (month[0].getDay() != 0)
			{
				month.unshift(this.monthsArray[i-1][fillerDay--]);
			}
			//console.log(this.monthsArray[i]);
		}
	},


	_backOneMonth:function(){
		if(this.displayedMonthIndex==0){
			var counter =this.monthsArray.length-1;
			this.set("displayedMonth", this.monthsArray[counter]);
			this.displayedMonthIndex=counter;
		}
		else{
			var diLess=this.displayedMonthIndex-1;
			this.set("displayedMonth", this.monthsArray[diLess]);
			this.displayedMonthIndex--;
		}
		var length=(this.displayedMonth.length-1);
		var month = this.displayedMonth[length].assignFullMonth();
			var year = this.displayedMonth[length].getFullYear();
			this.set("month",month);
			//console.log(year);
			this.set("year", year);
	},

	_forwardOneMonth:function(){
console.log( "index", this.displayedMonthIndex, "year", this.year, "month0", this.displayedMonth[0], "length again", this.displayedMonth.length)
		if(this.displayedMonthIndex==this.monthsArray.length-1)
		{
			this.set("displayedMonth",this.monthsArray[0]);
			this.displayedMonthIndex=0;						
		}
		else{
			var diMore=this.displayedMonthIndex+1;
			this.set("displayedMonth", this.monthsArray[diMore]);
			this.displayedMonthIndex=diMore;
			
		}
		console.log(this.displayedMonth);
		var length=this.displayedMonth.length-1;
		var month = this.displayedMonth[length].assignFullMonth();
		var year = this.displayedMonth[length].getFullYear();
			this.set("month",month);
		
			this.set("year", year);
			
	},
setHolidays: function(dayE){ 
      var holidayArray = [];
      holidayArray = [{"name": "Daylight Saving Time", "holiday":[2016,3,13]  }, 
        {"name": "St. Patrick's Day", "holiday":[2016,3,17] },
        {"name": "Palm Sunday", "holiday":[2016,3,20] }, 
        {"name": "Passover Begins", "holiday": [2016,3,23]  },
        {"name": "Purim", "holiday": [2016,3,24]  }, 
        {"name": "Good Friday", "holiday": [2016,3,25]  },
        {"name": "Easter", "holiday": [2016,3,27] },
        {"name": "Orthodox Good Friday", "holiday": [2016,4,29] },
        {"name": "Last Day of Passover", "holiday": [2016,4,30] }, 
        {"name": "Yom HaShoah", "holiday": [2016,5,4] }, 
        {"name": "Isra and Mi'raj, Cinco Di Mayo", "holiday": [2016,5,5]  }, 
        {"name": "MOTHERS DAY!!!", "holiday": [2016,5,8]  },
        {"name": "Memorial Day", "holiday": [2016,5,30] },
        {"name": "Ramadan Begins", "holiday": [2016,6,7]  },
        {"name": "Father's Day", "holiday": [2016,6,19] },
        {"name": "Independence Day July 4", "holiday": [2016,7,4] },
        {"name": "Labor Day", "holiday": [2016,9,5] },
        {"name": "Rosh Hashana, Muharram", "holiday": [2016,10,3] },
        {"name": "Columbus Day", "holiday": [2016,10,10]  },
        {"name": "Yom Kippur", "holiday": [2016,10,12]  },
        {"name": "Diwali", "holiday": [2016,10,29]  },
        {"name": "Halloween", "holiday": [2016,10,31] },
        {"name": "Veterans Day", "holiday": [2016,11,11]  },
        {"name": "Thanksgiving", "holiday": [2016,11,24]  },
        {"name": "Thanksgiving", "holiday": [2016,11,25]  }, 
        {"name": "Christmas Eve", "holiday": [2016,12,24] },
        {"name": "Christmas", "holiday": [2016,12,25] },
        {"name": "New Year's Eve", "holiday": [2016,12,31]  }
        ];
  
      var counter = holidayArray.length;
      var i=0;
      var eventDay={};
      eventDay.holiday='';
      eventDay.date=dayE;
      for(i=0;i<counter;i++){
        var holiday = new Date(holidayArray[i].holiday);
     // if(dayE.getDate()==4){console.log(holiday, dayE);}
        if (dayE.toLocaleString() == holiday.toLocaleString()){

           eventDay.holiday+= holidayArray[i].name + " ";
           console.log(holiday, holiday, eventDay.holiday);
        }
        if (eventDay.holiday!='' && dayE!=holiday)
          {return eventDay;}
      }
      return eventDay;

    },

	_computeTheMonths: function(input){

	var mon=(displayedMonth==undefined || displayedMonth==[])? month:displayedMonth[displayedMonthIndex].toString().substring(4,7);
		var returnVal =(mon=="Feb")?"February": (mon=="Mar")?"March":(mon=="Apr")?"April": (mon=="May")?"May":(mon=="Jun")?"June":(mon=="Jul")?"July":(mon=="Aug")?"August":(mon=="Sep")?"September":(mon=="Oct")?"October": (mon=="Nov")?"November":(mon=="Dec")?"December":"January";  
		console.log(returnVal);
			return returnVal;

	}

};
</script>