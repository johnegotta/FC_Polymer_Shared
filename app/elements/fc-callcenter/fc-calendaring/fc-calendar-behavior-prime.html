<script>
"use strict";

function fcCreateBaseLineEvents(startDate,stopDate){
     var daysArray = [];
	 daysArray=getDates(startDate,stopDate);
	 var counter =argDays.length;
	 var eventDaysArrayII=[];
		for(var i=0;i<counter;i++)
		{
			var aDay= this.holidayEvents(argDays[i]);
		 	var aDay2 =	this.satTestCourseEvents(aDay);
		 	daysArray.push(aDay2);
		}
	}
	
	

// satTestCourseEvents(argDate){
// 	allTestDates=[[2016, 5, 7],[2016, 6, 4],[2016, 8, 6],[2016,10,1],[2016,11,5],[2016,12,3],[2017,1,28],[2017,3,11],[2017, 5, 6], [2017, 6, 3],[2017, 8, 26],[2017, 10, 7],[2017,11,4],[2017, 12, 2],[2018,3, 10],[2018, 5, 5], [2018, 6, 2], [2018, 8, 25], [2018, 10, 6],[2018,11,3],[2018,12,1],[2019,3, 9],[2019,5,4],[2019, 6, 1]];
// 	var counter = allTestDates.length;
// 	var i = 0;
// 	var allDates = [];
// 	var theDay={};
// 	theDay.date=argDay;
// 	console.log(theDay.date);
// 	theDay.events=[];
// 	for (i = 0; i < counter; i++) 
// 	{		
// 		var daytwo = argDay;
		
// 		var testSet = [];
// 		var j = 0;
// 		var Mon_Wed =[];
// 		var Tue_Thu=[];
// 		for (j = 0; j < 6; j++) 
// 		{
// 			var saturday =new Date(allTestDates[i]);
// 			var testDate=new Date(allTestDates[i]);
// 			var sunday = new Date(allTestDates[i]);
// 			var monday = new Date(allTestDates[i]);
// 			var tuesday = new Date(allTestDates[i]);
// 			var wednesday = new Date(allTestDates[i]);
// 			var thursday = new Date(allTestDates[i]);
// 			var friday = new Date(allTestDates[i]); 
// 			var sat = j*7+7;
// 			var sun=j*7+6
// 			var mon = j*7+5;
// 			var tue= j*7+4;
// 			var wed= j*7+3;
// 			var thu= j*7+2;
// 			var fri= j*7+1;
// 			var event={};
// 			friday.setDate(friday.getDate() - fri);
// 			saturday.setDate(saturday.getDate() - sat);
// 			sunday.setDate(sunday.getDate()-sun);
// 			monday.setDate(monday.getDate() - mon);
// 			tuesday.setDate(tuesday.getDate() - tue);
// 			wednesday.setDate(wednesday.getDate() - wed);
// 			thursday.setDate(thursday.getDate() - thu);
// 			if(i==0 && daytwo.toLocaleString()==testDate.toLocaleString())
// 			{   
// 				event.testDate=testDate;
// 				event.isTestDate=true;
// 				event.shortLabel="Real SAT Test Date"
// 				event.startTime=new Date.setHours(7,0,0);
// 				event.endTime=new Date.setHours(12,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_700AMSaturdayTest";
// 				events.push(event);
// 				event={};
// 			}
			
// 			else if(daytwo.toLocaleString()==saturday.toLocaleString())
// 			{	
// 				event.practiceTestDate=saturday;
// 				event.isPracticeTestDate=true;
// 				event.shortLabel="Saturday Practice Test";
// 				event.startTime=new Date.setHours(9,0,0);
// 				event.endTime=new Date.setHours(12,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_900AMSaturdayPTest";
// 				events.push(event);
// 				event={};
// 			}
		
// 			else if(daytwo.toLocaleString()==monday.toLocaleString())
// 			{
// 				event.practiceTestDate=sunday;
// 				event.isPracticeTestDate=true;
// 				event.shortLabel="Sunday Practice Test";
// 				event.startTime=new Date.setHours(9,0,0);
// 				event.endTime=new Date.setHours(12,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_900AMSundayPTest";
// 				events.push(event);
// 				event={};
// 			}
		
// 			else if(daytwo.toLocaleString()==monday.toLocaleString())
// 			{
// 				event.monday6to9TestClass=monday;
// 				event.isMonday6to9TestClass=true;
// 				event.labelLong="Class for Monday-Wednesday 6:00pm-9:00pm, SAT Focused Course, for the" + testDate +".";
// 				event.shortLabel="M|W_6_9PM_SAT";
// 				event.startTime=new Date.setHours(18,0,0);
// 				event.endTime=new Date.setHours(21,0,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_M|W_6_9PM_SAT";
// 				events.push(event);
// 				event={};

// 				event.monday3_45TestClass=monday;
// 				event.isMonday3_45TestClass=true;
// 				event.labelLong="Class for Mon-Wed-Fri 3:45pm-5:045pm, SAT Focused Course, for the" + testDate+".";
// 				event.shortLabel="M|W|F_345PM_545PM_SAT";
// 				event.startTime=new Date.setHours(15,45,0);
// 				event.endTime=new Date.setHours(17,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().replace(" ", "") + "_1600SAT_M|W|F_345PM_545PM_SAT";
// 				events.push(event);
// 				event={};

// 			}
			
// 			else if(daytwo.toLocaleString()==tuesday.toLocaleString())
// 			{
// 				event.tuesday6to9TestClass=tuesday
// 				event.isTuesday6to9TestClass=true;
// 				event.labelLong="Class for Tuesday-Thursday 6:00pm-9:00pm, SAT Focused Course, for the" + testDate +"Class.";
// 				event.shortLabel="T|TH_6_9PM_SAT";
// 				event.startTime=new Date.setHours(18,0,0);
// 				event.endTime=new Date.setHours(21,0,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_T|TH_6_9PM_SAT";
// 				theDay.events.push(event);
// 				event={};
// 			}
			
// 			else if(daytwo.toLocaleString()==wednesday.toLocaleString())
// 			{
// 				event.wednesdayTestClass=wednesday;
// 				event.isWednesdayTestClass=true;
// 				event.labelLong="Class for Monday-Wednesday 6:00pm-9:00pm, SAT Focused Course, for the" + testDate +"Class.";
// 				event.shortLabel="M|W_6_9PM_SAT";
// 				event.startTime=new Date.setHours(18,0,0);
// 				event.endTime=new Date.setHours(21,0,0);

// 				events.push(event);
// 				event={};

// 				event.wednesday3_45TestClass=wednesday;
// 				event.isWednesday3_45TestClass=true;
// 				event.labelLong="Class for Mon-Wed-Fri 3:45pm-5:45pm, SAT Focused Course, for the" + testDate+".";
// 				event.shortLabel="M|W|F_345PM_545PM_SAT";
// 				event.startTime=new Date.setHours(15,45,0);
// 				event.endTime=new Date.setHours(17,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_M|W|F_345PM_545PM_SAT";
// 				events.push(event);
// 				event={};
// 			}
			
// 			else if(daytwo.toLocaleString()==tuesday.toLocaleString())
// 			{
// 				event.thursday6to9TestClass=thursday;
// 				event.isThursday6to9TestClass=true;
// 				event.labelLong="Class for Tuesday-Thursday 6:00pm-9:00pm, SAT Focused Course, for the" + testDate +"Class.";
// 				event.shortLabel="T|TH_6_9PM_SAT";
// 				event.startTime=new Date.setHours(18,0,0);
// 				event.endTime=new Date.setHours(21,0,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_T|TH_6_9PM_SAT";
// 				events.push(event);
// 				event={};
// 			}
			
			
// 				else if(daytwo.toLocaleString()==friday.toLocaleString())
// 			{
// 				event.friday3_45TestClass=friday;
// 				event.isFriday3_45TestClass=true;
// 				event.labelLong="Class for Mon-Wed-Fri 3:45pm-5:45pm, SAT Focused Course, for the" + testDate+".";
// 				event.shortLabel="M|W|F_345PM_545PM_SAT";
// 				event.startTime=new Date.setHours(15,45,0);
// 				event.endTime=new Date.setHours(17,45,0);
// 				event.fcid=new Date.getMilliseconds(testDate).toString().split(" ").splice("").toString() + "_1600SAT_M|W|F_345PM_545PM_SAT";
// 				events.push(event);
// 				event={};
// 			}
// 			return events;
// 		}

// 	}
		
// }

function holidayEvents(theDay){
      var holidayArray = [];
      holidayArray = [{"name": "Daylight Saving Time", "holiday":[2016,3,13]  }, 
        {"name": "St. Patrick's Day", "holiday":[2016,3,17] },
        {"name": "Palm Sunday", "holiday":[2016,3,20] }, 
        {"name": "Passover Begins", "holiday": [2016,3,23]  },
        {"name": "Purim", "holiday": [2016,3,24]  }, 
        {"name": "Good Friday", "holiday": [2016,3,25]  },
        {"name": "Easter", "holiday": [2016,3,27] },
        {"name": "Orthodox Good Friday", "holiday": [2016,4,29] },
        {"name": "Last Day of Passover", "holiday": [2016,4,30] }, 
        {"name": "Yom HaShoah", "holiday": [2016,5,4] }, 
        {"name": "Isra and Mi'raj, Cinco Di Mayo", "holiday": [2016,5,5]  }, 
        {"name": "MOTHERS DAY!!!", "holiday": [2016,5,8]  },
        {"name": "Memorial Day", "holiday": [2016,5,30] },
        {"name": "Ramadan Begins", "holiday": [2016,6,7]  },
        {"name": "Father's Day", "holiday": [2016,6,19] },
        {"name": "Independence Day July 4", "holiday": [2016,7,4] },
        {"name": "Labor Day", "holiday": [2016,9,5] },
        {"name": "Rosh Hashana, Muharram", "holiday": [2016,10,3] },
        {"name": "Columbus Day", "holiday": [2016,10,10]  },
        {"name": "Yom Kippur", "holiday": [2016,10,12]  },
        {"name": "Diwali", "holiday": [2016,10,29]  },
        {"name": "Halloween", "holiday": [2016,10,31] },
        {"name": "Veterans Day", "holiday": [2016,11,11]  },
        {"name": "Thanksgiving", "holiday": [2016,11,24]  },
        {"name": "Thanksgiving", "holiday": [2016,11,25]  }, 
        {"name": "Christmas Eve", "holiday": [2016,12,24] },
        {"name": "Christmas", "holiday": [2016,12,25] },
        {"name": "New Year's Eve", "holiday": [2016,12,31]  }
        ];
  
      var counter = holidayArray.length;
      var i=0;
      var event={};
      event.holiday='';
      event.date=new Date(theDay);
      for(i=0;i<counter;i++){
        var holiday = new Date(holidayArray[i].holiday);
        if (event.date.toLocaleString() == holiday.toLocaleString()){

           event.holiday = holidayArray[i].name + " ";
           console.log(event.holiday, event.date);
        }
        if (event.holiday!='' && theDay.toLocaleString()!=holiday.toLocaleString())
          {return event;}
      }
      return event;

    }
  
  
class FcEvent{
	constructor(argEvent){this.build(argEvent.name, argEvent.startTime, argEvent.endTime, argEvent.practiceTest, argEvent.holiday, argEvent.fcid, argEvent.location, argEvent.completed, argEvent.relatedFcids, argEvent.parentEventName, argEvent.parentEventFcid)}

getFirebaseLocation(theDate){return "https://focused0ne.firebaseio.com/events";}	
  build(name, startTime, endTime, practiceTest, holiday, fcid, location, completed, relatedFcids,  parentEventName, parentEventFcid)
  {
    
    this.name=name || ""; 
    
    this.startTime=new Date(startTime) || new Date(); console.log(this.startTime);
    this.endTime=new Date(endTime) || ""; 
    this.practiceTest = new Date(practiceTest) || '';
    //this.holiday = this.HolidayEvents(new Date(startTime)) || ''; console.log(this.holiday);
    fcid?this.fcid=fcid:this.assignNewFcid();
    this.location=location || ""; 
    this.completed=completed || false;
    this.relatedFcids=relatedFcids || "";  
    this.parentEventName=parentEventName || ""; 
    this.parentEventFcid=parentEventFcid || "";
    this.numberDate=this.startTime.midnightToker();	
    console.log(this.numberDate);
     //this.dateKey=  numberDate.toString() + "_" + this.startTime + "_" + this.name;
  }
assignNewFcid()
		{ 	var ref = new Firebase(this.getFirebaseLocation());
    		var self= this;
  			ref.child('counter').transaction(function(argCounter){return argCounter+1;}, 
      				function(error, isSuccessful, finalVal)
        				{ console.log(error, isSuccessful, finalVal.val());
          						if(isSuccessful)
            						{
              							self.fcid=finalVal.val();
            						}
        				});

		}
}       

Date.prototype.assignFullMonth = function()
{
	var dat = new Date(this.valueOf());
	var monArray = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
	return monArray[dat.getMonth()];
}

function TimeSlots(){
				var timeArr = [];
        		for(var i=12; i<=48;i++){
              var hour=(Math.floor(i/2) <13)?Math.floor(i/2):(Math.floor(i/2)-12);
              var j=false;
              j=(i>47)?true:false;
              if(hour<10){hour='0'+hour.toString();}
              var space=(i<20)?true: false;
              var halfhour=(i%2==0)?0:3;
              var ampm=(i<24)?"am":(j==true)?"am":"pm";
              var tobj = {"hour": hour,
                          "halfhour": halfhour,
                          "ampm": ampm, 
                          "space": space
                        };
              var string=hour.toString() + ":" + halfhour.toString() + "0"+ ampm;
              var obj2={"label": string, "val": "open", "name": string};
              timeArr.push(obj2);
          }
          return timeArr;
         }


   function getDates(startDate, stopDate) {
      var dateArray = new Array();
      var currentDate = startDate;
      while (currentDate <= stopDate) {
        dateArray.push(currentDate)
        currentDate = currentDate.addDays(1);
      }
      return dateArray;
    }

Date.prototype.addDays = function(days) {
       var dat = new Date(this.valueOf())
       dat.setDate(dat.getDate() + days);
       return dat;
}


	
function getShortDays(numChars, argDay)
{	var shortDaysArray = [Su,M,Tu,W,Th,F,Sa];
	var singlesArray = [M,W,F];
	var dayBlocks=["M|W|F","Tu|Th"];
 	var md = argDay;
			if(numChars>2)
			{
			md=md.slice(0,numChars);
			return md;
			}
			else
				{
					var letters = md.slice(0,2);
					var lilLetters=md.slice(0,1);
					if(	shortDaysArray.indexOf(letters)!==-1)
						{
							var john = singlesArray.indexOf(lilLetters);
							console.log(singlesArray[john]);
							return singlesArray[john];
						}
					else {var retVal= shortDaysArray.indexOf(letters);
						console.log(shortDaysArray[retVal]);
							return shortDaysArray[retVal];
						}
				}
		}


 Date.prototype.midnightToker= function()
 {
 	var year= this.getFullYear(); 
	var month= this.getMonth();
	var day = this.getDate();
    var numberDate= Date.UTC(year, month, day);
    return numberDate;
 }	

window.FCBehaviors = window.FCBehaviors || {};
FCBehaviors.FcCalendarBehaviorPrime = {
	properties: {
		 startDate:{
		 	type: Date,
		 	notify: true
		 },
		 endDate:{
		 	type: Date,
		 	notify: true
		 },
		displayedMonthIndex:{
			type: Number,
			notify: true
		},
		theDate:{
			type: Date,
			notify: true
		},
		displayedMonth:{
			type: Array,
			value: [],
			notify: true
		},
		monthsArray:{
			type: Array,
			value: function(){return [];},
			notify: true
		},
		dayOfWeek: {
			type: String,
			notify: true
		},
		date: {
			type: Array,
			value: function(){ return [];},
			notify: true
		},
		year: {
			type: String,
			notify: true
		},
		day:{
			type: Date,
			notify: true
		},
		dayArray:{
			type: Array,
			value: [],
			notify: true
		},
		days:{
			type: Array,
			value: function()
			{
					return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
			},
			notify: true
		}, 
		
		month: {
			type: String,
			value:"",
			notify: true
		}, 
		units:{
			type: String,
			value:"months",
			notify: true

		}


	},


	attached: function(){
	
		// this.calendarCreator()
	},

	calendarCreator: function(start, end, units)
	{	var currDate=[];
		if (units!=undefined && units!=null){this.set("units", units);} 
		var startDate=(start!=null)?start:(new Date()).addDays(0);
		var endDate = (end!=null)?end:(new Date()).addDays(120);
		var i=0;
		console.log(startDate, endDate);
		if(endDate<=startDate)
			{
				var startDateHolder=startDate;
				startDate=[];
				startDate=endDate;
				endDate=[];
				endDate=startDateHolder; 
				//console.log(startDate, startDateHolder, endDate);
			}//date crossing condition
		while(startDate.getDay() != 0)//filling beginning week of calendar
		{
			startDate = startDate.addDays(-1);
			
		}
		
		while(endDate.getDay() != 6)
		{
			endDate = endDate.addDays(+1);
			
		}
		
		this.set('date', getDates(startDate, endDate));
		console.log(this.date);
		var numDays = this.date.length;
		var currentMonth = 0; 
		for (i = 0; i < numDays; i++) 
		{
			currDate=this.date[i];
			// currDate[i].baseEvent = new FcBaseEvents(this.date[i]);
			// currDate[i].date = new Date(this.date[i]);
			
			if(i==0)
			{	
				this.push("monthsArray", []);
				this.monthsArray[currentMonth].push(currDate);
				this.set("month", this.date[i].assignFullMonth());
			}
			else if(i>0)
			{
				//var currDate = this.date[i];
				var yesterday = this.date[i-1];
				var dateYester = yesterday.toDateString();
				var dateToday = currDate.toDateString();
				if(currDate.assignFullMonth() != yesterday.assignFullMonth() && this.units=="months")
				{	
					this.push("monthsArray", currDate);
					currentMonth++;
				}
				else
				{	
					this.monthsArray[currentMonth].push(currDate);
					console.log(currDate);
				}
			}
		}
		this.padMonths();
		this.set("displayedMonth", this.monthsArray[0]);
		this.set("year", this.displayedMonth[0].getFullYear());
		this.set("displayedMonthIndex",0);
		var numDizDays = this.displayedMonth.length;
		this.set("month", this.displayedMonth[numDizDays-1].assignFullMonth());
		console.log(this.month, this.month, this.month);
		

	},//end of function

	padMonths: function()
	{	var month=[];
		var i = 0;
		var numMonths = this.monthsArray.length;
		for(i=1; i < numMonths; i++)
		{
			month = this.monthsArray[i];
			console.log(month);
			var lastMonth = this.monthsArray[i-1];
			var numDaysPrevMonth = this.monthsArray[i-1].length;
			var fillerDay = numDaysPrevMonth - 1;
			// while (month[0].getDay() != 0)
			// {
			// 	month.unshift(this.monthsArray[i-1][fillerDay--]);
			// }
			//console.log(this.monthsArray[i]);
		}
	},


	_backOneMonth:function(){
		if(this.displayedMonthIndex==0){
			var counter =this.monthsArray.length-1;
			this.set("displayedMonth", this.monthsArray[counter]);
			this.displayedMonthIndex=counter;
		}
		else{
			var diLess=this.displayedMonthIndex-1;
			this.set("displayedMonth", this.monthsArray[diLess]);
			this.displayedMonthIndex--;
		}
		var length=(this.displayedMonth.length-1);
		var month = this.displayedMonth[length].assignFullMonth();
			var year = this.displayedMonth[length].getFullYear();
			this.set("month",month);
			//console.log(year);
			this.set("year", year);
	},

	_forwardOneMonth:function(){
console.log( "index", this.displayedMonthIndex, "year", this.year, "month0", this.displayedMonth[0], "length again", this.displayedMonth.length)
		if(this.displayedMonthIndex==this.monthsArray.length-1)
		{
			this.set("displayedMonth",this.monthsArray[0]);
			this.displayedMonthIndex=0;						
		}
		else{
			var diMore=this.displayedMonthIndex+1;
			this.set("displayedMonth", this.monthsArray[diMore]);
			this.displayedMonthIndex=diMore;
			
		}
		console.log(this.displayedMonth);
		var length=this.displayedMonth.length-1;
		var month = this.displayedMonth[length].assignFullMonth();
		var year = this.displayedMonth[length].getFullYear();
			this.set("month",month);
		
			this.set("year", year);
			
	},
setHolidays: function(dayE){ 
      var holidayArray = [];
      holidayArray = [{"name": "Daylight Saving Time", "holiday":[2016,3,13]  }, 
        {"name": "St. Patrick's Day", "holiday":[2016,3,17] },
        {"name": "Palm Sunday", "holiday":[2016,3,20] }, 
        {"name": "Passover Begins", "holiday": [2016,3,23]  },
        {"name": "Purim", "holiday": [2016,3,24]  }, 
        {"name": "Good Friday", "holiday": [2016,3,25]  },
        {"name": "Easter", "holiday": [2016,3,27] },
        {"name": "Orthodox Good Friday", "holiday": [2016,4,29] },
        {"name": "Last Day of Passover", "holiday": [2016,4,30] }, 
        {"name": "Yom HaShoah", "holiday": [2016,5,4] }, 
        {"name": "Isra and Mi'raj, Cinco Di Mayo", "holiday": [2016,5,5]  }, 
        {"name": "MOTHERS DAY!!!", "holiday": [2016,5,8]  },
        {"name": "Memorial Day", "holiday": [2016,5,30] },
        {"name": "Ramadan Begins", "holiday": [2016,6,7]  },
        {"name": "Father's Day", "holiday": [2016,6,19] },
        {"name": "Independence Day July 4", "holiday": [2016,7,4] },
        {"name": "Labor Day", "holiday": [2016,9,5] },
        {"name": "Rosh Hashana, Muharram", "holiday": [2016,10,3] },
        {"name": "Columbus Day", "holiday": [2016,10,10]  },
        {"name": "Yom Kippur", "holiday": [2016,10,12]  },
        {"name": "Diwali", "holiday": [2016,10,29]  },
        {"name": "Halloween", "holiday": [2016,10,31] },
        {"name": "Veterans Day", "holiday": [2016,11,11]  },
        {"name": "Thanksgiving", "holiday": [2016,11,24]  },
        {"name": "Thanksgiving", "holiday": [2016,11,25]  }, 
        {"name": "Christmas Eve", "holiday": [2016,12,24] },
        {"name": "Christmas", "holiday": [2016,12,25] },
        {"name": "New Year's Eve", "holiday": [2016,12,31]  }
        ];
  
      var counter = holidayArray.length;
      var i=0;
      var eventDay={};
      eventDay.holiday='';
      eventDay.date=dayE;
      for(i=0;i<counter;i++){
        var holiday = new Date(holidayArray[i].holiday);
     // if(dayE.getDate()==4){console.log(holiday, dayE);}
        if (dayE.toLocaleString() == holiday.toLocaleString()){

           eventDay.holiday+= holidayArray[i].name + " ";
           console.log(holiday, holiday, eventDay.holiday);
        }
        if (eventDay.holiday!='' && dayE!=holiday)
          {return eventDay;}
      }
      return eventDay;

    },

	_computeTheMonths: function(year, month, monthsArray, displayedMonthIndex, displayedMonth){

	var mon=(displayedMonth==undefined || displayedMonth==[])? month:displayedMonth[displayedMonthIndex].toString().substring(4,7);
		var returnVal =(mon=="Feb")?"February": (mon=="Mar")?"March":(mon=="Apr")?"April": (mon=="May")?"May":(mon=="Jun")?"June":(mon=="Jul")?"July":(mon=="Aug")?"August":(mon=="Sep")?"September":(mon=="Oct")?"October": (mon=="Nov")?"November":(mon=="Dec")?"December":"January";  
		console.log(returnVal);
			return returnVal;

	}

};
</script>