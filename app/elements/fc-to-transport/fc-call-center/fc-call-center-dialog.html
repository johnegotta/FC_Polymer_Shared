<dom-module id="fc-call-center-dialog">
<template>
<style>
:host{
      background: white;
      padding: 0px 3px 4px 8px;
      opacity: 1;
      position: static;
      @apply(--horizontal-layout);
      @apply(--layout-flex);
      }
    .headerLeft{
      height: 42px; width: 42px; color: white; float: left;top: 5px;
    }
    .headerRight{
      height: 42px; width: 42px; color: white; float: right;top: 5px;
      }
      .intakeForm{
      	border: 1px #efefef solid;
      	margin: 12px 0px;
      }
     
		paper-button{
		 	 width: 50%;
		 	 min-width: 147px;
		 	 font-weight: 600; 	  
		 	 font-size: 14px;
		 	 text-align: center;
		 	 white-space: nowrap;
		 	 max-height: 36px;
		 	 @apply(--layout-nowrap);
		 	 background: white;
		 	 border: #efefef 1px solid;
		 }
		 paper-button.green{
		 	color: green; 
		 	border: 2px solid green;
		}
		paper-button.darkblue{
			color: #009;
			border: 2px solid #009;
		}
		paper-button.red{
			color: red;
			border: 2px solid red;
		}
		paper-button.orange{
			color: orange;
			border: 2px solid orange;
		}
		paper-button:hover, paper-button:active{
			box-shadow: 2px 4px 7px 2px; 

		} 
		paper-button.darkblue:hover, paper-button.darkblue:active{
			box-shadow: 2px 4px 7px 2px gold; 

		} 
		.buttonRow{
			@apply(--layout-flex);
			@apply(--layout-horizontal);
			padding: 2px;
		}

.footerclass{
	height: 32px;
	padding: 14px;
	color: white;
	background: #03A9F4;
	font-weight: 600;
	text-align: center;
	font-size: 11px;
}
.slides{overflow: hidden; overflow-y: scroll;}

.one{
	font-family: merriweather; 
	font-weight: 600;
	color: #080808;
	font-size: 14px;

	white-space: nowrap;
	display: inline-block;
}
      paper-card{
        width: 100%;
        --paper-card-header-image-text:{color:#009; position: absolute; right: 32px; top: 45px;}
        --paper-card-header-image: {width: 165px; height: 120px; margin: 12px 16px 16px 16px;};
        --paper-card-header:{height: 95px; border-bottom: double 6px green;}
  
    }
    paper-input{
      margin:8px;
    }
    gold-input{
     margin:8px; 
    }
      neon-animated-pages {
        @apply(--layout-flex);
        @apply(--layout-horizontal)
        margin: 12px 0px 12px 0px
        padding: 12px;
        background: white;
        @apply(--layout-self-stretch);
        min-height: 1080px;
        height: 100%;
      }
      neon-animatable {
        color: white;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--paper-font-display3);
        margin: 0px;
        padding: 0px;
      }
    
    .subheading {
    font-size: 14px;
    color: brown;
    font-family: times;
 		float: right;
 		margin: 0px 12px;
    padding: 8px;
    }
    paper-radio-button{
    		font-size: 16px;
    		font-weight: 600;
    		size: var(--paper-radio-size, 18px);
    		 /*  --paper-radio-button-label-color: var(--my-blue-009, #000099);*/
    		   --paper-radio-button-checked-color: var(--paper-green-900);


    }
    .card-actions{
    	padding: 16px 8px;
    }
    label.returningCaller{
    	color: black;
    	font-size: 18px;
    /*	font-style: italic;*/
    	font-weight: 700;
    }
    paper-radio-group.tallbox{
    	@apply(--layout-vertical);
    	 --paper-radio-group-padding: var(--too-much-padding, 6px);

    }
    iron-icon{ 
        width: 36px;
        height: 36px;
    }
    p{
    	text-indent: 36px;
    	font-size: 14px;
    	font-weight: 600;
    		}
  .setHeight {
    min-height: 680px;
    max-height: 1480px;

    max-width: 485px;
    min-width: 380px;
    margin: 4px;
    padding: 4px;
  }
  
  .timestamp{
  	font-weight: 600;
  	font-size: 16px;
  	padding: 8px;
  	float: left;

  }
  .dropbtn:hover, .dropbtn:focus{
		    background-color: #3e8e41;
		}
		/* The container <div> - needed to position the dropdown content */
		.dropdown {
		    position: relative;
		    display: inline-block;
		}
		/* Dropdown Content (Hidden by Default) */
		.dropdown-content {
		    display: none;
		    position: absolute;
		    background-color: #f9f9f9;
		    min-width: 160px;
		    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
		}
		/* Links inside the dropdown */
		.dropdown-content a {
		    color: black;
		    padding: 12px 16px;
		    text-decoration: none;
		    display: block;
		}
		.check{
			font-size:26px;
			color: green;
			position: absolute;
			left: 5px;
		}
		.instruction{
			color:#009;
			font-weight:700;
		}
		.radioGroupBlock{
			padding: 12px;



		},
		.importantNote{
				color: black;
				font-weight: 600;
				padding: 8px;
				margin: 4px;
				margin-bottom: 26px;

		},
		.detailPads{
				margin:12px;
				margin-top: 24px;

		}

		.show {display:block; z-index: 45; right: 0;}
  @media(max-width: 687px){
  	#content{
  		@apply(--layout-vertical);
  		@apply(--layout-center);
  	}
  	/*add more here*/
  }
  </style>
  <iron-form>
  <fc-ddr-card id="focusedCallInterface"  header-set-height="225px" head-class="darkBlue" header-title="Focused Client Intake Center" class="vertical layout flex nowrap self-stretch" on-tap="_tapHandler" style="padding-right:2px; margin: 4px 0px 4px 0px; min-width: 100%!important;">
  	
    <div class="dropdown headerRight">
          <span btn="rightClick" style="position: absolute; right: -36px; top: 4px; font-size: 42px;"><span style="position: relative; font-size: 18px;top:-5px;">NEXT</span>&#8680;</span>
        <paper-icon-button icon="icons:dashboard" class="dropbtn" btn="openDropdown" style="position: relative; right: 64px;">   
        </paper-icon-button>
        <paper-list-box id="dropdownlist" class="dropdown-content" style="position: absolute; right: 64px; border: 1px #adadad solid;">
		 	<template is="dom-repeat" id="controllerList" items="{{signUpPages}}">
				<paper-item class="block" style="border: 1px silver solid; min-width: 146px!important; max-width: 360px!important;padding: 3px!important;color: green;" on-tap="toggleSelection">
                    <span hidden$="{{!item.selectCheck}}" class="check">&#10148;</span>
                    <span>{{item.name}}</span><span>{{selected}}</span>
                </paper-item>
		 	</template>
		</paper-list-box>
	</div>
	
	<div class="dropdown headerLeft horizontal layout">
   <span btn="leftClick" style="position: absolute; left: -36px; top: 4px; font-size: 42px;">&#8678;<span style="position: relative; font-size: 18px;top:-5px;">BACK</span></span>
		<paper-icon-button icon="icons:dashboard" class="dropbtn" style="position: relative; left: 64px;" btn="openDropdown"></paper-icon-button>
			<paper-list-box id="dropdownlist2" class="dropdown-content" style="position:relative; left: 18px;width: 320px!important; min-width: 320px!important; max-width: 320px!important; border: 4px green solid;">
  
		 	 	<template is="dom-repeat" id="controllerList" items="{{signUpPages}}">
					<paper-item class="block" style="border: 1px silver solid; width: 300px!important; min-width: 300px!important; max-width: 300px!important;padding: 3px!important;color: green;" btn="toggleSelection"><span hidden$="{{!item.selectCheck}}" class="check">&#10148;</span>{{item.name}}
                    </paper-item>
		 	    </template> 
	 	  </paper-list-box>
	</div>
 	<div class="flex layout horizontal center-justified">
 		<section id="hanger" ></section>
        <neon-animated-pages id="pages" selected="[[selected]]" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
            <div id="container1">
                <fc-call-center-form-one id="childOne" current-height="{{childHeight}}">
                        <span class="pageTotal">{{shadowIndex}}</span>
                </fc-call-center-form-one>
            </div>
            <template is="dom-repeat" items="{{inputArraysAb}}">
                <div>
                    <fc-call-center-form input-array="{{item}}" current-height="{{siblingHeight}}"item="{{inputArraysAb}}" page-number="{{computePageNumber(selected)}}" item-object="{{item}}">
                        <span class="pageTotal">{{_computePageTotal(inputArraysAb, index)}}
                        </span>
                    </fc-call-center-form>
                </div>
            </template>
            <div>
        <fc-call-list-view id="callList" style="height: 600px; width:460px;" search-vals="{{searchVals}}"></fc-call-list-view>
        </div>
        <div>
         <fc-tabbed-card id="viewProfile" student="{{studentSelectable}}" on-close="_onClose"></fc-tabbed-card>
        </div>
        </neon-animated-pages>
    </fc-ddr-card>
</iron-form>
</template>
<script>
FcCallCenterDialog=Polymer({
	is:"fc-call-center-dialog",
		 behaviors:[Polymer.NeonAnimatableBehavior,
                Polymer.NeonAnimationBehavior,
                Polymer.NeonAnimationRunnerBehavior],
        listeners: {"onload":"doStuffOnLoad",
            "on-call-click": "_onCallClick", 
            "sendInputVal": "_passSearchVals", 
            "studentSelected":"_setPreviousCaller"
            },
    properties: {
        entryAnimation: {
          type: String,
          value: function(){ return "";},
          notify: true
        },
        shadowIndex:{
            type: String,
            notify: true
        },
        exitAnimation:{
            type: String,
            value: function(){return "";},
            notify: true
        },
        searchVals:{
            type: Object,
            value: {
            fcProfile: {},
        },
            notify: true, 
            reflectToAttribute: true
    },
    childHeight:{
        type: String,
        notify: true,
    },
    siblingHeight:{
        type: String,
        computed: "_computeSiblingHeight(childHeight)",
        notify: true,
    },
    data: {
        type: Array,
        value: function(){return [];},
        notify: true
    },
        pageTotal:{
          type: Number,
          notify: true
        },
        selected: {
          type: Number,
          value: function(){return 5;},
          notify: true
        },
    inputArraysAb:{
        type: Array,
        value:function(){return[];},
        notify: true
    },
    courseInputs:{
        type:Function,
        value:FcCourse.getInputs(),
        notify: true,
    },
    currentPage:{
      type: Number,
      computed:"computePageNumber(selected)",
      notify: true
    },
		signUpPages:{
			type: Array,
			value:function(){
				return [{"name":"Identify Returning Callers", "selectCheck": false}, {"name":"Name and Phone Number", "selectCheck": false}];
			},
			notify: true,
		},
		

	},
    doStuffOnLoad(e){
        this.async(function(){window.getComputedStyle(this.$.container1, null).getPropertyValue("height");}, 4400);
        console.log(window.getComputedStyle(this.$.container1, null).getPropertyValue("height"), e);
    },
  _computeSiblingHeight(childHeight){
    console.log(childHeight, childHeight);
    return childHeight;

  },

  ready(){
      this.initializePages();
  },
  attached(){
    var childHt= this.$.container1;
    this.root.addEventListener('dom-change', function() { var ht=window.getComputedStyle(childHt,null).getPropertyValue("height");console.log('ht', ht);}, this);
    this.async(this.openDdr, 300);
  
  },
  calculateInputKeyAndValueArrayFromPrototypeOfClassStaticGetter(protoStaticGetter){
    var arrReturn=protoStaticGetter,it={},arrHolder=[];
    var keyValArrReturn= arrReturn.map(function(val,index){
        if(index%8===0){arrHolder=[];}//sets the 8 inputs a page
        var temp=val[1].label2;
        temp=temp.replace(/\s/g, "");
        var propertyName=temp.replace(temp.charAt(0),temp.charAt(0).toLowerCase()), label=val[1].label2, name=propertyName,dropdownItems=val[2].map(function(value,i,arr){var obj={};obj={"name": value, "value":value, "selectCheck": false}; return obj;}),multiSelect=(val[3])?val[3].multiSelect:false, ab=(index%2===0)?"A":"B";
        //setting ab allows a row of two inputs to be created for the dom-repeat
        var nameProp="name"+ab,labelProp="label"+ab,propertyNameProp="propertyName"+ab,dropdownItemsProp="dropdownItems"+ab, multiSelectProp="multiSelect"+ab;
        it[nameProp]=name,it[labelProp]=label,it[propertyNameProp]=propertyName,it[dropdownItemsProp]=dropdownItems;
        it[multiSelectProp]=multiSelect;
        //the above lines allow the creation of the A input and the B input to be shared in the same object;
        console.log(it[dropdownItemsProp]);
        if(index%2!==0){
            var holder=it;
            it={};
            arrHolder.push(holder);
            }
        //above uses sets one full object in an array that will be sent with 3 other object pairs to full a page (see directly below)
            if((index+1)%8===0){return arrHolder;}
            else{ return false;} //false allows for the easy filtering of the mapped array, in the chained function below/we are only 1 in 8 of the array "slots" for the new array; so array is not sparse, filter ;-)
        }).filter(function(val){return(val!==false)});
    console.log(keyValArrReturn);
    return keyValArrReturn;
  },
  computePageNumber(selected){ return this.selected+1;},

  _computePageTotal(inputArraysAb, index){
     var pageTotal=(this.inputArraysAb.length+1);
     this.set("pageTotal", pageTotal);
     this.set("shadowIndex", pageTotal);
     console.log(index);
    return pageTotal;},

  initializePages(){
    //get at least the labelable values from the classes we have made... oh getters and setters would make this five-10 lines of code....
    var student=new FcStudentProfile({}), pastAcademics=new FcStudentPastAcademics({});
        var it={},keyz=Object.keys(pastAcademics),keys=Object.keys(student),inputArrayA=[],inputArrayB=[],contentArray=[], two=keys[12],one=keys.splice(12,1);
        //note that the it object will be used for moving properties from one object to another, later in the code via an Object.assign--poor mans defineProperties set and gets...
        keys.push(two);
        var moreKeys=keys.concat(keyz); 
        var length;
        moreKeys.forEach(function(val, index, array){
          length=array.length;
        var label=val.replace(/([A-Z])/g, ' $1'),  
        label=label.replace(/^./, function(label){ return label.toUpperCase(); }),
        label=label.replace("1", " One"),
        label=label.replace("2", " Two");
        var ab=(index%2===0)?"A":"B",nameProp="name"+ab,labelProp="label"+ab,propertyNameProp="propertyName"+ab,dropdownItemsProperty="dropdownItems"+ab, multiSelectProperty="multiSelect"+ab;
        //built up the franken-it object now gonna use it to run sixty input objects! wish i ordered the data more consistently earlier....
        it[labelProp]=label,it[nameProp]=val,it[propertyNameProp]=val, it[dropdownItemsProperty]=(val.selectedItems)?val.selecteditems: false;
        // it[multiSelectProperty]=(val.multiSelect&&val.multiSelect===true)?true:false;
        var pushVal=(index%2===0)?inputArrayA:inputArrayB;
        //alternating on the index to get a pair of items to load on the dom!
        pushVal.push(it);
        it={};
        //cleared `it`, next gonna grab eight inputs (four pairs of two) for the cards
        if((index+1)%4==0 || array.length-1===index){
              this.push("inputArraysAb", [inputArrayA, inputArrayB]);
              inputArrayA=[];
              inputArrayB=[];
                 }
         }, this);
        //this was original impl... used two arrays to make columns... now need to resort them and move paired odd array elements object sub properties all onto one replacement element for the other two, and maintain order in the impl... Wait for it... wait for it... it's is coming!
         var mymerge=this.inputArraysAb.map(function(prop, index, array){
         var pickle=prop[0].concat(prop[1]); 
            var nobj=Object.assign({},pickle[0],pickle[2]);
            var nobj2=Object.assign({},pickle[1],pickle[3]);
            return[nobj,nobj2];
         }, this);
        //this is a columns to rows switch will need same api dynamics in the grid table and in any accounting interface DUAL USE IMPORTANT!!! 
         var arrat=[];
         mymerge.forEach(function(val,i,arr){
                if(i%2===0&&i<arr.length-1){var mini=val.concat(arr[i+1]); arrat.push(mini);}
            });
         var pickle=this.calculateInputKeyAndValueArrayFromPrototypeOfClassStaticGetter(this.courseInputs);
           var retArray= arrat.concat(pickle);
            console.log(arrat,pickle);
        //had to do the above twice to get the ordering correct...see 391 above, this time though I didnt need the assigment as I did two at once above;
        // next we wipe out our mistake in approach by resetting the original array we had to deal with...
         this.set("inputArraysAb",null);
         this.set("inputArraysAb", retArray);
    },


	_tapHandler(e){
		var targ=e.target;
		while(!targ.attributes.btn && targ.nodeName!=="FC-DDR-CARD")
		{
			targ=targ.parentElement;
		}
		if(targ.attributes.btn){
		this[targ.attributes.btn.value](e);
	   }
	},
	openDdr(){
		this.$.focusedCallInterface.falseClose();
		this.$.focusedCallInterface.falseClose();
	},
   _computePageNumber(index){console.log(index); var retVal = parseInt(index)+2;},
	
    toggleSelection(e){
        var item = this.$.controllerList.itemForElement(e.target);
        var model=this.$.controllerList.modelForElement(e.target);
        if(model.item.selectCheck&&(model.item.selectCheck===true||model.item.selectCheck===false))
        {
            model.set("item.selectCheck",!model.item.selectCheck);
            var index=this.selected.indexOf(item);
            if(index<0){
        	   e.target.style.background="aliceblue";
        	   this.$.selector.select(item);
    	   }
    	   else{
    		  e.target.style.background="white";
    		  this.splice("selected",index,1);
            }
        }
    },
_passSearchVals: function(e, detail){
      console.log(e.detail.value, e.detail.name, "take Note here");
      var name = e.detail.name;
      var val = e.detail.value;
        if(name=="parent1FirstName"){this.set("searchVals.parent1FirstName", val);}else if(name=="parent1LastName"){this.set("searchVals.parent1LastName", val);} else if(name=="parent2FirstName"){this.set("searchVals.parent2FirstName", val);}else if(name=="parent2LastName"){this.set("searchVals.parent2LastName", val);}else if(name=="firstName" || name=="studentFirstName"){ this.set("searchVals.studentFirstName", val);}else if(name=="studentLastName" || name=="lastName"){ this.set("searchVals.studentLastName", val);}else if(name=="parent1Email"){this.set("searchVals.parent1Email", val);} else if(name=="studentEmail" || name=="email"){ this.set("searchVals.studentEmail", val);} else if(name=="parent2Email"){ this.set("searchVals.parent2Email", val);}else if(name=="parent1Telephone"){ this.set("searchVals.parent1Telephone", val);}else if(name=="parent2Telephone"){ this.set("searchVals.parent2Telephone", val);} else if(name=="telephone" || name=="studentTelephone"){this.set("searchVals.studentTelephone", val);}else{this.set("searchVals", this.searchVals);}
      this.$.callList.updateSearchVals(this.searchVals, name, val);


    },
    _onCallClick: function(e) {
      this.$.pages.selected = 1;
      console.log(e.detail.item);
     this.$.viewProfile.setStudent(e.detail.item.fcid); 
     console.log(e.detail.item.fcid);
     console.log(this.studentSelectable, "here is selected");
  
    },
     _setPreviousCaller: function(e, detail)
    {
        console.log(e.detail);
        this.set("studentSelectable", e.detail);
    },

    _onClose: function() {
      this.$.pages.selected = 0;
    },


 openDropdown(e){
		var targ=e.target;
		while(targ.nodeName!="PAPER-ICON-BUTTON"&& targ.nodeName!=="FC-DDR-CARD")
		{
			targ=targ.parentElement;
		}
		if(targ.nodeName=="PAPER-ICON-BUTTON")
		{
			var list=targ.nextElementSibling;
					console.log(list);
			var check =Polymer.dom(list).classList.contains("show");
			if(check){
					Polymer.dom(list).classList.remove("show"); 		
			}
			else{
				this.set("dropdownOpen",true);
				Polymer.dom(list).classList.add("show");
				}
		}
     },
       rightClick: function() {
        this.entryAnimation = 'slide-from-left-animation';
        this.exitAnimation = 'slide-right-animation';
       this.selected = (this.selected === (this.inputArraysAb.length))? 0 : (this.selected + 1);
       
      },
      leftClick: function() {
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
       this.selected = this.selected === 0 ?(this.inputArraysAb.length): (this.selected - 1);
         
      },

});

class FcStudentPastAcademics{
constructor (gradeLevel, currentSchool, pastSchool, highestEducationLvl, startMath, startReading, startTotal,goalScore,desiredTestDate, fcid){
  this.gradeLevel= gradeLevel ||"";
  this.currentSchool= currentSchool ||"";
  this.pastSchool= pastSchool ||"";
  this.highestEducationLevel= highestEducationLvl ||"";
  this.startMathScore =  startMath  || "";
  this.startReadingScore = startReading || "";
  this.startTotalScore = startTotal || "";
  this.goalScore=goalScore || "";
  this.desiredTestDate=desiredTestDate||"";
  if(this.desiredTestDate){
  this.weeksUntilTestDate=new Date()-this.desiredTestDate;
  }
  }
};
</script>
</dom-module>

<!--
<neon-animated-pages class="fit" id="pages9" selected="0">
    <fc-call-list-view id="callList" style="height: 600px; width:460px;" search-vals="{{searchVals}}"></fc-call-list-view>
         <fc-tabbed-card id="viewProfile" student="{{studentSelectable}}" on-close="_onClose"></fc-tabbed-card>
        </neon-animated-pages>
        -->