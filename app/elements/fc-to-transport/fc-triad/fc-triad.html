<dom-module id="fc-triad">
<template>
<style>
:host{
	position: static;
	background: white;
	box-shadow: 4px 11px 21px 7px #9fafaf;
	max-width: 100%;
	padding: 0px 0px;
	margin: 6px 10px;
	max-height: 92vh;
	display: flex;	/*width: 420px;*/
}
.calendarheader{
	border-right: 1px solid white;
	text-align: center; 
	padding-right:1px; 
	font-size: 14px; 
	font-weight: 600; 
	margin: auto; 
	margin-top: 3px; 
	border-top: 1px solid #afafaf; 
	margin-bottom: 3px; 
	background: white;
}
.calendarcontainer{
background: white; 
}
.calendarborder{
	background: #005c00; 
	border-bottom: #005c00 solid 2px; 
	width: 100%;
}

.headerArrowLeft{
	position: absolute; 
	top: 0px; 
	color: white; 
	left: 2px;
}
.headerMonthYear{
	margin: 0 auto;
	text-align: center;
	color: white; 
	font-size:22px; 
	font-weight: 500;
	padding: 6px 6px;
	@align(--layout-self-stretch);
	@align(--layout-center);
	@align(--layout-flex);
	@align(--layout-center-justified);
	}
.headerTop{
min-height: 38px;

}
.headerArrowRight{
	 color: white; 
	 position:absolute; 
	 right: 2px;
}
  .card{
  	border-top: 1px solid silver;
  	text-align: center; 
  	margin: 1px; 
  	display: flex;

  	@apply(--self-stretch);
  } 
  .cardcontainer{
  	background: white; 
  	overflow:scroll; 

  }
  .cardcontainer2{
	
  	overflow:scroll; 

  }
  iron-icon{
  	height: 20px;
  	width: 20px;
  }

}
</style><!-- 
on-track="focusedDragMe" -->
<!--holder for horizontal two panel view begins here-->
	<div drags on-down="dragsOn" id="myPanel" style$="width:{{currentWidth}}; height:{{currentHeight}}px;" class="horizontal layout flex self-stretch calendarcontainer">
	<!--text-holder is here-->
		<div class="layout vertical flex-4" style="background: #fafafa; padding: 12px 24px;">
  			<template class="marque" is="dom-repeat" items="{{wordEvents}}" as="wordEvent">
    					<span class="marquee">{{wordEvent}}</span> 
    					
  			</template>
  		</div>
  	<!--text holder ends-->
  	<!--calendar and green division begin-->
		<div class$="layout {{visualSwap}} flex-10"><!--visual swap in horizontal layout here-->
			<!--greeen side border-->
			<section style$="width: 25px; background:{{background}};">
			</section>
		<!--green side border ends; buttons can be in border-->
		<!--to panel top and bottom display with calendar begins-->
			<div class="vertical layout flex self-stretch">
				<paper-material class=" layout vertical around-justified calendarborder" style="max-height: 125px!important;">
					<section class="horizontal layout center-justify headerTop" style="align-items: center;">
						<paper-icon-button 
							on-tap="_backOne" 
							icon="icons:chevron-left" 
							hidden={{backHidden}} 
							class="headerArrowLeft layout horizontal flex-2 self-shrink">
						</paper-icon-button>
						<section class="layout horizontal headerMonthYear">
							[[computeViewMonth(displayedIndex)]] [[computeYear(displayed)]]
						</section>
						<paper-icon-button 
							on-tap="_forward" 
							hidden="{{forwardHidden}}" 
							icon="icons:chevron-right" 
							class="headerArrowRight layout horizontal flex-2 self-shrink">
						</paper-icon-button>
					</section> 
				</paper-material><!--header ends-->
				<section on-down="dragsOff" on-track="_resize" hidden="{{!isResizing}}"  on-up="dragsOn" style="position: absolute; right: -4px; top: 0px; bottom:0px; cursor:ew-resize; padding: 4px; width: 8px!important;opacity: 0;">
				</section><!--resizer-->
				<section class="horizontal layout flex-1">
						<!-- //DAYS AND DAYS OF WEEK COLUMN REPEATER -->
					<template is="dom-repeat" class="horizontal layout self-stretch nowrap" items="{{displayedTwo}}">
						<div class="vertical layout flex" style$="width:calc(.84*{{currentWidth}})px; height:calc(.84*{{currentHeight}})px;" >
							<paper-material class="horizontal layout center center-justified" style$="font-size: 20px; font-weight:600; background:{{background}}; color: white;text-align: center; padding: 1px;">
									<a>{{item.0}}</a>
							</paper-material>
							<section class="vertical layout flex" style="background: white; box-shadow: 4px 11px 21px 7px #9fafaf; border-bottom: 1px silver solid; border-right: 1px silver solid;">
								<template is="dom-repeat" items="{{item.1}}" as="day" style$="font-size: 24px; font-weight:600; color: {{background}};">
									<section style="border:green solid 2px; padding: 8px; background: white;" class="date vertical layout flex center center-justified self-stretch">
										
										<a class="date horizontal flex layout center-justified self-stretch" id="button" style$="min-width:25px; cursor: pointer; min-height: 25px; padding: 4px; border-radius: 50%; background: {{computeEventHeightLightColor(day.event.highlightcolor)}}; text-align: center;font-size: 18px; font-weight:600; color: {{background}};">
											<section class="date horizontal layout center-justified self-stretch" hidden="{{!day.inMonth}}">[[_computePrettyDay(day.date)]]</section>
										</a>
										<span>
										<iron-icon icon="{{day.eventIcon}}" style="color:{{day.eventSecondaryColor}}; background:{{day.eventPrimaryColor}};border-radius:50%;cursor: pointer;">
										</iron-icon>
										{{day.eventText}}{{day.eventU}}
										<iron-icon icon="{{day.eventIcon1}}" style$="color:{{day.eventSecondaryColor1}}; background:{{day.eventPrimaryColor1}}; cursor: pointer;border-radius:50%;">
										</iron-icon>
										{{day.eventText}}{{day.eventU}}
										</span>
									</section>
								</template>
							</section>
						</div>
					</template>
				</section>
				<section class="horizontal layout flex-1">
					<div class="marquee" style="background: #fafafa; padding: 12px 24px;">
		  				<template class="marque" is="dom-repeat" items="{{wordEvents}}" as="wordEvent">
		    					<span class="marquee">{{wordEvent}}</span> 	
		    					<span class="marquee">{{wordEvent}}</span> 		
		  				</template>
		  			</div>
				</section>
			</div>
		</div>
 <section  on-down="dragsOff" on-track="_resize" hidden="{{!isResizing}}" style="position: absolute; bottom: -4px; cursor:ns-resize; right: 0px; top:{{computeCurrentHeight(currentHeight)}}px; left: 0px; padding:4px; height: 8px; width: 99%; opacity: 0;" on-up="dragsOn">
 </section>
 </div>
</template>
<script>
FcTriad=Polymer({
	is: "fc-triad",
	behaviors:[FCBehaviors.FcCalendarBehaviorPrime],
	observers:[],
	properties: {
		day:{
			type: Object, 
			value: {},
			notify: true
		},
		fcCourse:{
			type: FcCourse,
			value: function(){return new FcCourse({});},
			notify: true
		},
		background: {
			type: String,
			value:function(){return "#005c00";},
			notify: true,
		},
		visualSwap:{
			type: String,
			value: function(){return "horizontal";},
			notify: true,
		},
		
		days:{
			type: Array,
			value: function()
			{
					return ["Sun","Mon","Tues","Wed","Thur","Fri","Sat"];
			},
			notify: true
		},
	
		maxIndex:{
			type: Number,
			notify: true,
		},
		displayedIndex:{
			type:Number,
			value: 0,
			notify: true
		},
		displayedTwo:{
			type: Array,
			notify: true
		},
		displayed:{
			type: Array,
			notify: true
		},
		displayedCalendarMonth:{
			type: String,
			computed: "computeViewMonth(displayedIndex)",
			notify: true
		},
		currentWidth: {
			type: String,
			value: function(){},
			notify: true,

		},
		currentHeight: {
			type: String,
			value: function(){return "42vh";},
			notify: true
		},
		units: {
			type: String,
			value: "months",
			notify: true 
		},
		forwardHidden:{
			type: Boolean,
			value: false,
			notify: true
		},
		backHidden:{
			type: Boolean,
			value: false,
			notify: true
		},
		wordEvents:{
			type:Array,
			value: function(){
			readingArr=[];
			var words="I walked twenty miles a day, when I had just turned twenty years-old...Older dogs not only have a difficult time learning new tricks, but also tend to forget even their most favored of youthful pleasures. Older men would be more faithful. So, I was to marry a Berto twenty years my senior, unlike her Berto who--at twenty days he junior--the whole world believed would have wandered if Mama were not so incessantly desirable. It is twenty minutes past when Berto and I married: Mamma insisted on that precise time. She always said that she and 'her' Berto had such a lovely first night and forty-four years of time after together all beacse they had and she would never pay any mind to others schedules. Mamma called it one of her Benito's many, but oddly enough--to her at least--most reveerred and marvelled at traits. Mamma never seemed to understand that everyone actually did everything at her pace and on her schedule. She was the Mussolini of the whole world's personal train schedule. Everything precisely on time. Her time or someone shot the clock, and everyone who had ever so terribly lie about the time.";
				var wordArr=words.split(" "),
				counter=wordArr.length,
				start=wordArr[0];
				for(var i=1; i<counter;i++){
					var zeroed=i%9;
					start +=" " +wordArr[i];
					start=start.toString();
					if(zeroed===0||i+1.1>counter){ 
						readingArr.push(start);
						start="";
					}
						}
			return readingArr;},
			notify: true,
		},
		event:{
			type: Array,
			value: [],
			notify: true
		},
		drags:{
			value: true,
			notify: true
		}, 
		isResizing: {
			value: true,
			notify: true

		},

  },
computeEventHeightLightColor:function(){
	return "aliceblue";
},

computeDay: function(day){if(day){return "pretty";}
},
ready: function()
{	
		var today = new Date();
		var index=today.getMonth();
 		this.set("displayedIndex",index);
		this.async(this.initialize, 240);
},

computeCurrentHeight: function(currentHeight){
   	var ht=window.screen.height;
      ht=.90*(ht);
      ht=ht.toString()+"px";
    	if(this.currentHeight==undefined) {this.set("currentHeight", ht); this.style.height=ht;}
    	
    	
    },
setArrays:function(){
	var daysofweek=this.displayed.sort(function(a,b){
		return (b.date.getDay()-a.date.getDay());});

	//console.log(daysofweek, "yoohoo");
	var daysOfWeek=daysofweek.reverse();
	var dow=[["Sun"],["Mon"],["Tues"],["Wed"],["Thur"],["Fri"],["Sat"]];
	var counter=daysofweek.length;
	var holder=[],
	iconsarr=["social:school","icons:dashboard", "icons:chrome-reader-mode", "maps:local-dining", "image:exposure-neg-1","image:exposure-neg-2","image:exposure-plus-1","image:exposure-plus-2","icons:cloud-download","icons:cloud-download"];
	holder.push(daysOfWeek[0]);
	for(let i=1; i<counter; i++)
	{	var truth=(daysOfWeek[i].date.getDay()==daysOfWeek[i-1].date.getDay());
		if(daysOfWeek[i].inMonth && i%3==0){
			daysOfWeek[i].eventIcon=iconsarr[Math.floor(i/3)],
			daysOfWeek[i].eventIcon1=iconsarr[Math.floor((i/3)+(1/4))],
			daysOfWeek[i].eventPrimaryColor="aliceblue",
			daysOfWeek[i].eventSecondaryColor="#009";
			daysOfWeek[i].eventPrimaryColor1="aliceblue",
			daysOfWeek[i].eventSecondaryColor1="red";
		}
		if(truth)
		{
			holder.push(daysOfWeek[i]);
		}
		if(i==counter-1 || !truth){
			var holder2=holder.sort(function(a,b){
				return a.displayIndex-b.displayIndex;
			});
			//console.log(holder2, "h2");
			var slot=Math.floor(i/7);
			if(i==counter-1){slot++;}
			dow[slot].push(holder2);
			holder=[];
			holder2=[];
			holder.push(daysOfWeek[i]);
			}

	}
	//console.log(dow, "dow");
	this.set("displayedTwo", dow);

	},
initialize:function(days){
	var startYear =new Date().getFullYear();
   	var endYear =startYear + 3;
	var date=new Date(startYear, 0, 1);
	var dateEnd =new Date(endYear, 11, 31);
	if(days){
	this.calendarCreator(date, dateEnd, "months", days);
	}
	else{
		this.calendarCreator(date, dateEnd, "months");
	}
 var counter=this.monthsArray.length;
 	this.set("maxIndex", counter-1);
		var self=this;
		this.calendarDayArray=[];
		this.calendarMonthsArray=[];
 for(var i=0;i<counter; i++)
		 { 	
		 	var array = this.monthsArray[i];
		 	this.monthsArray.length;
			self.push("calendarMonthsArray",array);
		 	array.forEach(function(item, index, arr){
		   		self.push("calendarDayArray", item);
		 	});
		}
		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
		var calendar =[];
		//console.log(this.displayed);
		calendar = this.calendarDayArray;
		this.set("fcCourse.courseCalendarDaysArray", calendar);
		this.set("fcCourse.calendarDayArray", calendar);
			this.setArrays();
},

computeDisplayed: function (displayedIndex)
{
	return this.calendarMonthsArray[displayedIndex];
},
_forward: function(){
		if(this.displayedIndex ==this.maxIndex)
 		{
 			this.set("forwardHidden",true);
 		}
 		else
 		{	this.set("backHidden",false);
 			this.set("forwardHidden",false);
 			console.log(this.calendarMonthsArray);
    		this.set("displayedIndex", this.displayedIndex+1);
    		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
    		this.setArrays();
    	}
    },
 _backOne: function(){	
 		if(this.displayedIndex===0)
 		{ 
 			this.set("backHidden",true);
 		}
 		else
 		{	this.set("forwardHidden",false);
 			this.set("backHidden",false);
    		this.set("displayedIndex", this.displayedIndex-1);
    		console.log(this.calendarMonthsArray);
    		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
 				this.setArrays();
 		}
 	
    },
  
  computeYear:function(displayed)
  		{
  		var	y =  new Date();
  		y=y.getFullYear();
  		var	m = new Date();
  		var retVal=y+Math.floor((this.displayedIndex)/12);
		return retVal;
		},

computeNotInMonths: function(item, displayedIndex){
	var x=new Date(item).getFullMonth();
	var y=this.displayedCalendarMonth;
	var retVal = (x===y);
	var len = this.displayed.length;
	return retVal;
},
computeViewMonth: function(displayedIndex){
 var monArr =[];	
 monArr=["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"];
	return monArr[displayedIndex];
	},

_computePrettyDay: function(d)
 	{	
 		var day=new Date(d).getDate();//console.log(day);
 		return day;

 	},

 	 _resize: function(e){
          var self=this;
          var template=this.$.ddrtemplate;
          this.set("drags",false);
          e.preventDefault();
          var width=Math.floor(parseFloat(window.screen.width)*.96);
          var height=Math.floor(parseFloat(window.screen.height)*.999);
          if(this.isResizing==true){
          switch(e.detail.state) {
                case 'start':
                var theId=this.relId;
                var elem=this.$$(theId);
                var sWidth =window.getComputedStyle(self.$.myPanel, null).getPropertyValue("width");
                var sheight =window.getComputedStyle(self.$.myPanel, null).getPropertyValue("height");
                self.set("currentHeight", sheight);
              
                 break;
                case 'track':
                  var newheight = parseInt(self.currentHeight) + e.detail.ddy;
                  var nwidth = parseInt(self.currentWidth) + e.detail.ddx;
                  var nheight2=(newheight<parseFloat(self.minHeight))?self.minHeight:(newheight>height)?height: newheight;
                  var nwidth2=(nwidth<320)?320:(nwidth>width)? width:nwidth;
                  var trueWidth = nwidth2.toString()+'px';
                  var trueHeight = nheight2.toString()+'px';
                  
                  
                  self.set("currentWidth",trueWidth);
                  self.set("currentHeight",trueHeight);
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                
                  break;
                case 'end':
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                  this.set("heightHolder", self.currentHeight);
                  this.set("widthHolder", self.currentWidth);
                  // self.notifyResize();
                  this.toggleColor=true;
                  // self._onIronResize();
                  self.set("refit", true);
                 // self.afterStartResize();
                  Polymer.dom.flush();
                  break;
              }
            }
        },
      
     dragsOff: function(){this.set("drags", false);},
    dragsOn: function(){ if(!this.drags){this.async(this.dragSwitch, 500);}},
    dragSwitch: function(){this.set("drags", true);},
    focusedDragMe:function(e){
        if(this.drags==true){
            var self=this;
            e.preventDefault();
            switch(e.detail.state)
            {
              case 'start':
                // console.log('START NoWayAreWe Draggin');
                self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
                self._topprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("top"))-e.detail.y;
                //console.log('top distance differenced?' + self._topprime);
               if(self.counter==0){   self.translate3d(0, 0, 0);}
                Polymer.dom(self).setAttribute("style.position", "fixed"); 
               Polymer.dom(self).setAttribute("style.left", "0px"); Polymer.dom(self).setAttribute("style.left",self._leftprime+"px");
               Polymer.dom(self).setAttribute("style.top", "0px"); Polymer.dom(self).setAttribute("style.top",self._topprime+"px");
                
                self.set("refit",true);
                self.changeX=0;
                self.changeY=0;
                Polymer.dom.flush();
                break;
              case 'track':
                self.changeX=e.detail.ddx + self.changeX;
                self.changeY=e.detail.ddy + self.changeY;
                self.translate3d(self.changeX.toString() + 'px', self.changeY.toString() + 'px', 0);
                break;
              case 'end':
                //console.log(self._topprime);
                self._right = parseInt(window.getComputedStyle(self, null).getPropertyValue("right"))
                self._bottom = self.getBoundingClientRect().top;
                self._x= ((self._leftprime + e.detail.x)>=0)?(self._leftprime + e.detail.x): 0;
                self._y=((self._topprime + e.detail.y)>=0)?Math.ceil(self._topprime + e.detail.y):0;
            

                //console.log("ENDING", self._x, e.detail.x, e.detail.y, e.detail.dx);
              
                self.style.left=self._x.toString()+'px';
                self.style.top=self._y.toString()+'px';
                Polymer.dom(self).setAttribute("style.top", e.detail.y+'px'); Polymer.dom(self).setAttribute("style.left",e.detail.x+'px');
          self.translate3d(0, 0, 0);

                //console.log('y: ' + e.detail.y);
                    
                self.dragging=false;
                self.set("refit",true);
                Polymer.dom.flush();
                break;
            }
        }
    },
       falseClose: function(){
        this.toggleColor=!this.toggleColor;
        if(this.toggleColor===false){
        this.set('currentHeight', this.minHeight);
        this.style.height= this.minHeight;
        this.style.width=this.currentWidth +"px";
        this._onIronResize();
      }
        else{
          this.set('currentHeight',this.heightHolder);
          this.style.height = this.heightHolder;
          this._onIronResize();
            }

       },
});
</script>
</dom-module>
