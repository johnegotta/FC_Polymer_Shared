<dom-module id="fc-calendar-day-back">
<template>
<style>
.primary{
	color: #008;
	font-weight:600;
	font-size: 13.5px;
	width: 167px;
}
#main{background: white;}
.secondary{
		color: grey;
	font-weight:500;
	font-size: 11px;
	margin-top: 11px;
	padding: 0 4px;
	width: 50px;
}	
.circle
	{border-radius: 180px;position: absolute; top: 1px; left: 8px; z-index: 5;width: 12px; height: 12px; background: red;border: 2px solid white;padding: 2px; margin: 0px 2px 2px 2px;cursor: pointer; @apply(--shadow-elevation-8dp);
     }
iron-icon.small {
	height: 14px!important;
	width:14px!important;
}
.scheduling{padding: 0px 5px;}
.header-class{min-height: 35px !important; max-height: 55px !important; height: 100%;}
.selected{}
</style>
<fc-event-dialog event="{{dialogEvent}}" id="eventDialog">
</fc-event-dialog>

<div class="horizontal layout" id="main">
<div 
      class="circle" 
      id="button" 
      on-click="_onClearButtonClick"
      hidden$="{{!isSingle}}">
</div>
	<div class="vertical layout" id="swipable" style="margin: 2px; border: silver 2px solid; height: {{backHeight}}; width:{{backWidth}};">
			<section class="header-class layout horizontal" style="height: 42px!important; font-size:16px; background: [[_computeHeaderBackGround(calDay.*)]]; padding-top: 6px; text-align: center; font-family: merriweather;">	
					<section class="flex-7" style="text-align: center; padding: 8px 2px 2px 8px;">
					[[computeShowDate(calDay.date)]]
					 </section>
				<div class="vertical layout flex nowrap">
				<content select=".headerButton"></content>
				</div>
			</section>
		<paper-list-box style="height: 360px; overflow-y: scroll;" on-dragover="allowDrop" on-drop="handleDrop">

<content></content>
		<template is="dom-repeat" items="{{eventList}}" as="event">
				<fc-event-item 
				draggable="true"
				on-dragstart="handleDragStart"
				event="{{event}}"
				event-list="{{eventList}}"
				back-width={{backWidth}}
			>
			<section class="dialogButton" on-tap="openup" style="border-radius:180px;">
					<iron-icon class="small" style="height: 16px!important;width:16px!important; border-radius:180px; color: white; background: silver;" icon="icons:add-circle-outline">
					</iron-icon>
				</section>
			</fc-event-item>


				</template>

		</paper-list-box>
</div>

</div>
</template>
<script>
FcCalendarDayBack=Polymer({
	is:"fc-calendar-day-back",
	behaviors:
		[
			"FCBehaviors.FcCalendarBehaviorPrime"
		],
	observers:[],
	properties:
	{
		fcCourse:{
			type: FcCourse, 
			value: function()
			{
			return new FcCourse();
			},
			notify: true,
		},
		isSingle:{
			type: Boolean,
			value: false,
			notify: true
		},
		backHeight: {
			type: String, 
			value: "420px",
			notify: true
		},
		backWidth:{
			type: String,
			value: "320px",
			notify: true
		},
	
		calDay:{
			type: FcCalendarDay,
			observer: "observeCalDay",
			notify: true
		},
		eventList:{
			type: Array,
			value:function(){return [];},
			notify: true
		},
		courseCalendarDaysArray:{
			type: Array,
			value:[],
			notify: true,
		},

   	hook: {
   		type: Array,
		value: [],
		notify: true
	},
    sharedElements: {
        type: Object,
        value: function() {
          return {
            'hero': this.$.main
          };
        }
      },
    animationConfig: {
        type: Object,
        value: function() {
          return {
            'entry': [{
              name: 'fade-in-animation',
              node: this.$.button
            }, {
              name: 'hero-animation',
              id: 'hero',
              toPage: this
            }],
            'exit': [{
              name: 'fade-out-animation',
              node: this.$.button
            }, {
              name: 'scale-down-animation',
              node: this.$.main,
              transformOrigin: '50% 50%',
              axis: 'y'
            }]
          }
        }
      }
    },
    _onClearButtonClick: function() {
      this.fire('close');
    },
	_computeHeaderBackGround: function(daylist){
			if(daylist.base && daylist.base.isTestDate===true)
		{
			return "gold; color: #008; font-weight: 700";
		}
		else{ return "#008; color: white; font-weight: 600";} 
	},
	_computeEventList: function(calDay){
	if(calDay){
	return calDay.eventList;
	}
	},
	setDay: function(hday){
		this.set("hook", hday);
		},
	_computeTestDayEvents:function(dayList){
	if(daylist.base.isTestDate===true)
		{
			return "SAT TEST DATE";

		}
		else{ return "#008; color: white; font-weight: 600";} 
	},
	  openup: function(e){
    		console.log(e);
    		var event=e.model.__data__.event;
    		this.$.eventDialog.openDi();
    		console.log(this.$.eventDialog, event);
    		this.set("dialogEvent", event);
    		console.log(this.$.eventDialog, event, this.dialogEvent);

    },
	computeShowDate: function(date){
		if(date){ 
			var d=new Date(date);
		var p= d.toDateString();
		return p;
		}
	},

	observeCalDay: function(newv, oldv){
		this.set("eventList",newv.eventList);
	}, 
	handleDragStart: function(e){
     var cucumber =JSON.stringify(e.model.__data__.event);
      e.dataTransfer.setData("fcdata", JSON.stringify(e.model.__data__.event));
      console.log(cucumber, e, e.model, e.target);
      var pickle=localStorage.setItem("cucumber", cucumber);
    },
	handleDrop: function(e){
		e.preventDefault();
		 console.log(e, e.model, e.target);
		var target=e.target;
		while(target.nodeName!="FC-CALENDAR-DAY-BACK" && target.nodeName!="BODY"){
			target=target.parentNode;
		}
		if(target.nodeName=="FC-CALENDAR-DAY-BACK"){
			console.log(target, target, target.calDay.cdIndex);
			var index=target.calDay.cdIndex;
     var strData=(e.dataTransfer.getData("fcdata"));
       var edata = JSON.parse(strData);
         var ev=new FcEvent(edata);// add a last change index/timestamp for recording to system

		if(!this.fcCourse.courseCalendarDaysArray[index].eventList){
		 	this.set(["fcCourse.courseCalendarDaysArray", index, "eventList"], []);
		 }
		 console.log(this.fcCourse.courseCalendarDaysArray[index].eventList);
	 this.push(["fcCourse.courseCalendarDaysArray", index, "eventList"], ev);
      }
      },
    allowDrop: function (e) {
      e.preventDefault();
    },
    _sortSlots: function(a,b){
			var ao = stringTime(a.startTime);
			var bo= stringTime(b.startTime); 
		if (ao> bo) {
    		return 1;
  			}
  		if (ao < bo) {
   	 		return -1;
  			}
  		if (ao ===bo){
  			  return 0;
			}
		},
});
</script>
</dom-module>