<dom-module id="fc-event-element">
<template>
<style>
:host{
	font-family: merriweather;
	font-size: 14px;
	line-height: 1.0;
	margin-top: 12px;
	background: white;
	position:relative;
	height: 420px;
	width: 330px;
}
paper-item {
	border: 1px solid #adadad;
		background: white;
    --paper-item-focused: {
      background: var(--paper-amber-500);
      font-weight: 600;
    };
    
  }
#demo{
	display: block;
	background: #aedefe;
}
.holder{
	width: 320px;
	height: 360px;
	background: #aedefe;
	margin-left: 2px;
	border: gold ridge 1px;
	box-shadow: 4px 11px 21px 7px #9fafaf;
		display: block;
	oveflow: hidden;
	float: right;
}
.innerholder{
	overflow-y: scroll;
}
.header-class{
font-size: 18px;
color: white;
	background: #03A9F4;
font-weight: 600;
text-align: center;
	padding: 12px 12px 20px 12px;
min-height: 44px;
}
/*paper-item{

	border: 1px solid #adadad;
 --paper-item-focused: {
      background: var(--paper-amber-500);
      font-weight: bold;
    };
}*/
.selected{background: var(--paper-amber-500);
      font-weight: bold;}
.primary{
	color: #008;
	font-weight:600;
	font-size: 15.5px;
}
.secondary{
		color: grey;
	font-weight:500;
	font-size: 11px;
}	
.slides{overflow: hidden; overflow-y: scroll;}

.one{
	font-family: merriweather; 
	font-weight: 600;
	color: #080808;
	font-size: 14px;
	white-space: nowrap;
	display: inline-block;
}
.two{
	font-family: merriweather; 
	display: inline-block;
	width: 95px !important;
	overflow: hidden;
	overflow-x: scroll;
	white-space: nowrap;
	font-size: 14px;
}
</style>
<div class="layout vertical slides" style="margin-top: 3px; float: right;">
<template is="dom-repeat" items="{{inputOptions}}" as="option">
	
	
		<section class="holder layout vertical">
			<section class="header-class layout horizontal">
				<paper-icon-button on-tap="_backOneInput" icon="icons:arrow-back" style="color: white; left: 5px;padding-bottom: 8px; float: left;"></paper-icon-button>
					<span class="flex layout horizontal nowrap center center-justified" style="color: white; font-size:18px; margin-top: 4px; text-align: center; font-family: merriweather;">[[option.header]]</span>
					<paper-icon-button on-tap="_forwardOneInput" icon="icons:arrow-forward" style="color: white; float: right;" class="headerRight"></paper-icon-button> 
			</section>
			<paper-listbox class="layout vertical scroll" style="overflow: hidden; overflow-y: scroll;">
				<template is="dom-repeat" class="layout vertical flex scroll" style="max-height: 170px; overflow: hidden; overflow-y: scroll;" items="{{option.selectItems}}" as="value">
						<paper-item on-tap="soSelected" class="layout horizontal courseData">
							<paper-item-body  class="layout vertical one" value$="{{value}}" two-line>
								<div class="primary">[[value]]</div>
								<div class="secondary">[[option.labelA]]</div>
							</paper-item-body>   	
							<paper-icon-button icon="star" on-tap="soUnSelected" value$="{{val}}" alt="favourite this!">
							</paper-icon-button>
			  			</paper-item>
					</template>
				</paper-listbox>
				<section  class="header-class layout horizontal">
				</section>	
			</section>


</template>
</div>
</template>
<script>
"use-strict";
Polymer({
	is:"fc-event-element",
		behaviors:["FCBehaviors.FcCalendarBehaviorPrime"], 
	properties:{
		eventData:{
			type: Object,
			value: {},
			notify: true, 
			reflectToAttribute: true
		},
		
		fcCourse: {
			type: FcCourse,
			value:function(){return new FcCourse();},
			notify: true,
		},
		inputIndex: {
			type: Number,
			value: 0,
			notify: true
		},	
		valueOptions: {
			type: Array, 
			notify: true
			},
		inputOptions: {
			type: Array, 
		 	computed:"selectInputs(inputs, inputIndex)",
			notify: true,
			reflectToAttribute: true
		},
		inputs: {
			type: Array,
			value: [],
			notify: true
		},
		saveChoiceLocal:{
			type: Boolean, 
			value: false,
			notify: true
		},

		event: {
			type: FcCourse,
			value:function(){return new FcCourse();},
			notify: true, 
			reflectToAttribute: true
		},

		calendarDayArray:{
			type: Array,
			value: [],
			notify: true,
			reflectToAttribute: true
		},
		summer:{
			type: Boolean,
			value: false,
			notify: true

		},
	
	},

	_backOneInput()
	{
		this.set("saveChoiceLocal", true);
		this.set("inputIndex", this.inputIndex-1);
	},
	_forwardOneInput()
	{	
		this.set("saveChoiceLocal", true);
		this.set("inputIndex", this.inputIndex+1);
	},

	selectInputs(inputs, inputIndex)
	{		
		var retVal = [];
		if(this.inputIndex===0)	
			{ 		
					retVal.push(inputs[this.inputIndex]);
					//console.log(retVal);
			}
			else if(this.saveChoiceLocal===true)
			{	
				retVal.push(inputs[this.inputIndex]);
				this.set("saveChoiceLocal", false);
			}
			return retVal;
	},

	soSelected(e){
		var propertyName = e.model.__data__.option.name;
		var val = e.model.__data__.value;
		console.log(e.model.__data__, propertyName, val);
		var self=this;
		
		if(propertyName == "testDate")
		{
			
			var cat=this.fcCourse.courseCalendarDaysArray.filter(function(one, two, three){
				one.calendarDay.eventList=[];
				one.calendarDay.eventList=self.getTimes(one.calendarDay.isHoliday, one.calendarDay.showDate);
				return one;
			});

			this.set("fcCourse.courseCalendarDaysArray", null);
			this.fcCourse.setTestDate(val);
			console.log(this.fcCourse.courseCalendarDaysArray, cat);
			this.async(function(){this.set("courseCalendarDaysArray", cat);}, 200);
		}
		else if(propertyName == "programLength")
		{
			var pickle= this.fcCourse.setCourseLength(val);
			this.push("fcCourse.eventArray",pickle);
		}
		else if(propertyName == "practiceTestDay")
		{
			var arrayEve=[];
			arrayEve=this.fcCourse.setPracticeTestDay(val);
			if(arrayEve[0]===true)
			{
				this.fcCourse.practiceTestArray = [];
				this.fcCourse.practiceTestArray = this.fcCourse.courseCalendarDaysArray.filter(function(currentValue, index, array)
				{
					if(currentValue.calendarDay.inPracticeTestArray===true)
					{return currentValue;}
				});
			this.fcCourse.practiceTestDay=arrayEve[1];
			this.fcCourse.numberOfPracticeTests=this.fcCourse.practiceTestArray.length;
			}
			this.push("fcCourse.eventArray",this.fcCourse.practiceTestArray);
			//this.set("fcCourse.courseCalendarDaysArray", this.fcCourse.courseCalendarDaysArray);
		}
		else if(propertyName == "courseMeetingSets")
		{
			var eventArr= this.fcCourse.setCourseMeetingDaysAndTimes(val);
			this.fcCourse[propertyName] = val;
			this.set("fcCourse.summerMeetingDays", "Not Applicable");
			this.push("fcCourse.eventArray",eventArr);
			this.set("fcCourse.courseCalendarDaysArray", this.fcCourse.courseCalendarDaysArray);
			var self=this;
			this.fcCourse.courseCalendarDaysArray.filter(function(currentValue, index, array)
		{	var len=currentValue.calendarDay.eventList.length;
			for(var i=0; i<len;i++)
			{
			self.notifyPath("fcCourse.courseCalendarDaysArray." + index + ".calendarDay.eventList." + i, currentValue.calendarDay.eventList[i]);
			}
		});


		}
		else if(propertyName == "summerMeetingDays")
		{	var eventArr = this.fcCourse.setCourseMeetingDaysAndTimes(val);
			this.fcCourse[propertyName] = val;
			this.set("fcCourse.courseMeetingSets", val);
			this.push("fcCourse.eventArray",eventArr);
			this.set("fcCourse.courseCalendarDaysArray", this.fcCourse.courseCalendarDaysArray);
			var self = this;
			this.fcCourse.courseCalendarDaysArray.filter(function(currentValue, index, array)
		{	var len=currentValue.calendarDay.eventList.length;
			for(var i=0; i<len;i++)
			{
			self.notifyPath("fcCourse.courseCalendarDaysArray." + index + ".calendarDay.eventList." + i, currentValue.calendarDay.eventList[i]);
			}
		});
		}
		else if(propertyName=="privateCoach")
			{	this.set("fcCourse.courseType", "Private Coaching"); 
				this.set("fcCourse.coach", val);
				this.set("fcCourse.courseSize", 1);
			this.fcCourse[propertyName] = val;}
		else if(propertyName=="privateCoachingHours")
		{ 
			this.set("fcCourse.privateCoachingHours", val);
			var retVal = (val=="12 Hours, 4-6 Sessions, Price Total")?"3 Weeks": (val == "18 Hours, 6-9 Sessions, Price Total")?"4 Weeks": (val == "24 Hours, 8-12 Sessions, Price Total")?"5 Weeks": (val == "36 Hours, 12-18 Sessions, Price Total")?"6 Weeks": (val == "50 Hours, up to 25 Sessions, Price Total")?"10 Weeks": "13 Weeks";
			this.set("fcCourse.programLength", retVal);
			console.log(val);
			

		}
		else if(propertyName == "testDate" && this.fcCourse.isPrivateSchedule===true)
		{
			this.fcCourse.setTestDate(val);
			this.fcCourse.setCourseLength(this.fcCourse.programLength);

		}
		else
		{
			this.fcCourse[propertyName] = val;
		}
			this.fcCourse[propertyName] = val;
			var propertyString="fcCourse."+propertyName;
			this.notifyPath(propertyString, val);
		
		// if(propertyString=="fcCourse.programLength" && this.fcCourse.testDate!==""){var d=new Date(this.fcCourse.testDate);}
		var self= this;
		console.log(this.fcCourse.eventArray, "here is a mush of the events");
		//this.set("fcCourse.courseCalendarDaysArray", this.fcCourse.courseCalendarDaysArray);
	    var indexOfNextInput= this.fcCourse.setCourseCreatorNextInput(propertyName, val, this.inputIndex);
	    console.log("is too a function");
	    this.set("saveChoiceLocal",true);
		this.set("inputIndex", indexOfNextInput);

	
},

getTimes: function(isHoliday)
	{	
		var slotsArr = [];
		var timeArr = [];
		for(var i=9; i<=20;i++)
        {
              var hour=(i<13)?i:(i-12);
              if(hour<10){hour=hour.toString();}
              var minutes="00";
              if(i==12){minutes="30";}
              if(i===15){minutes="45"}
              var ampm=(i<12)?"AM":"PM";
              var tobj = {"hour": hour,
                          "minutes": minutes,
                          "ampm": ampm, 
                        };
              var string=hour.toString() + ":" + minutes+ ampm;
              if(isHoliday==true)
              {
              	timeArr.push({"time": "NO BOOK", "activity": "HOLIDAY!", "coach":"HOLIDAY", "location": "HOLIDAY", "startTime":"", "endTime": "", "fcid": "", "date":"", "background": "gold"});
              }
              else
              	{
              		timeArr.push({"time": string, "activity": "", "coach":"", "location": "", "startTime":"", "endTime": "", "fcid": "", "date":""});
          		}
              if(i!==16){i=i+2;}
              else if(i===16){i=17;}
          	}
          return(timeArr);
	},

});
</script>
</dom-module>
