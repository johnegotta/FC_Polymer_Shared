<dom-module id="fc-calendar-dialog">
<template>
<style>
:host{
background: white;
padding: 0px 3px 4px 8px;
opacity: 1;}
.calendarItem{height: 380px!important;}
.fbutton{text-align: center; width: 99.6%;border: #afafaf 1px solid; border-radius: 3px; z-index: 7; box-shadow: 3px 7px 11px 4px #efefef; padding: 5px 0px; cursor: pointer;}
.fbutton:active{
	border:4px solid #2435C9;
 color: #FFD410;
 box-shadow: inset 0 1px 0 0 #FFF6CE,inset 0 -1px 0 0 #E3C852,inset 0 0 0 1px #FCE88D;
 -moz-box-shadow: inset 0 1px 0 0 #FFF6CE,inset 0 -1px 0 0 #E3C852,inset 0 0 0 1px #FCE88D;
 -webkit-box-shadow: inset 0 1px 0 0 #FFF6CE,inset 0 -1px 0 0 #E3C852,inset 0 0 0 1px #FCE88D;
 background-color: #5DD7FC;
 width: 98.6%
}
</style>		
<fc-ddr-card drags="true" head-class="darkBlue" is-picker="true" header-title="Focused Planner" class="flex layout vertical" style="padding-right:2px; margin: 4px 0px 4px 0px; width: 100%!important; height: 500px;">
	
<section class="flex layout horizontal center-justified">

</section>
 <div class="flex layout horizontal center-justified">
 			<array-selector id="arrselector" items="{{fcCourseObject.eventArray}}" selected="{{selected}}" multi toggle></array-selector>
			<neon-animated-pages 
				class="layout vertical flex-1" 
				id="pages" 
				style="width: 320px; 
				height:360px;" 
				selected="1">
				<fc-tabbed-calendar-card 
					on-close="_onClose"
					cal-day="{{quickPass.day}}"
					event-list="{{quickPass.eventList}}"
					good-catch="{{quickPass}}" 
					fc-course="{{fcCourseObject}}" 
					fc-event="{{fcEvent}}">
				</fc-tabbed-calendar-card>
				<fc-date-picker-proto 
					displayed-month="{{displayedMonth}}" 
					on-click="_dateSelected" 
					fc-course="{{fcCourseObject}}" 
					course-calendar-days="{{computeCalendarDays(fcCourseObject.courseCalendarDaysArray.*)}}" 
					id="myCalendarCard">
					<section 
						class="footer fbutton" 
						on-tap="createCalendar">
						Create Calendar from Selected Days
					</section>
				</fc-date-picker-proto>
			</neon-animated-pages>
			<fc-base-event-inputs 
				class="horizontal flex-2 layout" 
				value-options={{valueOptions}} 
				output-options="{{outputs}}" 
				fc-course="{{fcCourseObject}}">
			</fc-base-event-inputs>
			
			<div class="horizontal layout flex-1">
				<fc-event-element 
					fc-course="{{fcCourseObject}}" 
					inputs="{{inputs}}" 
					class="calendarItem">
 				</fc-event-element>
 			</div>
		</div>
		<paper-tabs id="calendarTabs" scrollable="true" style="padding: 2px 0px; height: 420px; outline: 0px;" class="horizontal layout flex scroll" bar="true" hide-scroll-buttons="false"> 
	<div class="horizontal layout justified" style="width: 100%; margin: 20px; overflow-x: scroll;">
					
						<fc-calendar-day-back course-calendar-days="{{computeCalendarDays(fcCourseObject.courseCalendarDaysArray.*)}}" fc-course={{fcCourseObject}}>
						</fc-calendar-day-back>
					</div>
					</paper-tabs>
				
</fc-ddr-card>
	
</template>
<script>
FcCalendarDialog= Polymer({
	is:"fc-calendar-dialog",
	behaviors:["FCBehaviors.FcCalendarBehaviorPrime", 
	"fcDraggableDataBehavior"
		 // "Polymer.PaperDialogBehavior"
		  ],
	// observers:['fcCourseObjectObserver(fcCourseObject.courseCalendarDaysArray.*)'],
	listeners:{'on-date-click': 'passclick'},
	properties:{
		fcCourseObject:{
			type: FcCourse,
			notify: true
		},
		counter: {
			type: Boolean,
			value: false, 
			notify: true
		},
		displayedMonth:{
			type:Array,
			notify: true
		},
		valueOptions: {
			type: Array, 
			value: [],
			notify: true
			},
		outputs: {
			type: Array,
			value: [],
			notify: true
		},
		days:{
			type: Array,
			value: [],
			notify: true,
		},
		slot:{
			type: Array,
			value:[],
			notify: true
		},
		event:{
			type: Array, 
			value: [],
			notify: true,

		},
	
		inputs: {
			type: Array,
			value: [],
			notify: true
		},

		day: {
				type: Object,
				value:{},
				notify: true
				},
		quickPass:{
			type: Object,
			value: {},
			notify: true


		},
	


	},
	
	ready: function()
	{	
		this.set("fcCourseObject", new FcCourse());
		var self=this;
		var valueArray=FcCourse.getMoreInputs();
		valueArray.forEach(function(item, index, array){
			 self.push("valueOptions",item);
		 });
	},
	
	selectedTwo: function(event){


	},
	createCalendar: function(){
		var sortedCalDays= this.fcCourseObject.courseCalendarDaysArray.sort(function(a,b){
			if (a.dateId > b.dateId) {
    		return 1;
  			}
  			if (a.dateId < b.dateId) {
   	 		return -1;
  			}
  			if (a.dateId ===b.dateId){
  			  return 0;
			}
		});
		this.set("fcCourseObject.courseCalendarDaysArray", sortedCalDays);
	},

	passclick:function(e){
		console.log(e, e.detail);
		var day=e.detail.day;
		this.set("quickPass", day);
		this.fire("on-pass-click",{"calday":day});
	},

	
	computeCalendarDays: function(CCDAday)
	{
		console.log(CCDAday, "LOOK HERE, THIS COULD BE THE ISSUE");
		if(CCDAday)
			{
			var arrayB=[];
			arrayB.push({"daybase":CCDAday.base, "dayvalue":CCDAday.value, "path": CCDAday.path});
		
			
				return arrayB;
			}
		
	},
	computeEvents: function(days)
	{

		return days.value;
	},



attached: function()
	{		
		this.set("firstTime", false);
		var inputO=this.inputValueAndLabelSerialization(this.valueOptions);
		this.set("inputs", inputO);	
		var outputs= this._computeOutput(this.valueOptions, this.fcCourseObject);
		this.set("outputs", outputs);
	},

fcCourseObjectObserver: function(newVal)
{
	//console.log(newVal, newVal.value);

},

_computeDate: function(date){
	if(date){
	return date.toDateString();	
	}
},

_computeOutput: function(valueOptions, fcCourseObject)
	{
		var length=valueOptions.length;
	 	 var outputArray=[];
	 	for(i=0;i<length;i++)
	  {
	 		var valarr = [];
	 		valarr=valueOptions[i];
	 		var name = valarr[1].label2;
	 			name =name.charAt(0).toLowerCase() + name.slice(1);
	 			name=name.replace(/\s/g,'');
	 		var propertyName ="fcCourseObject."+name;
	 		var eventOutput={
	 			"name":name,
	 			"inputType": "select",
	 			"header":valarr[0].label,
	 			"labelA":valarr[1].label2,
	 			"value": this.fcCourseObject[name] || ""
	 		};
	 		outputArray.push(eventOutput);
	 	}
	 	return outputArray;
	},


inputValueAndLabelSerialization: function(valueOptions)
	 {	
		var length=valueOptions.length;
	 	 var derray=[];
	 	for(i=0;i<length;i++)
	  {	
	 		var valarr = [];
	 		valarr=valueOptions[i];
	
	 		var eventInput={
	 			"name":"",
	 			"inputType": "select",
	 			"header":valarr[0].label,
	 			"labelA":valarr[1].label2,
	 			"labelB":"",
	 			"isRepeaterSelect":true,
	 			"selectItems":valarr[2],
	 			"style":"",
	 			"class": "",
	 			"aside":{	"noteOne:": "",
	 						"noteTwo:": ""}
			};
	 			var name = valarr[1].label2;
	 			name =name.charAt(0).toLowerCase() + name.slice(1);
	 			name=name.replace(/\s/g,'');
	 		eventInput.name=name;
	 		derray.push(eventInput);

	 	}
	 	 return derray;
	 },	
	
	
	


_dateSelected: function(event) {
      // var targetOne = event.target;
      // while (targetOne.nodeName!=="FC-DATE-MINI"&& targetOne !== this && !targetOne._templateInstance && targetOne.nodeName!="PAPER-ICON-BUTTON" && targetOne.nodeName!="PAPER-MATERIAL" && targetOne.nodeName!="BODY") {
      //   targetOne = targetOne.parentNode;
       
      // }
      //  if(targetOne.nodeName=="FC-DATE-MINI")
      //   {
      //   	this.push("fcCourseObject.courseCalendarDaysArray", targetOne.day);
        	
        
      
    
      // this.sharedElements = {
      //   'hero': this
      // };
      // this.fire('on-date-click', {//this is where we pass data... we do not have a click yet... it will be on another level likely
      //   item: targetOne.day
      // });
      //       this.$.pages.selected = 0;
      //      }
    },
    _forward: function(){
    	this.$.myCalendarCard._forwardOneMonth();
    },
    _backOne: function(){
    	this.$.myCalendarCard._backOneMonth();
    },


    _onClose: function() {
      this.$.pages.selected = 1;
    },

  computeYear: function(displayedMonth)
{	
	if(this.displayedMonth[15])
	{
	return displayedMonth[15].date.getFullYear();
	}
} 
});
</script>
</dom-module>
