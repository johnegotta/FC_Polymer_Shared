<dom-module id="fc-date-mini">
<template>
<style>
section{
	border-radius: 50%;
}
</style>
	<div id="myblock" class="vertical layout center-justified" style$="{{circleSelect}}; color: aliceblue; [[_computeSizeStyle(sizeWanted)]] [[computeWhite(inMonth, calendarDay.isSelected)]]; background: [[computePickedDaysDark(inMonth, calendarDay.isSelected)]]; text-align: center; color: [[computePickedDaysWhite(inMonth, calendarDay.isSelected,calendarDay.isTestDate)]]; width:{{currentWidth}}px; height: {{currentHeight}}px;" on-tap="toggleDays"> 
		<section id="blockSon" class="horizontal layout center-justified" style$="[[_computeCircleRadius(circleSelect,currentWidth, currentHeight)]] height:[[currentHeight]]px; width:[[currentHeight]]px; align-text: center; align-item: center; align-content: right;" > 
			<content select=".date"></content>
		</section>
	</div> 
			<span hidden$="{{_calculateHideNotes(sizeWanted)}}"style$="{{dateCardMiniNotesStyle}}; padding-right: 1px;">[[computeDayNotes(calendarDay, eventList)]]</span> 
		
</template>
<script>
(function(){
	"use-strict";
	function Measurer(bindToHeight, self) {
    // I'll omit parameter validation here.
    
    Object.defineProperty(self, 'value', {
        get : function ( ) {
            return bindToHeight.value;
        },
        set : function ( val ) {
            bindToHeight.value = val;
        }
    });
};
})();

Polymer({
	is:"fc-date-mini",
	behaviors: [FCBehaviors.FcCalendarBehaviorPrime],
	properties: {
		day:{
			type: FcCalendarDay,
			value:{},
			notify: true
		},
		hideNotes:{
			type: Boolean,
				value: false,
			notify: true
		},
		eventList:{
			type: Array,
			value:[],
			notify: true
		},
 		dateMiniStyles: {
 			type: String, 
 			computed: "_computeSizeStyle(sizeWanted)",
 			notify: true
 		},
 		circleSelect: {
 			type: String,
 			computed:"_computeCircleSelectStyle(sizeWanted)",
 			notify: true
 		},
 		sizeWanted:{
 			type: String,
 			value:"medium",
 			notify: true
 		},
 		dateCardMiniNotesStyle: {
 				type: String,
 				value: function(){return "font-size:8px; font-weight: 500; font-style: merriweather; color: #008; height: 9px;"},
 				notify: true
 		},
 		fontSize:{
 			type: Number,
 			notify: true,

 		},

		calendarDay:{
			type: FcCalendarDay,
			value:{},
			notify: true
		}, 
		currentWidth:{
				type: String,
				value:function(){return 25;},
				notify: true
			}, 
			currentHeight:{
				type: String,
				value:function(){return 25;},
				notify: true
			}, 
		isCourseMeeting: {
			type: Boolean,
			value:false,
			notify: true
		},
		isPracticeTestDay:{
			type: Boolean, 
			value: false,
			notify: true
		},
		miniDate:{
			type: Date, 
			notify: true,
		},
		fcCourse:{
			type: FcCourse,
			value: function(){var retVal = new FcCourse(); return retVal;},
			notify: true
		},
		toggleDay:{
			type: Boolean,
			value: false, 
			notify: true
		}, 
		inMonth: {
			type: Boolean,
			value: false,
			 reflectToAttribute: true,
			 notify: true
		}, 
		dayId:{
			type: Number, 
			value:"",
			notify: true
		},
		displayedMonth:{
			type: Array,
			notify: true
		},
		displayedIndex:{
			type: Number,
			notify:true,
			reflectToAttribute: true
		},
		cdIndex:{
			type: String,
			value: "-1",
			notify: true,
		},
		parentCurrentWidth:{
				type: String,
				notify: true
		},
		parentCurrentHeight:{
				type: String,
				notify: true
		},
		selectedArray:{
			type: Array,
			value: [],
			notify: true
		},
		selected: {
			type: Array, 
			notify: true
			},
		isSelected: {
			type: Boolean,
			value: false,
			observer: "observeIsSelected",
			notify: true
		},
		heightLog:{
			type:Array,
			value:[],
			notify: true,
			observer: "observeHeight",
		},
		widthLog:{
			type: Array,
			value:[],
			notify: true,
			observe: "observeWidth",
		},
		hiComp:{
			type: Object,
			computed: "computeHiComp(heightLog, currentHeight, parentCurrentHeight)",
			notify: true
			},
		widComp:{



		},
		dimensionsObject:{



		}

	},
	ready:function(){

},
	computeHiComp:function(hl, ch, pch){
		var holder={};
			//this.makeCircles(hl);
		// var result=hl.lastIndexOf(!false);
		// var lv=(parseFloat(hl[result]));
		// var cv=parseFloat(ch);
		// var retVal1=((lv-cv)===0);
		// var pv=parseFloat(pch);
		// var fractC=Math.floor(pv/cv);
		// var fractL=Math.floor(pv/lv);

		// var holder={
		// 	key1: retVal1,
		// 	key2: lv,
		// 	key3: cv,
		// 	key4: pv,
		// 	key5: fractC,
		// 	key6: fractL
		// };
		// console.log(holder, holder, holder);
		// return holder;

	},
	_computeCircleRadius: function(a,b,c,h,w){


	},
	ready: function(){

	},
	observeHeight:function(nv, ov){
		//console.log(nv, ov);		

	},
	observeWidth: function(nv,ov){
		console.log(nv,ov)

	},
	attached: function(){

			this.makeCircles();
	},
	_computeSizeStyle: function(size){
		if(size=="" || size =="medium" || size=="normal"){
			this.set("dateCardMiniNotesStyle",  "font-size:8px; font-weight: 500; font-style: merriweather; color: #008;");
				return "font-size: 14px; font-weight: 500; cursor: pointer; border: 1px solid";
				}
		else if(size=="small" || size=="datePicker" || size=="datepicker"){
			return "margin-bottom: 0px; font-size: 14px; font-weight: 500; cursor: pointer;";

		}

	},

	makeCircles: function(){

				var h=this.$.myblock.style.height;
				var w=this.$.myblock.style.width;
				var something=	Polymer.dom(this.root).firstElementChild.firstElementChild;
				var son=something.firstELementChild;
				var styles=getComputedStyle(something, null);
				h=styles.getPropertyValue("height");
				var setVal=(h!="auto" && h!="" && parseFloat(h))?parseFloat(h): false;
				this.push("heightLog",setVal);
				var self=this;
				var values=[];
				values=this.heightLog.filter(function(val){return (val!==false);});
				console.log(values);
				w=styles.getPropertyValue("width");
				var wsetter=(w!="auto" && w!="" && parseFloat(w))?parseFloat(w): false;
				var argarr=[];
				this.push("widthLog",wsetter);
				var argarr=this.widthLog.filter(function(val){return (val!==false);});
				this.async(function(){
				var oi=values.pop();
				var bi=argarr.pop();
				var valH=Math.floor((oi+bi)*.5);
				this.set("fontSize", valH);
				var oib=Math.ceil(valH);
				this.set("fontSize", oib);
				this.set("currentHeight", valH);
				this.set("currentWidth", valH);
			},1800);
		},

		_calculateHideNotes: function(size){
				if(size=="small" || size=="datePicker" || size=="datepicker"){
						var ret= true;
						}
				else{var ret= false;}
				//console.log(ret);
					return ret;
		},
		_computeCircleSelectStyle: function(size){
					return "border-radius:50%";

		},

	computeDayNotes:function(calendarDay,elist){
		var retVal;
		if(calendarDay.isTestDate) {return calendarDay.dateText;} 
		else{
			elist.forEach(function(ev, ind, arr){
				if(ev.eventType=="course meeting")
				{
					retVal=calendarDay.meetingText;
				}
				else if(ev.eventType=="practice test")
				{
					retVal=calendarDay.practiceTestText;
				}
			},this);
			return retVal;
			}
	},
			
	computeDayId:function(calDay)
	{
		return calDay.dateId;
	},
	observeIsSelected: function(newVal,oldVal){
		if(newVal===true && oldVal===false)
		{ console.log(newVal);
			if(!this.fcCourse.courseCalendarDaysArray)
			{
				this.fcCourse.courseCalendarDaysArray=[];
			}
			if(!this.calendarDay)
			{
				this.set("calendarDay", new FcCalendarDay());
			}
		}
	},

	computeMiniDate: function(calendarDay){
		return calendarDay.date;

	},
	observeBackground: function(calendarDay){
		
		//console.log(calendarDay);
	},

	
  	computePickedDaysDark: function(inMonth, calendarDay)
  	{
  		if(inMonth===true)
  		{ 

  			var retVal =(calendarDay===true)?"#008; border: 1px #008 solid":"white";
  			return retVal;
  		}
  		else
  		{
  			
  			return "#fff";
  		}
  	},

  	toggleDays: function(e)
  	{	
  		//console.log(e);
  		if(this.inMonth===true)
  		{	
  			if(!this.selectedArray)
  				{	
  					this.set("selectedArray", []);
  				}
  			if(this.toggleDay==false)
  			{
					this.toggleDay=!this.toggleDay;
			  		this.isSelected = !this.isSelected;
			 		this.set("calendarDay.toggleDay",!this.calendarDay.toggleDay);
				  	this.set("calendarDay.isSelected", !this.calendarDay.isSelected);
				  	this.set("calendarDay.inCourseCalendar", !this.calendarDay.inCourseCalendar);
					var timestamp =new Date();
			}
			else if(this.toggleDay===true){
				this.toggleDay=!this.toggleDay;
			  		this.isSelected = !this.isSelected;
			  		this.set("calendarDay.toggleDay",!this.calendarDay.toggleDay);
				  	this.set("calendarDay.isSelected", !this.calendarDay.isSelected);
				  	this.set("calendarDay.inCourseCalendar", !this.calendarDay.inCourseCalendar);
				  	var timestamp =new Date();
			}
		var eList=this.calendarDay.eventList;
		//console.log(eList);
					
	  		if(this.calendarDay.isSelected===true || this.calendarDay.inCourseCalendar===true)
	  			{	
	  				this.push("selectedArray", this.calendarDay);
	  				
	  			}
	  		
	  	}
	  	
	  		
  	},
  	computeWhite: function(inMonth, calendarDay)
  	{
  		if(inMonth===true)
  		{
  			return "white";
  		}
  		else 
  		{
  			return "#fff";
  		}
  	},
  	computePickedDaysWhite: function(inMonth, calendarDay, testDate){
  		if(inMonth)
  		{
  			var retVal=(calendarDay===true)?"white":(testDate===true)? "red; font-weight: 700": "#008";
  			return retVal;
  		}
  		else if(inMonth==false) 
  		{
  			
  			return "#fff";
  		}
  	},

});
 </script>
 </dom-module>
 