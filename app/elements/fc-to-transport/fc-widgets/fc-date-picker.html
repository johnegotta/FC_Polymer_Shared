<dom-module id="fc-date-picker">
<template>
<style>
:host{
	position: fixed;
}
.calendarheader{
	text-align: center;  
	width:calc(100%/7.3)!important; 
	font-size: 18px; 
	font-weight: 600; 
	padding: 1px 4px;

	color: #fff;
	background: #009;
	height: 18px!important;
}
.calendarcontainer{
background: white; 
border: 1px solid #009;
box-shadow: -2px 6px 17px 4px #9fafaf;*/

}
.calendarborder{
	background: #009; 
	width: 100%;
}

.headerMonthYear{
	text-rendering: center;
	text-align: center;
	color: white; 
	font-size:18px;
	padding-top: 6px;
	font-weight: 600;
	}
.headerTop{
height: 100%;

}
.headerArrowRight{
	padding-top: 4px;
	 color: white; 
	 @apply(--layout-horizontal);
	@apply(--layout-flex);
	@apply(--flex-self-shrink);
}
.headerArrowLeft{
	padding-top: 4px;
	color: white;
	@apply(--layout-horizontal);
	@apply(--layout-flex);
	@apply(--flex-self-shrink);
}
  .card{
  	text-align: right; 
  	width:calc(101%/7.3); 
  	/*margin: 1px 1px 0px 1px;*/
  	font-size: 18px;
  	font-weight: 400;
  	display: flex;
  	border-left: 1px solid #efefef;
  	border-top: 1px solid #efefef;
  	padding: 3px 0px 0px 0px;
  	@apply(--self-shrink);
  } 
  .cardcontainer{
  	background: white; 
  	overflow-y:scroll;
  	min-height: 185px; 
 
  }
  .cardcontainer2{
  	overflow:scroll;


  }
 
</style>
	<paper-dialog id="sizeDialog" no-cancel-on-outside-click style="width: 320px; height: 380px; background: aliceblue; border: 2px solid #009;">
		Height: {{currentHeight}}, Width: {{currentWidth}}
		<fc-input-prime input-type="range" min="240" max="1200" value="{{currentWidth}}" label="Width">
		</fc-input-prime>
		<fc-input-prime input-type="range" min="240" max="1200" value="{{currentHeight}}" label="Height">
		</fc-input-prime>
		<paper-button on-tap="closeModal">close</paper-button>
		<paper-button on-tap="swap">swap</paper-button>
	</paper-dialog>
	<div class$="{{orientation}} layout flex wrap calendarcontainer" style$="height: {{currentHeight}}px!important; width: {{currentWidth}}px!important;">
		<paper-material class$="{{vertOrient}} [[_computeHeaderHeight(orientation)]] calendarborder">
			<section class$="{{vertOrient}} layout flex center headerTop">		
				<section class$="headerMonthYear [[_computeHeaderClass(currentHeight, currentWidth, orientation)]]" style$="[[_computeHeaderStyle(currentWidth, currentHeight, orientation)]]">
					[[computeViewMonth(displayedIndex, monthsList, orientation)]]
				</section>
				<section id="navigationBlock" class$="[[changeButtonClassOnOrientationChange(orientation)]]" style$="[[computeHeaderArrangementState(orientation)]]">
					<div class="layout horizontal flex center center-justified">
						<section on-tap="_backOne" class="headerArrowLeft">
							<iron-icon icon="icons:chevron-left" style$="[[_computeBackHidden(backHidden)]];">
							</iron-icon>
						</section>
						<section on-tap="launchDialog" class="layout flex center center-justified" style="width: 20px; height: 20px; border-radius: 50%; color: white;">
							<iron-icon icon="social:public"></iron-icon>
						</section>
						<section on-tap="_forward" class=" headerArrowRight">
							<iron-icon icon="icons:chevron-right" style$="[[_computeBackHidden(forwardHidden)]];">
							</iron-icon>
						</section>
					</div>
				</section>
				<section class="horizontal flex layout end-justified" style="[[_computeWhereTheYearMustGo(orientation)]]">
				 [[computeYear(displayed)]]
				</section>
			
		</section> 
	</paper-material>

		<div class="vertical flex-9 layout cardcontainer" style$="width: {{currentWidth}}px!important overflow-y: scroll; [[computeLine(orientation)]]">
		<section class="horizontal layout flex" style$="padding: top: 3px; margin-bottom: 4px; max-height: 20px!important;[[computeLine(orientation)]]">
			<template is="dom-repeat" class="horizontal layout nowrap" items="{{days}}">
			<!--example of stupid-->
				<paper-material class="calendarheader" >
					{{item}}
				</paper-material><!--days of week header-->
			</template>
		</section>
			<section class="horizontal layout flex wrap" style$="overflow-y: scroll; margin-top: 1px; width: {{currentWidth}}!important;">
				<template 
					is="dom-repeat" 
					class="horizontal layout wrap" 
					items="{{displayed}}" 
					as="day">
						<fc-date-mini
						 	class="card"
						 	in-month="[[computeNotInMonths(day.freshDate, displayedIndex, day.inMonth)]]"
						 	day="{{day}}"
						 	day-id="{{day.dayId}}"
						 	calendar-day={{day}}
						 	mini-date="{{day.date}}"
						 	index={{day.index}}
						 	id$={{day.dateId}}
						 	current-width="{{currentWidth}}"
						 	current-height="{{currentHeight}}"
						 	testDate={{day.testDate}} 
						 	event-list="{{day.eventList}}"
						 	fc-course="{{fcCourse}}">
							<span class="date self-stretch" style="font-weight: 600; font-size: 18px;" id="button">[[day.dayOfMonth]]</span>
						</fc-date-mini>	
				</template>
			</section>

		<!-- <section class="layout horizontal" style="background: #aedefe; min-height: 6px; max-height: 36px;width:{{currentWidth}}px!important;">
				
					
					
				</section> -->
				
		</div>
	</div>
</template>
<script>
FcDatePicker=Polymer({
	is: "fc-date-picker",
	behaviors:[FCBehaviors.FcCalendarBehaviorPrime, FCBehaviors.DraggableBehavior],
	observers:[],
	properties: {
		day:{
			type: FcCalendarDay, 
			value: {},
			notify: true
		},
		fcCourse:{
			type: FcCourse,
			value: function(){return new FcCourse({});},
			notify: true
		},
		days:{
			type: Array,
			value: function()
			{
					return ["Su","M","Tu","W","Th","F","Sa"];
			},
			notify: true
		},
		orientation:{
			type: String,
			value: function(){
				return "horizontal";
			},
			notify: true,
		},
		currentWidth: {
			type: String,
			value: function(){return "365";},
			notify: true,
		},
		currentHeight: {
			type: String,
			value: function(){return "286";},
			notify: true,
		},
		maxIndex:{
			type: Number,
			notify: true,
		},
		displayedIndex:{
			type:Number,
			value: 0,
			notify: true
		},
		displayed:{
			type: Array,
			notify: true
		},
		displayedCalendarMonth:{
			type: String,
			computed: "computeDisplayedMonth(displayedIndex, monthsList)",
			notify: true
		},
		vertOrient:{
			type: String,
			value: function(){return "vertical";},
			notify: true
		},
		units: {
			type: String,
			value: "months",
			notify: true 
		},
		forwardHidden:{
			type: Boolean,
			value: false,
			notify: true
		},
		backHidden:{
			type: Boolean,
			value: false,
			notify: true
		},
		event:{
			type: Array,
			value: [],
			notify: true
		},
		drags:{
			type: Boolean,
			value: true,
			notify: true,
			reflectToAttribute: true
		},

		monthsList: {
			type: Array,
			value: function(){return["January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December","January","February","March","April","May","June","July","August","September","October","November","December"];
			},
			notify: true
		},
   },

_computeHeaderHeight: function(orientation){
	var retVal=(orientation=="horizontal")?"layout flex-2": "layout flex-1 flex-shrink";
	return retVal;
},

launchDialog: function(){
	this.$.sizeDialog.alwaysOnTop=true;
	this.$.sizeDialog.opened=true;
	

},
computeLine:function(orientation){
	var retVal = (orientation=="vertical")?"border-top: 3px silver solid;": "";

},
_computeWhereTheYearMustGo: function(orientation){
	var retVal=(orientation=="horizontal")?"color: white; font-weight: 500; font-size: 22px; font-style: italic;position: absolute; bottom: 8px; right: 12px;": "color: white;  position: relative; font-weight:600;font-size: 24px; padding-top: 4px;font-style: italic; padding-right: 18px;"
	return retVal;
},
swap:function(){
	var retVal=(this.orientation=="horizontal")? "vertical": "horizontal";
	var setOpposite=(this.orientation=="horizontal")?"horizontal": "vertical";
	this.set("vertOrient", setOpposite);
	this.set("orientation",retVal);

},
changeButtonClassOnOrientationChange: function(orientation){
var retVal=(orientation=="vertical")?"horizontal layout flex center center-justified":"horizontal layout center end-justified";
return retVal;
},
closeModal: function(){
	this.$.sizeDialog.close();
	this.$.sizeDialog.opened=false;
},

computeHeaderArrangementState: function(orientation){
	var otherMiddle=1;
var retVal=(orientation=="vertical")?"position: relative; padding-left: 4px;": "position:absolute; left:" +otherMiddle+  "px; bottom: 38px;";
	return retVal;
},
_computeHeaderClass: function(orientation){
	var retVal=(orientation=="horizontal")?"layout vertical flex-12 headerMonthYear": "layout horizontal flex headerMonthYear";
	return retVal;

},
_computeHeaderStyle:function(one, two, orientation){
	var retVal=(orientation=="horizontal")?"text-direction: vertical; width: 1em; padding-top: 20px;": "text-direction: horizontal;padding-left: 16px; font-size: 24px;";
	Polymer.updateStyles();
return retVal;


},
ready: function()
{	
		var today = new Date();
		var index=today.getMonth();
 		this.set("displayedIndex",index);
		this.async(this.initialize, 40);
},
initialize:function(days){
	var startYear =new Date().getFullYear();
   	var endYear =startYear + 3;
	var date=new Date(startYear, 0, 1);
	var dateEnd =new Date(endYear, 11, 31);
	if(days){
	this.calendarCreator(date, dateEnd, "months", days);
	}
	else{
		this.calendarCreator(date, dateEnd, "months");
	}
 var counter=this.monthsArray.length;
 	this.set("maxIndex", counter-1);
		var self=this;
		this.calendarDayArray=[];
		this.calendarMonthsArray=[];
 for(var i=0;i<counter; i++)
		 { 	
		 	var array = this.monthsArray[i];
		 	this.monthsArray.length;
			self.push("calendarMonthsArray",array);
		 	array.forEach(function(item, index, arr){
		   		self.push("calendarDayArray", item);
		 	});
		}
		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
		var calendar =[];
		calendar = this.calendarDayArray;
		this.set("fcCourse.courseCalendarDaysArray", calendar);
		this.set("fcCourse.calendarDayArray", calendar);
},
_computeBackHidden: function(backHidden){
	if(backHidden){this.async(this.takeAwayArrow, 100);	return "color: #008";}
	else {return"color: white";}

},
takeAwayArrow: function(){
			this.updateStyles();
			console.log("I updated styles, not");		
             Polymer.dom.flush();		
        },

computeDisplayed: function (displayedIndex)
{
	return this.calendarMonthsArray[displayedIndex];
},
_forward: function(){
		if(this.displayedIndex ==this.maxIndex)
 		{
 			this.set("forwardHidden",true);
 		}
 		else
 		{	this.set("backHidden",false);
 			this.set("forwardHidden",false);
    		this.set("displayedIndex", this.displayedIndex+1);
    		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
    	}
    },
 _backOne: function(){	
 		if(this.displayedIndex===0)
 		{ 
 			this.set("backHidden",true);
 		}
 		else
 		{	this.set("forwardHidden",false);
 			this.set("backHidden",false);
    		this.set("displayedIndex", this.displayedIndex-1);
    		this.set("displayed", this.calendarMonthsArray[this.displayedIndex]);
 		}
 	
    },
  
  computeYear:function(displayed)
  		{
  		var	y =  new Date();
  		y=y.getFullYear();
  		var	m = new Date();
  		var retVal=y+Math.floor((this.displayedIndex)/12);
		return retVal;
		},

computeNotInMonths: function(dayDate, displayedIndex, inMonth){
	var z=inMonth; console.log(inMonth);
	var x=new Date(dayDate).getFullMonth();
	var y=this.displayedCalendarMonth;
	var retVal = (x===y);
	return retVal;
},
computeDisplayedMonth: function(displayedIndex, monthsList){
	if(monthsList && displayedIndex){
	return monthsList[displayedIndex];
}
},
computeViewMonth: function(displayedIndex, monthsList, orientation){
 	if(monthsList && displayedIndex){
	var month=monthsList[displayedIndex].split("").map(function(val){return val+" ";});
	var sMonth=	month.toString().replace(/,/g,"").toUpperCase();
	var retVal=(orientation=="horizontal")?sMonth: monthsList[displayedIndex];
	console.log(retVal);
	return retVal;
}
	},

});
</script>
</dom-module>
