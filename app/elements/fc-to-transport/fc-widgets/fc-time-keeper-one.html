<dom-module id="fc-clock">
<style is="custom-style">
:host{
	position: absolute; 
	top: 8px;
	background: #fff;
	left: 8px;
	min-width: 245px; 
	z-index:93;
};
paper-material{
	opacity: 1;
	position: relative;
	background: #ffffff;
	border: 3px ridge #aecdfe;
	padding: 8px 4px;
	display: block;
	@apply(--horizontal-layout);
	@apply(--nowrap-layout);
}
.timer{
	font-size: 17px; 
	opacity: 1; 
	font-weight: 600; 
	font-family: merriweather; 
	color: #007; 
	padding: 6px 4px 2px 4px; 
	border: .4px solid #efefef;
}
.slight{
	font-size: 14px; 
	font-family: merriweather; 
	opacity: 1; 
	color: #008; 
	font-weight: 400;
}
.startbutton{
	margin: 1px; 
	border: 2px solid #efefef;  
	box-shadow: 3px 7px 17px 2px #dedede; 
	font-size: 14px; 
	font-weight: 600; 
	text-align: center; 
	padding: 2px; 
	margin-bottom: 5px; 
	width: 100%;
}
.startbutton:hover{ 
	box-shadow: 1px 3px 4px 1px; 
	font-weight: 700;
}
fc-input-prime{
	max-width: 98%;

}
.clockname{
	font-size:18px;
	color: #008; 
	font-family: times;
}
.clockname::after{
	font-size: 10px;
	color: white;
	display: block;
	content: " .";
}
.clockname:hover::after{
	font-size: 10px; 
	color: brown;
	display: block;
	content: " Tap to Change Clock Type";

}
@keyframes yellowalert{
	from {background-color: white;}
	to{background-color: orange;}
}
.blinkyellow{
	width: 14px;
	height: 14px;
	background-color: white;
	animation-name: yellowalert;
	animation-duration: .45s;
	animation-iteration-count: 240;
	animation-direction: alternate;
}
.blinkyellow:hover::after{
	display: flex;
	font-size: 7px;
	color: #008;
	content: " Click to Visit Calendar";
}
.small{
	display: block;
	width: 8px;
	height: 8px;
}
.small:hover, .small:active{
	width: 24px;
	height: 24px;
	}
.small.hover::after, .small.active::after{
	font-size: 10px;
	color: #C87533;
	display: block;
	content: " Click to Visit Calendar";
}
.inviso{display: none; width: 0px; height: 0px; opacity: 0;}

@keyframes redalert {
    from {background-color: #dfdfdf;}
    to {background-color: red;}
}
.animatedalert{
 
    background-color: #dfdfdf;
    animation-name: redalert;
    animation-duration: .3s;
    animation-iteration-count: infinite;
    animation-direction: alternate;
}



}
</style>

<template>
<div style="padding: 0px; width: 240px; outline: 1px solid #efefef">
	<div style="padding: 2px; text-align: center;" class="layout vertical" on-track="_focusedDraggable" drags>
		<div style="padding: 2px; border: 1px #008 solid; text-align: center; overflow: hidden; overflow-y: scroll background: white;" class="layout vertical" on-tap="alarmoff">
		<section class="vertical layout block" style="overflow-y: scroll;">
		<template is="dom-repeat" items="{{soundingAlarms}}" as="alarm">
				<span class="horizontal-layout flex nowrap" style="border: 1px silver solid; font-size: 12px; height: 14px; overflow-x: scroll;margin: 0px; padding: 0px;">[[alarm.alarmName]]  [[computeSoundingAlarm(alarm.alarmTime)]]</span>
		</template>
		</section>
			<div class="layout horizontal flex center-justified">
				<paper-material style$="width: 165px; margin: 24px 20px {{toggleMargin}} 20px;" class="layout vertical" elevation="3">
					<span draggable drags on-tap="toggle" class="slight">{{date}}</span>
					<section id="theClock" cursor:pointer; on-dblclick="opencollapser" class="timer">{{theTime}} </section>	
				</paper-material>
			</div>
  			<iron-collapse id="collapser"  class="vertical layout center-justified glass"> 
 				<div class="layout vertical flex center-justified nowrap">
					<section style="font-weight: 600; font-size: 16px;" class="horizontal layout flex nowrap center-justified">	
						<section class="layout horizontal flex-2">
							<iron-icon style="width: 32px; height: 32px;z-index: 22; color: silver; opacity: .85" on-tap="selectPrevious" icon="icons:chevron-left">
							</iron-icon>
						</section>
						<section class="layout horizontal flex-10 center-justified" style="cursor:pointer;">
							<span class="clockname">
								<span on-tap="selectApi">{{currentClock.clockType}}</span>{{computeTheSes(currentClock.clockType)}}
							</span>
						</section>
						<section class="layout horizontal flex-2">
							<iron-icon icon="icons:chevron-right" on-tap="selectNext" style="width: 24px; height: 24px;z-index: 22; color: silver; opacity: .85">
							</iron-icon>
						</section>		
					</section>
					<div class="layout vertical flex center-justified nowrap" style="max-width: 240px!important; min-height: 52px; padding-right: 0px;">
						<section class="layout horizontal flex nowrap center-justified">
							<section class="layout horizontal flex nowrap center-justified" style="align-self: center;">
								<fc-clobjid-prime 
									id="dsv"
									input-style="text-align: left; margin-left: 1px; margin-left: -5px; padding: 0px 1px; border: 1px silver solid; font-weight: 600;min-width: 7px;max-width: 15px;" 
									orientation="horizontal" 
									dataobject="{{currentClock.allClockData}}"
									>
								</fc-clobjid-prime>
						
								<iron-icon on-tap="displayDatePicker" style$="position: absolute; right: 6px; background: white; padding: 0px; height: 12px; width: 12px; margin: 0px; color: #5DD7FC;" class$="{{_computeCalendarNeeded(currentClock.clockType, currentClock, alarmArray)}}" icon="icons:today">
								</iron-icon>
							
								</section>
						</section>
						<paper-button 
							class="horizontal flex layout nowrap center-justified self-stretch startbutton" 
							style$="color:{{onOffColor}};"
							on-tap="toggleRunning">
									[[currentClock.clockName]][[currentClock.alarmName]]
						</paper-button>
					</div>
						
 							
 						<iron-collapse id="collapse" class="vertical layout flex"> 
 							<audio loop id="myAlarmNoise" style="border: green 2px solid; width: 220px; height: 35px;">
  									<source src="fc-clock/beep-06.mp3" type="audio/mp3">
  										<source src="fc-clock/beep-10.mp3" type="audio/mp3">
											Your browser does not support the audio element.
							</audio>
							
									 <fc-input-prime input-type="datetime-local" 
										value="{{alarmTime}}" 
										label="Set Alarm Date & Time"
										style="text-align: left;"
										label-style="padding-top: 4px; font-size: 13px; font-weight: 500; 0px; margin: 0px; font-style:italics;"
										input-style="text-align: right; font-size: 14px; padding: 1px; margin: 0px; line-height: .8"; 
										is-current-time="true">
									</fc-input-prime>
									<fc-input-prime style="text-align: left;"
										input-type="text"
										label-style="font-size: 13px; font-weight: 500; 0px; margin: 0px; font-style:italics"
										input-style="font-size: 14px; padding: 1px; margin: 0px; line-height: .6";
										label="Alarm Name" 
										value="{{alarmName}}">
									</fc-input-prime>
								<paper-tabs 
		      						id="assistantMenu" 
						      		scrollable="true"
						      		style="padding: 2px 0px; max-height: 96px; min-height: 32px; min-width: 120px;" on-down="dragsOff" on-up="dragsOn"   on-tap="clickHandler"
						      		bar="true"
						      		hide-scroll-buttons="true"> 
									<!-- <section class="horizontal layout flex" style="overflow-x: scroll;width: 320px;"> -->
									<paper-icon-button on-tap="muteAlarm" style="color: #CD7F32;" icon="{{muteButton}}"></paper-icon-button>
									<paper-icon-button on-tap="addNewAlarm" style="color: #4285f4;" icon="device:add-alarm"></paper-icon-button>
									<paper-icon-button on-tap="deleteAlarm" style="color: #C87533;" icon="icons:delete"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="icons:restore"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="icons:view-list"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="icons:date-range"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="icons:swap-vertical-circle"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="notification:event-available"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="social:notifications-active"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="notification:event-busy"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="notification:event-note"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="social:notifications-off"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="icons:swap-horiz"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="icons:alarm-off"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="icons:gavel"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="social:person-add"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #C87533;" icon="icons:language"></paper-icon-button>
									<paper-icon-button on-tap="reset" style="color: #4285f4;" icon="maps:local-library"></paper-icon-button>
									
								</paper-tabs>
								
					</iron-collapse>
 				</div>
			<section class="horizontal flex layout nowrap center
					 center-justified" style="width: 100%; font-size: 13px; font-weight:600; font-family: merriweather; color: #007; margin-left: 0px;">
					<paper-button style="text-align: center; border: 2px solid #efefef;" on-tap="addNewAlarm" class="horizontal layout flex center-justified">Add</paper-button>
						<paper-button class="horizontal layout flex center-justified" style="text-align: center;border: 2px solid #efefef;" on-tap="resetCurrentClock">[[_computeResetButton(currentClock.isRunning)]]</paper-button>

					<paper-button class="horizontal layout flex center-justified" style="text-align: center; border: 2px solid #efefef;" on-tap="alarmoff">off</paper-button>
			</section>
		</iron-collapse>
		</div>
		</div>
		</div>
		</template>

<script>



function FcClockData(argTenths, argFirstDigit, argLastDigit, argDateTime)
{	
	var firstDigit = argFirstDigit || 0;
	var lastDigit = argLastDigit || 7;
	if(!argDateTime){
	var digitArray = [
		{name: "thours", value: 0, inputType: "digit", label:" "+" H"},
		{name: "hours", value: 0, inputType: "digit", label:"H", colon:":"},
		{name: "tmin", value: 0, inputType: "digit", label:"M"},
		{name: "min",value: 0, inputType: "digit", label:"M", colon:":"},
		{name: "tsec",value:0, inputType: "digit", label:"S"},
		{name: "sec",value: 0, inputType: "digit", label:"S", colon:":"},
		{name: "tenth", value: 0, inputType: "digit", label:"s"},
		{name: "hundredth", value: 0, inputType: "digit", label:"s"}
	];
	for(var i = 0; i < 8; i++)
	{
		var obj = digitArray[i];
		this[obj.name] = obj;
		if(i < firstDigit || i > lastDigit)
		{
			this[obj.name].hidden = true;
		}
	}

	
	this.convertFromTenths(argTenths);
	}
	if(argDateTime){
		this.alarmDate=argDateTime;
		this.getAlarmData(argDateTime);

	}
}
FcClockData.prototype.getAlarmData=function(argDateTime)
{	
	var timeArray = [
		{name: "thours", value: 0, inputType: "digit", label:"H"},
		{name: "hours", value: 0, inputType: "digit", label:"H", colon:":"},
		{name: "tmin", value: 0, inputType: "digit", label:"M"},
		{name: "min",value: 0, inputType: "digit", label:"M", colon:":"},
		{name: "tsec",value:0, inputType: "digit", label:"S"},
		{name: "sec",value: 0, inputType: "digit", label:"S", colon:":"},
		{name: "tenth", value: "", inputType: "digit", label:"s"},
		{name: "hundredth", value: "M", inputType: "digit", label:"s"}
	];
	for(var i = 0; i < 8; i++)
	{var obj = timeArray[i];
		this[obj.name] = obj;
	}
	this.timeArray=timeArray;
	this.alarmData=this.convertFromDateToPropertyValues(argDateTime);
	this.setAlarmData();
};
FcClockData.prototype.setAlarmData=function(){
	this.hundredth.value ="M";
	var ampm= this.alarmData.ampm.split("");
	var ap= (ampm[0]=="a" || ampm[0]=="A")?"A": "P";
	console.log(ap);
	this.tenth.value = ap;
	this.sec.value = this.alarmData.secondsN%10;
	this.tsec.value = Math.floor(this.alarmData.secondsN/10);
	this.min.value =this.alarmData.minutesN%10;
	this.tmin.value =Math.floor(this.alarmData.minutesN/10);
	this.hours.value =(this.alarmData.hoursN<13)?this.alarmData.hoursN%10:(this.alarmData.hoursN-12)%10;
	this.thours.value =(this.alarmData.hoursN<13)?Math.floor(this.alarmData.hoursN/10):Math.floor((this.alarmData.hoursN-12)/10);
	this.monthN=this.alarmData.monthN;
	this.yearN=this.alarmData.yearN;
	this.dayOmonthN=this.alarmData.dateN;
	this.toDateTimeLocalInput=this.alarmData.toInputDateTimeLocal;
	console.log(this.timeArray);
	
	var nd = this.convertedFromInputToDate();
	this.dateObject=nd;//dtl datetimelocal Date Object
	this.calendarDate=new Date(this.yearN, this.monthN-1, this.dayOmonthN);
};
FcClockData.prototype.convertedFromInputToDate=function()
{
		var dtl = this.toDateTimeLocalInput.split("T");
		var dpart=dtl[0].split("-");
		var year = dpart[0];
		var month=parseInt(dpart[1])-1;
		var day=dpart[2];
		var timepart= dtl[1].split(":");
		var hours=timepart[0];
		var minutes=timepart[1];
		var atime = new Date(year, month, day, hours, minutes);
		return atime;
};
FcClockData.prototype.convertFromDateToPropertyValues=function(argDateTime)
{
			var theDate = new Date(this.alarmDate);	
			var yearNjs = theDate.getYear();
			var yearN = (yearNjs + 1900);
			var year = yearN.toString();
			var monthN = theDate.getMonth() + 1;
			var month = (monthN<10)? "0" + monthN.toString(): monthN.toString();
			var dateN = theDate.getDate();
			var date = dateN<10? "0" + dateN.toString(): dateN.toString();
			var hoursN = theDate.getHours();
			var ampm = hoursN >= 12? "PM": "AM"; 

			var minutesN = theDate.getMinutes();
			var minutes = minutesN<10 && minutesN>0? "0" + minutesN.toString():minutesN==0? "0" +"0": minutesN.toString();
			var secondsN = theDate.getSeconds();
			var seconds =secondsN<10 && secondsN>0? "0" + secondsN.toString():secondsN==0? "0" +"0": secondsN.toString();
			var millisecondsN = theDate.getMilliseconds();
			var milliseconds = millisecondsN ==0? "0" + "0" + "0":millisecondsN >0 && millisecondsN<10? "0" +"0" + millisecondsN.toString(): millisecondsN >=10 && millisecondsN<100? "0" + millisecondsN.toString(): millisecondsN.toString(); 
			var milliseconds = millisecondsN.toString();
			var hoursNUS= hoursN>0 && hoursN>12? (hoursN-12): hoursN == 0? 12: hoursN;
			var hours = hoursNUS <10? "0" + hoursNUS.toString(): hoursNUS.toString();
			var hours24 = hoursN == 0? "0" + "0": hoursN<10 && hoursN>0?"0" + hoursN.toString(): hoursN.toString();

			var timeNow = year+"-"+month+"-"+date+" "+hours+":"+minutes+" "+ampm;
			var timeNowTwo = "Date: " + month + "/"+date+"/"+year+" Time: "+hours+":" + minutes+":"+ seconds+" " + ampm;
			var toInputDateTimeLocal = year+"-"+month+"-"+date+"T"+hours24+":"+minutes;
			var holderObject={
				"year":year, 
				"month":month, 
				"date":date, 
				"hours":hours, 
				"minutes":minutes, 
				"seconds":seconds, 
				"milliseconds":milliseconds,
				"ampm": ampm,
				"yearN": yearN,
				"monthN": monthN,
				"dateN": dateN,
				"hoursN": hoursN,
				"minutesN": minutesN,
				"secondsN": secondsN,
				"millisecondsN": millisecondsN, 
				"yearNjs": yearNjs, 
				"timeNow": timeNow,
				"timeNowTwo":timeNowTwo,
				"toInputDateTimeLocal":toInputDateTimeLocal
									};
			return holderObject;
};
FcClockData.prototype.convertToTenths = function()
{
	var result = 0;
	result += this.tenth.value;
	result += this.sec.value * 10;
	result += this.tsec.value * 100;
	result += this.min.value * 600;
	result += this.tmin.value * 6000;
	result += this.hours.value * 36000;
	result += this.thours.value * 360000;
	return result;
};



FcClockData.prototype.convertFromTenths = function(argTenths)
{	
	
	this.tenth.value = argTenths % 10;
	var fullsec = Math.floor(argTenths / 10) % 60;
	this.sec.value = fullsec % 10;
	this.tsec.value = Math.floor(fullsec / 10);
	var fullmin;
	if(argTenths>35999 && argTenths<60000)
	{
		fullmin = Math.floor(argTenths / 600) % 100;
	}
	else
	{
		fullmin = Math.floor(argTenths / 600) % 60;
	}
	this.min.value = fullmin % 10;
	var fullhour = Math.floor(argTenths / 36000);
	this.hours.value = fullhour % 10;
	this.tmin.value = Math.floor(fullmin / 10);
	if(argTenths>35999 && argTenths<60000)
	{
		this.hours.value = 0;
	}
	else
	{
		//this.tmin.value = fullmin % 60;
	}

};

class FcClock
{
	constructor(argName, argType, argTenths, argFirstDigit, argLastDigit)
	{
		this.clockName = argName;
		this.clockType = argType;
		this.startTenths = argTenths;
		this.isRunning = false;
		this.firstDigit = argFirstDigit;
		this.lastDigit = argLastDigit;
		this.allClockData = new FcClockData(argTenths, argFirstDigit, argLastDigit);
	}
	convertFromTenths(argTenths)
	{
		this.allClockData.convertFromTenths(argTenths);
	}
	convertToTenths()
	{
		return this.allClockData.convertToTenths();
	}
	toggleRunning()
	{
		var d = (new Date()).getTime();
		if(this.isRunning)
		{
			this.lastTurnedOff = d;
			this.lastTurnedOffTenths = this.allClockData.convertToTenths();
		}
		else
		{
			this.lastTurnedOn = d;
			this.lastTurnedOnTenths = this.allClockData.convertToTenths();
		}
		this.isRunning = !this.isRunning;
	}
};
class FcAlarmClock {
constructor(argName, argDateTime)
	{
		this.alarmName = argName;
		this.clockType = "Alarmclock";
		this.startTenths = 0;
		this.firstDigit = 0;
		this.lastDigit = 7;
		this.clockData = new FcClockData(0, 0, 7, argDateTime);
		var dataSet=this.clockData.convertFromDateToPropertyValues(argDateTime);
		this.alarmData=dataSet;
		this.alarmTime = new Date(argDateTime);
		var now = new Date();
		var active = (now < this.alarmTime);
		this.isActive=active;
		this.allClockData=this.setAlarmClockTimeDisplay();
		this.dateObject=this.clockData.dateObject;
		this.calendarDate=this.clockData.calendarDate;
	}	
	convertFromDateToProperties(argDateTime)
	{
		return this.clockData.convertFromDateToPropertyValues(argDateTime);
	}
	convertFromInputToDate()
	{
	return this.clockData.convertFromInputToDate();
	}
	getAlarmData()
	{
		return this.clockData.getAlarmData();
	}
	setAlarmSubData(){
		this.clockData.setAlarmData();
	}
	setAlarmClockTimeDisplay(){
		return this.clockData.timeArray;
	}
};

Polymer({
	is: "fc-clock",
	listeners:{"on-tap": "addAlarm", "buttNew.tap": 'displayDatePicker'},

	properties: {
		currentClock: {
			type: FcClock,
			value: {},
			notify: true,
		},
		clockType: {
			type: String, 
			notify: true,
		},
		openingArray:{
			type: Array,
			value:[],
			notify: true,
		},
		alarmArray: {
			type: Array,
			value: [],
			notify: true
		},
		fcClockArray: {
			type: Array,
			value: [],
			notify: true
		},
		displayedArray:{
			type: Array,
			computed: "_computeDisplayedArray(fcClockArray, clockApi, openingArray,alarmArray)",
			observer: "watchDisplayed",
			notify: true
		},
		clockApi:{
			type: String,
			value: function(){return "Countdown";},
			notify: true,
		},
		apiChoices:{
			type:Array,
			value:function(){
				return ["Countdown",
						"Stopwatch",
						"Alarmclock"
						
							];
			},
			notify: true

		},
		calendarButton:{
			type: Boolean,
			notify: true
		},
		muteButton:{
			type: String,
			value:function(){
				var muted = this.$.myAlarmNoise.muted;
				var getVal=(muted)?"av:volume-up": "av:volume-off";
				return getVal;
			},
			notify: true
		},
		clockPrimarySwitch:{
			type: Boolean, 
			value: false,
			notify: true
		},
		 swapIcon: {
		 	type: String,
		 	value: function(){return "query-builder";},
		 	notify: true
		 },
		 onOffColor: {
		 	type: String,
		 	value: "green",
		 	notify: true
		 },
		
		drags:{
			type: Boolean,
			value: true,
			notify: true
		},
		dragCounter:{
			type: Number,
			value: 0,
			notify: true
		},
		alarmTime:{
				type: String,
				notify: true,
		},
		theTime:{
			type: String,
			value:function(){
				var newtime = new Date();
				var update = newtime.toLocaleTimeString();
				return update;
			},
			notify: true
		}, 
		
		clockIndex: {
			type: Number, 
			value: 0,
			notify: true
		},
		toggleMargin:{
			type: String, 
			value: "32px",
			notify: true
		},
		soundingAlarms:{
			type: Array,
			value:[],
			notify: true
		},
		date:{
			type: Date,
			value:function(){
				var d=new Date();
				return d.toDateString();
			},
			notify: true
		},
		alarmName:{
			type: String,
			notify: true,
		},
		theCountdown:{
			type: Number,
			value: 0,
			notify: true
			}, 
		
      	now:{
      		type: Date, 
      		notify: true
      	}
    
	},
	behaviors:[],

	 displayDatePicker: function(e){
		console.log(e, e.target, "I am tapping");
		this.set("calendarButton", !this.calendarButton);
		this.$.collapse.opened=!this.$.collapse.opened;	

	},
	clockwatcher: function(newVal, oldVal)
	{
		console.log(newVal, oldVal);
	},

	ready: function()
	{
		this.setClockConstructor();
	},
	attached: function()
	{	
		this.initializeClocks();
		this.$.myAlarmNoise.muted=true;
	},
	dragsOff: function(){
			this.set("drags", false);
	},
	dragsOn: function(){
			this.async(this.dragSwitch, 50);
	},
	dragSwitch: function(){
		this.set("drags", true);},

	resetCurrentClock: function(e){
		if(this.currentClock.isRunning===true)
		{
				this.set("currentClock.isRunning", false);
				this.set("onOffColor", "green");
		}
		else{
		this.set("currentClock.allClockData", new FcClockData(this.currentClock.startTenths, this.currentClock.firstDigit, this.currentClock.lastDigit));
		this.set("displayedArray." + this.currentIndex, this.currentClock);
		}
	},
	_computeResetButton: function(running){
		var retVal=(running===true)?"STOP":"RESET";
		return retVal;
	},
	
	_computeDisplayedArray: function(fcClockArray, api, openingArray){
		if(fcClockArray!==[] && this.openingArray!==[])
			{
				if(api!=="Alarmclock")
				{
					var retVal = fcClockArray.filter(function(val, index, arr){
						return (val.clockType==api);
						});
					console.log(retVal, api, "heeeeeereeeee");
		
					return retVal;
				}
				else if(api=="Alarmclock" && this.alarmArray)
				{    console.log(api, this.alarmArray, this.displayedArray);
					return this.alarmArray;
				}
				else{return openingArray;}
			}
	}, 

	_computeDataObject: function(one, two, three, four){
		console.log(one, two, three, four)

		if(one=="Alarmclock"){return three;}
		else{return two;}

	},

	selectApi: function(e){
		console.log(e, e.target, e);
		var compareVal=e.target.firstChild.data;
		var retVal= "";
		this.apiChoices.forEach(function(val, index, array){
			if(array[index-1]==compareVal){retVal=val;}
			else if(index==array.length-1 && compareVal==val){retVal=array[0];
					}				
			else if(compareVal=="Stopwatch"){this.set("clockPrimarySwitch",true); retVal="Alarmclock";}
			else if (compareVal=="Alarmclock"){this.set("clockPrimarySwitch",false); retVal=array[0];} 
		}, this);
		console.log(retVal, "look here for value");
		this.set("clockApi",retVal);

	},
	toggleRunning: function(event)
	{	
		var bool= !this.currentClock.isRunning;
		this.currentClock.toggleRunning();
		var setVal = this.onOffIcon=="icons:forward"?"icons:close":"icons:forward";
		this.set("onOffIcon", setVal);
		this.set("onOffColor", this.onOffColor=="green"?"red":"green");
		this.set("currentClock.isRunning",bool);
	},
	
computeTheSes: function(clockType){
	if(clockType=="Stopwatch"){return "es";}
	else return "s";
},
	computeAlarmColor: function(argActive)
	{
		return argActive?"green":"red";
	},
_computeCalendarNeeded: function(ctype, cc, alarmArray){
	var now=new Date().getTime();
	if(ctype!="Alarmclock"){return "inviso";}
		var tester=alarmArray.some(function(val, index){
	return (((val.alarmTime.getTime()-now)/1000)<86000)});
		console.log(tester);
		var retVal=(tester)?"blinkyellow": "small";
		return retVal;
},

opencollapser: function()
{
this.$.collapser.opened=!this.$.collapser.opened;
var tm =(this.toggleMargin=="32px")?"12px": "32px";
this.set("toggleMargin",tm);

},

    dragYes: function()
    {
    	this.set("drags",true);
    },
  
	toggle: function(e)
	{	
		this.$.collapse.opened=!this.$.collapse.opened;	
	},

	selectPrevious: function(e){
		var num =(this.clockIndex>0)?(this.clockIndex-1):0;
			this.switchClock(num);
	},
	selectNext: function(){
		var last=this.displayedArray.length-1;
		var num =(this.clockIndex<last)?(this.clockIndex+1):last;
			this.switchClock(num);			
	},
	watchDisplayed: function(newVal, oldVal){
		console.log(oldVal, newVal);
		if(newVal.length){this.switchClock(0);}
	},
	switchClock: function(num){	if(this.displayedArray && this.clockApi!="Alarmclock"){
		this.set("clockIndex", num);
		console.log(this.clockIndex, this.clockApi);
		this.set("currentClock", this.displayedArray[num]);
		this.set("onOffIcon", this.currentClock.isRunning?"icons:close":"icons:forward");
		this.set("onOffColor", this.currentClock.isRunning?"red":"green");
		}
		else if(this.displayedArray && this.clockApi=="Alarmclock"){   
			if(!num){num=0;}
			this.set("clockIndex", num);
			this.set("currentClock", this.alarmArray[num]);
			this.set("onOffIcon", this.currentClock.isActive?"icons:close":"icons:forward");
			this.set("onOffColor", this.currentClock.isActive?"red":"green");
		}
		// else{this.set("clockApi", this.clockApi);}
	},
	_focusedDraggable:function(e)
	{
	  	if(this.drags==true){
	        var self=this;
	        e.preventDefault();
			switch(e.detail.state)
			{
	          case 'start':
	            // console.log('START NoWayAreWe Draggin');
	            self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
	            self._topprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("top"))-e.detail.y;
	            console.log('top distance differenced?' + self._topprime);
	            // }
	            self.changeX=0;
	            self.changeY=0;
	            Polymer.dom.flush();
	            break;
	          case 'track':
	            self.changeX=e.detail.ddx + self.changeX;
	            self.changeY=e.detail.ddy + self.changeY;
	            self.translate3d(self.changeX.toString() + 'px', self.changeY.toString() + 'px', 0);
	            break;
	          case 'end':
	            console.log(self._topprime);
	            self._right = parseInt(window.getComputedStyle(self, null).getPropertyValue("right"))
	            self._bottom = self.getBoundingClientRect().top;
	            self._x= ((self._leftprime + e.detail.x)>=0)?(self._leftprime + e.detail.x): 0;
	            self._y=((self._topprime + e.detail.y)>=0)?Math.ceil(self._topprime + e.detail.y):0;
	            self.translate3d(0, 0, 0);

	            console.log("ENDING", self._x);
	            self.style.left=self._x.toString()+'px';
	            self.style.top=self._y.toString()+'px';
	            console.log('y: ' + e.detail.y);
	            self.dragging=false;
	            Polymer.dom.flush();
	            break;
	        }
	    }
	},
	setClockConstructor:function(){
		var nowish = (new Date()).getTime() + 50000;
		var laterish = (new Date()).getTime() + 90000;
		this.alarmArray = [];
		this.addAlarm("NOW-ISH",nowish);
		this.addAlarm("LATER-ISH", laterish);
		this.fcClockArray = [];
	  	this.push("fcClockArray", new FcClock("Reading Countdown", "Countdown", 39000, 0, 7));
	 	this.push("fcClockArray", new FcClock("Writing Countdown", "Countdown", 21000, 0, 7));
	 	this.push("fcClockArray", new FcClock("Math Countdown 1", "Countdown", 15000, 0, 7));
	 	this.push("fcClockArray", new FcClock("Math Countdown 2", "Countdown", 33000, 0, 7));
	 	this.push("fcClockArray", new FcClock("Essay Countdown", "Countdown", 30000, 0, 7));
	 	this.push("fcClockArray", new FcClock("Countdown 1", "Countdown", 0, 0, 7));
	 	this.push("fcClockArray", new FcClock("Countdown 2", "Countdown", 0, 0, 7));
        this.push("fcClockArray", new FcClock("Stopwatch 1", "Stopwatch", 0, 0, 7));
        this.push("fcClockArray", new FcClock("Stopwatch 2", "Stopwatch", 0, 0, 7));
	  	this.set("currentClock", this.fcClockArray[0]);
	  	var temp=this.fcClockArray.filter(function(val,index){
	  		return(val.clockType=="Countdown");
	  	})
	  	this.set("openingArray", temp);
	  	console.log(this.openingArray, this.currentClock);
	},

	initializeClocks:function(){
		var self = this;
		setInterval(function(){
			var currentTime = new Date();
			var time = currentTime.toLocaleTimeString();
			self.set("theTime", time);
			var numClocks = self.fcClockArray.length;
			var numAlarms = self.alarmArray.length;
			for(var i = 0; i < numClocks; i++)
			{
				var clock = self.fcClockArray[i];
				if(clock.isRunning)
				{
					var stamp = currentTime.getTime();
					var tenths = clock.convertToTenths();
					var deltaTenths = Math.floor((stamp  - clock.lastTurnedOn)/100);
					var newTenths;
					if(clock.clockType == "Countdown")
					{
						newTenths = clock.lastTurnedOnTenths - deltaTenths;
						if(newTenths <= 0)
						{
							newTenths = 0;
							console.log("clock named " + clock.clockName + " ran out at " + currentTime);
							clock.isRunning = false;
						}
					}
					else if(clock.clockType == "Stopwatch")
					{
						newTenths = clock.lastTurnedOnTenths + deltaTenths;
						//tenths+=1;
					}
					if(self.currentClock.clockType!="Alarmclock")
					{
						clock.convertFromTenths(newTenths);
						var path = "currentClock.allClockData.tenth.value";
						var pathlight = "fcClockArray." + i + ".allClockData";
						self.notifyPath(path, self.currentClock.allClockData.tenth.value);
					}

				}
			}
			for(i = 0; i < numAlarms; i++)
			{
				var alarm = self.alarmArray[i];
				//console.log(self.alarmArray);
				var alarmTime = alarm.alarmTime;
				if(alarm.isActive && (currentTime.getTime() > alarmTime.getTime()) )
				{
					//console.log("Alarm went off at " + currentTime, alarm);
					self.ringAlarm(alarm);
					alarm.isActive = false;
					self.notifyPath("alarmArray." + i + ".isActive", false);
				}
			}
		}, 100);


	},
	deleteAlert:function(){this.splice("soundingAlarms", 0,1);},
	ringAlarm: function(alarm){
		this.$.myAlarmNoise.play();
		this.push("soundingAlarms", alarm);
	},
	alarmoff: function(){
		this.$.myAlarmNoise.pause();
	},
	muteAlarm: function(){
			var muted = this.$.myAlarmNoise.muted;
			this.$.myAlarmNoise.muted=!this.$.myAlarmNoise.muted;
			var setVal=(muted)?"av:volume-up": "av:volume-off";
			this.set("muteButton",setVal);
	},
	computeSoundingAlarm: function(alarmTime){
			return alarmTime.toLocaleString();

	},
	_computeAlarms: function(name, time){
		console.log(name, this.currentClock, this.currentClock.clockName);
			if(name==this.currentClock.clockName){
			return `${time.toLocaleString()}`;
		}
	},
	addNewAlarm: function(e){
		console.log(this.alarmTime);
		var dtl = this.alarmTime.split("T");
		var dpart=dtl[0].split("-");
		var year = dpart[0];
		var month=parseInt(dpart[1])-1;
		var day=dpart[2];
		var timepart= dtl[1].split(":");
		var hours=timepart[0];
		var minutes=timepart[1];
		var atime = new Date(year, month, day, hours, minutes);
			this.addAlarm(this.alarmName, atime);
	}, 

	addAlarm: function(argName, argTime)
	{	var newAlarm=new FcAlarmClock(argName, argTime);
		this.push("alarmArray", newAlarm);
		
	},

});
</script>
</dom-module>