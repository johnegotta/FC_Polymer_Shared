 <dom-module id="fc-reorderered-list">
    <style>
      :host {
        display: flex;
        @apply(--layout-end-justified);
        @apply(--layout-vertical);
        @apply(--layout-self-stretch)
        overflow-y: scroll;
        left-margin: 4%;
        -webkit-overflow-scrolling: touch;
      }
    </style>
    <template>
    <div class="flex self-stretch layout vertical" style="overflow: hidden; overflow-y: scroll; max-height: 94%;">
      <content></content>
    </div>
    </template>


  <script>
    Polymer({
      is: 'fc-reordered-list',
      listeners: {
        scroll: 'handleScroll',
        'dom-change': 'trackElements'
      },
      handleScroll: function() {
        if (this.dragEl) {
          this.updateDragPosition();
        }
      },
      trackElements: function(e) {
        if (!this.repeater && e.target.is == 'dom-repeat') {
          this.repeater = e.target;
        }
        if (e.target == this.repeater) {
          Polymer.dom(this).children.forEach(function(el) {
            if (el !== this.repeater && !el.__reorderTracking) {
              this.listen(el, 'track', 'handleTrack');
              el.__reorderTracking = true;
            }
          }, this);
        }
      },
      handleTrack: function(e) {
         this.dragEl = e.target;
            while(!this.dragEl.classList.contains("item")&& this.dragEl.nodeName!="BODY" && this.dragEl.nodeName!="FC-DASHBOARD-ONE"){this.dragEl=this.dragEl.parentElement;}
            if(this.dragEl.nodeName=="FC-DASHBOARD-ONE"){console.log("YOU F___ED THE POOCH"); alert("pooch f___ED");}
            else if(this.dragEl.classList.contains("item")){
              console.log(this.dragEl, this.dragEl.classList);
              Polymer.dom(this.dragEl).setAttribute("style.zIndex","220000");
               Polymer.dom(this.dragEl).setAttribute("style.background","white");
        switch (e.detail.state) {
          case 'start':
            // Capture initial state
            this.startScrollTop = this.scrollTop;
            this.dragEl.style.pointerEvents = 'none';
            this.dragEl.classList.add('dragging');
            this.dragModel = this.repeater.modelForElement(this.dragEl);
            console.log(this.repeater.modelForElement(this.dragEl));
            break;
          case 'track':
            // Re-position dragged item
            this.updateDragPosition(e.detail.dy);
            // Translate non-dragged items up/down
            var overEl = e.detail.hover();
            var overModel = overEl && this.repeater.modelForElement(overEl);
            if (overModel) {
              this.overModel = overModel;
              this.dirOffset = e.detail.ddy < 0 ? -1 : 0;
              var lastOverIndex = this.overIndex || 0;
              var overIndex = overModel.index + this.dirOffset;
              var start = Math.max(overIndex < lastOverIndex ? overIndex : lastOverIndex, 0);
              var end = overModel.index < lastOverIndex ? lastOverIndex : overModel.index;
              var children = Polymer.dom(this).children;
              for (var i=start; i<=end; i++) {
                var el = children[i];
                if (el != this.repeater && i !== this.dragModel.index) {
                  var dir = 0;
                  if (i > this.dragModel.index && i <= overIndex) {
                    dir = -1;
                  } else if (i > overIndex && i < this.dragModel.index) {
                    dir = 1;
                  }
                  Polymer.dom(el).classList.add('moving');
                  this.translate3d(0, dir * this.dragEl.offsetHeight + 'px', 0, el);
                }
              }
              this.overIndex = overModel.index;
            }
            break;
          case 'end':
            // Move item in array to new position
            var fromIdx = this.repeater.items.indexOf(this.dragModel.item);
            if (fromIdx >= 0 && this.overModel) {
              var toIdx = this.repeater.items.indexOf(this.overModel.item) +
                (this.overModel.index > this.dragModel.index ? this.dirOffset : 0);
              var item = this.repeater.splice('items', fromIdx, 1)[0];
              this.repeater.splice('items', toIdx, 0, item);
            }
            // Reset style of dragged & moved elements
            this.dragEl.style.pointerEvents = '';
            this.dragEl.classList.remove('dragging');
            this.dragEl = null;
            Polymer.dom(this).children.forEach(function(el) {
              this.transform('', el);
              el.classList.remove('moving');
              
            }, this);
            
            Polymer.dom(this.dragEl).setAttribute("style.zIndex","1");
            break;
        }
      }
      else{}
      },
      updateDragPosition: function(dy) {
        this.trackDelta = dy || this.trackDelta || 0;
        var scrollDelta = this.scrollTop - this.startScrollTop;
        var pos = this.trackDelta + scrollDelta;
        this.translate3d(0, pos + 'px', 0, this.dragEl);
      }
    });
  </script>
  </dom-module>
