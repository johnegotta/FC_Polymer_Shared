<dom-module id="fc-mapped-grid">
 <template id="fc-mapped-grid-template">
 <style>
         :host{margin: 12px; padding: 4px;overflow: scroll;position: static;background: white; opacity: 1; @apply(--layout-vertical);@apply(--layout-flex); };
        textarea{margin:0px; border: 1px #dfdfdf solid; box-shadow: 1px 3px 4px 2px #fafafa;cursor: cell; font-size: 18px; font-weight: 600; color: #009; font-family: merriweather; text-align: center; white-space: wrap;
          max-height: 45px; min-height: 45px; border: 1px solid #afafaf; padding-top: 4px; font-family: merriweather; color: #009; text-align: center; resize:none; @apply(--layout-self-shrink);}
        details{outline: 0px white solid;}
        summary{outline: 0px white solid;}
        section{background:white;}
        paper-item{border: 1px solid #afafaf;}
        #myContextMenu{min-width: 280px; max-height: 420px; position: fixed; border:4px ridge gold; overflow-y: scroll; box-shadow: 5px 7px 11px 3px #afafaf;}*{@apply(--layout-nowrap);}
        #mappedGridContainer{min-width:50.99vw; background: aliceblue; max-width:92.99vw; width: 75%; min-height: 50vh; max-height:96vh; height: 60vh; padding-top: 19px; margin: 16px;}
        input{padding: 6px; min-height: 12px; align-items: center;}
        paper-button{
          min-width: 110px; height: 65px; text-align: center; margin: 12px; border: #afafaf solid 2px; box-shadow: 4px 7px 15px 9px slategrey;
        }
</style>

 <array-selector id="columnSelector" items="{{dataArrays}}" multi toggle selected="{{selectedArraySet}}">
 </array-selector>
<!-- <a> -->
<div on-contextmenu="mycontextMenu">
<div is-gridbox="true" on-mousedown="closemenu" id="mappedGridContainer" class="horizontal layout flex self-stretch reverse">
<!--side utility editing menu for the spreadsheet-like versions-->
<section class="layout flex-1" style="width: 120px;padding: 8px 28px; height: 100%; border: #005c00;">
FWD<paper-icon-button icon="icons:dashboard" on-tap="arraySwap"></paper-icon-button>ONE 
{{arrayIndex}}
<paper-button on-tap="initializeIndexDB">Init DB</paper-button>
<paper-button on-tap="deletedb">delete all</paper-button>
<paper-button on-tap="changeSource">Data Swap</paper-button>
                                from database
<paper-button on-tap="recallSpreadSheet">Access DB</paper-button>
                                    
</section>
<div hidden="{{!four}}" id="hanger1" contenteditable="true" style="display:flex; flex-direction: column; flex-wrap:nowrap; max-width: 97.5%; width: auto;">
<div id="hanger3"   contenteditable="true" on-contextmenu="mycontextMenu"  on-focus="setValuesInMap" style="display:flex; flex-direction: row; flex-wrap:nowrap; max-width: 95%; width: auto; overflow: scroll;">
</div>
</div>
<div id="polymerGrid" class="horizontal layout flex-9 self-stretch reverse">
  <template is="dom-repeat"  id="mappedGridRepeater" observe="data selected" class="horizontal layout flex" id="template" index-as="columnIndex" items="{{selectedArraySet}}" as="col">
        <div id$="divCol_[[columnIndex]]" hidden="{{four}}" class="vertical layout container nowrap self-stretch column">
        <input on-click="lockColumn" type="checkbox" name="hl" value="[[columnIndex]]" checked="[[computeLockedColumn(col.id)]]">
              <textarea id$="{{col.id}}" class="horizontal layout flex nowrap center center-justified self-shrink" draggable="true" on-dragstart="startDrag" value="{{col.value::textarea}}" on-dragover="dragOver" on-drop="handleDrop" style$="{{col.style}}">{{col.name}} 
          </textarea>    
          <template is="dom-repeat" id$="template_{{columnIndex}}" class="vertical flex layout" observe="highlight col row" is="dom-repeat" items="{{col.columnCells}}">
               <!--          <a link={{}}> -->
                <textarea 
                    input-type="text" 
                    draggable="true" 
                    id$="{{item.id}}" 
                    value="{{item.value::textarea}}" 
                    contenteditable="true" 
                    style$="{{item.style}}"
                    class$="{{item.class}}"
                    key="{{item.key}}"
                    related-cells="{{item.relatedCells}}"
                    grid-name="{{item.gridName}}"
                    archive="{{item.archive}}" 
                    max-char="450">  
                </textarea>      
            <!--         </a> -->
          </template>
        </div>
  </template>
  </div>
</div>
</div>
<paper-listbox id="myContextMenu"  hidden>
  <paper-item class="around-justified">
        <paper-swatch-picker>
        </paper-swatch-picker><span>  &nbsp; Text Color &nbsp;&nbsp; &nbsp;</span>
        <input type="color" value="{{background::input}}"> Background Color
  </paper-item>
    <template is="dom-repeat"  items="{{contextMenuCategories}}" as="category" index-as="categoryIndex">
        <paper-item value="{{category.title}}">
            <details>
                <summary>{{category.title}}</summary>
                <paper-listbox style="min-width:360px!important; max-width: 360px!important;">
                    <template is="dom-repeat" items="{{category.buttons}}" as="item">
                          <paper-item onclick="{{item.myFunction}}" btn-set-value="{{item.dataSetValue}}" btn-text="{{item.text.0}}" btn-args="{{item.dataArgs}}"style$="padding: 0px; margin: 0px; font-size: 18px; font-weight: 700; font-family: merriweather; color: #009;{{_computeStyle(item.dataProperty, item.dataSetValue, color, background, item.text.0)}}" btn-property="{{item.dataProperty}}">                {{item.text.0}}
                              <span btn-property="{{item.dataProperty}}" btn-text="{{item.text.0}}" btn-set-value="{{item.dataSetValue}}" btn-function="{{item.datafunction}}"style$="font-size: 24px; font-weight: 300; color: #009;{{_computeStyle(item.dataProperty, item.dataSetValue, color, background, item.text.0)}}">{{item.text.2}}</span>
                              <span btn-property="{{item.dataProperty}}" btn-text="{{item.text.0}}" btn-set-value="{{item.dataSetValue}}" btn-function="{{item.dataFunction}}" btn-args="{{item.dataArgs}}" style$="{{_computeStyle(item.dataProperty, item.dataSetValue, color, background, item.text.0)}}; font-size: 28px;">{{item.text.1}}</span> 
                          </paper-item>
                    </template> 
                </paper-listbox>
            </details>
        </paper-item>
    </template>
</paper-listbox>
 </template>
 <script>
 FcMappedGrid=Polymer({
 	is:"fc-mapped-grid",
  behaviors:[Polymer.Templatizer, FCBehaviors.FcDataGridDataLoadingBehavior, FCBehaviors.FcDataGridStylingBehavior],
  listeners: {"color-picker-selected":"getcolor"},
 	properties: { 
    format:{
      type: Object,
      value:function(){return {};},
      notify: true,
    },
    arraysIndex:{
        type: Number,
        value: function(){return 0;},
        observer:"observeIndex",
        notify:true,
    },
    four:{     type:Boolean,
     computed:"computefour(arrayIndex)",
      notify: true,
    },
    parentTarget:{
        type: Object,
        notify: true,
    
    },data:{
      type: Array,
      value: function(){return [];},
      notify: true
    }


   
   
 	},
ready(){
    this.parser3();
    this.parser2();
    this.push("dataArrays", this.columns2);
    this.push("dataArrays",this.columns3);
        this.push("dataArrays",this.columns4);
    this.set("selectedArraySet", this.dataArrays[this.arrayIndex]);
    this.set("parentTarget", this.$.mappedGridRepeater);
     
  },
    attached(){ this.parser3()},

  mycontextMenu(e){
    this.set("gridEvent", e);
    this.set("sourceCell", e.target);
    this.$.myContextMenu.hidden=false;
    this.$.myContextMenu.style.left=(e.clientX-330)+"px";
    this.$.myContextMenu.style.top=(e.clientY-80)+"px";
    this.$.myContextMenu.style.zIndex=25000;
    var key=e.target.getAttribute("id").split("_");//
    if(key[2]==0 && key[1]!=0){
      var returnColumnHeader=this.columnMenu.concat(this.basemenu);
    this.setMenuEntries(returnColumnHeader);
    }
    else if(key[1]==0&&key[2]!=0){
        var returnRowMenu=this.rowMenu.concat(this.basemenu);
         this.setMenuEntries(returnRowMenu);
    }
    else if(key[1]&&key[2]){ this.setMenuEntries(this.basemenu);}
    else{this.setMenuEntries([]);}
  },

computeColSelected(one, trigger){},
  getcolor(e){
    this.set("color",e.detail.color);
  },

  setMenuEntries(returnValue){
      this.set("contextMenuCategories", returnValue);
  },
  closemenu(e){
    this.$.myContextMenu.hidden=true;
  },
    observeGridEvents(a,b){if(a){console.log(a);if(a && b){console.log(a,b);}}},


  _computeStyle(property, val, color, background, text ){
    if(text||text.match(" ")){
 var retVal=(text.match("Remove"))?`background: ${this.defaultFormat.background};`:(text.match("Base"))?`color: ${this.defaultFormat.color};`:(property==="background:")?`background: ${this.background};`:(property==="color:")?`color: ${this.color}`: property + val;
 return retVal;
}
else return "background: gold;";
         //NOTE TODO: MUST SAVE THE SET OF PROPERTIES WILL OVERWRITE EACH TIME!!!
  },
 arraySwap(e){
        var arrayNum=(this.arrayIndex===0)?1:(this.arrayIndex===1)?2:(this.arrayIndex===2)?3:(this.arrayIndex===3)?4:(this.arrayIndex===4)?5:(this.arrayIndex===5)?6:(this.arrayIndex===6)?7:(this.arrayIndex===7)?8:(this.arrayIndex===8)?9:0;
        this.set("arrayIndex", arrayNum);
        this.set("selectedArraySet", this.dataArrays[this.arrayIndex]);
  },
computefour(arrayIndex){
    return(arrayIndex===3);
},
observeIndex(newVal, oldVal){
  console.log(newVal, oldVal, "index for names");
},
changeSource(e){this.set("fromDb",!this.fromDb)},
lockColumn(e){},
startDrag(e){},
dragOver(e){},
handleDrop(e){},
computeLockedColumn(col){},

 
  });
    </script>
   </dom-module>

