<dom-module id="fc-fit-wrapper">
<template>
  <style>
    :host {
      color: #009;
      position: relative!important;
      overflow-y: scroll;
    }
    div{padding: 0px;
        background: white;}
        section{background: aqua;}
  </style>

<div id="myPanel" style="border:4px double #009; height:[[computePanelHeight(positionTarget)]]; max-width: 4000px; max-height: 4000px; width:[[computePanelWidth(positionTarget)]];  overflow-y: scroll;">
 <button on-tap="openButtons">O</button><paper-button on-tap="seeElement">Yep</paper-button>
   <iron-collapse id="collapsable">
  <section on-tap="updateAlign">
   <p>
      <button data-align="verticalAlign_top">top</button>
      <button data-align="verticalAlign_bottom">bottom</button>
      <button data-align="verticalAlign_auto">auto</button>
      <button data-align="verticalAlign_null">null</button>
    </p>
    <p>
      <button data-align="horizontalAlign_left">left</button>
      <button data-align="horizontalAlign_right">right</button>
      <button data-align="horizontalAlign_auto">auto</button>
      <button data-align="horizontalAlign_null">null</button>

    </p>
    <p>
    <button data-align="noOverLap_bool_false">no overlap</button>
    <button data-align="dynamicAlign_bool_true">dynamic align</button>
    </p>
  </section>
  </iron-collapse>
  <iron-collapse id="seeUrElement">
    <content></content>
    </iron-collapse>
</div>
 </template>
<script>
FcFitWrapper=Polymer({
    is: 'fc-fit-wrapper',
    behaviors: [
      Polymer.IronFitBehavior,
       FCBehaviors.ResizableRootBehavior
    ],
    properties:{
      _defaultTarget:{
        value:function(){return Polymer.dom(this.root).querySelector("#gridBox78");},
        notify: true
      },
      positionTarget:{
        value: function(){return Polymer.dom(this.root.parentNode);},
        notify: true
    },

      parentN:{
        type:Object,
        value:function(){var parent= Polymer.dom(this).parentNode;
          return parent;}
      },
      drags:{
        type: Boolean,
        value: function(){return false;},
        notify: true,
      },

    },
    ready(){
      this.initialize();
        },
    initialize(){
      this.set("autoFitOnAttached",true);
      this.set("dynamicAlign",true);
      this.set("noOverlap", false);
      this.set("verticalAlign","auto");
      this.set("horizontalAlign","auto");

        },

    openButtons(){
        this.$.collapsable.opened=!this.$.collapsable.opened;
      },
     seeElement(){

     this.$.seeUrElement.opened=!this.$.seeUrElement.opened
   },
    updateAlign(e){  
      if(e.target.nodeName==="BUTTON"){  
          var target = e.target.dataset.align;
          var attValArr=target.split("_"),
          att=attValArr[0].toString(),
          val=attValArr[1].toString();
          if(val=="bool"){this.set(att,!this[att]);}
          else{this.set(att,val);}
        }
        console.log(this.horizontalAlign, this.verticalAlign, this.dynamicAlign);
          this.specialRefit();
      },
      _computeFitInto(pt){
        console.log(pt);
        if(pt && pt.parentNode){
        var target=pt;
        while(target.nodeName!="FC-MAPPED-GRID"){
          target=target.parentNode;

        }
        return target;
      }


      },
  dragsOff(){
    this.set("drags", false);
    this.set("draggable", false);
    this.set("dragging", false);


  },
  dragsOn(){
 this.set("drags", true);
    this.set("draggable", true);
    this.set("dragging", true);

  },

  specialRefit(target){
    console.log("in sp1");
    this.set("positionTarget",target);
    if(this._raf){
      console.log("in sp3");
      this._raf && window.cancelAnimationFrame(this._raf);
      this._raf=window.requestAnimationFrame(()=>{
        this._raf = null;
        console.log(this._raf);
        if(target){ this.set("positionTarget", target); console.log("in sp4");}
        this.async(this.refit, 3);
      });
      }
      else{
        this.refit(); console.log("in sp2");}
      this.computePanelWidth(target);
      this.computePanelHeight(target);
    },

 
    computePanelWidth: function(target){
        if(target && target.style && window.getComputedStyle(target, null).getPropertyValue("width")){
      return Math.floor(parseFloat(window.getComputedStyle(target, null).getPropertyValue("width"))*.98).toString()+"px";
    }
    },

    computePanelHeight:function(target){  
        if(target && target.style && window.getComputedStyle(target, null).getPropertyValue("height"))
        {
      return Math.floor(parseFloat(window.getComputedStyle(target, null).getPropertyValue("height"))*.98).toString()+"px";
    }
    },

    
     attached: function(){
        var self=this;
        this.set("isResizing", true);
     
        this.click();
        this.set("heightHolder", this.currentHeight);
        this.set("_notifyingDescendant", true);
       this.set("verticalAlign", "auto"); this.set("horizontalAlign", "auto");
       this.set("dragState", this.drags);

    },

  });
</script>
</dom-module>
<!--
    template._raf = null;
    template.refit = function() {
      template._raf && window.cancelAnimationFrame(template._raf);
      template._raf = window.requestAnimationFrame(function() {
        template._raf = null;
        myFit.refit();
      });
    };



    // Listen for resize and scroll on window.
    window.addEventListener('resize', template.refit);
    window.addEventListener('scroll', template.refit);

    function toggleClass(element, cssClass, condition) {
      element.classList[condition ? 'add' : 'remove'](cssClass);
    }
  </script>
</template>

</script> -->