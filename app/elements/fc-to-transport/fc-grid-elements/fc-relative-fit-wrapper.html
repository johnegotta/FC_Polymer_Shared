<dom-module id="fc-relative-fit-wrapper">
<template>
  <style>
    :host {
      background: white;
      color: #009;
      text-align: center;
      position: relative!important;
      overflow: scroll;

    }
    div{padding: 0px;
        background: white;
        border: 14px silver ridge;
        overflow: scroll;}
        section{background: aqua;}
  </style>

<div id="myPanel" style="background: white; height:[[computePanelHeight(positionTarget,special)]]; width:[[computePanelWidth(positionTarget,special)]];">
 <iron-collapse id="seeElement" style="background:white;">
    <content></content>
  </iron-collapse>
</div>
 </template>
<script>
FcFitWrapper=Polymer({
    is: 'fc-relative-fit-wrapper',
    behaviors: [
      Polymer.IronFitBehavior,
      // FCBehaviors.ResizableRootBehavior
    ],
    properties:{
      _defaultTarget:{
        value:function(){return Polymer.dom(this.root).querySelector("#gridBox78");},
        notify: true
      },
      positionTarget:{
        value: function(){return Polymer.dom(this.root.parentNode);},
        notify: true
    },
    special:{



    },

      parentN:{
        type:Object,
        value:function(){var parent= Polymer.dom(this).parentNode;
          return parent;}
      },
      drags:{
        type: Boolean,
        value: function(){return false;},
        notify: true,
      },

    },
    ready(){
      this.initialize();
      this.openToSeeElement();
        },
    initialize(){
      this.set("autoFitOnAttached",false);
      this.set("dynamicAlign",true);
      this.set("noOverlap", false);
      this.set("verticalAlign","top");
      this.set("horizontalAlign","left");

        },

    openToSeeElement(){
      this.$.seeElement.opened=true;
    },
      _computeFitInto(pt){
        console.log(pt);
        if(pt && pt.parentNode){
        var target=pt;
        while(target.nodeName!="FC-MAPPED-GRID"){
          target=target.parentNode;

        }
        return target;
      }


      },
  dragsOff(){
    this.set("drags", false);
    this.set("draggable", false);
    this.set("dragging", false);


  },
  dragsOn(){
 this.set("drags", true);
    this.set("draggable", true);
    this.set("dragging", true);

  },



  specialRefit(target){
    console.log("in sp1");
    this.set("positionTarget",target);
    if(this._raf){
      console.log("in sp3");
      this._raf && window.cancelAnimationFrame(this._raf);
      this._raf=window.requestAnimationFrame(()=>{
        this._raf = null;
        console.log(this._raf);
        if(target){ this.set("positionTarget", target); console.log("in sp4");}
        this.async(this.refit, 3);
      });
      }
      else{this.refit(); console.log("in sp2");}
      console.log(target.style.width, target.style.height, window.getComputedStyle(target, null).getPropertyValue("width"), window.getComputedStyle(target, null).getPropertyValue("height"));
      var newHeight=window.getComputedStyle(target, null).getPropertyValue("height");
      this.computePanelWidth(target);
      var newWidth=window.getComputedStyle(target, null).getPropertyValue("width");
      this.computePanelHeight(target);
    },

 
    computePanelWidth: function(target){
        if(target && target.style && window.getComputedStyle(target, null).getPropertyValue("width")){
      return Math.floor(parseFloat(window.getComputedStyle(target, null).getPropertyValue("width"))*.98).toString()+"px";
    }
    },

    computePanelHeight:function(target){  
        if(target && target.style && window.getComputedStyle(target, null).getPropertyValue("height"))
        {
      return Math.floor(parseFloat(window.getComputedStyle(target, null).getPropertyValue("height"))*.98).toString()+"px";
    }
    },

    
     attached: function(){
        var self=this;
        this.set("isResizing", true);
        var self=this;
        var par=Polymer.dom(this.root).parentNode;
    console.log(par);
        this.click();
        this.set("heightHolder", this.currentHeight);
        this.set("_notifyingDescendant", true);
       this.set("verticalAlign", "auto"); this.set("horizontalAlign", "auto");
       this.set("dragState", this.drags);

    },


  });
</script>
</dom-module>