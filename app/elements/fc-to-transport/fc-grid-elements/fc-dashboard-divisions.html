<dom-module id="fc-dashboard-divisions">
   <template strip-whitespace>
  <style>
  :host{overflow-y: scroll;
    @apply(--vertical-layout);
    @apply(--layout-fit);
    position: absolute;
    top: 0px;
    bottom: 0px;
    left:0px;
    right: 0px;
    overflow: hidden;
  }
    .container {
      min-height: 99vh;
      border: 4px solid #aaa;
    }
    
    #box1, #box3, #box5, #box6, #box11{
      width: 50%; 
    }
  paper-material{max-height: 102vh;}
  div{overflow: hidden;
    height: 50%;
      overflow-y: scroll;
      max-height: 100%;
    }
     #box5, #box11{
      min-height:218vh;
      max-height:99px;
     }

    fc-relative-fit-wrapper{
      cursor: move;

    }
    
  </style>
  
  <style is="custom-style">
    /* TODO(polyup): For speed, consider reworking these styles with .classes
                     and #ids rather than [attributes].
    */
    [layout] {
      @apply(--layout);
    }
    [layout][horizontal] {
      @apply(--layout-horizontal);
    }
    [layout][vertical] {
      @apply(--layout-vertical);
    }
    [flex] {
      @apply(--layout-flex);
    }
    iron-splitter{
      z-index:2;
      position: static;
    }
  </style>
<paper-material class="container horizontal layout flex">
<!--left-drawer begins-->
<!--hidden="{{!isResizing}}"-->
<div class="horizontal layout flex self-stretch" is-resizing dragging draggable id="dashboardLeftDrawer" is-resizing style$="width:{{dashboardLeftDrawerCurrentWidth}}px; height: 101vh; border-right: 2px green solid; position: absolute; left: 0px; top: 0px; bottom: 0px; z-index:999999999999;">
      
  <div class="vertical layout flex" style="min-height: 102vh; background: white;">     
    <template is="dom-repeat" id="widgetHolder" items="{{widgets}}" as="widget">
    <section class="horizontal flex layout wrap" style="margin-left: 32px;">
      <section style="height: 36px; width: 36px; overflow: hidden; margin: 16px; border:solid gold 6px; background: green; box-shadow: 4px 8px 16px 5px #aeaeae; border-radius: 50%; z-index: 34;" parent-cws="out" on-up="handleDrop" text="{{widget.name}}">
        <fc-relative-fit-wrapper id="wrapper{{index}}" on-track="dragAndDrop" class="item wrapper" cws="out" on-track="dragAndDrop" draggable drags>
       </fc-relative-fit-wrapper>
    </section>
    <span>
  </span>
    <span class="horizontal layout center justified">{{widget.nodeName}}</span>
  </section>
</template>

    <section class="horizontal flex layout wrap" style="margin-left: 32px;">
        <section style="height: 36px; width: 36px; overflow: hidden; margin: 16px; border:solid gold 6px; background: green; box-shadow: 4px 8px 16px 5px #aeaeae; border-radius: 50%; z-index: 34;" parent-cws="out" on-up="handleDrop" text="{{widget}}">
            <fc-relative-fit-wrapper id="wrapper2" on-track="dragAndDrop" class="item wrapper" cws="out" on-track="dragAndDrop" draggable drags>
                      <content select=".leftDrawer"></content>
            </fc-relative-fit-wrapper>
        </section>
    </section>
  </div>
<section on-down="dragsOff" id="dashboardLeftDrawer_resizer" on-track="_resize" on-up="dragsOn" is-resizing dragging draggable style$="position: relative; left:calc( {{dashboardLeftDrawerCurrentWidth}}+12)px; bottom:0px; top: 0px; min-width: 44px!important;margin-right:-22px; height: 103vh; cursor:ew-resize; padding: 4px; width: 133px!important; opacity: 1; background: orange; border-right: 13px solid red; z-index: 9898989898989898898;">
</section>

</div>
<!--Drawer-End-->
   <!--BOX CONTAINER ON DASHBOARD LAYOUT-->
  <div class="container horizontal layout flex-6" style$="position: relative; top: 0px; bottom: 0px; height:[[currentHeight]]; right:0px;"> 
  <!--LEFT COLUMN CONTAINER ON DASHBOARD LAYOUT-->
    <div id="box11">
      <!--Left-TOP BOX FOR ZONE in LEFT COLUMN-->
      <div class="flex dropzone" style="height: 45vh; overflow-y:scroll;"  parent-cws="in" on-dragover="allowDrop" on-up="handleDrop">
        <fc-relative-fit-wrapper id="wrapper1" cws="in" class="item wrapper" on-track="dragAndDrop" draggable drags>
                <content select=".leftTop"></content>
        </fc-relative-fit-wrapper>
      </div>
      <!--END LEFT TOP BOX IN DASH BOARD-->
      <!--LEFT COLUMN SPLITTER(row creator)-->
          <iron-splitter style="background: blue; height: 24px;border: 2px solid gold;" direction="up">
          </iron-splitter>
      <!--END LEFT COLUMN SPLITTER(row creator)-->
      <!--BEGIN BOTTOM HALF OF LEFT COLUMN-->
      <div id="box4" class='flex dropzone'  style="overflow-y:scroll;" parent-cws="in" on-dragover="allowDrop" on-up="handleDrop">
            <fc-relative-fit-wrapper id="wrapper2" cws="in" class="item wrapper" on-track="dragAndDrop" draggable drags>
              <fc-ddr-card>
                    <content select=".leftBottom">

                    </content>
              </fc-ddr-card> 
      </fc-relative-fit-wrapper> 
   </div>
  </div>
    <iron-splitter style="top: 0px; bottom:0px; background: blue; width: 24px;  border: 2px solid gold;" direction="left"></iron-splitter>


  <div id="box5" class="flex">
        <div class="layout flex dropzone" on-dragover="allowDrop" parent-cws="in" on-up="handleDrop" style="height: 45vh; overflow-y:scroll;">
            <fc-relative-fit-wrapper id="wrapper3" cws="in" class="item wrapper" on-track="dragAndDrop" draggable drags>
                <content select=".rightTop"></content>
            </fc-relative-fit-wrapper>
        </div>
  <iron-splitter style="background: blue; height: 24px;border: 2px solid gold;" direction="up">
  </iron-splitter>
      <div class="flex layout self-stretch dropzone" parent-cws="in" on-dragover="allowDrop" on-up="handleDrop" style="overflow-y:scroll;">
          <fc-relative-fit-wrapper id="wrapper4" cws="in" class="item wrapper" current-height="{{currentHeight}}" current-width="{{currentWidth}}" on-track="dragAndDrop" draggable drags>
            <content select=".rightBottom"></content>
          </fc-relative-fit-wrapper>
      </div>
  </div>
  </div>
  <div class="horizontal layout flex self-stretch end" is-resizing dragging draggable id="dashboardRightDrawer" is-resizing style$="width:{{dashboardRightDrawerCurrentWidth}}px; height: 101vh; background:white; position: absolute; right: 0px; top: 0px; bottom: 0px; left:">
<section id="dashboardRightDrawer_resizer" on-down="dragsOff" on-track="_resize" on-up="dragsOn" is-resizing dragging draggable style$="position:relative; right:{{dashboardRightDrawerCurrentWidth}}px; left: 0px; bottom:0px; top: 0px; min-width: 12px; height: 103vh; cursor:ew-resize; padding: 4px; width: 13px!important; max-width:13px; opacity: 1; border-left: 3px solid orangered; z-index:223300; background: purple;">
</section>
  <div class="vertical layout flex" style="position: absolute; right:0px; top: 0px; bottom: 0px; min-height: 102vh; background: white;">     
    <template is="dom-repeat" id="widgetHolder" items="{{widgets}}" as="widget">
    <section class="horizontal flex layout wrap" style="margin-left: 32px;">
      <section style="height: 36px; width: 36px; overflow: hidden; margin: 16px; border:solid gold 6px; background: green; box-shadow: 4px 8px 16px 5px #aeaeae; border-radius: 50%; z-index: 34;" parent-cws="out" on-up="handleDrop" text="{{widget.name}}">
        <fc-relative-fit-wrapper id="wrapper{{index}}" on-track="dragAndDrop" class="item wrapper" cws="out" on-track="dragAndDrop" draggable drags>
       </fc-relative-fit-wrapper>
    </section>
    <span>
  </span>
    <span class="horizontal layout center justified">{{widget.nodeName}}</span>
  </section>
</template>

    <section class="horizontal flex layout wrap" style="margin-left: 32px;">
        <section style="height: 36px; width: 36px; overflow: hidden; margin: 16px; border:solid gold 6px; background: green; box-shadow: 4px 8px 16px 5px #aeaeae; border-radius: 50%; z-index: 34;" parent-cws="out" on-up="handleDrop" text="{{widget}}">
            <fc-relative-fit-wrapper id="wrapper2" on-track="dragAndDrop" class="item wrapper" cws="out" on-track="dragAndDrop" draggable drags>
                      <content select=".rightDrawer"></content>
            </fc-relative-fit-wrapper>
        </section>
    </section>
  </div>
</div>
  </paper-material>
 <!--  </fc-ddr-card> -->
  </template>
  <script>
FcDashboardDivisions=Polymer({
    is:"fc-dashboard-divisions",
    behaviors:[Polymer.IronResizableBehavior],
    properties:{
        currentHeight:{
        notify: true
        },
fauxSheight:{
  type: Number,
    notify: true
  },
  dashboardLeftDrawerCurrentWidth:{
    type: Number,
    value:function(){return 175;},
    notify: true
  },

  ldid:{
    type: String,
    value: "dashboardLeftDrawer"
  },
  dashboardRightDrawerCurrentWidth:{
      type: Number,
      value: function(){return 175;},
      notify: true,
  },
  webAddress:{
    type:String,
    value:function(){
      return "http://localhost:3000";
    },
    notify: true,
  },
  webAddresses:{
    type:Array,
    value: function(){
     return ["http://localhost:3000","http://localhost:3000/#!/testarea1","http://localhost:3000/#!/testarea2",'http://localhost:3000/#!/users', 'http://localhost:3000/#!/user-info','http://localhost:3000/#!/user-info', 'http://localhost:3000"/#!/reading',"http://localhost:3000/#!/reading"];
  },
    notify: true,
  },
  isWrapper:{
    type: Boolean,
    value: false,
    notify: true
  },
  dragEl:{
    type: Object,
    notify: true 
  },
  wrapperDragEl:{
    type: Object,
    notify: true 

  },
  counter:{
    type:Number,
    value:0,
    notify: true,
  },
  widgets:{
    type:Array,
    value:function(){return [{"name":FcGridCellTempl,"show":true, "nodeName": "FC-GRID-CELL-TEMPL"}, {"name":FcGridContainer,"show":true, "nodeName":"FC-GRID-CONTAINER"},{"name":FcMappedGrid,"nodeName": "FC-MAPPED-GRID", "show":true},{"name":FcRqtversionc,"nodeName":"FC-RQTCVERSIONC","show":true},{"name":FcDragMenuProto,"showDash":false}];},
    //note here that I am giving the actual constructor functions, not the strings of the names.  The strings of the names didnt work, as they are not defined locally, so a this[arrayOfStringsNamesOfFunctions[ArrayNumberNeeded](ArgArray[0],ArgArray[1],ArgArray[2],ArgArray[3]...etc.) wont work.  
    notify: true,
  },
  parentDragEl:{
    type: Object,
    notify: true //note this is the parent of both the wrapper and the cell template--it is the cell
  },
  screenWidth:{
      type: Array,
      value: function(){
        var widthArray=[];
            var numberWidth=parseInt(window.innerWidth);
            widthArray.push(numberWidth);
            var width=window.innerWidth;
            widthArray.push(width);
            return widthArray;
      },
      notify: true
    },
  screenHeight:{
      type: Array,
      value: function(){
        var widthArray=[];
            var numberHeight=parseInt(window.innerHeight);
            widthArray.push(numberHeight);
            var width=window.innerHeight;
            widthArray.push(width);
            return widthArray;
      },
      notify: true
  },
  elementHolderArray:{
    type: Array,
    value:function(){return [];},
    notify: true,
      },
  },
  created(){

  },
  ready(){



  },
  attached(){
      this.async(function(){
        var holderArray=[], length=this.widgets.length;
        //go with this content tags deprecated
        //its now just an apend child in a slot
        for(var i=0;i<length;i++)
        {
            var element= new this.widgets[i].name();
            holderArray.push(element);
        }
        this.set("elementHolderArray", holderArray);
        this.implantElements(this.holderArray);
        }, 2000);
        //loaded heavy elements to see effect
        //not time to load, when I dom repeated their templates it was a disaster
    },

implantElements(elemArr){
    var target=this.$.widgetHolder,children=target.children;
    console.log(children, target);

},
computeOptionsArray(item, val){
    if(this.__data__[item]==undefined){ return item;}
    else{
    return this.__data__[item];
    }
  }, 
  _computeListItemData(itemData, courses, someArray, outputs){
    if(itemData=="courses"){this.async(function(){return this[itemData];}, 1500);}
     else{return this[itemData];}
  },

  dragAndDrop(e){
      var targ=e.target;
      event.preventDefault;
      while(targ.classList.contains("item")!==true && targ.nodeName!="PAPER-MATERIAL" && targ.classList.contains("stationary")!==true)
              {targ=targ.parentElement;}
      if(targ.classList.contains("stationary")==true){this.drags=false;}
      else if(targ.classList.contains("item")==true)
        {
          if(targ.classList.contains("wrapper")===true)
              {
                      this.set("wrapperDragEl", targ);
                      var par=Polymer.dom(targ).parentNode;
                      // console.log(par);
                      this.set("parentDragEl",par);
                      // console.log(this.wrapperDragEl, "leaving dragStart");
                      this.set("isWrapper",true);
                      var childrenArr=Polymer.dom(targ).childNodes;
                        var dragEl= childrenArr.find(function(val){return(val.nodeName.charAt(0)==="F" & val.nodeName.charAt(1)==="C");});//add try catch
                      // console.log(dragEl, "look here for dragEl");
                      this.set("dragEl", dragEl);
                      self=this.wrapperDragEl;
                      // console.log(self, self, Polymer.dom(targ).childNodes, "be sure you have the element.... getting template next");  
              }
          this.dragEl.drags=true;
          self.drags=true;
          this.dragEl.dragging=true;
          self.dragging=true;
          this.dragEl.draggable=true;
          self.draggable=true;
          switch(e.detail.state){
                  case 'start':
                      self._leftprime = parseInt(window.getComputedStyle(targ).getPropertyValue("left"))-e.detail.x;
                      self._topprime = parseInt(window.getComputedStyle(targ).getPropertyValue("top"))-e.detail.y;
                       self.changeX=0;
                       self.changeY=0; //TODO:Self has to be set dynamically see above, 
                       /*FIX??? HACK??  Wrapper solved issue temporarily, am experimenting with the hucking of the templates into the cells.  If that works, we can avoid repetitive copies of the same Elements by keeping a store house top level, and then firing them from the wrapper dashboard into apropos locals; 
                      Polymer.dom.flush();
                      */
                  break;
                  case 'track':
                        e.preventDefault();
                       self.changeX=e.detail.ddx + self.changeX; //SELF ISSUE
                       self.changeY=e.detail.ddy + self.changeY;
                       this.wrapperDragEl.translate3d(self.changeX.toString() + 'px', self.changeY.toString() + 'px', 0);
                      break;
                  case 'end':
                      var lt=e.detail.sourceEvent.toElement;
                      var bool =Polymer.dom(lt).classList.contains("wrapper");
                      while(!bool && lt.nodeName!="FC-RELATIVE-FIT-WRAPPER")
                       {
                          lt=lt.parentElement;
                           var bool =Polymer.dom(lt).classList.contains("wrapper");
                           console.log(bool, lt);
                       }
                      if(bool && this.isWrapper==true){
                        var parent=lt.parentElement;
                        this.set("lt.cws",this.parentDragEl.parentCws);
                        this.set("wrapperDragEl.cws", parent.parentCws);
                       // console.log(lt.cws, this.wrapperDragEl.cws);
                        Polymer.dom(this.parentDragEl).insertBefore(lt, this.wrapperDragEl);
                        // console.log(this.parentDragEl, parent);
                        Polymer.dom(parent).appendChild(this.wrapperDragEl);
                        self.dragging=false;
                         Polymer.dom.flush();
                      }
                  break;
                }//close switch???
            }//close if
       
      },
      _computeWrapperState(transformWrapperStyle, cws)
      {
        if(cws==="out"){
          return "height: 36px; width: 36px; border:solid gold 6px; background: green; box-shadow: 4px 8px 16px 5px #aeaeae;";
        }
        else return "";
      },
      handleDrop(e){
        // var lt=e.detail.sourceEvent.toElement;
        //               var bool =Polymer.dom(lt).classList.contains("wrapper");
        //               console.log(bool);
        //               while(!bool && lt.nodeName!="FC-RELATIVE-FIT-WRAPPER")
        //                {
        //                   lt=lt.parentElement;
        //                    var bool =Polymer.dom(lt).classList.contains("wrapper");
        //                }
        //               if(bool && this.isWrapper==true){
        //                 console.log(e, "in drop event");
        //                 console.log(lt, "am a wrapper element", this.dragEl, "dragElement");
        //                 var parent=lt.parentElement;
        //                 Polymer.dom(this.parentDragEl).insertBefore(lt, this.dragEl);
        //                 console.log(this.parentDragEl, parent);
        //                 Polymer.dom(parent).appendChild(this.dragEl);
        //                 self.dragging=false;
        //                 self.set("refit",true);
        //                 Polymer.dom.flush();
                      // }


      },
      allowDrop(e){e.preventDefault();},
// },
// attached:function(){
//   this.scrollH();
// },

// scrollH: function(){
//   var val = this.$.focusedGrid.scrollHeight
//   this.set("fauxSheight", val+"px");
// console.log(this.$.focusedGrid.scrollHeight, "scrollHeight", this.fauxSheight, this.scrollHeight);
// }, 
// _computeScrollHeight: function(fs){
//   if(fs){
//   return fs;
// }
// },

   _resize: function(e){
          e.preventDefault();
          this.isResizing=true;
          var nId=e.target.attributes.id.value.split("_");
          var theId="#"+nId[0];
          var elem=this.$$(theId);
          var width=Math.floor(parseFloat(window.screen.width)*.96);
          var height=Math.floor(parseFloat(window.screen.height)*.999);
      
          // if(this.isResizing===true){
            var widthString=nId[0]+"CurrentWidth";
          switch(e.detail.state) {
                case 'start':
                  var sWidth =window.getComputedStyle(elem, null).getPropertyValue("width");
                  sWidth = Math.floor(parseInt(sWidth));
                  this.set(widthString, sWidth);
                  console.log(this[widthString],elem, "look here a lot");
                 break;
                case 'track':
                  //var newheight = parseInt(self.currentHeight) + e.detail.ddy;
                  var change = (widthString.match("Right") && widthString.match("Right").length>0)? (- e.detail.ddx): e.detail.ddx;
                  var nwidth=this[widthString]+change;


                  // console.log(nwidth, this[widthString], e.detail.ddx);
                  // var nheight2=(newheight<parseFloat(self.minHeight))?self.minHeight:(newheight>height)?height: newheight;
                  var trueWidth=(nwidth<15)?15:(nwidth>width)? width:nwidth;
                  console.log((widthString.match("Right") && widthString.match("Right").length>0), trueWidth);
                
                  this[widthString]=trueWidth;
                  // var trueHeight = nheight2.toString()+'px';
                  //this[widthString]=trueWidth;
                  var holder=trueWidth;
                  holder=holder.toString()+"px";
                  //self.set("currentHeight",trueHeight);
                  Polymer.dom(elem).setAttribute("style.width",holder);
                  //self.style.height= trueHeight;
                  break;
                case 'end':
                 Polymer.dom(elem).setAttribute("style.width",holder);
                    var side=(widthString.match("Right") && widthString.match("Right").length>0)?"Right":"Left";
                    console.log(side, this[widthString],elem.style.width);
                  //self.style.height= trueHeight;
                  //this.set("heightHolder", self.currentHeight);
        
                  // self.notifyResize();
                 // this.toggleColor=true;
                  // self._onIronResize();
                  // self.set("refit", true);
                 // self.afterStartResize();
                  //Polymer.dom.flush();
                  break;
              }
            
        },
      
    dragsOff: function(){this.set("drags", false);},
    dragsOn: function(){ if(this.dragState){this.async(this.dragSwitch, 50);}},
    dragSwitch: function(){this.set("drags", true);},


  });
</script>
</dom-module> <!-- 
  <template id="FC-TO-DO-LIST">
   <fc-to-do-list params="{{thisAuth}}">
   </fc-to-do-list>
   </template>
    <template id="FC-GRID-CELL-TEMPL">
   <fc-grid-cell-templ params="{{thisAuth}}">
   </fc-grid-cell-templ>
   </template>
  <template id="FC-GRID-CONTAINER">
   <fc-grid-container></fc-grid-container>
   </template>
   <template id="FC-MAPPED-GRID">
   <fc-mapped-grid></fc-mapped-grid>
   </template>
   <template id="FC-RQTVERSIONC"> 
   <fc-rqtversionc></fc-rqtversionc>
   </template>
   <fc-dashboard-one hidden id="focusedPrimeOne">
   </fc-dashboard-one> -->