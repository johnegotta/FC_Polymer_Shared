<dom-module id="fc-ddr-card">
 <template>
<style>
 :host{
          margin: 7px 8px 8px 8px;
          min-width: 42px;
          max-width: 1780px;
          min-height: 64px;
          max-height: 1300px;
          position: absolute;
          background: white;
          padding: 8px;
    
        }
     paper-header-panel {
    
        max-width: 1780px;
        min-width: 98%;
        max-height: 1280px;
        min-height: 52px;
        margin: 4px;
         position: relative; 
        border: 4px solid #efefef;
        @apply(--shadow-elevation-2dp);
      }
      .paper-header {
        height: 46px;
        font-size: 21px;
        line-height: 25px;
        padding: 4px;
        color: white;
        transition: height 0.2s;
        margin-bottom: 5px;
      }
   
      .content {
        max-height: 2500px;
        min-height: 64px;
        overflow-y: scroll;
        
   
      }
      .tiny{
        height: 42px;
        font-size: 16px;

      }
      .cover {
        margin: 2px;
      }
      .magenta .paper-header {
        background-color: magenta;
      }
      .darkBlue .paper-header {
        background-color: #008;

      }
      .blue .paper-header {
        background-color: var(--paper-light-blue-500);
      }
      .red .paper-header {
        background-color: var(--paper-red-500);
      }
      .orange .paper-header {
        background-color: var(--paper-amber-500);
      }
      .green .paper-header {
        background-color: var(--paper-green-500);
      }
      .cyan .paper-header {
        background-color: var(--paper-cyan-500);
      }
      .lime .paper-header {
        background-color: var(--paper-lime-500);
      }
      .pink .paper-header {
        background-color: var(--paper-pink-a200);
      }

		
</style>


<!-- on-track="_focusedDraggable" -->
  <paper-header-panel id="myPanel" drags="true" style$="height: [[currentHeight]]; width: [[currentWidth]];" id$="{{relId}}" class$="[[headClass]] [[verticalClass]] layout flex around-justified">
  <div class="paper-header layout horizontal center-justified"  on-track="_focusedDraggable" style$="text-align: center; height: [[computeHeadHeight(isMini, isPage, isColumn, isCard, isCounter, isPicker)]]">
  <iron-icon 
            icon="icons:highlight-off" 
            name="fc-dialog-closer"
            description="designed to close the dialog"
            class="menuItems-light"
            hidden="{{!isResizing}}"
            on-tap="falseClose"
            style$="position: absolute; z-index: 45; border-radius: 180px; background: [[_computeButtonBG(toggleColor)]]; width: 14px; height: 14px; border-shadow: 11px 4px 18px 7px #afafaf; right: 0px; top: 0px;"
          >
      </iron-icon>
<content select=".headerLeft">
</content>


     [[_computeHeader(headerTitle)]]
<content select=".headerRight">
        </content>


     </div>
  
        <div id="attachContent" class="content" style$="height: 100%; opacity: 1; z-index: 200; background: white;">
   <content id="cardContent" style="height: 100%;">




   </content>
   <content select=".daycard">
   </content>
  
          

           	
		</div>

      <span on-track="_resize" hidden="{{!isResizing}}" style="position: absolute; bottom: 0px; right: 0px; height: 8px; width: 8px; padding: 4px; border: 2px white solid; border-radius:180px; background: aqua;"></span>  
 </paper-header-panel>    
       
</template>
    <script>
    
FcDdrCard=Polymer({
	is:'fc-ddr-card',
	behaviors:[
     "Polymer.IronFitBehavior", 
      "Polymer.IronResizableBehavior",

    ],

	properties: {
    verticalClass:{
      type: String,
      value: "vertical",
      reflectToAttribute: true,
      notify: true
    },
    headClass:{
      type: String,
      value: "blue",
      notify: true,
      reflectToAttribute: true
    },
    toggleColor:{
      type: Boolean,
      value: true,
      notify: true
    },
    headerTitle:{
      type: String,
      notify: true,
      reflectToAttribute: true
    },
    // isDateCard:{
    //   type: Boolean,
    //   computed: "computeSize(headClass, widthCounter)",
    //   notify: true
    // },
    attachContent: {
      type: Array,
      value: [],
      reflectToAttribute: true,
      notify: true
    },
		drags:{
			type: Boolean, 
			value: false,
			notify: true,
      reflectToAttribute: true
		},
		isResizing: {
			type: Boolean,
			value: true, 
			notify: true,
      reflectToAttribute: true
		},
		isMini: {
			type: Boolean,
			value: function(){return false;},
			notify: true,
      reflectToAttribute: true
		},
		inputValue: {
				type: String,
				notify: true,
				reflectToAttribute: true
		},
    isColumn:{
        type: Boolean, 
        value: false,
        notify: true
    }, 
    isCard:{
        type: Boolean, 
        value: false,
        notify: true
    },
    isPage:{
      type: Boolean, 
        value: false,
        notify: true
    },
    dragCounter:{
      type: Number,
      value: 0,
      notify: true
    },
    isCounter:{
        type: Object,
        value: { counter: 0, size: "column"},
        notify: true
    },
		
    widthCounter:{
      type: Number,
      value: 0,
      notify: true
    },
  
      currentWidth: {
          type: String, 
          notify: true, 
          reflectToAttribute: true
      },
      currentHeight: {
          type: String, 
     	  value:function(){ return "480px";},
          notify: true, 
          reflectToAttribute: true
      },
      
      theId: {
      	type: String, 
      	notify: true,
      },
      id:{
      	type: String,
      	computed: "_computeId(theId, day)",
      	notify: true
      },
      dragCounter: {
        type: Number,
        value: 0,
        notify: true
      },
      dragCorrection: {
      	type:Number,
      	value: function(){return 0;},
      	notify: true
      }, 
      isPicker:{
        type: Boolean, 
        value: false, 
        notifyResize: true,
        reflectToAttribute: true
      }

    },
    ready: function(){
      
    },
     attached: function(){
   
       // this.startWidth();
       this.set("_notifyingDescendant", true);
           // this.startHeight();

    },

    _computeHeader: function(headerTitle){
      return headerTitle;
    },
    computeHeadHeight: function(isMini, isPage, isColumn, isCard, isCounter, isPicker)
    {
      var height = (isColumn==true)?"98px;": isMini==true? "20px; font-size: 16px; font-weight: 700;":isCard==true?"46px;":isPicker==true?"32px;": "39px";
      return height;
      
    },
   
     startWidth: function(){
           var wc = this.widthCounter;
           //console.log(this.widthCounter);
          if(this.widthCounter<10)
          {
            var parent =this.parentElement;
             var w = parent.offsetWidth;
             while(w==NaN && parent!=document.body)
             {
               parent = parent.parentNode;
               w=parent.offsetWidth;
               //console.log(w, parent, parent.offsetWidth);
             }
              if(parent==document.body)
                {
                  this.set("currentWidth", "25vw");
                }
              else
              {
                var wInt =Math.floor(parseInt(w)*.98);
                var wSet=wInt.toString()+"px";
                //console.log(wSet, "here in the start set", this);
                this.set("currentWidth", wSet);
              }
            
            // var nodes=Polymer.dom(this.$.cardContent).getDistributedNodes();
            // console.log("these are the nodes " + nodes +"here inbetween");
            wc++;
            this.set("widthCounter", wc);
          }
          else
          { 
            wc++;
            this.set("widthCounter", wc);
          }
        },
     startHeight: function(){
      var parent =this.parentNode;
     var ht = window.getComputedStyle(parent, null).getPropertyValue("height");
      ht=(parseInt(ht));
      if(parent==document.body || ht<400){this.set("currentHeight", "100%");}
       while(ht==NaN || parent!=document.body){
        parent=parent.parentNode;
      }

        ht = window.getComputedStyle(parent, null).getPropertyValue("height");
        //console.log(ht);
      if(parent==document.body){this.set("currentHeight", "100%");}
      else{
      var hInt =Math.floor(parseInt(ht)*.88);
      var hset=hInt.toString()+"px";
      this.set("currentHeight", hset);}
     },

    // resizeMe: function(){
    
    //    var resizer = this.parentNode;
    //    var w = parseInt(window.getComputedStyle(resizer, null).getPropertyValue("width"));
    //    while(w==NaN || resizer!=document.body){
    //     resizer=resizer.parentNode;
    //     w== parseInt(window.getComputedStyle(resizer, null).getPropertyValue("width"));

    //    } 
    //  //  console.log(resizer);
    //    var z = window.getComputedStyle(resizer, null).getPropertyValue("width");
    //    //console.log(z);
    //         var wn=Math.ceil(w*.98);
    //   var width=wn.toString() + "px";
    //   //console.log(width);
    //   if(typeof wn==NaN){this.set("currentWidth", "29vw"); console.log("set at a thirdLOOOK HERE PLEASE MMMMMMM");}
    //     else{
    //   this.set("currentWidth", width);
   
    //   }  
    // },

    onIronResize: function(){
      // this.resizeMe();
      // this.afterStartResize();
      // this.notifyResize();
    },
   
    _computeCurrentHeight: function(drags){
    	var ht="450px";
    	if(currentHeight==undefined) {return ht;}
    	else{ this._resize(e);
    	}
    },
    _computeId: function(theId, day){
    	//console.log(theId, day, day, day, day, theId);

    },
    computeSelected: function(selectionArray){
      return "[name=first]";
    },
    
    _computeRelId: function(day){
    	 var dayId	= day.replaceAll("\\s+","");
    	 //console.log(dayId, dayId, dayId, dayId);
    	 return dayId;
    },
    computeId:function(theId){
    	//console.log(theId, theId, theId, theId, theId, theId);
    },
    _resize: function(e){
          var self=this;
          e.preventDefault();
          if(this.isResizing==true){
          switch(e.detail.state) {
                case 'start':
                var theId=this.relId;
                var elem=this.$$(theId);
                var sWidth =window.getComputedStyle(self.$.myPanel, null).getPropertyValue("width");
                self.set("currentWidth", sWidth);
              
                 break;
                case 'track':
                  var newheight = parseInt(self.currentHeight) + e.detail.ddy;
                  var nwidth = parseInt(self.currentWidth) + e.detail.ddx;
                  var trueWidth = nwidth.toString()+'px';
                  var trueHeight = newheight.toString()+'px';
                  
           
                  self.set("currentWidth",trueWidth);
                  self.set("currentHeight",trueHeight);
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                
                  break;
                case 'end':
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                  // self.notifyResize();
                  self.onIronResize();
                 // self.afterStartResize();
                  Polymer.dom.flush();
                  break;
              }
            }
        },
    
       falseClose: function(){
        this.toggleColor=!this.toggleColor;
        if(this.toggleColor===false){
        this.set('currentHeight', "128px");
      }
        else{
          this.set('currentHeight', "480px");
            }

       },
       _computeButtonBG: function(toggleColor){
        var returnVal=(toggleColor==false)?"red;":"green;";
        return returnVal;

       },

  _focusedDraggable:function(e){
  	// console.log("we tried to drag");
  	 if(this.drags==true){
      Polymer.dom(this).setAttribute("style.position", "fixed");
        var self=this;
        e.preventDefault();
        //console.log(e, e.detail);
        switch(e.detail.state) {
          case 'start':
          if (this.dragCounter<1){
              //console.log('top distance differenced?' + e.detail.y);
              //console.log('left distance' + self._leftprime, e.detail.x);
              self.style.left=0;
              self.style.top=0;
            
              self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
         //console.log(self._leftprime);
            // self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
            self._topprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("top"))-e.detail.y-e.detail.y;
              //console.log(self._topprime);
              this.dragCounter++;
            }
            else{
              self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
         //console.log(self._leftprime);
              self._topprime =  self._topprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("top"))-e.detail.y;
            }
              // self.style.left=e.detail.x;
              // self.style.top=e.detail.y;
             
            
            //console.log('top distance differenced?' + self._topprime);
            // }
            self.changeX=0;
            self.changeY=0;
            Polymer.dom.flush();
            break;
          case 'track':
            self.changeX=e.detail.ddx + self.changeX;
            self.changeY=e.detail.ddy + self.changeY;
            self.translate3d(self.changeX.toString() + 'px', self.changeY.toString() + 'px', 0);
            break;
          case 'end':
            //console.log(self._topprime);
            self._right = parseInt(window.getComputedStyle(self, null).getPropertyValue("right"))
            self._bottom = self.getBoundingClientRect().bottom;
            self._x= ((self._leftprime+e.detail.x)>=0)?(self._leftprime+e.detail.x):e.detail.x;
            self._y=((self._topprime)+e.detail.y>=0)?(self._topprime+e.detail.y):e.detail.y;
            self.translate3d(0, 0, 0);

            //console.log("ENDING", self._x);
            self.style.left=self._x.toString()+'px';
            self.style.top=self._y.toString()+'px';
            //console.log('y: ' + e.detail.y);
            self.dragging=false;

            Polymer.dom.flush();
            break;
        }
      }
    }

});
</script>
</dom-module>