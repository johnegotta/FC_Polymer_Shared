
<dom-module id="fc-ddr-card">
 <template>
<style>
 :host{ @apply(--layout-fit);
     /*   min-width: 320px;
        resize: both;
        position: absolute;    */
        }
     paper-header-panel {
       min-width: 320px; 
        min-height: 52px;
        resize: both;
         position: absolute;
         background: white; 
        border: 4px solid #efefef;
        @apply(--shadow-elevation-2dp);
      }
      .paper-header {
        height: 46px;
        font-size: 21px;
        line-height: 25px;
        padding: 4px;
        color: white;
        transition: height 0.2s;
        margin-bottom: 5px;
      }
   
      .content {
        max-height: 2500px;
        min-height: 64px;
        overflow-y: scroll;
        
   
      }
      .tiny{
        height: 42px;
        font-size: 16px;

      }
      .cover {
        margin: 2px;
      }
      .magenta .paper-header {
        background-color: magenta;
      }
      .darkBlue .paper-header {
        background-color: #008;

      }
      .blue .paper-header {
        background-color: var(--paper-light-blue-500);
      }
      .red .paper-header {
        background-color: var(--paper-red-500);
      }
      .orange .paper-header {
        background-color: var(--paper-amber-500);
      }
      .green .paper-header {
        background-color: var(--paper-green-500);
      }
      .cyan .paper-header {
        background-color: var(--paper-cyan-500);
      }
      .lime .paper-header {
        background-color: var(--paper-lime-500);
      }
      .pink .paper-header {
        background-color: var(--paper-pink-a200);
      }

		
</style>

  
<!--  -->
  <paper-header-panel id="myPanel" on-pageshow="anotherResize" on-track="focusedDragMe" drags="true" style$="height: [[computePanelHeight(currentHeight)]]; width: [[computePanelWidth(currentWidth)]];" class$="[[headClass]] [[verticalClass]] layout flex around-justified" draggable>
  <div class="paper-header layout horizontal center-justified" style$="text-align: center; height: [[computeHeadHeight(isMini, isPage, isColumn, isCard, isCounter, isPicker)]]">
  <iron-icon 
            icon="icons:highlight-off" 
            name="fc-dialog-closer"
            description="designed to close the dialog"
            class="menuItems-light"
            hidden="{{!isResizing}}"
            on-tap="falseClose"
            style$="position: absolute; z-index: 45; background: [[_computeButtonBG(toggleColor)]]; width: 14px; height: 14px; border-shadow: 11px 4px 18px 7px #afafaf; right: 0px; top: 0px;"
          >
      </iron-icon>
      <section on-down="dragsOff" on-track="_resize" hidden="{{!isResizing}}"   on-up="dragsOn" style="position: absolute; right: -2px; top: 0px; bottom:0px; left: {{_computeCurrentWidthPlus(currentWidth)}}px; width: 12px!important;background: green;"></section>
<content select=".headerLeft">
</content>


     [[_computeHeader(headerTitle)]]
<content select=".headerRight">
        </content>


     </div>
  
        <div id="attachContent" class="content" style$="height: 100%; opacity: 1; z-index: 200; background: white;">
   <content id="cardContent" style="height: 100%;">




   </content>
   <content select=".daycard">
   </content>
  
          

           	
		</div>

    
 </paper-header-panel>    
      <section  on-down="dragsOff" on-track="_resize" hidden="{{!isResizing}}" style="position: absolute; bottom: -12px; right: 0px; top:{{computeCurrentHeight(currentHeight)}}px; left: 0px; height: 12px; width: 100%; background: green;" on-up="dragsOn"></section>     
</template>
    <script>
    
FcDdrCard=Polymer({
	is:'fc-ddr-card',
	behaviors:[
     "Polymer.IronFitBehavior", 
      "Polymer.IronResizableBehavior",
      "FCBehaviors.DraggableBehavior"

    ],
    listeners:{"on-pageshow": "anotherResize"},

	properties: {
 
    focusedPlanner: {
      type: Boolean, 
      value: false,
      notify: true
    },
    headClass:{
      type: String,
      value: "blue",
      notify: true,
      reflectToAttribute: true
    },
    toggleColor:{
      type: Boolean,
      value: true,
      notify: true
    },
    headerTitle:{
      type: String,
      notify: true,
      reflectToAttribute: true
    },

		drags:{
			type: Boolean, 
			value: false,
			notify: true,
      reflectToAttribute: true
		},
		isResizing: {
			type: Boolean,
			value: true, 
			notify: true,
      reflectToAttribute: true
		},

    dragCounter:{
      type: Number,
      value: 0,
      notify: true
    },
   
  
      currentWidth: {
          type: String, 
          notify: true,
          observer: "observeCurrentWidth",
          reflectToAttribute: true
      },
      currentHeight: {
          type: String, 
          notify: true, 
          observer: "observeCurrentHeight",
          reflectToAttribute: true
      },
  
      dragCounter: {
        type: Number,
        value: 0,
        notify: true
      },

    },
    anotherResize:function(){

      var nhe=parseFloat(this.currentHeight)+2;
      var nwi=parseFloat(this.currentWidth)+2;
      var showMe= this.set("currentHeight",nhe);
      this.set("currentWidth", nwi);

    },
    ready: function(){
      
    },
    observeCurrentHeight:function(newVal, oldVal){
      if(newVal && newVal!=oldVal){
        Polymer.dom.flush();
         console.log(newVal, newVal, oldVal,"new, new, old");
        var ht= Math.floor(parseFloat(newVal));//making sure no pxs or %s are sent in;
      console.log(ht, ht, ht, ht, ht, ht, "this value should set the height");
      Polymer.dom(this).setAttribute("style.height", ht+"px");
    }

    },
    computePanelWidth: function(measure){
      return Math.floor(parseFloat(measure)*.99).toString()+"px";
    },

    computePanelHeight:function(measure){  
    console.log(measure,measure,measure, this, this.style.height, "this should be the panel height") 
      return Math.floor(parseFloat(measure*.99)).toString()+"px";
    },

    observeCurrentWidth: function(newVal,oldVal){
      if(newVal && newVal!=oldVal){
        Polymer.dom.flush();
        console.log(newVal);
        var wt= Math.floor(parseFloat(newVal));//making sure no pxs or %s are sent in;
      Polymer.dom(this).setAttribute("style.width", wt+"px");
    }


    },
    
     attached: function(){
        var self=this;
      this.fire("mywidth", {mywidth: self, parent: self.parent});
      this.click();
      this.startWidth();
      this.startHeight();
    this.anotherResize();
      this.set("drags",true);
       // this.startWidth();
       this.set("_notifyingDescendant", true);

    },
    _computeCurrentWidthPlus: function(currentWidth){
      var retVal=parseFloat(currentWidth)-12;
      return retVal;

    },

    _computeHeader: function(headerTitle){
      return headerTitle;
    },
    computeHeadHeight: function(isMini, isPage, isColumn, isCard, isCounter, isPicker)
    {
      var height = (isColumn==true)?"98px;": isMini==true? "20px; font-size: 16px; font-weight: 700;":isCard==true?"46px;":isPicker==true?"32px;": "39px";
      return height;
      
    },
    computeCurrentHeight: function(currentHeight){
      var retHeight=parseFloat(this.currentHeight)-12;
      return retHeight;

    },
   
     startWidth: function(){
      var self=this;
      var dH=parseFloat(window.screen.width);
      console.log(dH);
      var dW=Math.floor(.45*dH).toString();
      this.set("currentHeight", dW);
        },
    startHeight: function(){
      var self=this;
      var dH=parseFloat(window.screen.height);
      console.log(dH);
      Math.floor(.95*dH).toString();
      this.set("currentHeight", dH);
      this.fire("mywidth", {mywidth: self, parent: self.parent});
     },
    onIronResize: function(){

      // this.resizeMe();
      // this.afterStartResize();
      // this.notifyResize();
    },
   
    _computeCurrentHeight: function(){
    	var ht=window.screen.height;
      ht=.98*(ht);
      ht=ht.toString()+"px";
    	if(this.currentHeight==undefined) {this.set("currentHeight", ht);}
    	
    	
    },
   
    _resize: function(e){
          var self=this;
          e.preventDefault();
          var width=Math.floor(parseFloat(window.screen.width)*.96);
          var height=Math.floor(parseFloat(window.screen.height)*.999);
          if(this.isResizing==true){
          switch(e.detail.state) {
                case 'start':
                var theId=this.relId;
                var elem=this.$$(theId);
                var sWidth =window.getComputedStyle(self.$.myPanel, null).getPropertyValue("width");
                self.set("currentWidth", sWidth);
              
                 break;
                case 'track':
                  var newheight = parseInt(self.currentHeight) + e.detail.ddy;
                  var nwidth = parseInt(self.currentWidth) + e.detail.ddx;
                  var nheight2=(newheight<240)?240:(newheight>height)?height: newheight;
                  var nwidth2=(nwidth<320)?320:(nwidth>width)? width:nwidth;
                  var trueWidth = nwidth2.toString()+'px';
                  var trueHeight = nheight2.toString()+'px';
                  
                  
                  self.set("currentWidth",trueWidth);
                  self.set("currentHeight",trueHeight);
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                
                  break;
                case 'end':
                  self.style.width= trueWidth;
                  self.style.height= trueHeight;
                  // self.notifyResize();
                  self.onIronResize();
                 // self.afterStartResize();
                  Polymer.dom.flush();
                  break;
              }
            }
        },
      
      dragsOff: function(){this.set("drags", false);},
    dragsOn: function(){this.async(this.dragSwitch, 50);},
    dragSwitch: function(){this.set("drags", true);},
    focusedDragMe:function(e){
        if(this.drags==true){
            var self=this;
            e.preventDefault();
            switch(e.detail.state)
            {
              case 'start':
                // console.log('START NoWayAreWe Draggin');
                self._leftprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("left"))-e.detail.x;
                self._topprime = parseInt(window.getComputedStyle(self, null).getPropertyValue("top"))-e.detail.y;
                console.log('top distance differenced?' + self._topprime);
               if(self.counter==0){   self.translate3d(0, 0, 0);}
                Polymer.dom(self).setAttribute("style.position", "fixed"); 
               Polymer.dom(self).setAttribute("style.left", "0px"); Polymer.dom(self).setAttribute("style.left",self._leftprime+"px");
               Polymer.dom(self).setAttribute("style.top", "0px"); Polymer.dom(self).setAttribute("style.top",self._topprime+"px");
                
                self.set("refit",true);
                self.changeX=0;
                self.changeY=0;
                Polymer.dom.flush();
                break;
              case 'track':
                self.changeX=e.detail.ddx + self.changeX;
                self.changeY=e.detail.ddy + self.changeY;
                self.translate3d(self.changeX.toString() + 'px', self.changeY.toString() + 'px', 0);
                break;
              case 'end':
                console.log(self._topprime);
                self._right = parseInt(window.getComputedStyle(self, null).getPropertyValue("right"))
                self._bottom = self.getBoundingClientRect().top;
                self._x= ((self._leftprime + e.detail.x)>=0)?(self._leftprime + e.detail.x): 0;
                self._y=((self._topprime + e.detail.y)>=0)?Math.ceil(self._topprime + e.detail.y):0;
            

                console.log("ENDING", self._x, e.detail.x, e.detail.y, e.detail.dx);
              
                self.style.left=self._x.toString()+'px';
                self.style.top=self._y.toString()+'px';
                Polymer.dom(self).setAttribute("style.top", e.detail.y+'px'); Polymer.dom(self).setAttribute("style.left",e.detail.x+'px');
          self.translate3d(0, 0, 0);

                console.log('y: ' + e.detail.y);
                    
                self.dragging=false;
                self.set("refit",true);
                Polymer.dom.flush();
                break;
            }
        }
    },
       falseClose: function(){
        this.toggleColor=!this.toggleColor;
        if(this.toggleColor===false){
        this.set('currentHeight', "128px");
      }
        else{
          this.set('currentHeight', "480px");
            }

       },
       _computeButtonBG: function(toggleColor){
        var returnVal=(toggleColor==false)?"red;":"green;";
        return returnVal;

       },

 
});
</script>
</dom-module>