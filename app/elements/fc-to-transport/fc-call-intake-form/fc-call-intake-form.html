<dom-module id="fc-call-intake-form">
	<style>
  :host{
    position: relative;
    max-height: 2200px;
    min-width: 360px;
    overflow-y: scroll;
  }
  paper-card, paper-card.form {
    padding: 16px;
  	border: 4px double #008;
  	margin: auto;
    max-height:2200px;
    overflow-y: scroll;
    outline: 8px solid #aecefe;
 --paper-card-header: {
    border-bottom: 4px solid #efefef;

        @apply(--layout-horizontal);
        @apply(--layout-flex);
        @apply(--around-justified);
    };
    --paper-card-header-image: {
        width: 127px;
        height: 48.6px;
        padding: 12px;
        margin: 12px;
        position: relative: 
    };
   
    --paper-card-header-text: {
      color: #008;
      margin-right: 50px;
      line-height: 1;
      font-size: 28px;
      font-weight: 600;
      @apply(--layout-vertical);
        @apply(--layout-center);
    };


@apply(--paper-card);
@apply(--paper-card-header-text);
@apply(--paper-card-header-image);
}

  .headSeparator{
                  width: 100%;
                  background: #006;
                  border-top: 4px solid #006; 
                  border-bottom: 6px solid #c6dafc;
                  height: 4px;
                            }
	</style>
	<template>
<paper-dialog id="searchConfirm" style="min-width: 320px; max-width: 600px; min-height: 320px; max-height: 600px;" no-cancel-on-outside-click>
        <paper-button> Confirm Is Previous Caller</paper-button>
         <fc-input-prime name="callerRole" class="horizontal flex layout wrap" input-type="select" id="callerRole" option-one="Select a Role" option-two="parent1" option-three="student" option-four="parent2" option-five="other" value="{{callerRoleSelected}}" label="Caller Role"></fc-input-prime>


         <fc-input-prime label="{{callerRoleSelected}} First Name" on-keyup="_sendInputChanged" hidden="[[_searchHidden(callerRoleSelected)]]" name="{{callerRoleSelected}}FirstName"></fc-input-prime>
         <fc-input-prime label="{{callerRoleSelected}} Last Name" on-keyup="_sendInputChanged" hidden="[[_searchHidden(callerRoleSelected)]]" name="{{callerRoleSelected}}LastName"></fc-input-prime>

         <paper-button on-tap="selectStudent"></paper-button>

         <paper-button dismiss-dialog>dismiss</paper-button>
  </paper-dialog>


 <paper-card 
    heading="Focused Call Intake Form" 
    image="../../../images/FC_frontpage_logo.png" 
    style="border-bottom: 6px edged gold; overflow-y: scroll;  padding: auto;" 
    elevation="5" 
    class="form vertical flex wrap layout" 
    animated-shadow="true">
 <form is="iron-form" class="form" id="formGet" method="get" action="/">
 <paper-material elevation="4" style="background: #dadada; box-shadow: 3px 7px 11px 4px #9a9a9a;" class="vertical layout">
 <paper-material class="headSeparator" style="margin-bottom: 6px;"></paper-material>
    <section class="horizontal layout flex wrap"
      style="max-height: 25px; margin-left: 4px; color: brown; font-size:18px;  border-bottom: solid brown 1px; margin-bottom: 8px;">
      Timestamp & Callback Time 
    </section>
    <section class="horizontal layout flex wrap">
      <section class="horizontal layout flex wrap"> 
        <fc-input-prime input-type="datetime-local" class="horizontal flex layout wrap" name="timeStamp" id="callTimestamp" is-time-stamp="true"  readonly="true" label='Timestamp'>
        </fc-input-prime>
        <fc-input-prime id='callbacktime' class="horizontal layout flex wrap" name='callbackTime' tab-index='0' label='Scheduled Callback'  value='{{callbackTime}}' input-type="datetime-local" is-callback="true" on-input="updateInput">
         </fc-input-prime>
      </section>
    </section> 
  </div>
  <div class="vertical layout wrap">
    <section 
      style="max-height: 25px; margin-left: 4px; color: brown; font-size:18px;  border-bottom: solid brown 1px; margin-bottom: 8px;">
      Caller Classification 
    </section>  
    <span style="color:green; font-size: 16px; margin: 4px;"> Is this a Previous Caller?</span>
    <section class="horizontal layout">
      <section class="horizontal layout flex wrap">  
        <fc-input-prime 
          input-type="checkbox" 
          style="margin-top: -6px;"
          label="Yes. This is a previous caller." 
          name="isPreviousCaller"
          checked-prop="{{isPreviousCaller}}">
        </fc-input-prime>
        <fc-input-prime 
          input-type="checkbox"
          style="margin-top: -6px;" 
          label="No. This is a New Caller" 
          name="isNewCaller" 
          checked-prop="{{!isPreviousCaller}}">
        </fc-input-prime>
      </section>
      <section class="horizontal layout flex wrap">
       <fc-input-prime id='login' class="horizontal layout flex" name='intakeFcid' label='Your Login'  value='{{yourLogin}}' on-input="updateInput">
        </fc-input-prime>
         <!-- on-tap="{{_selectProfile(fcProfile)}}"  -->
      </section>
    </section>
    </div>
      <paper-material class="headSeparator" style="margin-top: 6px;"></paper-material>
  </paper-material> 
  
<content class="horizontal layout center-justified">
</content>
      <div class="card-actions horizontal layout container center-justified">
          <paper-button 
            raised
            on-tap="submitHandler" 
            class="flex layout self-stretch">
            Record and Continue
            </paper-button>
         <content select="paper-button"></content>
         <paper-button raised class="flex layout self-stretch" on-tap="resetHandler"> clear 3</paper-button>
        </div>
</form>
</paper-card>


	</template>
	<script>
		'use strict';
		(function() {
			class FCCallIntakeForm {
				get behaviors() {
					return [Polymer.IronResizableBehavior
					//add databehavior?
					];
				}
				beforeRegister() {
					this.is ="fc-call-intake-form";
					this.listeners = {
            "radio-checked-changed": "handleRadioChecked", "onclick": "display"};
					this.observers={};
					this.properties = {
            formSubmitOne:{
              type: Boolean,
              value: false,
              notify: true,
              reflectToAttribute: true
            },
            isPreviousCaller:{
              type: Boolean,
              value: false,
              observer: "isPreviousCallerNow",
              notify: true,
              reflectToAttribute: true
            },
            generalCategory: {
              type: Object, 
              value: {},
              notify: true, 
              reflectToAttribute: true
            },
            callerRoleSelected:{
              type: String,
              observer: "_whoIsTheCaller",
              notify: true,
              reflectToAttribute: true
            },
            searchValues:{
              type: Object,
              value: {},
              notify: true,
              reflectToAttribute: true
            },
            focusedStudent: {
              type: Object,
              notify: true
            }, 
            selectedFocusedStudent:{
              type: Object,
              computed:"computePreviousFocusedStudent(searchValues, focusedStudent)",
              notify: true, 
              reflectToAttribute: true

            }
            
					}; //end properties
			}
           ready(){

        }
        attached(){

        }
        isPreviousCallerNow(newval, oldval)
          { 
            console.log(oldval, newval);
            alert(oldval);
            if(newval==true){this.opendialog();} 
          }

        computePreviousFocusedStudent(searchValues, focusedStudent)
        {

          console.log(focusedStudent,"this is the search val: ", searchValues);

        }

        opendialog()
        {
          this.$.searchConfirm.open();
        }

        _searchHidden(callerRoleSelected)
        {
          if(callerRoleSelected!=null){return false;}
          else return true;




        }

        selectStudent(){




        }

        _sendInputChanged(e, detail){
    
          var target=e.target;
          while(target.nodeName!=="FC-INPUT-PRIME")
          {
              console.log(target.nodeName, e.target.value);
              target=target.parentNode;
          }
          var name=target.name;
          this.fire("sendInputVal", {value: e.target.value, name: name});
          this.searchValues[name]=e.target.value;
        }

        _whoIsTheCaller(newVal, oldVal)
        {
          if(newVal=="parent1")
          {
               console.log(oldVal, newVal);
          }
          else if(newVal=="student")
          {


               console.log(oldVal, newVal);

          }
          else if(newVal=="parent2")
          {

            console.log(oldVal, newVal);

          }
          else if(newVal=="other")
          {

            console.log(oldVal, newVal);

          }
          else
          {
            console.log(oldVal, newVal);


          }


        }

       submitHandler(event){
        this.set("formSubmitOne", true);
          var formResults = this.$.formGet.serialize();
          console.log(formResults, formResults.isClosed, formResults.isClosed);
            var d = new Date();
            var n = -d.getTime();
            console.log(n);
            // var profile = new FcStudentProfile();
            // profile=Object.assign(profile, formResults);
           var profile = new FcStudentProfile(formResults);
         var pacademics = new FcPastAcademics(formResults, profile.fcid);
            // var saveObj=inquiry.getFanout();
          var ref = new Firebase("https://focused0ne.firebaseio.com"); 
            //inquiry.fcSave(ref);
            var callerRole = this.callerRoleSelected;
            ref.child("students/" + profile.fcid).update(profile);
            ref.child("students/" + pacademics.fcid + "/pastacademics").update(pacademics);
              var inquiry = new FcInquiry(formResults, callerRole, profile);
             
              console.log(this.callerRoleSelected);
               inquiry.fcSave(ref);
            ref.onAuth(function(authdata){alert(authdata.uid);});


          console.log(formResults);

        }
        handleRadioChecked(event){
          event.stopPropagation();
          var generator = this.queryEffectiveChildren('fc-input-set-generator');
          var inputs = generator.querySelectorAll('fc-input-prime[input-name=' + event.detail.name + ']');
          var labels = generator.querySelectorAll('label');
          console.log("In handleRadioChecked", labels);
          for(var i=0; i < inputs.length; i++){
            if(inputs[i].inputId !== event.detail.id){
              inputs[i].checkedProp = false;
              inputs[i].classList.remove('wrapper-checkbox-checked');
            } else {
              inputs[i].checkedProp = true;
              inputs[i].classList.add('wrapper-checkbox-checked');
            }
          }
        }
      
        display(event) {
          var output = document.getElementById('output');
            output.innerHTML = JSON.stringify(event.detail);
        }

    
        resetHandler(event) {
          Polymer.dom(event).localTarget.parentElement.myData=null;
          Polymer.dom(event).localTarget.parentElement.myData=Polymer.dom(event).localTarget.parentElement.myDataTwo;
          this.set("formResults", null);
        }

			}//end of Class
			Polymer(FCCallIntakeForm);
		})();
	</script>
</dom-module>
