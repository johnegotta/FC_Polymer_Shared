<dom-module id="fc-grid">
<template>
<style is="custom-style">
.grid-box{
  width: 340px;
  height: 480px;
  padding: 3px;
  margin: 3px;
  display: block;
  color: black;
  background: white;
  overflow-x: hidden;
}

.grid-image{
    float: left;
    padding: 3px;
    height: 72px;
    color: black;
    width: 73px;
    background: aliceblue;
    display: block;

}
.grid-holder{
  width: calc(95%-85px);
  max-height: calc(98vh-64px);
  overflow: scroll;
}

</style>
<firebase-document id="ModelClass" location="focusedstudents.firebaseio.com/ModelClass" data="{{ModelClass}}" on-firebase-child-added="showTime"></firebase-document>
<!-- <firebase-collection id='scores' location="{{firebasepath}}" _on-query-value="_getScores" order-by-child='fcid' equal-to='{{this.fcid}}' log="true" on-firebase-child-added="_scoreGetter" data='{{score}}'></firebase-collection> -->
<!--<firebase-document id="testresultsz" location="https://focusedstaging1.firebaseio.com/students/agjaga1234/test_results" data="{{testresults}}" on-firebase-changed="showTime2"></firebase-document>-->
  <firebase-collection id='contactinfo' location="https://focusedstudents.firebaseio.com/contactinfo" order-by-child='fcid' equal-to=[[this.scores.scorekey]] data='{{grids}}'></firebase-collection>
  <div class="vertical layout wrap grid-holder">
    <paper-input id="searcher" label="Search" value="{{searchString}}" placeholder="Search Grid...">
    </paper-input>
    <div class="horizontal layout wrap">    
      <template is="dom-repeat" items="{{grids}}" filter="{{doFilter(searchString)}}">
        <paper-material elevation="2" class="grid-box">
        <fc-tabbed-card fcid="{{item.fcid}}" firebasepath="https://focusedstudents.firebaseio.com/courseresults">
        </fc-tabbed-card>
        <paper-tabs id="studenttabs" selected="{{selected}}" style="line-height:.6; background: #aecdfe;" scrollable>
              <paper-tab>Profile</paper-tab>
              <paper-tab>Scores</paper-tab>
              <paper-tab>Account</paper-tab>
              <paper-tab>ROI</paper-tab>
              <paper-tab>Academics</paper-tab>
              <paper-tab>Inquiries</paper-tab>
            </paper-tabs>
        <hr>
        <div class="vertical layout wrap" style="height: 78px;"> 
            <div class="grid-image">
            <img src="{{item.photo}}" height="72px" width="73px">
            </div>

          <div class="horizontal layout wrap" style="width: 210px; height: 78px; overflow-y: scroll;"> 
              <b><span>{{item.firstname}}</span>&nbsp <span>{{item.lastname}}</span></b> &nbsp
              <b>FCID</b>:<i><u><span>[[item.fcid]]</span></u></i>&nbsp
              <b>Phone</b>:<span>[[item.phone]]</span>&nbsp
              <b>Email</b>:<span>[[item.email]]</span>&nbsp
              <b>S-email</b>:<span>[[item.studentemail]]</span>
              &nbsp<span>[[item.school]]</span>
          </div>
        </div>
        <hr>
  
          <template is="dom-repeat" data="{{score}}" as="item">
            <div class="horizontal row wrap layout" style="overflow-y: scroll; padding: 3px">
                 <span>pretest: <span>[[potato.scoresPreTest]]</span></span><br>
                <span>Test 1: <span>[[potato.scoresTest1]]</span></span><br>
                 <span>T2: <span>[[potato.scoresTest2]]</span></span><br>
                 <span>T3: <span>[[potato.scoresTest3]]</span></span><br>
                 <span>T4: <span>[[potato.scoresTest4]]</span></span><br>
                 <span>T5: <span>[[potato.scoresTest5]]</span></span><br>
                 <span>T6: <span>[[potato.scoresTest6]]</span></span><br>
                <span>REAL SAT: <span>[[potato.realSAT]]</span></span><br>
                 <span>pretest: <span>[[potato.scoresPreTest]]</span></span><br>
            </div>
            </template>
          </paper-material>
        </template>

<!--      <template is="dom-repeat" items="{{griditemArray}}">
        <fc-cell-creator draggable="true" holder='{{holder}}' input='{{item.name}}' fclabel='[[index]]'></fc-cell-creator>
      </template>
      -->
      
    </div>
  </div>
    
</template>
<script>
Polymer({
  is:"fc-grid",
  properties: {
    defaultPath: "",
    pathOne: String, 
    pathTwo: String, 
    gridWidthPx: Number, 
    gridHeightPx: Number,
    scrollX: Boolean,
    scrollY: Boolean,
    isDnD: Boolean,
    fillViewPort: Boolean,
    gridImageOne: String,
    gridImageTwo: String,
    griditemnumber: {
        type: Number,
        notify: true,
        reflectToAttributes: true
      },
    griditemArray: {
      value: Array,
      notify: true,
      reflectToAttributes: true
    },
    fcids: {
      type: Array,
      notify: true,
      value: [],
      reflectToAttributes: true
    },
    scores: {
      type: Array,
      value: [],
      notify: true,
      reflectToAttributes: true
      },
    gridImageOne: '',
    gridImageTwo: '',
    searchString: {
      type: String,
      observer: 'filterGridContent'
    },
    reflectToAttributes: true,
    notify: true
  },
created: function (){
  
},
  updateFilter: function(argObj){
    console.log(argObj);
    this.searchString = argObj.firstname;

  },

  doFilter: function(e){
    console.log(e);
    return function(argItem){
      //console.log(argItem.fcid);
      //console.log(e);
      var fcid = argItem.fcid.toLowerCase();
      var search = e.toLowerCase();
      return (fcid.indexOf(search) > -1) //argItem.fcid == "GanaMary00001" || argItem.fcid == "StreelandAnna00001");
    };
  },

  filterGridContent: function(e)
  {
    //console.log(e.target.value);
    console.log(e);
    /*
    this.$.searcher.filter = function(e){
      return false;
    };
    */
  },

  showTime: function(e){
        var path = this.pathThree;
        console.log(path + " this is the additive path");
        var fcid = e.detail.childSnapshot.key();
        console.log(fcid);
        this.fcid=fcid;
        var firebasepath= this.pathThree + this.fcid;
        console.log(firebasepath);
        this.firebasepath = firebasepath;
        var ref = new Firebase("#!" + firebasepath);
        ref.orderByKey().startAt("real").endAt("scores\uf8ff").on("child_added", function(snapshot) {
        if(snapshot.exists() == false){
          var liToAddTwo = document.createElement('li');
            var showerTwo = document.getElementById('showIndicesTwo');
           console.log(fcid + ' and fcid ' + fcid);
            liToAddTwo.innerHTML = this.fcid + " " + "Did not take Test!!!";
            Polymer.dom(showerTwo).appendChild(liToAddTwo);
        }
        else if (snapshot.val()!== null) {
          var liToAdd = document.createElement('li');
          var shower = document.getElementById('showIndices');
          console.log(fcid + " just got scores");
          //here we can set local object arrays, or object objects
        liToAdd.innerHTML = fcid + " " + snapshot.key() +": " + snapshot.val();
           Polymer.dom(shower).appendChild(liToAdd);
           this.fcid = fcid;
        }
        //I dont get why nothing happens in this else? save that since there is no snapshot there is no function and the game ends there.
        
        });
    },

ready: function(){
  var mql = window.matchMedia("screen and (min-width: 601px) and (max-width: 800px");
  var mqlone = window.matchMedia("screen and (min-width: 801px) and (max-width: 1200px");
  var mgltwo = window.matchMedia("screen and (min-width: 1201px) and (max-width: 1600px");
  var mglthree = window.matchMedia("screen and (min-width: 1601px) and (max-width: 1900px");
  var mglfour = window.matchMedia("screen and (min-width: 1901px)");
  if (mglfour.matches){ // if media query matches
      this.gridWidthPx= 1400 + 'px';
      this.gridHeightPx= 1200 +'px';
      var numbcols = Math.round(1400/115);
      var numbrows = Math.round(1200/54);
      var total = numbcols*numbrows;
      var counter = 0; 
      for(counter=0; counter < total; counter++){
        //this.griditemArray[counter] = {'name': counter};
        this.griditemArray[counter].name = "the value of name " + counter;
        this.push('griditemArray', {name: "the value of name " + counter});
        console.log("this is the grid item counter in the grid element at ready " + JSON.stringify(this.griditemArray[counter]));
        console.log("this is the grid item name in the grid element at ready " + this.griditemArray[counter].name);
        this.griditemnumber=this.griditemArray[counter].name;
        console.log("this is the grid number at ready in the grid " + this.griditemnumber);
      }
    }
  else {
      this.gridWidthPx = 770 + 'px';
      this.gridHeightPx = 1200 + 'px';
      var numbcols = Math.round(800/115);
      var numbrows = Math.round(1200/54);
      var total = numbcols*numbrows;
      var counter = 0; 
      for(counter=0; counter < total; counter++){
        //this.griditemArray[counter] = {'name': counter};
        this.griditemArray[counter].name = "the value of name " + counter;
        this.push('griditemArray', {name: "the value of name " + counter});
        console.log("this is the grid item counter in the grid element at ready " + JSON.stringify(this.griditemArray[counter]));
        console.log("this is the grid item name in the grid element at ready " + this.griditemArray[counter].name);
        this.griditemnumber=this.griditemArray[counter].name;
        console.log("this is the grid number at ready in the grid " + this.griditemnumber);
      }
    }

},

attached: function (){
   
 
},

handleDragStart: function(e) {
      e.dataTransfer.setData("fcdata", JSON.stringify(e.model.item));
      console.log("drag begun for ");
      console.log(e.model.item);
    }, 

allowDrop: function (e) {
      e.preventDefault();
      console.log("drag over");
    },


});
</script>
</dom-module>