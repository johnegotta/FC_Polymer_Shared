<dom-module id="fc-grid">
	<template>
		<style is="custom-style">
			.grid-box{
			   width: 340px;
			   height: 480px;
			   padding: 3px;
			   margin: 3px;
			   display: block;
			   color: black;
			   background: white;
			   overflow-x: hidden;
			 }
			.grid-image{
				float: left;
				padding: 3px;
				height: 72px;
				color: black;
				width: 73px;
				background: aliceblue;
				display: block;
			}
			.grid-holder{
			   width: calc(95%-85px);
			   max-height: calc(98vh-64px);
			   overflow: scroll;
			   margin: 16px;
			}
		</style>
		<firebase-collection id="FBscoreTwo" order-by-child="student" data='{{items}}' location='https://focusedstaging1.firebaseio.com/test_results'></firebase-collection>
		<div class="vertical layout wrap grid-holder center center-justified">
		    <div class="horizontal layout"> 
				<paper-input id="searcher" label="Search" value="{{searchString}}" placeholder="Search Grid...">
				</paper-input>
				<paper-button on-tap="__assign">Assign New Positions
				</paper-button>
			</div>
			 	
						<template is="dom-repeat" items="{{superGridItemHolderArray}}" filter="{{doFilter(searchString)}}">
						<paper-material elevation="3"><span>[[index]]</span><span>[[item.key]]</span>
							</paper-material>
				  		</template>
		</div>
<!--SHOULD BE PART OF THE ASSISTANT OR AN ASSISANT LIKE FUNCTION OR ITS OWN ELEMENT
		NEW ELEMENT. NEW ELEMENT. ASSISTANT FEATURE???  NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE??? NEW ELEMENT. ASSISTANT FEATURE???
		-->
	<paper-dialog id="tada" no-cancel-on-outside-click="true">
		<div id="betterTada" style="min-height: 120px; min-width: 280px">
			<ul id="superTada">
		
			</ul>
		</div>
		<div class="buttons" style="height: 65px; padding: 8px 8px 8px 14px;" class="horizontal layout left-justified">
			<paper-button on-tap="conttap">Confirm Save</paper-button>
			<paper-button on-tap="back">Revert Array</paper-button>
			<paper-button dialog-dismiss on-tap="__clear">Continue Working</paper-button>
		</div>
	</paper-dialog>
</template>
<script>
Polymer({
  is:"fc-grid",
  properties: {
    defaultPath: "https://focusedstaging1.firebaseio.com/test_results",
    pathOne: "https://focusedstaging1.firebaseio.com/test_results", 
    pathTwo: String, 
    gridWidthPx: Number, 
    gridHeightPx: Number,
    scrollX: Boolean,
    scrollY: Boolean,
    isDnD: Boolean,
    fillViewPort: Boolean,
    gridImageOne: String,
    gridImageTwo: String,
    griditemNumber: {
	   type: Number,
	   notify: true,
	   reflectToAttributes: true
	 },
    griditemArray: {
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    superGridItemHolderArray: {
	 value: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    gridRows: {
	 type: Array,
	 notify: true,
	 reflectToAttributes: true
    },
    superOrderArray: {
	 type: Array,
	 value: [],
	 notify: true,
	 reflectToAttributes: true
	 },
    gridImageOne: '',
    gridImageTwo: '',
    searchString: {
	 type: String,
    },
      fcid: {
		 type: Array,
		 value: [],
		 notify: true,
		 reflectToAttributes: true
	 },
    currentDragger: Object,
    reflectToAttributes: true,
    notify: true

   },

  updateFilter: function(argObj){
    console.log(argObj);
    this.searchString = argObj.name;
  },

  doFilter: function(e){
    return function(argItem){
	 var itemname = argItem.name;
	 var search = e.toLowerCase();
	 return (itemname.indexOf(search) > -1) 
    };
  },
  
ready: function(){
	var theSet = this.$.FBscoreTwo.data;
	console.log(theSet);
	var mql = window.matchMedia("screen and (min-width: 601px) and (max-width: 800px");
	var mqlone = window.matchMedia("screen and (min-width: 801px) and (max-width: 1200px");
	var mgltwo = window.matchMedia("screen and (min-width: 1201px) and (max-width: 1600px");
	var mglthree = window.matchMedia("screen and (min-width: 1601px) and (max-width: 1900px");
	var mglfour = window.matchMedia("screen and (min-width: 1901px)");
	  	if (mglfour.matches){ // if media query matches
	 	this.gridWidthPx= 1940 + 'px';
	 	this.gridHeightPx= 1480 +'px';
	 	var numbcols = Math.round(1920/430);
	 	var numbrows = Math.round(1480/710);
	 	var limit = Math.round(numbcols*numbrows);
	 	console.log(limit);
	     var counter = 0;
	     for(counter=0; counter<limit ;counter++){
					this.push('superGridItemHolderArray', {key: counter});
		   		
		   			}
		   		}
    			
    	
  else {
	 this.gridWidthPx = 770 + 'px';
	 this.gridHeightPx = 1200 + 'px';
	 var numbcols = Math.round(320/160);
	 var numbrows = Math.round(480/96);
	 var total = Math.round(numbcols*numbrows);
	 var counter = 0; 
	 for(counter=0; counter < total; counter++){
	   //this.griditemArray[counter] = {'name': counter};
	   
	   this.push('superGridItemArray', {key: counter});
	   //console.log("this is the grid item counter in the grid element at ready " + JSON.stringify(this.griditemArray[counter]));
	   //console.log("this is the grid item name in the grid element at ready " + this.griditemArray[counter].name);
	   console.log("this is the grid number at ready in the grid " + this.superGridItemNumber);
	 }
    }
},

attached: function(){
	var theSet = this.$.FBscoreTWO.data;
	console.log(theSet);
},

handleDragStart: function(e) {
	 e.dataTransfer.setData("fcdata", JSON.stringify(e.model.item));
	 //console.log("drag begun for ");
	 //console.log(e.model.item);
	 var cell = e.target;
	 console.log(e.target);
	 while(cell.nodeName != "FC-CELL-CREATOR")
	 {
	   //console.log(cell);
	   cell = cell.parentNode;
	 }
	 this.currentDragger = cell;
    }, 
allowDrop: function (e) {
	 e.preventDefault();
	 //console.log("drag over");
    },
handleDrop: function(e)
  {
    //console.log(e.model.item);
    //console.log(e);
    var cell = e.target;
    var i = 0;
    while(cell.nodeName != "FC-CELL-CREATOR")
    {
	 cell = cell.parentNode;
	  console.log("in loop" + cell);
    }
    console.log(cell);
    //console.log("just droppped " + e.target + " on " + e.model.item.name);
    
    var temp = cell.input;
    var dataObj = JSON.parse(e.dataTransfer.getData("fcdata"));
    cell.input = dataObj.name;
    //console.log(this.currentDragger);
    this.currentDragger.input = temp;
    

  }, 

  __assign: function(){
    var i=0;
    for(i=0; i < this.griditemArray.length; i++){
    var namenow = this.griditemArray[i].name;
    console.log(i + " is the index number of " + namenow);
    var tadatwo = this.$.superTada;
    var tadathree = document.createElement("li");
    Polymer.dom(tadathree).innerHTML = "Index position " + i + " now is set to " + namenow + ". ";
    Polymer.dom(tadatwo).appendChild(tadathree);
    };
    this.$.tada.open();
  },

  __clear: function(){
    var myList  = this.$.superTada;
    Polymer.dom(myList).innerHTML = '';
    console.log(myList);
  }
});
</script>
</dom-module>