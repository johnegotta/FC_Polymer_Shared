<dom-module id="fc-general-card">
  <template>
    <style>
    paper-header-panel {
      height: 600px;
      width: 400px;
      overflow-y: scroll;
      border: 1px solid black;
    }
    .inputEnabler {
      padding: 10px;
    }
    #mainCardContentTabbedInfo {
      height: 400px;
      border: 1px dashed red;
    }
    </style>
    <!--<firebase-document id="desiredLoc" location="{{cardTopLevelRoute}}" on-firebase-child-added="createCardData"></firebase-document>-->
    <paper-header-panel id="fullCard">
      <paper-toolbar id="fullCardHeader">
        <paper-tabs id="fullCardHeaderTabs" selected="{{selectedTab}}">
        </paper-tabs>
      </paper-toolbar>
      <div id="mainCardContent">
        <div id="mainCardContentTopInfo" class="horizontal layout wrap">
        </div>
        <div id="mainCardContentTabbedInfo">
          <iron-pages id="mainCardContentTabbedInfoPages" selected="{{selectedTab}}">
          <iron-pages>
        </div>
      </div>
    </paper-header-panel>
  </template>
  <script>
    Polymer({
      is: "fc-general-card",
      properties: {
        firebaseUrl: {
          type: String,
          value: "focusedstaging1.firebaseio.com"
        },
        cardTopLevel: {
          type: String,
          value: "",
        },
        cardTopLevelRoute: {
          type: String,
          computed: "computeFullRoute(firebaseUrl,cardTopLevel)"
        }
      },
      ready: function(){
        this.createCardData();
      },
      computeFullRoute: function(first_part,second_part){
        return first_part + "/" + second_part;
      },
      factoryImpl: function(argCardTopLevel){
        this.cardTopLevel = argCardTopLevel;
      },
      enableInput: function(e) {
        console.log(e);
      },
      createCardData: function(){
        var self = this;
        var ref = new Firebase(self.firebaseUrl);
        ref.child(self.cardTopLevel).on("value", function(snap){
          Polymer.dom(self.$.mainCardContentTopInfo).innerHTML = '';
          Polymer.dom(self.$.fullCardHeaderTabs).innerHTML = '';
          var snapKey = snap.key();
          var snapObject = snap.val();
          //var snapRoute = ref.toString() + self.cardTopLevel;
          for (var subKey in snapObject){
            //console.log(typeof snapObject[subKey]);
            switch (typeof snapObject[subKey]){
              case "string" :
                var newDisabledInputContainerDiv = document.createElement("div");
                var newDisabledInput = document.createElement("paper-input");
                newDisabledInput.id = self.cardTopLevelRoute + "/" + subKey + "_input";
                newDisabledInput.setAttribute("data-location",self.cardTopLevelRoute + "/" + subKey);
                newDisabledInput.disabled = true;
                newDisabledInput.label = subKey;
                newDisabledInput.placeholder = snapObject[subKey];
                newDisabledInputContainerDiv.classList.add("inputEnabler");
                newDisabledInputContainerDiv.setAttribute("ondblclick","enableInput");
                newDisabledInputContainerDiv.appendChild(newDisabledInput);
                //var mainCardContentTopInfo = document.getElementById('mainCardContentTopInfo');
                //console.log(Polymer.dom(self.$.mainCardContentTopInfo));
                Polymer.dom(self.$.mainCardContentTopInfo).appendChild(newDisabledInputContainerDiv);
                break;
              case "object" :
                var newCardTab = document.createElement("paper-tab");
                newCardTab.innerHTML = subKey;
                Polymer.dom(self.$.fullCardHeaderTabs).appendChild(newCardTab);

                var pageToAdd = document.createElement("div");
                var pageToAddUL = document.createElement("ul");
                var objToGetMoreOf = snapObject[subKey];
                for (var lowerKey in objToGetMoreOf){
                  var lowerRoute = subKey + "/" + lowerKey;
                  ref.child(lowerRoute).once("value", function(lowerSnap){
                    var newLiToAdd = document.createElement("li");
                    console.log(lowerSnap.key());
                    newLiToAdd.innerHTML = JSON.stringify(lowerSnap.val());
                    pageToAddUL.appendChild(newLiToAdd);
                  });
                }
                pageToAdd.appendChild(pageToAddUL);
                Polymer.dom(self.$.mainCardContentTabbedInfoPages).appendChild(pageToAdd);
                //self.headerTabs.push(subKey);
                break;
            }
          }
        });
      }
    });
  </script>
</dom-module>