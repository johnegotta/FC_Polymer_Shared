<dom-module id="fc-single-column-display-delta">
<template>
<style>
:host{min-height: 1900px;
	display: flex;}
div.line-number {
			width: 28px;
			line-height: 1.2;
			font-size: 14pt;
			font-size: 1.25em;
			font-family: merriweather;
			font-weight: 500;
			font-style: italic;
			padding: 6px 0px 6px 0px;
			margin: 6px 0px 6px 0px;
			
		}
		div.columnContainer{
			overflow-y: scroll;
		}
		
		.highlighted {
			background: yellow;
		}
		
		div.text {
			line-height: 1.2;
			font-size: 14pt;
			font-size: 1.25em;
			font-family: merriweather;
			font-weight: 500;
			padding: 6px;
			margin: 6px 0px 6px 0px;
			min-height: 720px !important;
			display: flex;
			min-width: 260px !important;
			max-width: 660px !important;	
		}
</style>
<div class="layout horizontal flex wrap container">

					 		<div id="linenumbersA1" class="layout vertical line-number">
					 		<div class="line-numbers" id="linesA1">Lines</div>
					 		<div class="line-numbers" id="linesA">&nbsp</div>
					 			<template is="dom-repeat" items="{{lineNumberArray}}" filter="{{_numberRowsFilter(shown, lastRow)}}">
     								<span hidden="{{!item.show}}" id="oneOneNumbers_{{item.number}}">{{item.number}}</span><span hidden="{{item.show}}">&nbsp</span>
     							
    							</template>
					 		</div>
			<!--passage-1-column-1 container-->
					 		<div id="singlePassageColumn" class="layout horizontal flex wrap text">
					 		<article id="textColumnOne">
					 	    	<template is="dom-repeat" items="{{theContent}}">
 									<template is="dom-if" if="{{item.newPara}}">
 										<br><span>&nbsp&nbsp&nbsp&nbsp</span>
 									</template>
 									<a id="oneOneWords_{{item.order}}" hidden="{{!columnOneShow}}">{{item.word}}</a>
								</template>
									<br class="line-numbers">
									<hr>
								<div class="right-justified line-numbers" style="float:right; text-align: right;" id="singleColumnBounder"> Focused Coaching (c) 2016</div>
							</article>
					 		</div>
					 	</div>	
					 	<button on-tap="numberOneColumn">number</button>				
</template>
<script>
Polymer({
	is: 'fc-single-column-display-delta',
		observers: ['arrayWatcher(theContent.splices)', 'columnWatcher(lastRow)'],
		properties: {
		theContent:{
			type: Array, 
			value: [],
			notify: true, 
		},
	
		lastWordIndex: {
			type: Number,
			value: 0,
			notify: true
		},
		
		lineNumberArray:{
			type: Array,
			value: function(){
				var lineNumberArray = [];
				for(var i=1; i <= 180; i++)
				{	
					j=	i % 5 ? false: true;
					lineNumberArray.push({'number': i, 'show': j});
				}
				return lineNumberArray;
			},
			notify: true
		},
		
		lastRow:{
			type: Number,
			notify: true
		},
		
		shown:{
			type: Boolean,
			value: true,
			notify: true,
		}
	},
ready: function(){
	
	},
attached: function(){
},
_linesEst: function(){
	var colWidth = this.$.textColumnOne.clientWidth;
	var wordEst = Math.ceil((665/colWidth)*12.2);
	var linesEst = Math.floor(this.numWords/wordEst);
	return linesEst;
},
arrayWatcher: function(theContent){
	//console.log(this.theContent);
	if(this.theContent.length!==undefined){
	this.set('numWords',this.theContent.length);
	var lineEst = this._linesEst();
	this.set('lastRow', lineEst);
	this.numberOneColumn(lineEst); 
	//console.log(lineEst);
	}
},
computeLastRow: function(){
 	var bottom_of_first_word = this.$.linesA1.getBoundingClientRect().bottom;
	var lwId =  '#oneOneWords_' + this.lastWordIndex;
	var last_word_top = this.$$(lwId).getBoundingClientRect().bottom;
 	//console.log(last_word_top);
 	var line_height = this.$.linesA1.clientHeight;
 	var delta =  last_word_top - bottom_of_first_word;
 	var lastRow = Math.floor(delta/line_height);
 	this.lastRow = lastRow;
 	//console.log(this.lastRow);
 	this.set('lastRow', lastRow);
},
_notifyResize:function(secondShow){
	this.numberOneColumn();
	this.shown= !secondShow;
},
numberOneColumn: function(RowsEstimate){
		 var lwId =  '#oneOneWords_' + this.lastWordIndex;
		// console.log(this.$$(lwId));
		 if(lwId=="#oneOneWords_0" || this.$$(lwId)===undefined)
		 {
		 	if(RowsEstimate> 68) 
		 		{
		 			this.lastRow=RowsEstimate;
		 		} 
		 		else
		 		{
		 			var rowsEstimate = this._linesEst();
					this.lastRow= (rowsEstimate>68) ? rowsEstimatr: 68;
		 		}
		 }
		 else
		 {
		 	this.computeLastRow();
		}
		
		},
columnWatcher: function(lastRow){
this.numberOneColumn(lastRow);
},
_numberRowsFilter: function(shown, lastRow){
	if(shown==true)
	{
 			return (item) =>{
 				return (item.number <= lastRow);
 			};
	}
	else 
		{
		return (items) => { 
				return false;
			};
		}
	}
});
</script>
</dom-module>