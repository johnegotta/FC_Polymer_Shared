<dom-module id="fc-passage-display-es">
<template>
<style>

		div.columnContainer{
			overflow-y: scroll;
		}
		div.passageContainer{
			min-width: 310px;
			max-width: 1450px !important;
			margin: 16px;
		}
		.highlighted {
			background: yellow;
		}
		div.blurb{
			line-height: 1;
			font-size: 1.10em;
			font-family: merriweather;
			font-weight: 500;
			font-style: italic;
			display: block;
		}

</style>
<!--double-column line-number and passage vertical container-->
<firebase-collection location="https://focusedstaging1.firebaseio.com/passagesDestinations/new_Test_1" data="{{passageArray}}" on-firebase-value="altMethod"></firebase-collection>
<div id="fcpassagedisplay" style="width: 99.6%;">
	<div id="noJudge4" class="layout vertical flex container left passageContainer" style="overflow-y:scroll;">
	
		<div class="layout horizontal blurb" style="margin: 12px 24px 0px 24px;min-width: 240px !important; max-width: 680px !important; max-height: 140px;">
			{{passageBlurb}}
		</div>
	

		<!-- end-of-column-1 line number and text container-->
		<div id="doubleColumnContainer" class="layout horizontal columnContainer">
			<fc-single-column-layout-es
				class="flex-1 left-passage-column"
				id="firstColumn"
				the-content='{{passageArray}}'
				column-one
				last-word-index='[[lastWordIndexOfFirst]]'
				last-row-index='{{lastRowIndexOfFirst}}'>
			</fc-single-column-layout-es>
			<fc-single-column-layout-es
				class="flex-1 right-passage-column"
				id="secondColumn"
				hidden='{{!showingSecondColumn}}'
				the-content='{{passageArray}}'
				first-word-index='[[firstWordIndexOfSecond]]'
				last-word-index='[[finalWordIndex]]'
				first-row-index='[[firstRowIndexOfSecond]]'>
			</fc-single-column-layout-es>
		</div>

	</div>
<!--End of Vertical passage container-->
</div>
</template>
<script>
'use strict';
(function() {

class FCPassageDisplayES6 {

	get behaviors() {
		return [Polymer.IronResizableBehavior];
	}

	beforeRegister() {
		this.is ='fc-passage-display-es';
		this.listeners = {'iron-resize':'setUp'};
		this.properties = {
			passagePath: {
				type: String,
				value: 'new_Test_1',
				notify: true,
				reflectToAttribute: true
			},
			passageRootPath: {
				type: String,
				value: function(){
					return 'https://focusedstaging1.firebaseio.com/passagesDestinations';
				},
				notify: true,
				reflectToAttribute: true
			},
			passageFullPath: {
				type: String,
				value: '',
				notify: true,
				reflectToAttribute: true
			},
			passageArray:{
				type: Array,
				notify: true
			},
			passageTitle: {
				type: String,
				notify: true,
				reflectToAttribute: true
			},
			passageBlurb:{
				type: String,
				notify: true
			},
			lastWordIndexOfFirst: {
				type: Number,
				notify: true
			},
			firstWordIndexOfSecond: {
				type: Number,
				notify: true
			},
			finalWordIndex: {
				type: Number,
				notify: true
			},
			lastRowIndexOfFirst: {
				type: Number,
				notify: true
			},
			firstRowIndexOfSecond: {
				type: Number,
				computed: 'computeFirstRowIndexOfSecond(lastRowIndexOfFirst)',
				notify: true
			},
			showingSecondColumn: {
				type: Boolean,
				value: false,
				observer: 'splitPassageForColumns',
				notify: true,
				reflectToAttribute: true
			},
		    growingFirstColumn: {
		      type: Boolean,
		      value: false,
		      notify: true
		    }
		};
	}

	altMethod(e){
		this.passageBlurb=self.passageArray[1].passageBlurb;
		this.finalWordIndex=self.passageArray.length;
		console.log(this, "JUST GOT FIREBASE PASSAGE", this.passageArray, e);
		this.splitPassageForColumns();
	}

	splitPassageForColumns() {
		console.log(this, "IN splitPassageForColumns")
		if(this.showingSecondColumn == true){
			this.lastWordIndexOfFirst = Math.floor(.618*this.finalWordIndex);
			this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
      		this.readjustWordSplit();
		} else {
			this.lastWordIndexOfFirst = this.finalWordIndex;
		}
	}

	ready() {
		self = this;
		var ref = new Firebase(self.passageRootPath);
		console.log(self, "IN READY", self.passageRootPath);
		// ref.on("child_added", function(snap) {
		// 	console.log(self, "added", snap.key());
		// 	if(snap.key()=='new_Test_1') {
		// 		//self.splitPassageForColumns();
		// 		self.passageArray = snap.val();
		// 		console.log(self, self.passageArray);
		// 		self.passageBlurb=self.passageArray[1].passageBlurb;
		// 		self.finalWordIndex=self.passageArray.length;	
		// 	}
		// }).bind(self);
		//self.splitPassageForColumns();	
	}

	setUp() {
		this.screenTrueHeight =  (window.innerHeight-320);
		this.$.firstColumn = this.$.fcpassagedisplay.clientWidth;
		if(this.$.noJudge4.clientWidth >= 640 /*&& this.screenTrueHeight>=440*/) {
			this.showingSecondColumn = true;
		} else {
			this.showingSecondColumn = false;
		}
		console.log(this, "IN SETUP", this.showingSecondColumn);
		this.splitPassageForColumns();
	}

	readjustWordSplit() {
	    this.growingFirstColumn = !this.growingFirstColumn;
	    if(this.growingFirstColumn == true) {
	      this.lastWordIndexOfFirst = this.lastWordIndexOfFirst - this.querySelector('#firstColumn').wordsOffBottom();
	      this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
	    } else {
	      this.lastWordIndexOfFirst = this.lastWordIndexOfFirst + this.querySelector('#secondColumn').wordsOffTop();
	      this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
	      this.readjustWordSplit();
	    }
	}

	computeFirstRowIndexOfSecond(lastRowIndexOfFirst){
		return lastRowIndexOfFirst + 1;
	}
}

Polymer(FCPassageDisplayES6);

})();
</script>
</dom-module>
