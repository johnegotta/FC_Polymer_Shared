<dom-module id="fc-passage-display">
<template>
<style>

		div.columnContainer{
			overflow-y: scroll;
		}
		div.passageContainer{
			min-width: 320px;
			max-width: 1450px !important;
			margin: 36px;
			padding-top: 4px;
		}
		.highlighted {
			background: yellow;
		}
		div.blurb{
			line-height: .9;
			font-size: 1.00em;
			font-family: merriweather;
			font-weight: 500;
			font-style: italic;
			display: block;
			padding-bottom: 18px;
		}

		
		.passage-column{
			padding-left: 8px;
			margin-left: 6px;
			padding-right: 8px;
			margin-right: 6px;
		}

</style>
<!--double-column line-number and passage vertical container-->
<div id="fcpassagedisplay" style="width: 98%; height: 99.2%;" class="vertical layout flex">
	<div id="passageHolder" class="layout vertical flex container left passageContainer" style="overflow-y:scroll;">
		<div class="layout horizontal blurb" style="margin: 0px 24px 0px 24px; min-width: 240px !important; max-width: 740px !important; max-height: 64px;">
			{{passageBlurb}}
		</div>
	<!--single column container-->

		<!-- end-of-column-1 line number and text container-->
		<div id="doubleColumnContainer" class="layout horizontal columnContainer">
			<fc-single-column-layout
				class="flex-1 passage-column"
				id="firstColumn"
				the-content='{{passageArray}}'
				column-one
				last-word-index='[[lastWordIndexOfFirst]]'
				last-row-index='{{lastRowIndexOfFirst}}'>
			</fc-single-column-layout>
			<fc-single-column-layout
				class="flex-1 passage-column"
				id="secondColumn"
				hidden='{{!showingSecondColumn}}'
				the-content='{{passageArray}}'
				first-word-index='[[firstWordIndexOfSecond]]'
				last-word-index='[[finalWordIndex]]'
				first-row-index='[[firstRowIndexOfSecond]]'>
			</fc-single-column-layout>
		</div>

	</div>
<!--End of Vertical passage container-->
</div>
</template>
<script>

Polymer({
	is:'fc-passage-display',
	behaviors: [Polymer.IronResizableBehavior],
	listeners: {'iron-resize':'setUp'},
	properties: {
		passagePath: {
			type: String,
			value: 'new_Test_1',
			notify: true,
			reflectToAttributes: true
		},
		passageRootPath: {
			type: String,
			value: function(){
				return 'https://focusedstaging1.firebaseio.com/passagesDestinations';
			},
			notify: true,
			reflectToAttributes: true
		},
		passageFullPath: {
			type: String,
			value: '',
			notify: true,
			reflectToAttributes: true
		},
		passageArray:{
			type: Array,	
			notify: true
		},
		
		passageBlurb:{
			type: String,
			notify: true
		},
		lastWordIndexOfFirst: {
			type: Number,
			notify: true
		},
		firstWordIndexOfSecond: {
			type: Number,
			notify: true
		},
		finalWordIndex: {
			type: Number,
			notify: true
		},
		lastRowIndexOfFirst: {
			type: Number,
			notify: true
		},
		firstRowIndexOfSecond: {
			type: Number,
			computed: 'computeFirstRowIndexOfSecond(lastRowIndexOfFirst)',
			notify: true
		},
		showingSecondColumn: {
			type: Boolean,
			value: false,
			observer: 'splitPassageForColumns',
			notify: true,
			reflectToAttributes: true
		},
    growingFirstColumn: {
      type: Boolean,
      value: false,
      notify: true
    }

	},

	ready: function(){
		self=this;
		var ref = new Firebase(self.passageRootPath);
		ref.on("child_added", function(snap) {
			//console.log("added", snap.key());
			if(snap.key()==self.passagePath) {
				self.passageArray=snap.val();
				var counts = snap.val().length;
				console.log(`this is the incalculable length of snap.val() ${counts}`);
				self.passageBlurb=self.passageArray[1].passageBlurb;
				self.finalWordIndex=self.passageArray.length;
			}
		});
	},


	setUp: function()
	{
		this.screenTrueHeight =  (window.innerHeight-320);
		this.$.firstColumn = this.$.fcpassagedisplay.clientWidth;
		if(this.$.passageHolder.clientWidth >= 680 /*&& this.screenTrueHeight>=440*/) {
			this.showingSecondColumn = true;
      this.readjustWordSplit();
		} else {
			this.showingSecondColumn = false;
		}
	},

	splitPassageForColumns: function(){
		if(this.showingSecondColumn == true){
			this.lastWordIndexOfFirst = Math.floor(.618*this.finalWordIndex);
			this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
      //this.readjustWordSplit();
		} else {
			this.lastWordIndexOfFirst = this.finalWordIndex;
		}
	},

  readjustWordSplit: function(){
    if(this.growingFirstColumn == true) {
      this.lastWordIndexOfFirst = this.lastWordIndexOfFirst - this.querySelector('#firstColumn').wordsOffBottom();
      this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
    } else {
      this.lastWordIndexOfFirst = this.lastWordIndexOfFirst + this.querySelector('#secondColumn').wordsOffTop();
      this.firstWordIndexOfSecond = this.lastWordIndexOfFirst + 1;
    }

    this.growingFirstColumn = !this.growingFirstColumn;
  },

	computeFirstRowIndexOfSecond: function(lastRowIndexOfFirst){
		return lastRowIndexOfFirst + 1;
	}
});
</script>
</dom-module>
