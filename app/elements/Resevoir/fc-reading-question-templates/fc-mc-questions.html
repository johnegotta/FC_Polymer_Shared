<dom-module id="fc-rqtversion-mc">
<template>
<style>
:host {height: 99200px; width: 100%;
background: white;
	}
paper-input{
		padding: 5px;

}
</style>

<paper-material style='height: 1900px;'>
<paper-header-panel mode="waterfall" class="vertical layout" style="max-width: 100vw; background: white; border: 3px solid blue; min-height: 360px; max-height: 750px;">

<div style="background: cyan; height: 100px;" class="paper-header head header panel layout horizontal">
<!--<fc-pattern-finder id="fcpatternmatcher" auto-mode="true" style="display:none"></fc-pattern-finder> -->
	

<paper-input label="Question Filter I" style="max-width: 190px; padding: 5px;" value="{{one}}"></paper-input>
<paper-input label="Question Filter II" style="max-width: 190px; padding: 5px;" value="{{two}}"></paper-input>
<paper-input label="RegEx Question Filter" style="max-width: 190px; padding: 5px;" value="{{regexFilterTwo}}" on-input="clearMatches"></paper-input>
<select style="width:200px">
  <template is="dom-repeat" items="[[regexMatchResults]]">
    <option value="{{item}}">{{item}}</option>
  </template>
</select>
<select style="width:200px" on-change="setSelectedPattern">
  <template is="dom-repeat" items="[[commonPatterns]]">
    <option value="{{item.pattern}}">{{item.pattern}}</option>
  </template>
</select>
<paper-button on-tap="loadPatternsSelect">Load Patterns</paper-button>
 <paper-button style="background:cyan; color: white; border: 4px white solid; outline: 2px solid green; font-size: 14pt; border-radius: 6px;" on-tap="_saveFB_Test_1Qs">SAVE TO FIREBASE!</paper-button>
<div id="firepad2" stykle="background: black;"></div>
</div>
<div class="vertical layout flex">
<div class="horizontal layout flex wrap" style="height: 50000px; padding: 0px; 24px;">
	<section class="vertical flex layout" style="max-width: 440px; padding: 5px; border: 1px solid #008; margins: 5px;">
		<template is="dom-repeat" items="{{questions.T00001S1P1Qs}}">
			<paper-material style="border: 1px solid black; margin: 3px; padding: 2px;">
				<paper-input label="T1_S1_PassageNum Q. Part 1" value="{{item._q}}"></paper-input>
				<paper-input label="Ans. A Part 1" value="{{item._a}}"></paper-input>  <paper-input label="Ans. B Part 1" value="{{item._b}}"></paper-input>
				<paper-input label="Ans. C Part 1" value="{{item._c}}"></paper-input>
				<paper-input label="Ans. D Part 1" value="{{item._d}}"></paper-input>
			</paper-material>
		</template>
	</section>

	<section class="vertical flex layout" style="max-width: 440px; padding: 5px; border: 1px solid #008; margins: 5px;">
		<template is="dom-repeat" items="{{questions.T00001S1P2Qs}}">
					<paper-material style="border: 1px solid black; margin: 3px; padding: 2px;">
						<paper-input label="T2_S1_PassageNum Q. Part 1" value="{{item._q}}"></paper-input>
						<paper-input label="Ans. A Part 1" value="{{item._a}}"></paper-input>  <paper-input label="Ans. B Part 1" value="{{item._b}}"></paper-input>
						<paper-input label="Ans. C Part 1" value="{{item._c}}"></paper-input>				
						<paper-input label="Ans. D Part 1" value="{{item._d}}"></paper-input>
					</paper-material>   
				</template>
			</section>
	<paper-material class="vertical flex layout" style="max-width: 440px; padding: 5px; margins: 5px; border: 1px solid #008; background: #efefef; outline: 2px solid black;">
		<template is="dom-repeat" items="{{questions.T00001S1P3Qs}}">
			<paper-material style="border: 1px solid black; margin: 3px; padding: 2px;">
					<paper-input label="T3_S1_PassageNum Q. Part 1" value="{{item._q}}"></paper-input>
			 		<paper-input label="Ans. A Part 1" value="{{item._a}}"></paper-input>   
					<paper-input label="Ans. B Part 1" value="{{item._b}}"></paper-input>
					<paper-input label="Ans. C Part 1" value="{{item._c}}"></paper-input>
					<paper-input label="Ans. D Part 1" value="{{item._d}}"></paper-input>
			</paper-material>
		</template>
	</paper-material>
		<section class="vertical flex layout" style="max-width: 440px; padding: 12px 5px; margins: 5px 10px 20px 10px; border: 1px solid #008;">
			<template is="dom-repeat" items="{{questions.T00001S1P4Qs}}" as="item">
				<paper-material style="border: 1px solid black; margin: 3px; padding: 2px;">
					<paper-input label="T4_S1_PassageNum Q. Part 1" value="{{item._q}}"></paper-input>
					<paper-input label="Ans. A Part 1" value="{{item._a}}">
					</paper-input> 
					<paper-input label="Ans. B Part 1" value="{{item._b}}">
					</paper-input>
					<paper-input label="Ans. C Part 1" value="{{item._c}}">
					</paper-input>
					<paper-input label="Ans. D Part 1" value="{{item._d}}">
					</paper-input>
				</paper-material>
			</template>
		</section>
		<section class="vertical flex layout" style="max-width: 440px; padding: 12px 5px; margins: 5px 10px 20px 10px; border: 1px solid #008;">
			<template is="dom-repeat" items="{{questions.T00001S1P5_6Qs}}" as="item">
				<paper-material style="border: 1px solid black; margin: 3px; padding: 2px;">
					<paper-input label="T4_S1_PassageNum Q. Part 1" value="{{item._q}}"></paper-input>
					<paper-input label="Ans. A Part 1" value="{{item._a}}">
					</paper-input> 
					<paper-input label="Ans. B Part 1" value="{{item._b}}">
					</paper-input>
					<paper-input label="Ans. C Part 1" value="{{item._c}}">
					</paper-input>
					<paper-input label="Ans. D Part 1" value="{{item._d}}">
					</paper-input>
				</paper-material>
			</template>
		</section> 
	<!--
		<section class="vertical flex layout" style="max-width: 440px; padding: 12px 5px; margins: 5px 10px 20px 10px; border: 1px solid #008;">
			 <firebase-collection data="{{fcquestions}}" location="https://focusedstaging1.firebaseio.com/readingQuestionsTwo/testthree"></firebase-collection> 
			<template is="dom-repeat" items="{{fcquestions}}" as="item">
				<paper-material style="height: 430px; border: 1px solid black; margin: 3px; padding: 2px;">
					<paper-textarea label="TextArea for {{item._qfcid}}" value=
					"{{item.Qn}} {{item.Qa}} {{item.Qb}} {{item.Qc}} {{item.Qd}} {{item.Qe}}  
{{item.An}}  {{item.Aa}} {{item.Ab}} {{item.Ac}} {{item.Ad}} {{item.Ae}}

{{item.Bn}} {{item.Ba}} {{item.Bb}} {{item.Bc}} {{item.Bd}} {{item.Be}} 

{{item.Cn}} {{item.Ca}} {{item.Cb}} {{item.Cc}} {{item.Cd}} {{item.Ce}} 

{{item.Dn}} {{item.Da}} {{item.Db}} {{item.Dc}} {{item.Dd}} {{item.De}} ">
				</paper-textarea>
			</paper-material>
			</template>
		</section> 
		-->
		<paper-button style="height:180px; width: 180px; background: pink; color: green;" on-tap="findQuotes">Link Line Numbers and Citations</paper-button>

		<iron-list items="[[fcquestions]]" style="height: 900px;" as="quotes">
		<template>[[quotes.Af]] [[quotes.Bf]] [[quotes.Cf]] [[quotes.Df]] [[quotes.Qf]]</template></iron-list>
	</div>
</div>
</paper-header-panel>
</paper-material>



</template>

<script>
FcRqtversionc=Polymer({
	is: 'fc-rqtversion-mc',
	behaviors: [FCBehaviors.FCFirepadBehavior],
	properties: {
		argQAO:{
			type: Array,
			value: function(){return[];},
			notify: true
		},
		patterns: {
			type: Array,
			computed: "_computePatterns(one, two, regexFilter, selectedPattern, one_a, two_a, three_a)",
			notify: true
			},
		fcquestions:{
			type: Array,
			computed: "_computeFcQuestions(isFirepad, Jason)"
		},
		selected: {
			type: String,
			computed: "_onMySelected(mySelected)",
			notify: true
		},
		one:{
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		fbquestionsone:{
			type: Array,
			notify: true
		},
		two: {
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		regexFilter: {
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		one_a:{
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		two_a: {
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		three_a: {
			type: String,
			value: function(){
				return "";
			},
			notify: true
		},
		regexMatchResults: {
			type: Array,
			value: [],
			notify: true
		}, 
		commonPatterns: {
			type: Array,
			value: [],
			notify: true
		},
		selectedPattern: {
			type: String,
			value: "",
			notify: true
		},
		jason:{
			type: String,
			notify: true

		},
		myPassageStringsArray:{
			type: Array,
			notify: true
		}, 
		
		addAnwers: {
			type: String, 
			value: function(){
				return "true";
				},
			notify: true	
			},
		objectArray: {
			type: Array,
			value: function(){
				return [];
			},
			notify: true
		},
		questionArray:{
			type: Array,
			value:function(){
				return [];

			},
			notify: true
		},
		isFirepad:{
			type: Boolean,
			notify: true

		},
		quoteMatches:{
			type: Array,
			value: function(){
				return[];
			},
			notify: true
		},
},

ready: function()
{
	this.myPassageStringsArray=[];
	this.loadQuestionsFirepad();
	var passageString; 
	var self = this;
	var myPassages = localStorage.getItem("myPassages");
	this.firebase = new Firebase("https://focusedcoaching.firebaseio.com/");

	if(myPassages != null)
	{
		myPassages = JSON.parse(myPassages);
		this.passages = myPassages;
		console.log(myPassages);
		var counter = myPassages.length;
		while(counter> 0){ 
		 	counter--;
		 	var counterTwo = myPassages[counter].length;
		 	for(var i = 0; i<counterTwo; i++)
		 	{
		 		passageString= passageString + " " + myPassages[counter][i].word;
			}
			this.push("myPassageStringsArray",passageString);
			passageString = "";
		}
	}
	else
	{
		var passageLoc = this.firebase.child("reading/passages");
		passageLoc.on("value", function(snapshot){
			myPassages = snapshot.val();
			self.set("passages", myPassages);
			console.log(self.passages);
		});
	}
	
	console.log(this.myPassageStringsArray);
	var questionLoc = this.firebase.child("reading/questions");
	questionLoc.on("value", function(snapshot){
		self.set("questions", snapshot.val());
		console.log(self.questions);
	});

},

setIsFirepad: function(firepadfunction){
	if(firepadfunction==true){
		this.set("isFirepad", true);
	}
},

	_computeFcQuestions: function(isFirepad, jason){
		if(isFirepad==true){

			return textOfQuestions;
			}
		},

findLineNumbers: function()
{
	var savingArray= [this.passages["T00001S1"], this.passages["T00002S1"], this.passages["T00003S1"], this.passages["T00004S1"]];
	//[this.testone,this.testtwo,this.testthree,this.testfour];
	var argString;
	var qabcd =["_q","_a","_b","_c","_d"];
	var qarray=["Qf","Af","Bf","Cf", "Df"];
	for(var i=0; i<4; i++){
		for(var j=0;j<52;j++){
			for(var pi=0; pi<5; pi++){
			
			argString =savingArray[i][j][qabcd[pi]];
				
				var matches = argString.match(/\(?lines [0-9]+-[0-9]+\)?/g);
				if(matches != null)
				{
					//console.log("found line num string = " + matches);
					var numMatches = matches.length;
					for(var k = 0; k < numMatches; k++)
					{	
						var lineNum;
						if(k>0){lineNum+=" ";}
					 	lineNum=matches[k];
				
					savingArray[i][j][qarray[pi]]+=lineNum;
					console.log(lineNum);
					}
				
				}
				var matches = argString.match( /\(?line [0-9]+\)?/g ); 
				if(matches != null)
				{
				
					var numMatches = matches.length;
					for(var k = 0; k < numMatches; k++)
					{	
						var lineNum;
						if(k>0){lineNum+=" ";}
					 	lineNum=matches[k];
				
					savingArray[i][j][qarray[pi]]+=lineNum;
					}

				}
				
				matches = argString.match(/the (first|second|third|fourth|fifth|sixth|seventh|eighth|ninth|tenth|last|final|penultimate) paragraph/g);
				if(matches != null)
				{
					var numMatches = matches.length;
					for(var k = 0; k < numMatches; k++)
					{	
						var lineNum;
						if(k>0){lineNum+=" ";}
					 	lineNum=matches[k];
				
					savingArray[i][j][qarray[pi]]+=lineNum;
					}
				}
				}
			}
		}
				// return argString;
	},

attached: function(){
	 //this._saveFB_Test_1Qs();


},

 _saveFB_Test_1Qs: function(key, value){
		var savingNameArray=['T00001S1P', 'T00002S1P', 'T00003S1P', 'T00004S1P'];
		var savingArray=[this.testone,this.testtwo,this.testthree,this.testfour];
		var argString;
		var _qabcd =["_q","_a","_b","_c","_d"];
		var _QABCD=["Q","A","B","C","D"];
		var qabcdefghijkl=["q","a","b","c","d","e", "f", "g", "h","i","j","k","l"];
	for(var i=0; i<4; i++)
	{
		var test =savingArray[i];
		for(var j=0;j<52;j++)
		{
					var question = test[j];
					if(i==0)
					{
		 			question._ptype=(j<10)?"Fiction": (j>9 && j<21)? "Economics":(j>20 && j<31)? "Mixed: Natural Science Rights Narrative": (j>30&&j<41)? "Rights Narrative: Virginia Woolf; Three Gineas;":"Mixed: Double: Space Mining, Natural Science, Economics";
		 			// question._qtype="gettoUndit";
		 			question._p=(j<10)?"P1": (9<j && j<21)?"P2":(20<j && j<31)?"P3": (j>30 &&j<41)?"P4":"P5_6";
		 			(question._p=="P3" || question._p =="P2")? question.Ql=true:question.Ql=false;
		 					(question._p=="P5_6")?question.Qm=true: question.Qm=false;
		 			}
		 			else if(i==1)
		 				{	question._ptype=(j<10)?"Fiction;the Professor, Charlotte Bronte, 724 words; 4 sentences; Voice Narrative; narrative is in a male voice;": (j>9 && j<20)? "Economics, sort-of ethics and philosophy; Adam Smith;":(j>19 && j<32)? "DOUBLE PASSAGE WEB about the web; vague science about the web;": (j>31&&j<42)? "Rights Narative; 1869; suffrage; civil rights history;": "Natural science; Undersea waves; topography";
		 					question._p=(j<10)?"P1": (9<j && j<21)?"P2":(20<j && j<32)?"P3": (j>31 &&j<42)?"P4_P5":"P6";
		 					(question._p=="P6" || question._p =="P2")? question.Ql=true:question.Ql=false;
		 					(question._p=="P4_P5")?question.Qm=true: question.Qm=false;
		 				}
		 			else if(i==2)
		 				{	question._ptype=(j<10)?"Fiction;Mrs. Quabarl, 1911 SAKI; Woman Greets a Governess at the train station: again a piece on manners; social position; and 'coming up'": (j>9 && j<20)? "social science, urban planning, population dynamics, polution, sort-of ethics and philosophy;Fluff piece again; modern; HAS CHARTS;":(j>19 && j<30)? "Thor Handson: Biology; Evolotion. Birds flying; Natural Science;": (j>29&&j<41)? "DOUBLE PASSAGE; SOCIAL SCIENCE EDUCATION WOMEN`s Rights; report on public instruction, education for women; Second Passage: Mary Wolstencraft: rights of women; life of women; both from 1790s; dirrect response; She slams the first side;": "Natural science; the bees... colony collapse disorder; HAS CHARTS;";
		 				question._p=(j<10)?"P1": (9<j && j<20)?"P2":(19<j && j<30)?"P3": (j>29 &&j<41)?"P4_P5":"P6";
		 				(question._p=="P6" || question._p =="P2")? question.Ql=true:question.Ql=false;
		 					(question._p=="P4_P5")?question.Qm=true: question.Qm=false;
		 				}
		 			else if(i==3)
		 				{	question._ptype=(j<10)?"fiction; Set in 1897; Modern Writer; Swedish Scientists set out for the north pole in a hydrogen-think Hindenburg here kids-baloon. Adventure in the world before time;": (j>9 && j<21)? "social science, low brow economics; Cities & Demographics; Suburbs Cities;Fluff piece again; migration; modern; HAS CHARTS;":(j>20 && j<31)? "Natural Science: Emily Anthes: frankenstein's cat; genetic manipulation; cloning; engineered medicine; positive take, although slow to acknowledge the frankenstein nature of her actual descriptions. No chart;": (j>30&&j<41)? "DOUBLE PASSAGE; SOCIAL CONTRACT: 1890 Edmund Burke French Revolution; Thomas Paine 1791 Rights of Man; Social Contract; No charts;": "Natural science; atmospheric science; geology; radio carbon dating; cause of a medieval erruption different distant volcanos caused a cooling period in Europe; HAS CHARTS;";
		 					question._p=(j<10)?"P1": (9<j && j<21)?"P2":(20<j && j<31)?"P3": (j>31 &&j<41)?"P4_P5":"P6";
		 					(question._p=="P6" || question._p =="P2")? question.Ql=true:question.Ql=false;
		 					(question._p=="P4_P5")?question.Qm=true: question.Qm=false;
		 				}
		 			question._t=(i<9)?"T" + "0" +"0" +"0" +"0" + (i+1).toString():(i>=9&& i<99)?"T" + "0" +"0" +"0" +(i+1).toString():(i>=99&&i<999)?"T" + "0" +"0"+(i+1).toString():(i>=999&&i<9999)?"T" + "0"+(i+1).toString():i>=9999&&i<99999?"T" + (i+1).toString(): alert("Jason, see Julius and Stacy and Leo and Helena and J.Jr. and Wake: you have made 100,000 tests: that is enough;");
		 			question._sec="S1";
		 			question._qindex=j;
		 			question._qnumb=j+1;
		 			
		 			question._qfcid= (j<9)?question._t+question._sec+question._p+"Q" + "0" + (j+1).toString(): question._t+question._sec+question._p+"Q" + (j+1).toString();
		 			question.fcid=question._qfcid;
					for(var k=0; k<5; k++)
					{
						var part =question[_qabcd[k]];
						var matches = part.match( /\“.+?\”/g ); 
						var wordlist = part.split(" ");
						var questionPart = [_QABCD[k]];
						question[_QABCD[k] + "n"]=wordlist.shift();
			 				question[_QABCD[k]+"a"] = wordlist.slice(0,3).join(" "); 
			 				question[_QABCD[k]+"b"]=wordlist.slice(3,5).join(" ");
			 				question[_QABCD[k]+"c"]=(wordlist.slice(5,7)!==undefined && wordlist.slice(5,7)!==null)?(wordlist.slice(5,7).join(" ")):"";
			 				question[_QABCD[k]+"d"]=(wordlist.slice(7,10)!==undefined && wordlist.slice(7,10)!==null)?(wordlist.slice(7,10).join(" ")):"";
			 				question[_QABCD[k]+"e"]=(wordlist.slice(10,wordlist.length)!==undefined && wordlist.slice(10,wordlist.length)!==null)?(wordlist.slice(10,wordlist.length).join(" ")): "";
			 				var quoteAO=[];
		 			// 	if(i==0 && j<10 && matches!=null && matches!=undefined)
		 			// 	{
						// 	question.quoteObject=(this.findQuote(this.myPassageStringsArray[1], matches[0], question._qnumb, question._q, questionPart, question.fcid, quoteAO)!==undefined)?this.findQuote(this.myPassageStringsArray[1], matches[0], question._qnumb, question._q, questionPart, question.fcid, quoteAO): [];
						// }
		 				question.qz = question._t + question._sec + question._p + "Qs";
		 				this.objectArray=[];
		 				this.push("objectArray",question);		
					}
			if (i==0)
					{
						if(j<10){
							this.push("questionArray",question);
							this.mcpassagecluster[question.fcid] = question;
							if(j===9){
								var self=this;
								var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
				 				ref.child("T00001S1P1Qs").set(self.questionArray);
				 				ref.child("T00001S1P1Qs").update(this.mcpassagecluster);
				 				self.questionArray=[];
			 				}

						}
						else if(j>9 && j<22){
							this.push("questionArray",question);
							if(j==21){
						   
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00001S1P2Qs").set(self.questionArray);
							this.questionArray=[];
						
							}
						}
						else if (j>21 && j<32){
							self.push("questionArray", question);

						   if(j==31){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00001S1P3Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}

						else if (j>31 && j<42){
							self.push("questionArray", question);

						   if(j==41){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00001S1P4Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else {
						   
						   self.push("questionArray", question);
						   if(j==51){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00001S1P5_6Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
					}
					else if (i==1)
					{
						if(j<10){
							self=this;
						  
						  self.push("questionArray", question);
						   if(j==9){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
			 				ref.child("T00002S1P1Qs").set(self.questionArray);
			 				this.questionArray=[];
			 			}

						}
						else if(j>9 && j<21){
							self.push("questionArray", question);
						   if(j==20){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00002S1P2Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else if (j>20 && j<32){
							self.push("questionArray", question);

						   if(j==31){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00002S1P3Qs").set(self.questionArray);
							this.questionArray=[];
						}
						}

						else if (j>31 && j<42){
							self.push("questionArray", question);

						   if(j==41){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00002S1P4_5Qs").set(self.questionArray);
							this.questionArray=[];
						}
						}
						else {
						   self.push("questionArray", question);
						   if(j==51){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00002S1P6Qs").set(self.questionArray);
							this.questionArray=[];
						}
						}
					}
					else if (i==2)
					{
						if(j<10){
							self=this;
						  
						  self.push("questionArray", question);
						   if(j==9){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
			 				ref.child("T00003S1P1Qs").set(self.questionArray);
			 				this.questionArray=[];
			 				}

						}
						else if(j>10 && j<20){
							self.push("questionArray", question);
						   if(j==19){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00003S1P2Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else if (j>19 && j<30){
							self.push("questionArray", question);
						   if(j==29){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00003S1P3Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}

						else if (j>29 && j<41){
							self.push("questionArray", question);
						   if(j==40){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00003S1P4_5Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else {
						   self.push("questionArray", question);
						   if(j==51){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00003S1P6Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
					}
					else if (i==3)
					{
						if(j<10){
							self=this;
						  self.push("questionArray", question);
						   if(j==9){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
			 				ref.child("T00004S1P1Qs").set(self.questionArray);
			 				this.questionArray=[];
			 				}
						}
						else if(j>9 && j<21)
						{
							self.push("questionArray", question);
						   if(j==20){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions/");
							ref.child("T00004S1P2Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else if (j>20 && j<31){
							self.push("questionArray", question);

						   if(j==30){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00004S1P3Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
						else if (j>30 && j<41){
							self.push("questionArray", question);

						   if(j==40){
							var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
							ref.child("T00004S1P4_5Qs").set(self.questionArray);
							this.questionArray=[];
							}
						}
					else {
						   
						    self.push("questionArray", question);
						    if(j==51)
						    {
								var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
								ref.child("T00004S1P6Qs").set(self.questionArray);
								this.questionArray=[];
							}
					}
					
				}
			}
		}
  	},

removePunctuation: function(argWord)
{
	var result = argWord;
	result = result.replace(",", "");
	result = result.replace(";", "");
	result = result.replace(".", "");
	result = result.replace("!", "");
	result = result.replace("?", "");
	result = result.replace(":", "");
	result = result.replace(/\“/g, "");
	result = result.replace(/\”/g, "");
	return result;
},

removeBigEllipsis: function(argString)
{
	return argString.replace(" . . .", "");
},

findQuotes: function()
{
	var keys = Object.keys(this.questions);
	var numKeys = keys.length;
	console.log(numKeys);
	var i = 0;
	var j = 0;
	try
	{
	for(i=0; i < numKeys; i++)
	{
		var questionCluster = this.questions[keys[i]];
		console.log(questionCluster);
		var qkeys = Object.keys(questionCluster);
		var numQuestions = qkeys.length;
		console.log(numQuestions);
		for(j=0; j < numQuestions; j++)
		{
			var qabcd = ["_q", "_a", "_b", "_c", "_d"];
			var question = questionCluster[qkeys[j]];
			//console.log(question);
			var id = question.fcid;
			id = id.split("Q")[0];
			var passage = this.passages[id];
			var k = 0;
			var piece = {};
			for(k=0; k < 5; k++)
			{
				piece = question[qabcd[k]];
				console.log(piece);
				var quote = piece.match(/\“.+?\”/);
				console.log(quote);
				if(quote != null)
				{
					var result = this.findQuote(passage, quote[0]);
					console.log(result);
					if(result != null)
					{
						this.questions[keys[i]][j]["quote"+qabcd[k]] = result.quote;
						var m = 0; 
						var numMatches = result.matches.length;
						this.questions[keys[i]][j]["numQuoteMatches"+qabcd[k]] = numMatches;
						for(m=0;m<numMatches;m++)
						{
							this.questions[keys[i]][j]["quoteMatches"+qabcd[k]] = [];
							this.questions[keys[i]][j]["quoteMatches"+qabcd[k]].push(result.matches[m]);
						}
					}
				}
			}
			
		}
		console.log("finished cluster " + i);
	}
	}
	catch(e)
	{
		console.log(e);
	}
	console.log(this.questions[keys[0]]);
	//save to firebase
	//	this.firebase.child("questions").update(this.questions);
},

findQuote(argPassage, argQuote)
{
	if(argQuote == null) return;
	var quote = argQuote.replace(/\“/, "");
	quote = quote.replace(/\”/, "");
	console.log(quote);
	var numWords = argPassage.wordArray.length;
	var wholePassage = ""; //argPassage.wordArray.join(" ");
	var i = 0;
	for(i=1;i < numWords;i++)
	{
		var word = argPassage.wordArray[i].word;
		if(word != "")
		{
			wholePassage += word;
			if(i != (numWords - 1))
			{
				wholePassage += " ";
			}
		}
	}
	var realQuote = "";
	var elliptical = quote.indexOf("...");
	if(elliptical < 0)
	{
		realQuote = quote;
	}
	else
	{
		var chunks = quote.split("...");
		var regexString = chunks[0] + ".+?" + chunks[1];
		var regex = new RegExp(regexString, "g"); //take out g if confident only one match
		matches = wholePassage.match(regex);
		console.log(matches);
		realQuote = matches[0];
	}
	realQuote = this.removeBigEllipsis(realQuote);
	console.log(realQuote);
	var foundFirst = false;
	var foundLast = false;
	var realQuoteArray = realQuote.split(" ");
	var quoteLength = realQuoteArray.length;
	var result = {"quote": realQuote, "matches": []};
	i=1;
	var numMatches = 0;
	var startIndex;
	var endIndex;
	var first = this.removePunctuation(realQuoteArray[0]);
	var last = this.removePunctuation(realQuoteArray[quoteLength - 1]);	
	for(i=1; i< numWords;i++)
	{
		var sword = this.removePunctuation(argPassage.wordArray[i].word);
		if(!foundFirst)
		{
			if(sword == first)
			{
				foundFirst = true;
				startIndex = i+1;
				console.log("found first word '" + sword + "' at index " + (i+1).toString());
				if(quoteLength == 1)
				{
					result.matches.push({"startIndex": i+1, "endIndex": i+1});
					numMatches++;
					foundFirst = false;
				}
				else  //check rest of quote
				{
					var quoteIndex = 0;
					var k = i;
					for(quoteIndex=0; quoteIndex < quoteLength; quoteIndex++)
					{
						sword = this.removePunctuation(argPassage.wordArray[k+quoteIndex].word);
						while(sword == "")
						{
							sword = this.removePunctuation(argPassage.wordArray[(++k)+ quoteIndex].word);
							//ugh, hack. remove blank words from word array!!!
						}
						var quoteWord = this.removePunctuation(realQuoteArray[quoteIndex]);
						if(sword == quoteWord)
						{
							//great, quote continues to match; do nothing
							console.log("matched word '" + quoteWord + "'");
						}
						else
						{
							console.log("passage says '" + sword + "' but quote word is '" + quoteWord + "'");
							foundFirst = false;
							break;
						}
					}
					if(foundFirst)
					{
						result.matches.push({"startIndex": i+1, "endIndex": i+quoteLength});
						numMatches++;
						foundFirst = false;
					}
				}
			}
		}
		/*
		else //have found quote beginning
		{
			//console.log("found first, and now finding '" + sword + "'");
			if(sword == last)
			{
				endIndex = i + 1;
				result.matches.push({"startIndex": startIndex, "endIndex": endIndex});
				foundFirst = false;
				numMatches++;
			}
			else if(sword == first)
			{
				//oops found another beginning, so use new one
				startIndex = i+1;
				foundFirst = true;
				// if(quoteLength == 1)
				// {
				// 	result.matches.push({"startIndex": i+1, "endIndex": i+1});
				// 	numMatches++;
				// 	foundFirst = false;
				// }
			}
		}
		*/
	}
	if(numMatches > 0)
	{
		return result; //{"quote": realQuote, "startIndex": startIndex, "endIndex": endIndex};
	}
	else
	{
		return null;
	}
},
// findQuoteInPart: function(argPassage, argQuote)
//  	{
//   var quote = argQuote.replace(/\“/g, ""); //start curly quote!
//   quote = quote.replace(/\”/g, ""); //end curly quote!
//   var elliptical = quote.indexOf("...");
//   var matches = [];
//   if(elliptical > 0)
//   {
//    var chunks = quote.split("...");
//    var regexString = chunks[0] + ".+?" + chunks[1];
//    var regex = new RegExp(regexString, "g"); //take out g if confident only one match
//    matches = argPassage.match(regex);
//   }
//   else
//   {
//    matches = argPassage.match(quote);
//   }
//   if(matches == null)
//   {
//    console.log("ERROR should have matched: ", quote);
//   }
//   else
//   {
//    this.set("quoteMatches", matches);
//  }
// },
//  findQuote: function(argPassage, argQuote, argPassageQuestionNumber, argPassageQuestion, questionPart, fcid, argQAO)
//  	{
//   var quote = argQuote.replace(/\“/g, ""); //start curly quote!
//   quote = quote.replace(/\”/g, ""); //end curly quote!
//   var elliptical = quote.indexOf("...");
//   var matches = [];
//   if(elliptical > 0)
//   {
//    var chunks = quote.split("...");
//    var regexString = chunks[0] + ".+?" + chunks[1];
//    var regex = new RegExp(regexString, "g"); //take out g if confident only one match
//    matches = argPassage.match(regex);
//   }
//   else
//   {
//    matches = argPassage.match(quote);
//   }
//   if(matches == null)
//   {
//    console.log("ERROR should have matched: ", quote);
//   }
//   else
//   {
//    var numMatches = matches.length;
//    for(i=0; i < numMatches; i++)
//    {
//     console.log(matches[i]);
//   }
//    this.set("quoteMatches", matches);

//  }
//   var numMatches = this.quoteMatches.length;
//   for(pick=0; pick < numMatches; pick++)
//   {
//    var quoteWordList = matches[pick].split(" ");
//    var numWordsInQuote = quoteWordList.length-2;
//    var passageWordList = this.myPassageStringsArray[0].split(" ");
//    var numWordsInPassage = passageWordList.length;
//    var j = 0; //index into passage word list
//    var k = 0;
//    var foundMatch = false;
//    var arrayArray = localStorage.getItem("myPassages");
//    arrayArray=JSON.parse(arrayArray);
   
//    var z=1;
//    var p=0;
//    var startindex=-1;
//    var endindex=-1;
//    var foundFirst = false;
//    for(z=1; z<numWordsInPassage; z++){
//   	var word=arrayArray[10][z].word;
//   	if(word==quoteWordList[0])
//   	{
//   				foundFirst=true;
//   				startindex= arrayArray[10][z].wordIndex;;
  			
//  	}
//   	else
//   	{
//   		if(foundFirst)
//   		{ 	
//   			if(word==quoteWordList[numWordsInQuote])
//   			{
//   			endindex=(word.wordIndex!==undefined && word.wordIndex!==null)?word.wordIndex: -1;
//   			}
  			
//   		}
//   	}
//   	}
//   	var holder=argPassageQuestionNumber-1;
// 	this.set("argQAO",{"questionNumber":argPassageQuestionNumber,
//   				"questionIndex": holder,
// 				questionPart: this.quoteMatches[i],
// 				"question": argPassageQuestion,
// 				"questionSubpart": questionPart,
// 				"quoteStartIndex": startindex,
// 				"quoteEndIndex": endindex,
// 				"quote": this.quoteMatches[i], 
// 				"fcid": fcid
//   			});
// 	console.log(startindex, "end Index");
// 			 startindex=-1;
//    			endindex=-1;
// 			return this.argQAO;

// 		}
// 	}

// }, 
	
   




  //  while(!foundMatch)
  //  {
  //   while(passageWordList[j] != quoteWordList[0] && j < numWordsInPassage)
  //   {
  //    j++;
  //   }
  //   var startIndex = j;
  //   //found match for first word or ran out of passage
  //   while(k < numWordsInQuote && j < numWordsInPassage)
  //   {
  //    if(quoteWordList[k] == passageWordList[j])
  //    {
  //     //matching continues
  //     j++; k++;
  //    }
  //    else
  //    {
  //     console.log("Error: failed to match word " + quoteWordList[k]);
  //     break;
  //    }
  //   }
  //   if(k == numWordsInQuote)
  //   {
  //    //we found whole quote
  //    foundMatch = true;
  //    var quoteObj = {"startIndex": startIndex, "endIndex": startIndex + numWordsInQuote - 1};
  //    console.log(quoteObj);
  //   }
  //   if(j == numWordsInPassage)
  //   {
  //    console.log("Error: ran out of passage without finding quote ", quote);
  //    break;
  //   }

  //  }
  // }
 // },
 	
		 	
	

 		// var selfie=this;
 		// this.findLineNumbers();
 		// var ref = new Firebase("https://focusedstaging1.firebaseio.com/reading/questions/");
 		// ref.child(question.fcid).set(savingArray[i]);
 


_computePatterns: function(one,two,three,one_a,two_a,three_a){

 	return [one, two, three, one_a, two_a, three_a];
 }
        
});
</script>
</dom-module>