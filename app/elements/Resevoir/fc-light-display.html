<dom-module id="fc-light-display">
<template>
<style>
:host {
	position: relative;
	max-height: 750px important!;

    }
div.line-number {
	width: 18px;
	height: 20px;
	line-height: 1.0;
	font-size: 1em;
	/*font-size: 1.25em;*/
	font-family: merriweather;
	font-weight: 500;
	font-style: italic;
	padding: 2px 2px;
	margin: 2px;


    }
    .blurb-class{
    	max-width: 420px; 
    	padding: 2px 0px 2px 3px; 
    	font-size: .8em; 
    	line-height: 1.00;
    	font-style: oblique;

    }

    .highlighted {
	background: yellow;
    }
paper-header-panel{
	position: absolute;
}
    div.text {
	line-height: 1.0;
	font-size: 1em;
     /* font-size: 1.25em;*/
	font-family: merriweather;
	font-weight: 500;
	padding: 2px 0px 2px 2px;
	margin: 0px 0px 0px 0px;
	min-height: 1800px !important;
	display: flex;
	min-width: 300px !important;
	max-width: 620px !important;
    }	

</style>
	<paper-header-panel class="vertical layout flex wrap text" mode="waterfall" style="margin: 4px; padding:6px; border: 1px ridge silver; max-width: 620px; min-height: 360px; max-height: 750px !important;">
	<!--passage header and content select menu-->
		<div 
			class="paper-header" 
			id="headerPanel" 
			style="margin-bottom:4px; border: 1px solid #3f51b5; min-height: 60px; max-height 120px; background: #ff4081"
			> 
			<array-selector 
				id="selector" 
				items="{{passagesWordArrays}}" 
				selected="{{selected}}" 
				multi 
				toggle>
			</array-selector>

	    	<fc-dropdown-menu 
		  		style="min-width: 240px;" 
		  		on-select="toggleSelection" 
		  		id="passagesList" 
		  		data-source="{{passagesWordArrays}}" 
		  		selected="{{selected}}"
		  		>
		  	</fc-dropdown-menu>
		</div>
	<!--end of passage header and content select menu-->
	<!--sgl/dble column content&line number horiz sec.-->
	<div 
		class="layout horizontal flex content super-content" style="min-height: 300px; max-height: 675px;">
		<!--blurb and passage-->
		<div class="layout vertical flex">
			<section class="blurb-class">[[selected.0.passageBlurb]]</section>
			<div class="layout horizontal flex nowrap container" style="max-width: 660px; min-height: 5000px; padding: 2px 0px 12px 8px;">
				<div id="line-numbers" class="layout vertical line-number">
				  <div class="line-numbers" id="linesA1">Lines</div>
				    <template is="dom-repeat" items="{{lineNumberArray}}" filter="{{_numberFilter(lineNumbers)}}">
					  <span hidden="{{!item.show}}" id$="LN{{item.number}}">{{item.number}}</span>
					  <span hidden="{{item.show}}">&nbsp</span>
				    </template> 
				</div>
					  <!--passage-1-column-1 container-->
			    <div id="firstColumn" class="layout horizontal flex wrap text">
					<article id="textColumnOne" style="margin: 2px 2px 2px 2px; padding: 0ps 3px 0px 4px; max-width: 620px;">
					  	<template is="dom-repeat" items="{{selected}}"  filter="">
							<template is="dom-if" if="{{item.newPara}}">
						  	<br><span>&nbsp&nbsp&nbsp&nbsp</span>
							</template>
							<a id$="A[[item.wordIndex]]" hidden$="{{item.is_transitionWord}}">{{item.word}}</a>
					     	<a id$="A[[item.wordIndex]]_transition" hidden$="{{!item.is_transitionWord}}" >{{item.word}}</a><!--style="background:green;"-->
					  </template>
					  <br class="line-numbers">
					  <hr>
					  <div id="focusedMark" class="right-justified line-numbers" style="float:right; text-align: right;" id="singleColumnBounder"> Focused Coaching (c) 2016</div>
					</article>
			    </div>
			</div>
		</div>
		<!--region for a second passage column-->
	</div>
	<!--end content sect; this was single column ONLY!-->
</paper-header-panel>		 
</template>
<script>
'use strict';

    (function() {
	class fcLightDisplay {
	   get behaviors() { 
	    return [
		  Polymer.IronResizableBehavior, 
		  FCBehaviors.FCFirepadBehavior,
		  FCBehaviors.PassageDataBehavior
		  ];
	   }
	   beforeRegister() {

		this.is = 'fc-light-display';
	    this.properties = {
	  
	    estimatedHeight: {
		type: Number,
		value: function(){
		  var estimatedHeight=Math.ceil(screen.height*.895);
		 return estimatedHeight;
		},
		notify: true,
		reflectToAttribute: true 
	    }, 
	    
	    lineNumberArray: {
		  type: Array,
		  computed: '_computeLineNumberArray(passageOneWordArray, lineNumbers)',
		  notify: true
		  },
		  isFirePad: {
		  	type: Boolean,
		  	value: function(){
		  		return true;

		  	},
		  	notify: true
		  },

	doublePassage: {
	  type: Boolean,
	  value: false,
	  notify: true, 
	  reflectToAttribute: true
	},
	secondPassage: {
	  type: Boolean,
	  value: false,
	  notify: true,
	  reflectToAttribute: true

	},

	shorterThan550:{
	  type: Boolean,
	  value: false, 
	  notify: true,
	  reflectToAttribute: true
	}, 

	lineNumbers: {
		type: Number,
		value: function(){
		return 180;
		},
		notify: true
	}, 
	
	hitSaveOne:{
		type: Boolean,
		value: function(){
			return false;
		},
		notify: true
	}
	 
		  
		
    };

	  this.listeners = {'iron-resize': '_onIronResize'

	
	    };
	   
	

	 
	     }
	 
	  _computeLineNumberArray(passageOneWordArray, lineNumbers){
		  this.arrayNums=[]
		  for(var i=1; i <= 180; i++)
		     {
			var showLine =  i % 5 ? false: true;
			this.push('arrayNums',{'number': i, 'show': showLine});
			}
			 this.addEventListener("mouseover", this.setMeasureParams);
     		this.notifyResize();
			return this.arrayNums;
			}
     _computeValue(myValue){
		return myValue;
	  }

	 _onIronResize(){
	 	var ht=Math.floor((this.$.focusedMark.getBoundingClientRect().top-this.$.linesA1.getBoundingClientRect().top)/this.$.focusedMark.getBoundingClientRect().height)-2;
	     console.log(ht);
	     if(!isNaN(ht)){this.set("lineNumbers", ht);}

	 }
	  setMeasureParams(){
	  this._computeLineNumberArray();

	      var ht=Math.floor((this.$.focusedMark.getBoundingClientRect().top-this.$.linesA1.getBoundingClientRect().top)/this.$.focusedMark.getBoundingClientRect().height)-2;
	     console.log(ht);
	     if(!isNaN(ht)){this.set("lineNumbers", ht) && this.this.removeEventListener("mouseover", this._onIronResize);}

	  }

	

_theContentFilter(firstWordIndex, lastWordIndex) {
	// if(!isNaN(lastWordIndex)){
	//   return (item) =>{
	// 	return (item.wordIndex >= firstWordIndex && item.wordIndex <= lastWordIndex);
	//   };
	// } else {
	//   return (item) =>{
		return true;
	//   };
	// }
  }


  _numberFilter(lineNumbers) {
	return (item) =>{
	  return (item.number <= lineNumbers);
	    };
	  } 
	
	}
    Polymer(fcLightDisplay);
 
  })();
</script>
</dom-module>