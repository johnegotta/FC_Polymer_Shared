<script>
window.FCBehaviors = window.FCBehaviors || {};
FCBehaviors.FcPassageLocalDataBehavior = {
listeners:{"questionKey":"setQuestionKey"},
properties:{
	selected: {
		type: Object,
		value: function(){return {};},
		observer: "observeSelected",
		notify: true
	},
	selectedItem:{
		type:String,
		value: function(){return "";},
		notify: true
	},
	questionKey:{
		type: String,
		value: function(){return "";},
		notify: true,

	},
	passageTitleForMenu:{
		type: String,
		value: function(){return "";},
		notify: true,
	},

	 menuItemArray: {
   		type: Array,
		value: function(){
			var rValue = (this.menuItemArray ==[] && localStorage.getItem("localPassages")!==undefined)? localStorage.getItem("localPassages"): [];
			return rValue;},
    	notify: true
    }

},//end of properties

	_getAndSetLocalOrDatabase:function(){
		var gotLocalPassages=	localStorage.getItem('localPassages');
			gotLocalPassages = JSON.parse(gotLocalPassages);
			console.log(gotLocalPassages[0].questionItemKey);
			this.set("questionKey",gotLocalPassages[0].questionItemKey);
			this.set("passageTitleForMenu",gotLocalPassages[0].menuItem);
	 (gotLocalPassages!=undefined)?this.set("menuItemArray",gotLocalPassages):this._getFromFireBaseAndSetLocal();
	
		},
attached: function(){
		this._getAndSetLocalOrDatabase();
		},

	observeSelected(newVal, oldVal){
		if(newVal.key){
		this.fire("newPassageSelected", {"newSelected": newVal});
			}
	}, 
	
	 _getFromFireBaseAndSetLocal: function(){
		var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/passages");
		var self=this;
		ref.on("value", function(snapshot){
			var localContent = snapshot.val();
			var keys = Object.keys(localContent);
			var counter = keys.length;
			for(var i=0; i<counter; i++)
			{	var qik = keys[i].toString() + "Qs"
				self.push("menuItemArray", 
				{
					"itemValue": localContent[keys[i]].wordArray,
					"menuItem": localContent[keys[i]].menuItem,
					"key": keys[i],
					"questionItemKey":qik 
				});
		  //  console.log(self.menuItemArray[i].key, "I am the passage", self.menuItemArray[i].questionItemKey);
		    }
		    var holder = self.menuItemArray;
		   holder= JSON.stringify(holder);
		  	localStorage.setItem('localPassages', holder);
		});		 
	  },







	};//end of file
</script>