<dom-module id="fc-passage-question-display">
<style>
:host {
	padding-left: 12px;
	margin-left: 6px;
	position: relative;
	top: 0px;
	font-size: 16pt;
	bottom: 0px;
	height: 99vh;
	right: 0px;
	left: 0px;
	display: flex;
	min-width: 96%;
	max-width: 99vw;
    }
  
    .highlighted {
	background: yellow;
    }

</style>
<template>

<paper-header-panel class="vertical layout flex" style="height: 93vh; margin:12px 10px; padding: 6px 6px 24px 6px; font-weight: 600; background: #fff; border: 3px solid silver; color: #000088;">
	    <paper-material class="paper-header header-panel head horizontal layout left-justified" style="min-hieght: 60px; max-height: 90px; padding: 12px 6px 12px 6px; font-weight: 600; background: aliceblue; font-size: 20px; border-bottom: 1px solid #000088; color: #000088;">
	    <div class="vertical layout">
	    <section>Questions for Passage: <span>[[selectedItem._t]][[selectedItem._sec]][[selectedItem._p]]</span></section>
	    <section> Question Location: [[selectedItem.qz]]</section>
	    </div>
	    <section class="horizontal layout flex nowrap">	
			<array-selector 
				id="selector" 
				items="{{menuItemArray}}" 
				selected="{{selected}}"

				multi 
				toggle>
			</array-selector>

	    	<fc-dropdown-menu 
	    		class="flex layout horizontal"							
		  		style="max-width: 60px;" 
		  		on-select="toggleSelection" 
		  		id="questionsForPassages"
		  		data-source="{{menuItemArray}}" 
		  		selected="{{selectedItem}}"
		  		value$="{{selectedItem.key}}"
		  		>
		  	</fc-dropdown-menu>
		</section>
	  </paper-material>

	   <div class="layout vertical flex" style="height: 1900px;">
	     		<section 
	     			class="blurb-class"
	     			>

	     		</section>

<div class="layout horizontal flex nowrap container" style="min-height: 5000px; padding: 2px 0px 6px 8px;">
<section class="vertical layout wrap" style="height: 180vh;" name="Bc">
<fc-editable-question-template style="max-width: 100%;" data-source$="{{selectedItem}}"></fc-editable-question-template>
</section>
	  </div>
	  </paper-header-panel> 
	</template>
<script>
Polymer({
	is: "fc-passage-question-display",
	behaviors:[FCBehaviors.QuLocalDataBehavior],
	properties: {
		// selected: {
		// 	notify: true,
		// },
		// selectedItem: {
		// 	type: Array,
		// 	notify: true
		// 	},
		sharedSelection: {
			type: String,
			notify: true,
			reflectToAttribute: true
		},
		passageTypeSelected: {
			type: String,
			value: function(){return "fiction";},
			notify: true
		},
		menuItemArray: {
			type: Array,
			value: function(){
				var rValue = (this.menuItemArray ==[] && localStorage.getItem("localQuestions")!==undefined)? localStorage.getItem("localQuestions"): this._getAndSetData();
				return rValue;
			},
    		notify: true
    	}
	},

	coincideChange: function(){
		var counter = this.menuItemArray.length;
		for(var i=0; i<counter; i++){
			if(this.menuItemArray[i].key ==this.sharedSelection){
				//alert("We have a 	match");
				this.set("selectedItem", this.menuItemArray[i]);
				this.set("selected", this.selectedItem);
				}
		}
	},
	shareSelections: function(){
		this.set('sharedSelection', this.menuItemArray.key);

	},

	attached: function(){
		this._getAndSetData();
	},

	_getAndSetData:function(){
		var gotLocalQuestions=	localStorage.getItem('localQuestions');
			gotLocalQuestions = JSON.parse(gotLocalQuestions);
	 (gotLocalQuestions!=undefined)?this.set("menuItemArray",gotLocalQuestions) && 	this.set("itemSelected", gotLocalQuestions[0]):this._getDataAndSetLocal();
	console.log(this.menuItemArray);
	},

	 _getDataAndSetLocal: function(){
		var ref = new Firebase("https://focusedcoaching.firebaseio.com/reading/questions");
		var self=this;
		ref.on("value", function(snapshot){
			var locQs = snapshot.val();
			var keys = Object.keys(locQs);
			var counter = keys.length;
			for(var i=0; i<counter; i++)
			{	var relatedContentKey = locQs[keys[i]]._t.toString() + locQs[keys[i]]._sec.toString() +locQs[keys[i]]._p.toString();
				self.push("menuItemArray", 
				{
					"itemValue": locQs[keys[i]],
					"menuItem": keys[i],
					"key": keys[i],
					"relatedContentKey": relatedContentKey 
				});
		    console.log(self.menuItemArray[i].key);
		    }
		    var holder = self.menuItemArray;
		   holder= JSON.stringify(holder);
		  	localStorage.setItem('localQuestions', holder);
		});
		 
	  }
});
</script>
</dom-module>
